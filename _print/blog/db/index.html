<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/blog/db/><link rel=alternate type=application/rss+xml href=https://pigsty.io/blog/db/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Database | PIGSTY</title><meta name=description content="Articles about the database industry - trends, news, research, concepts, and best practices"><meta property="og:url" content="https://pigsty.io/blog/db/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="Database"><meta property="og:description" content="Articles about the database industry - trends, news, research, concepts, and best practices"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Database"><meta itemprop=description content="Articles about the database industry - trends, news, research, concepts, and best practices"><meta itemprop=dateModified content="2026-01-08T18:48:49+08:00"><meta itemprop=keywords content="Database,BLOG"><meta name=twitter:card content="summary"><meta name=twitter:title content="Database"><meta name=twitter:description content="Articles about the database industry - trends, news, research, concepts, and best practices"><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class="td-section td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class="nav-link active" href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/blog/db/>Return to the regular view of this page</a>.</p></div><h1 class=title>Database</h1><div class=lead>Articles about the database industry - trends, news, research, concepts, and best practices</div><ul><li><a href=#pg-6d8b8833515a7775897248b4af83636c>Claude Code Quick Start: Using Alternative LLMs at 1/10 the Cost</a></li><li><a href=#pg-977f2289aaf2ccdbaac84fb31c166f97>Data 2025: Year in Review with Mike Stonebraker</a></li><li><a href=#pg-576daee67e5b257e291ad8466df578fc>What Database Does AI Agent Need?</a></li><li><a href=#pg-5633aa0bf628d2825aec2c8c39a067a5>MySQL and Baijiu: The Internet’s Obedience Test</a></li><li><a href=#pg-9412bb07bbd093de6b26165953bbda35>Victoria: The Observability Stack That Slaps the Industry</a></li><li><a href=#pg-32b9c24fd5f6e732d5751832e9e22527>MinIO Is Dead. Who Picks Up the Pieces?</a></li><li><a href=#pg-39c19ee240fae7af824141b30fb47508>MinIO is Dead</a></li><li><a href=#pg-30d46ca3c78d6e29fdb9c3dcfb789096>When Answers Become Abundant, Questions Become the New Currency</a></li><li><a href=#pg-b435e1d520f785ac61dba93fa62f2cae>On Trusting Open-Source Supply Chains</a></li><li><a href=#pg-9bf0663a585c599a3124db83b8c2deca>Don't Run Docker Postgres for Production!</a></li><li><a href=#pg-0c502e16243bb262cdd86482d44ab0dc>DDIA 2nd Edition, Chinese Translation</a></li><li><a href=#pg-e767ffbf0ade7adbbb3e894363d5c2dc>Column: Database Guru</a></li><li><a href=#pg-4e0d2bc85b233b048f8b114f131c596a>Dongchedi Just Exposed “Smart Driving.” Where’s Our Dongku-Di?</a></li><li><a href=#pg-8f1e2c6df6cb5233cc88950f2fa1acfc>Google AI Toolbox: Production-Ready Database MCP is Here?</a></li><li><a href=#pg-0f3f9ae0863696e249fba6210db8746f>Where Will Databases and DBAs Go in the AI Era?</a></li><li><a href=#pg-d776e9db95708b18d199c4de6e9ae4f3>Stop Arguing, The AI Era Database Has Been Settled</a></li><li><a href=#pg-6ba79323f93adb767352bc6b2f297ddb>Open Data Standards: Postgres, OTel, and Iceberg</a></li><li><a href=#pg-bf048c9530d55b60185e6f4c8a0c1df9>The Lost Decade of Small Data</a></li><li><a href=#pg-dd2269204fca84a0bed2486aa44ac5d4>Scaling Postgres to the Next Level at OpenAI</a></li><li><a href=#pg-359f327632677501a3c1920db3a32a4b>How Many Shops Has etcd Torched?</a></li><li><a href=#pg-7c07f1baaa53dfe3e61de3005f67c082>In the AI Era, Software Starts at the Database</a></li><li><a href=#pg-efd48be9faa3ff9f78f1314b955e9fd5>MySQL vs. PostgreSQL @ 2025</a></li><li><a href=#pg-c4df8de5db8bf34946dc032b369d468f>Database Planet Collision: When PG Falls for DuckDB</a></li><li><a href=#pg-8b6f59a6d7382c6db9288e342d13e95a>Comparing Oracle and PostgreSQL Transaction Systems</a></li><li><a href=#pg-3574d7e5711eb199ea28caa0646e9e4a>Database as Business Architecture</a></li><li><a href=#pg-2f0eb2d4492366bac61fc6120846eb93>7 Databases in 7 Weeks (2025)</a></li><li><a href=#pg-aaf2123d302c34b5420e80384b81f211>Solving Poker 24 with a Single SQL Query</a></li><li><a href=#pg-62363462242f428e810f0ff6e9957079>Self-Hosting Supabase on PostgreSQL</a></li><li><a href=#pg-eaa681fd37b80cda6e42dfc20bcbeaf0>Modern Hardware for Future Databases</a></li><li><a href=#pg-10c969208d55922688ef8f22e3271e25>Can MySQL Still Catch Up with PostgreSQL?</a></li><li><a href=#pg-69a610dd2291dacefb18dc7cdcd46da2>Open-Source "Tyrant" Linus's Purge</a></li><li><a href=#pg-a2b17ced6f6e514360c46bb14f581713>Optimize Bio Cores First, CPU Cores Second</a></li><li><a href=#pg-4a0eef4d9e255660adc67a5393533288>MongoDB Has No Future: Good Marketing Can't Save a Rotten Mango</a></li><li><a href=#pg-460de0fdfb5eb9112894cfe3047d5d0f>MongoDB: Now Powered by PostgreSQL?</a></li><li><a href=#pg-90c0fcdf4027da83a4744b5699d3cd9b>Switzerland Mandates Open-Source for Government Software</a></li><li><a href=#pg-19494097f0edd1d59fd940b2a5026866>MySQL is dead, Long live PostgreSQL!</a></li><li><a href=#pg-36f375fd37b38b81fbc16f46b093587b>CVE-2024-6387 SSH Vulnerability Fix</a></li><li><a href=#pg-7b9962c18bde04fcc3217523fd2325f6>Can Oracle Still Save MySQL?</a></li><li><a href=#pg-93ceebd0266c7994861c955faa1e194d>Oracle Finally Killed MySQL</a></li><li><a href=#pg-aa9633901d56337ce9489e25283c0e93>MySQL Performance Declining: Where is Sakila Going?</a></li><li><a href=#pg-e0a1c2eedffe3df00d35ee7c51d671fc>Can Chinese Domestic Databases Really Compete?</a></li><li><a href=#pg-565d53bf218c62a92841cfa1733a4a22>The $20 Brother PolarDB: What Should Databases Actually Cost?</a></li><li><a href=#pg-2f9d3a3c7bc34c83e43aa467cc47edce>Redis Going Non-Open-Source is a Disgrace to "Open-Source" and Public Cloud</a></li><li><a href=#pg-37de8c98e0077491a5dcc4c1bf949ec8>How Can MySQL's Correctness Be This Garbage?</a></li><li><a href=#pg-3085215d905f9975fefe74e9dc129cba>Database in K8S: Pros & Cons</a></li><li><a href=#pg-370ebd3d2007a7dd41ff3c4fa833b7aa>Are Specialized Vector Databases Dead?</a></li><li><a href=#pg-38a45a64085e625531d57d4a2d04f7d5>Are Databases Really Being Strangled?</a></li><li><a href=#pg-cd7f63f1abd791104bd257d3714fd3c8>Which EL-Series OS Distribution Is Best?</a></li><li><a href=#pg-05e4c736ef6a276915b122a7c6593a4b>What Kind of Self-Reliance Do Infrastructure Software Need?</a></li><li><a href=#pg-c4dc125c4dfcb370c1becf943a2038be>Back to Basics: Tech Reflection Chronicles</a></li><li><a href=#pg-1ef05570d6ebab14417fb403e0bc0ce8>Database Demand Hierarchy Pyramid</a></li><li><a href=#pg-0125c5ebbbe2e9c1c12f5b8e60eabe1c>Are Microservices a Bad Idea?</a></li><li><a href=#pg-564f2bc59ef0064fb9b5b78f3ee282ef>NewSQL: Distributive Nonsens</a></li><li><a href=#pg-64cb6ba6751d68792d8b25958525d973>Time to Say Goodbye to GPL</a></li><li><a href=#pg-65bb532e2949268a0bd020d4878070be>Is running postgres in docker a good idea?</a></li><li><a href=#pg-f32afa47c9942c188f3de7f42228d87b>Understanding Time - Leap Years, Leap Seconds, Time and Time Zones</a></li><li><a href=#pg-d8949c62ff071aa82e551077d044affe>Understanding Character Encoding Principles</a></li><li><a href=#pg-61a26df3028fb51a243921297c170783>Concurrency Anomalies Explained</a></li><li><a href=#pg-ade689d300c8e645854023963c47d580>Blockchain and Distributed Databases</a></li><li><a href=#pg-0deaa1202a01c3a259cae90143e4afee>Consistency: An Overloaded Term</a></li><li><a href=#pg-af84b03927b12ebc4cf08b933702c27b>Why Study Database Principles</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-6d8b8833515a7775897248b4af83636c>Claude Code Quick Start: Using Alternative LLMs at 1/10 the Cost</h1><div class=lead>How to install and use Claude Code? How to achieve similar results at 1/10 of Claude&rsquo;s cost with alternative models? A one-liner to get CC up and running!</div><div class="td-byline mb-4">By <b>Ruohang Feng</b> |
<time datetime=2026-01-04 class=text-body-secondary>January 04, 2026</time></div><p><a href=https://vonng.com/en/db/claude-code-intro/><img src=/img/hero/db/claude-code-intro.jpg alt=featured></a></p><p>How to install and use Claude Code? How to achieve similar results at 1/10 of Claude&rsquo;s cost with alternative models? A one-liner to get CC up and running! <a href=https://vonng.com/en/db/claude-code-intro/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-977f2289aaf2ccdbaac84fb31c166f97>Data 2025: Year in Review with Mike Stonebraker</h1><div class=lead>A conversation between Mike Stonebraker (Turing Award Winner, Creator of PostgreSQL), Andy Pavlo (Carnegie Mellon), and the DBOS team.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-12-24 class=text-body-secondary>December 24, 2025</time></div><p><a href=https://vonng.com/en/db/db-year-review-2025/><img src=/img/hero/db/db-year-review-2025.jpg alt=featured></a></p><p>A conversation between Mike Stonebraker (Turing Award Winner, Creator of PostgreSQL), Andy Pavlo (Carnegie Mellon), and the DBOS team. <a href=https://vonng.com/en/db/db-year-review-2025/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-576daee67e5b257e291ad8466df578fc>What Database Does AI Agent Need?</h1><div class=lead>The bottleneck for AI Agents isnt in database engines but in upper-layer integration. Muscle memory, associative memory, and trial-and-error courage will be key.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-12-21 class=text-body-secondary>December 21, 2025</time></div><p><a href=https://vonng.com/en/db/agent-native-db/><img src=/img/hero/db/agent-native-db.jpg alt=featured></a></p><p>The bottleneck for AI Agents isnt in database engines but in upper-layer integration. Muscle memory, associative memory, and trial-and-error courage will be key. <a href=https://vonng.com/en/db/agent-native-db/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-5633aa0bf628d2825aec2c8c39a067a5>MySQL and Baijiu: The Internet’s Obedience Test</h1><div class=lead>MySQL is to the internet what baijiu is to China: harsh, hard to swallow, yet worshipped because culture demands obedience. Both are loyalty tests—will you endure discomfort to fit in?</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/SBZRQCCZ7PmsbDSgcRaqBQ>WeChat</a></b> |
<time datetime=2025-12-20 class=text-body-secondary>December 20, 2025</time></div><p><a href=https://vonng.com/en/db/mysql-baijiu/><img src=/img/hero/db/mysql-baijiu.jpg alt=featured></a></p><p>MySQL is to the internet what baijiu is to China: harsh, hard to swallow, yet worshipped because culture demands obedience. Both are loyalty tests—will you endure discomfort to fit in? <a href=https://vonng.com/en/db/mysql-baijiu/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-9412bb07bbd093de6b26165953bbda35>Victoria: The Observability Stack That Slaps the Industry</h1><div class=lead>VictoriaMetrics is brutally efficient—using a fraction of Prometheus + Loki’s resources for multiples of the performance. Pigsty v4 swaps to the Victoria stack; here’s the beta for anyone eager to try it.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/RLN0DMzfvSibkGgq2VRcoQ>WeChat</a></b> |
<time datetime=2025-12-17 class=text-body-secondary>December 17, 2025</time></div><p><a href=https://vonng.com/en/db/victoria-stack/><img src=/img/hero/db/victoria-stack.jpg alt=featured></a></p><p>VictoriaMetrics is brutally efficient—using a fraction of Prometheus + Loki’s resources for multiples of the performance. Pigsty v4 swaps to the Victoria stack; here’s the beta for anyone eager to try it. <a href=https://vonng.com/en/db/victoria-stack/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-32b9c24fd5f6e732d5751832e9e22527>MinIO Is Dead. Who Picks Up the Pieces?</h1><div class=lead>MinIO just entered maintenance mode. What replaces it? Can RustFS step in? I tested the contenders so you don’t have to.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/A7bAFSAk3dte7QfXu5qHQw>WeChat</a></b> |
<time datetime=2025-12-08 class=text-body-secondary>December 08, 2025</time></div><p><a href=https://vonng.com/en/db/minio-alternative/><img src=/img/hero/db/minio-alternative.jpg alt=featured></a></p><p>MinIO just entered maintenance mode. What replaces it? Can RustFS step in? I tested the contenders so you don’t have to. <a href=https://vonng.com/en/db/minio-alternative/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-39c19ee240fae7af824141b30fb47508>MinIO is Dead</h1><div class=lead>MinIO announces it is entering maintenance mode, the dragon-slayer has become the dragon – how MinIO transformed from an open-source S3 alternative to just another commercial software company</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Ruohang Feng</a>（<a href=https://vonng.com/en/>@Vonng</a>）| <a href=https://mp.weixin.qq.com/s/aBUwEMxZ_xKmHisaaT4uWw>Wechat</a></b> |
<time datetime=2025-12-04 class=text-body-secondary>December 04, 2025</time></div><p><a href=https://vonng.com/en/db/minio-is-dead/><img src=/img/hero/db/minio-is-dead.jpg alt=featured></a></p><p>MinIO announces it is entering maintenance mode, the dragon-slayer has become the dragon – how MinIO transformed from an open-source S3 alternative to just another commercial software company <a href=https://vonng.com/en/db/minio-is-dead/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-30d46ca3c78d6e29fdb9c3dcfb789096>When Answers Become Abundant, Questions Become the New Currency</h1><div class=lead>Your ability to ask questions—and your taste in what to ask—determines your position in the AI era. When answers become commodities, good questions become the new wealth. We are living in the moment this prophecy comes true.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-12-02 class=text-body-secondary>December 02, 2025</time></div><p><a href=https://vonng.com/en/db/ai-question/><img src=/img/hero/db/ai-question.jpg alt=featured></a></p><p>Your ability to ask questions—and your taste in what to ask—determines your position in the AI era. When answers become commodities, good questions become the new wealth. We are living in the moment this prophecy comes true. <a href=https://vonng.com/en/db/ai-question/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-b435e1d520f785ac61dba93fa62f2cae>On Trusting Open-Source Supply Chains</h1><div class=lead>In serious production you can’t rely on an upstream that explicitly says “no guarantees.” When someone says “don’t count on me,” the right answer is “then I’ll run it myself.”</div><div class="td-byline mb-4">By <b>Feng Ruohang</b> |
<time datetime=2025-11-22 class=text-body-secondary>November 22, 2025</time></div><p><a href=https://vonng.com/en/db/tuna-mirror-site/><img src=/img/hero/db/tuna-mirror-site.jpg alt=featured></a></p><p>In serious production you can’t rely on an upstream that explicitly says “no guarantees.” When someone says “don’t count on me,” the right answer is “then I’ll run it myself.” <a href=https://vonng.com/en/db/tuna-mirror-site/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-9bf0663a585c599a3124db83b8c2deca>Don't Run Docker Postgres for Production!</h1><div class=lead>Tons of users running the official docker postgres image got burned during recent minor version upgrades. A friendly reminder: think twice before containerizing production databases.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com/en/>Vonng</a>（<a href=https://github.com/Vonng>@Vonng</a>）</b> |
<time datetime=2025-11-20 class=text-body-secondary>November 20, 2025</time></div><p><a href=https://vonng.com/en/db/no-docker-pg/><img src=/img/hero/db/no-docker-pg.jpg alt=featured></a></p><p>Tons of users running the official docker postgres image got burned during recent minor version upgrades. A friendly reminder: think twice before containerizing production databases. <a href=https://vonng.com/en/db/no-docker-pg/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-0c502e16243bb262cdd86482d44ab0dc>DDIA 2nd Edition, Chinese Translation</h1><div class=lead>The second edition of Designing Data-Intensive Applications has released ten chapters. I translated them into Chinese and rebuilt a clean Hugo/Hextra web version for the community.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-08-10 class=text-body-secondary>August 10, 2025</time></div><p><a href=https://vonng.com/en/db/ddia-v2/><img src=/img/hero/db/ddia-v2.jpg alt=featured></a></p><p>The second edition of Designing Data-Intensive Applications has released ten chapters. I translated them into Chinese and rebuilt a clean Hugo/Hextra web version for the community. <a href=https://vonng.com/en/db/ddia-v2/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-e767ffbf0ade7adbbb3e894363d5c2dc>Column: Database Guru</h1><div class=lead>The database world is full of hype and marketing fog. This column cuts through it with blunt commentary on industry trends and product reality.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-08-08 class=text-body-secondary>August 08, 2025</time></div><p><a href=https://vonng.com/en/db/guru/><img src=/img/hero/db/guru.jpg alt=featured></a></p><p>The database world is full of hype and marketing fog. This column cuts through it with blunt commentary on industry trends and product reality. <a href=https://vonng.com/en/db/guru/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4e0d2bc85b233b048f8b114f131c596a>Dongchedi Just Exposed “Smart Driving.” Where’s Our Dongku-Di?</h1><div class=lead>Imagine a “closed-course” shootout for domestic databases and clouds, the way Dongchedi just humiliated 30+ autonomous cars. This industry needs its own stress test.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/qUL75eq9ciZqE_WJ1UofYg>WeChat</a></b> |
<time datetime=2025-07-26 class=text-body-secondary>July 26, 2025</time></div><p><a href=https://vonng.com/en/db/car-autopilot-test/><img src=/img/hero/db/car-autopilot-test.jpg alt=featured></a></p><p>Imagine a “closed-course” shootout for domestic databases and clouds, the way Dongchedi just humiliated 30+ autonomous cars. This industry needs its own stress test. <a href=https://vonng.com/en/db/car-autopilot-test/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-8f1e2c6df6cb5233cc88950f2fa1acfc>Google AI Toolbox: Production-Ready Database MCP is Here?</h1><div class=lead>Google recently launched a database MCP toolbox, perhaps the first production-ready solution.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-07-09 class=text-body-secondary>July 09, 2025</time></div><p><a href=https://vonng.com/en/db/google-mcp/><img src=/img/hero/db/google-mcp.jpg alt=featured></a></p><p>Google recently launched a database MCP toolbox, perhaps the first production-ready solution. <a href=https://vonng.com/en/db/google-mcp/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-0f3f9ae0863696e249fba6210db8746f>Where Will Databases and DBAs Go in the AI Era?</h1><div class=lead>Who will be revolutionized first - OLTP or OLAP? Integration vs specialization, how to choose? Where will DBAs go in the AI era? Feng&rsquo;s views from the HOW 2025 conference roundtable, organized and published.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-06-30 class=text-body-secondary>June 30, 2025</time></div><p><a href=https://vonng.com/en/db/ai-dba-job/><img src=/img/hero/db/ai-dba-job.jpg alt=featured></a></p><p>Who will be revolutionized first - OLTP or OLAP? Integration vs specialization, how to choose? Where will DBAs go in the AI era? Feng&rsquo;s views from the HOW 2025 conference roundtable, organized and published. <a href=https://vonng.com/en/db/ai-dba-job/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-d776e9db95708b18d199c4de6e9ae4f3>Stop Arguing, The AI Era Database Has Been Settled</h1><div class=lead>The database for the AI era has been settled. Capital markets are making intensive moves on PostgreSQL targets, with PG having become the default database for the AI era.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-06-03 class=text-body-secondary>June 03, 2025</time></div><p><a href=https://vonng.com/en/db/db-for-ai/><img src=/img/hero/db/db-for-ai.jpg alt=featured></a></p><p>The database for the AI era has been settled. Capital markets are making intensive moves on PostgreSQL targets, with PG having become the default database for the AI era. <a href=https://vonng.com/en/db/db-for-ai/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-6ba79323f93adb767352bc6b2f297ddb>Open Data Standards: Postgres, OTel, and Iceberg</h1><div class=lead>Three emerging standards in the data world: Postgres, OpenTelemetry, and Iceberg. Postgres is already the de facto standard.</div><div class="td-byline mb-4">By <b>Paul Copplestone</b> |
<time datetime=2025-05-27 class=text-body-secondary>May 27, 2025</time></div><blockquote><p>Author: <strong>Paul Copplestone</strong> (Supabase CEO) | Original: <a href=https://supabase.com/blog/open-data-standards-postgres-otel-iceberg>Open Data Standards: Postgres, OTel, and Iceberg</a></p></blockquote><p><a href=https://vonng.com/cn/db/open-data-standard/><img src=/img/hero/db/open-data-standard.jpg alt=featured></a></p><p>Three emerging standards in the data world: Postgres, OpenTelemetry, and Iceberg. Postgres is already the de facto standard. <a href=https://vonng.com/cn/db/open-data-standard/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-bf048c9530d55b60185e6f4c8a0c1df9>The Lost Decade of Small Data</h1><div class=lead>If DuckDB had launched in 2012, the great migration to distributed analytics might never have happened. Data isnt that big after all.</div><div class="td-byline mb-4">By <b>Hannes Mühleisen</b> |
<time datetime=2025-05-23 class=text-body-secondary>May 23, 2025</time></div><blockquote><p>Author: <strong>Hannes Mühleisen</strong> (DuckDB Labs) | Original: <a href=https://duckdb.org/2025/05/19/the-lost-decade-of-small-data.html>The Lost Decade of Small Data</a></p></blockquote><p><a href=https://vonng.com/cn/db/smalldata-decade/><img src=/img/hero/db/smalldata-decade.jpg alt=featured></a></p><p>If DuckDB had launched in 2012, the great migration to distributed analytics might never have happened. Data isn&rsquo;t that big after all. <a href=https://vonng.com/cn/db/smalldata-decade/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-dd2269204fca84a0bed2486aa44ac5d4>Scaling Postgres to the Next Level at OpenAI</h1><div class="td-byline mb-4">By <b><a href=https://vonng.com/en/>Ruohang Feng</a> (<a href=https://vonng.com/en/>@Vonng</a>) | Speaker: Bohan Zhang | <a href=https://vonng.com/en/db/openai-pg/>Blog</a></b> |
<time datetime=2025-05-19 class=text-body-secondary>May 19, 2025</time></div><p>At <a href=https://2025.pgconf.dev/schedule.html><strong>PGConf.Dev 2025</strong></a>, <a href=https://www.linkedin.com/in/bohan-zhang-52b17714b>Bohan Zhang</a> from OpenAI shared a session titled <a href=https://www.pgevents.ca/events/pgconfdev2025/schedule/session/433-scaling-postgres-to-the-next-level-at-openai/>Scaling Postgres to the next level at OpenAI</a>, giving us a peek into the database usage of a top-tier unicorn.</p><blockquote><p>“At OpenAl, we’ve proven that PostgreSQL can scale to support massive read-heavy workloads - even without sharding - using a single primary writer”</p><p>—— Bohan Zhang from OpenAI, PGConf.Dev 2025</p></blockquote><p><img src=https://vonng.com/db/openai-pg/1.jpg alt=1.jpg></p><p>Bohan Zhang is a member of the OpenAI Infra team, student of <a href=https://www.cs.cmu.edu/~pavlo/>Andy Pavlo</a>, and co-found <a href=https://github.com/OuterTune/OuterTune>OtterTune</a> with him.</p><blockquote><p>This article is based on Bohan’s presentation at the conference. with chinese translation/commentary by <strong>Ruohang Feng</strong> (<a href=https://github.com/Vonng/>Vonng</a>): Author of <a href=https://pigsty.io/>Pigsty</a>.
The original chinese version is available on <a href=https://mp.weixin.qq.com/s/ykrasJ2UeKZAMtHCmtG93Q>WeChat Column</a> and <a href=https://pigsty.cc/db/openai-pg/>Pigsty CN Blog</a>.</p></blockquote><blockquote><p>Hacker News Discussion: <a href="https://news.ycombinator.com/item?id=44071418#44072781">OpenAI: Scaling Postgres to the Next Level</a></p></blockquote><hr><h2 id=background>Background</h2><p><strong>Postgres is the backbone of our most critical systems at OpenAl.</strong> If Postgres goes down, many of OpenAI’s key features go down with it — and there’s plenty of precedent for this. PostgreSQL-related failures have caused several ChatGPT outages in the past.</p><p><img src=https://vonng.com/db/openai-pg/2.webp alt=2.webp></p><p>OpenAI uses managed PostgreSQL databases on Azure, without sharding. Instead, they employ a classic primary-replica replication architecture with <strong>one primary and over dozens of read replicas</strong>. For a service with several hundred million active users like OpenAI, scalability is a major concern.</p><hr><h2 id=challenges>Challenges</h2><p>In OpenAI’s PostgreSQL architecture, read scalability is excellent, but “<strong>write requests</strong>” have become the primary bottleneck. OpenAI has already made many optimizations here, such as offloading write workloads wherever possible and avoiding placing new business logic into the main database.</p><p><img src=https://vonng.com/db/openai-pg/3.webp alt=3.webp></p><p>PostgreSQL’s MVCC design has <a href=https://www.cs.cmu.edu/~pavlo/blog/2023/04/the-part-of-postgresql-we-hate-the-most.html>some known issues</a>, such as table and index bloat. Tuning autovacuum is complex, and every write generates a completely new version of a row. Index access might also require additional heap fetches for visibility checks. These design choices create challenges for scaling read replicas: for instance, more WAL typically leads to greater replication lag, and as the number of replicas grows, network bandwidth can become the new bottleneck.</p><hr><h2 id=measures>Measures</h2><p>To tackle these issues, we’ve made efforts on multiple fronts:</p><h3 id=reduce-load-on-primary>Reduce Load on Primary</h3><p>The first optimization is to smooth out write spikes on the primary and minimize its load as much as possible, for example:</p><ul><li>Offloading all possible writes.</li><li>Avoiding unnecessary writes at the application level.</li><li>Using lazy writes to smooth out write bursts.</li><li>Controlling the rate of data backfilling.</li></ul><p>Additionally, OpenAI offloads as many read requests as possible to replicas. The few read requests that cannot be moved from the primary because they are part of read-write transactions are required to be as efficient as possible.</p><p><img src=https://vonng.com/db/openai-pg/4.jpg alt=4.webp></p><h3 id=query-optimization>Query Optimization</h3><p>The second area is query-level optimization. Since long-running transactions can block garbage collection and consume resources, they use <code>timeout</code> settings to prevent long “idle in transaction” states and set session, statement, and client-level timeouts. They also optimized some multi-way JOIN queries (e.g., joining 12 tables at once). The talk specifically mentioned that using ORMs can easily lead to inefficient queries and should be used with caution.</p><p><img src=https://vonng.com/db/openai-pg/5.webp alt=5.webp></p><h3 id=mitigating-single-points-of-failure>Mitigating Single Points of Failure</h3><p>The primary is a single point of failure; if it goes down, writes are blocked. In contrast, we have many read-only replicas. If one fails, applications can still read from others. In fact, many critical requests are read-only, so even if the primary goes down, they can continue to serve reads.</p><p>Furthermore, we’ve distinguished between low-priority and high-priority requests. For high-priority requests, OpenAI allocates dedicated read-only replicas to prevent them from being impacted by low-priority ones.</p><p><img src=https://vonng.com/db/openai-pg/6.webp alt=6.webp></p><h3 id=schema-management>Schema Management</h3><p>The fourth measure is to allow only lightweight schema changes on this cluster. This means:</p><ul><li>Creating new tables or adding new workloads to it is not allowed.</li><li>Adding or removing columns is allowed (with a 5-second timeout), but any operation that requires a full table rewrite is forbidden.</li><li>Creating or removing indexes is allowed, but must be done using <code>CONCURRENTLY</code>.</li></ul><p>Another issue mentioned was that persistent long-running queries (>1s) would continuously block schema changes, eventually causing them to fail. The solution was to have the application optimize or move these slow queries to replicas.</p><p><img src=https://vonng.com/db/openai-pg/7.webp alt=7.webp></p><hr><h2 id=results>Results</h2><ul><li>Scaled PostgreSQL on Azure to millions of QPS, supporting OpenAI’s critical services.</li><li>Added dozens of replicas without increasing replication lag.</li><li>Deployed read-only replicas to different geographical regions while maintaining low latency.</li><li>Only one SEV0 incident related to PostgreSQL in the past nine months.</li><li>Still have plenty of room for future growth.</li></ul><p><img src=https://vonng.com/db/openai-pg/8.webp alt=8.webp></p><blockquote><p>“At OpenAl, we’ve proven that PostgreSQL can scale to support massive read-heavy workloads - even without sharding - using a single primary writer”</p></blockquote><hr><h2 id=case-studies>Case Studies</h2><p>OpenAI also shared a few case studies of failures they’ve faced. The first was a cascading failure caused by a redis outage.</p><p><img src=https://vonng.com/db/openai-pg/9.webp alt=9.webp></p><p>The second incident was more interesting: extremely high CPU usage triggered a bug where the WALSender process kept spin-looping instead of sending WAL to replicas, even after CPU levels returned to normal. This led to increased replication lag.</p><p><img src=https://vonng.com/db/openai-pg/10.webp alt=10.webp></p><hr><h2 id=feature-suggestions>Feature Suggestions</h2><p>Finally, Bohan raised some questions and feature suggestions to the PostgreSQL developer community:</p><p>First, regarding <strong>disabling indexes</strong>. Unused indexes cause write amplification and extra maintenance overhead. They want to remove useless indexes, but to minimize risk, they wish for a feature to “disable” an index. This would allow them to monitor performance metrics to ensure everything is fine before actually dropping it.</p><p><img src=https://vonng.com/db/openai-pg/11.webp alt=11.webp></p><p>Second is about <strong>RT observability</strong>. Currently, <code>pg_stat_statement</code> only provides the average response time for each query type, but doesn’t directly offer latency metrics like p95 or p99. They hope for more histogram-like and percentile latency metrics.</p><p><img src=https://vonng.com/db/openai-pg/12.webp alt=12.webp></p><p>The third point is about <strong>schema changes</strong>. They want PostgreSQL to record a history of schema change events, such as adding/removing columns and other DDL operations.</p><p><img src=https://vonng.com/db/openai-pg/13.webp alt=13.webp></p><p>The fourth case is about the <strong>semantics of monitoring views</strong>. They found a session with <code>state = 'active'</code> and <code>wait_event = 'ClientRead'</code> that lasted for over two hours. This means a connection remained active long after <code>query_start</code>, and such connections can’t be killed by the <code>idle_in_transaction_timeout</code>. They wanted to know if this is a bug and how to resolve it.</p><p><img src=https://vonng.com/db/openai-pg/14.webp alt=14.webp></p><p>Finally, a suggestion for optimizing PostgreSQL’s <strong>default parameters</strong>. The default values are too conservative. Could better defaults be used, or perhaps a heuristic-based configuration rule?</p><hr><h2 id=vonngs-commentary>Vonng’s Commentary</h2><p>Although PGConf.Dev 2025 is primarily focused on development, you often see use case presentations from users, like this one from OpenAI on their PostgreSQL scaling practices. These topics are actually quite interesting for core developers, as many of them don’t have a clear picture of how PostgreSQL is used in extreme scenarios, and these talks are very helpful.</p><p><img src=https://vonng.com/db/openai-pg/15.webp alt=15.webp></p><p>Since late 2017, I managed dozens of PostgreSQL clusters at <a href=https://tantanapp.com/en>Tantan</a>, which was one of the largest and most complex PG deployments in the Chinese internet scene: dozens of PG clusters with around 2.5 million QPS. Back then, our largest core primary had a 1-primary-33-replica setup, with a single cluster handling around 400K QPS. The bottleneck was also on single-database writes, which we eventually solved with application-side sharding, similar to <a href=https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c>Instagram’s approach</a>.</p><p>You could say I’ve encountered all the problems and used all the solutions OpenAI mentioned in their talk. Of course, the difference is that today’s <a href=https://pigsty.io/cloud//bonus/>top-tier hardware</a> is orders of magnitude better than it was eight years ago. This allows a startup like OpenAI to serve its entire business with a single PostgreSQL cluster without sharding. This is undoubtedly another powerful piece of evidence for the argument that “<a href=https://pigsty.io/db/distributive-bullshit/>Distributed Databases Are a False Need</a>”.</p><p>During the Q&amp;A, I learned that OpenAI uses managed PostgreSQL on Azure with the highest available server hardware specs. They have dozens of replicas, including some in different geographical regions, and this behemoth cluster handles a total of about millions QPS. They use Datadog for monitoring, and the services access the RDS cluster from Kubernetes through a business-side PgBouncer connection pool.</p><p>As a strategic customer, the Azure PostgreSQL team provides them with dedicated support. But it’s clear that even with top-tier cloud database services, the customer needs to have sufficient knowledge and skill on the application and operations side. Even with the brainpower of OpenAI, they still stumble on some of the practical driving lessons of PostgreSQL.</p><p>During the social event after the conference, I had a great chat with Bohan and two other database founders until the wee hours. The off-the-record discussions were fascinating, but I can’t disclose more here, haha.</p><p><img src=https://vonng.com/db/openai-pg/selfie.jpeg alt=selfie.jpeg></p><hr><h2 id=vonngs-qa>Vonng’s Q&amp;A</h2><p>Regarding the questions and feature requests Bohan raised, I can offer some answers here.</p><p>Most of the features OpenAI wants already exist in the PostgreSQL ecosystem, they just might not be available in the vanilla PG kernel or in a managed cloud database environment.</p><hr><h3 id=on-disabling-indexes>On Disabling Indexes</h3><p>PostgreSQL actually has a “feature” to disable indexes. You just need to update the <code>indisvalid</code> field in the <a href=https://www.postgresql.org/docs/current/catalog-pg-index.html><code>pg_index</code></a> system catalog to <code>false</code>. The planner will then stop using the index, but it will continue to be maintained during DML operations. In principle, there’s nothing wrong with this, as concurrent index creation uses these two flags (<code>isready</code>, <code>isvalid</code>). It’s not black magic.</p><p>However, I can understand why OpenAI can’t use this method: it’s an undocumented “internal detail” rather than a formal feature. But more importantly, <strong>cloud databases usually don’t grant superuser privileges</strong>, so you just can’t update the system catalog like this.</p><p>But back to the original need — fear of accidentally deleting an index. There’s a simpler solution: just confirm from monitoring view (<a href=https://www.postgresql.org/docs/current/monitoring-stats.html#MONITORING-PG-STAT-ALL-INDEXES-VIEW><code>pg_stat_all_indexes</code></a>) that the index isn’t being used on either the primary or the replicas. If you know an index hasn’t been used for a long time, you can safely delete it.</p><blockquote><p>Monitoring index switch with <a href=https://pigsty.io/about/observability/>Pigsty</a> <a href="https://demo.pigsty.io/d/pgsql-tables?viewPanel=panel-354">PGSQL TABLES</a> Dashboard</p><p><a href="https://demo.pigsty.io/d/pgsql-tables?viewPanel=panel-354"><img src=https://vonng.com/db/openai-pg/17.webp alt=17.webp></a></p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Create a new index
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>UNIQUE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8> </span><span style=color:#000>CONCURRENTLY</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts_pkey2</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>aid</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Mark the original index as invalid (not used), but still maintained. planner will not use it.
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>UPDATE</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_index</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#000>indisvalid</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>indexrelid</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pgbench_accounts_pkey&#39;</span><span style=color:#000;font-weight:700>::</span><span style=color:#000>regclass</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h3 id=on-observability>On Observability</h3><p>Actually, <a href=https://pigsty.io/ext/stat/pg_stat_statements/><strong><code>pg_stat_statements</code></strong></a> provides the <code>mean</code> and <code>stddev</code> metrics, which you can use with properties of the normal distribution to estimate percentile metrics. But this is only a rough estimate, and you need to reset the counters periodically, otherwise the effectiveness of the full historical statistics will degrade over time.</p><p><a href=https://vonng.com/en/pg/pgss/><img src=pgss.jpg alt=pgss.jpg></a></p><blockquote><p>RT Distribution with <a href=https://demo.pigsty.io/d/pgsql-query>PGSQL QUERY</a> Dashboard from <a href=https://vonng.com/en/pg/pgss/>PGSS</a></p></blockquote><p>PGSS is unlikely to provide P95, P99 RT percentile metrics anytime soon, because it would increase the extension’s memory footprint by several dozen times. While that’s not a big deal for modern servers, it could be an issue in extremely conservative environments. I asked the maintainer of PGSS about this at the <a href=https://wiki.postgresql.org/wiki/PGConf.dev_2025_Developer_Unconference#The_Future_of_pg_stat_statements>Unconference</a>, and it’s unlikely to happen in the short term. I also asked Jelte, the maintainer of Pgbouncer, if this could be solved at the connection pool level, and a feature like that is not coming soon either.</p><p>However, there are other solutions to this problem. First, the <a href=https://pgext.cloud/e/pg_stat_monitor/><strong><code>pg_stat_monitor</code></strong></a> extension explicitly provides detailed percentile RT metrics, but you have to consider the performance impact of collecting these metrics on the cluster. A universal, non-intrusive method with no database performance overhead is to add query RT monitoring directly at the application’s Data Access Layer (DAL), but this requires cooperation and effort from the application side.</p><p>Also, using eBPF for side-channel collection of RT metrics is a great idea, but considering they’re using managed PostgreSQL on Azure, they won’t have server access, so that path is likely blocked.</p><hr><h3 id=on-schema-change-history>On Schema Change History</h3><p>Actually, PostgreSQL’s logging already provides this option. You just need to set <a href=https://www.postgresql.org/docs/current/runtime-config-logging.html%23GUC-LOG-STATEMENT><strong><code>log_statement</code></strong></a> to <code>ddl</code> (or the more advanced <code>mod</code> or <code>all</code>), and all DDL logs will be preserved. The <a href=https://pgext.cloud/e/pgaudit/><strong><code>pgaudit</code></strong></a> extension also provides similar functionality.</p><p>But I suspect what they really want isn’t DDL logs, but something like a system view that can be queried via SQL. In that case, another option is <a href=https://www.postgresql.org/docs/current/sql-createeventtrigger.html><code>CREATE EVENT TRIGGER</code></a>. You can use an event trigger to log DDL events directly into a data table. The <a href=https://pigsty.io/ext/util/ddl_historization/><strong><code>pg_ddl_historization</code></strong></a> extension provides a more convenient way to do this, and I’ve compiled and packaged this extension as well.</p><p>Creating an event trigger also requires superuser privileges. AWS RDS has some special handling to allow this, but it seems that PostgreSQL on Azure does not support it.</p><hr><h3 id=on-monitoring-view-semantics>On Monitoring View Semantics</h3><p>In OpenAI’s example, <a href=https://www.postgresql.org/docs/current/monitoring-stats.html%23MONITORING-PG-STAT-ACTIVITY-VIEW><strong><code>pg_stat_activity.state</code></strong></a> = <code>active</code> means the backend process is still within the lifecycle of a single SQL statement. The <a href=https://www.postgresql.org/docs/current/monitoring-stats.html%23WAIT-EVENT-TABLE><strong><code>WaitEvent</code></strong></a> = <code>ClientRead</code> means the process is on the CPU waiting for data from the client. When both appear together, a typical example is an idle <code>COPY FROM STDIN</code>, but it could also be TCP blocking or being stuck between <code>BIND</code> / <code>EXECUTE</code>. So it’s hard to say if it’s a bug without knowing what the connection is actually doing.</p><p>Some might argue that waiting for client I/O should be considered “idle” from a CPU perspective. But <code>state</code> tracks the execution state of the statement itself, not whether the CPU is busy. <code>state = 'active'</code> means the PostgreSQL backend considers “this statement is not yet finished.” Resources like row locks, buffer pins, snapshots, and file handles are considered “in use.” This doesn’t mean it’s running on the CPU. When the process is running on the CPU in a loop waiting for client data, the wait event is <code>ClientRead</code>. When it yields the CPU and “waits” in the background, the wait event is <code>NULL</code>.</p><p>But back to the problem itself, there are other solutions. For example, in Pigsty, when accessing PostgreSQL through HAProxy, we set a <a href=https://github.com/pgsty/pigsty/blob/main/roles/haproxy/templates/haproxy.cfg.j2#L30>connection timeout</a> at the LB level for the primary service, defaulting to 24 hours. More stringent environments would have a shorter timeout, like 1 hour. This means any connection lasting over an hour would be terminated. Of course, this also needs to be configured with a corresponding max lifetime in the application-side connection pool, to proactively close connections rather than having them be cut off. For offline, read-only services, this parameter can be omitted to allow for ultra-long queries that might run for two or three days. This provides a safety net for these <code>active</code>-but-waiting-on-I/O situations.</p><p>But I also doubt whether Azure PostgreSQL offers this kind of control.</p><hr><h3 id=on-default-parameters>On Default Parameters</h3><p>PostgreSQL’s default parameters are quite conservative. For example, it <a href=https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-SHARED-BUFFERS>defaults to using 128 MB of memory</a> (the minimum can be set to 128 KB!). On the bright side, this allows its default configuration to run in almost any environment. On the downside, I’ve actually seen a case of a production system with 1TB of physical memory running with the 128 MB default… (thanks to double buffering, it actually ran for a long time).</p><p>But overall, I think conservative defaults aren’t a bad thing. This issue can be solved in a more flexible, dynamic configuration process. RDS and Pigsty both provide pretty good <a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/oltp.yml#L13>initial parameter heuristic config rules</a>, which fully address this problem. But this feature could indeed be added to the PG command-line tools, for example, having <a href=https://www.postgresql.org/docs/current/app-initdb.html><code>initdb</code></a> automatically detect CPU/memory count, disk size, and storage type and set optimized parameter values accordingly.</p><hr><h3 id=self-hosted-postgresql>Self-hosted PostgreSQL?</h3><p>The challenges OpenAI raised are not really from PostgreSQL itself, but from the additional limitations of managed cloud services. One solution is to use the IaaS layer and self-host a PostgreSQL cluster on instances with local NVMe SSD storage to bypass these restrictions.</p><p>In fact, my project <a href=https://pigsty.io/>Pigsty</a> built for ourselves to solve PostgreSQL challenges at a similar scale. It scales well, having supported Tantan’s 25K vCPU PostgreSQL cluster and 2.5M QPS. It includes solutions for all the problems mentioned above, and even for many that OpenAI hasn’t encountered yet. And in a self-hosting manner, open-source, free, and ready to use out of the box.</p><p>If OpenAI is interested, I’d certainly be happy to provide some help. But I think when you’re in a phase of hyper-growth, fiddling with database infra is probably not a high-priority item. Fortunately, they still have excellent PostgreSQL DBAs who can continue to forge these paths.</p><hr><h2 id=references>References</h2><p>[1] HackerNews OpenAI: Scaling Postgres to the Next Level: <a href="https://news.ycombinator.com/item?id=44071418#44072781">https://news.ycombinator.com/item?id=44071418#44072781</a></p><p>[2] PostgreSQL is eating the database world: <a href=https://pigsty.io/pg/pg-eat-db-world>https://pigsty.io/pg/pg-eat-db-world</a></p><p>[3] Chinese: Scaling Postgres to the Next Level at OpenAI <a href=https://pigsty.cc/db/openai-pg/>https://pigsty.cc/db/openai-pg/</a></p><p>[4] The part of PostgreSQL we hate the most: <a href=https://www.cs.cmu.edu/~pavlo/blog/2023/04/the-part-of-postgresql-we-hate-the-most.html>https://www.cs.cmu.edu/~pavlo/blog/2023/04/the-part-of-postgresql-we-hate-the-most.html</a></p><p>[5] PGConf.Dev 2025: <a href=https://2025.pgconf.dev/schedule.html>https://2025.pgconf.dev/schedule.html</a></p><p>[6] Schedule: Scaling Postgres to the next level at OpenAI: <a href=https://www.pgevents.ca/events/pgconfdev2025/schedule/session/433-scaling-postgres-to-the-next-level-at-openai/>https://www.pgevents.ca/events/pgconfdev2025/schedule/session/433-scaling-postgres-to-the-next-level-at-openai/</a></p><p>[7] Bohan Zhang: <a href=https://www.linkedin.com/in/bohan-zhang-52b17714b>https://www.linkedin.com/in/bohan-zhang-52b17714b</a></p><p>[8] Ruohang Feng / Vonng: <a href=https://github.com/Vonng/>https://github.com/Vonng/</a></p><p>[9] Pigsty: <a href=https://pigsty.io/>https://pigsty.io</a></p><p>[10] Instagram’s Sharding IDs: <a href=https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c>https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c</a></p><p>[11] Reclaim hardware bouns: <a href=https://pigsty.io/cloud//bonus/>https://pigsty.io/cloud//bonus/</a></p><p>[12] Distributed Databases Are a False Need: <a href=https://pigsty.io/db/distributive-bullshit/>https://pigsty.io/db/distributive-bullshit/</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-359f327632677501a3c1920db3a32a4b>How Many Shops Has etcd Torched?</h1><div class=lead>Plenty. If you’re rolling your own Kubernetes, odds are you’ll crash because etcd ships with a 2 GB time bomb.</div><div class="td-byline mb-4">By <b>Ruohang Feng</b> |
<time datetime=2025-05-07 class=text-body-secondary>May 07, 2025</time></div><p><a href=https://vonng.com/en/db/bad-etcd/><img src=/img/hero/db/bad-etcd.jpg alt=featured></a></p><p>Plenty. If you’re rolling your own Kubernetes, odds are you’ll crash because etcd ships with a 2 GB time bomb. <a href=https://vonng.com/en/db/bad-etcd/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7c07f1baaa53dfe3e61de3005f67c082>In the AI Era, Software Starts at the Database</h1><div class=lead>Future software = Agent + Database. No middle tiers, just agents issuing CRUD. Database skills age well, and PostgreSQL is poised to be the agent-era default.</div><div class="td-byline mb-4">By <b>Ruohang Feng</b> |
<time datetime=2025-04-27 class=text-body-secondary>April 27, 2025</time></div><p><a href=https://vonng.com/en/db/ai-agent-era/><img src=/img/hero/db/ai-agent-era.jpg alt=featured></a></p><p>Future software = Agent + Database. No middle tiers, just agents issuing CRUD. Database skills age well, and PostgreSQL is poised to be the agent-era default. <a href=https://vonng.com/en/db/ai-agent-era/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-efd48be9faa3ff9f78f1314b955e9fd5>MySQL vs. PostgreSQL @ 2025</h1><div class=lead>A 2025 reality check on where PostgreSQL stands relative to MySQL across features, performance, quality, and ecosystem.</div><div class="td-byline mb-4">By <b>Ruohang Feng</b> |
<time datetime=2025-04-17 class=text-body-secondary>April 17, 2025</time></div><p><a href=https://vonng.com/en/db/mysql-vs-pgsql/><img src=/img/hero/db/mysql-vs-pgsql.jpg alt=featured></a></p><p>A 2025 reality check on where PostgreSQL stands relative to MySQL across features, performance, quality, and ecosystem. <a href=https://vonng.com/en/db/mysql-vs-pgsql/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-c4df8de5db8bf34946dc032b369d468f>Database Planet Collision: When PG Falls for DuckDB</h1><div class=lead>If you ask me, we’re on the brink of a cosmic collision in database-land, and Postgres + DuckDB is the meteor we should all be watching.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2025-03-12 class=text-body-secondary>March 12, 2025</time></div><p><a href=https://vonng.com/en/db/pg-kiss-duckdb/><img src=/img/hero/db/pg-kiss-duckdb.jpg alt=featured></a></p><p>If you ask me, we’re on the brink of a cosmic collision in database-land, and Postgres + DuckDB is the meteor we should all be watching. <a href=https://vonng.com/en/db/pg-kiss-duckdb/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-8b6f59a6d7382c6db9288e342d13e95a>Comparing Oracle and PostgreSQL Transaction Systems</h1><div class=lead>The PG community has started punching up: Cybertec’s Laurenz Albe breaks down how Oracle’s transaction system stacks against PostgreSQL.</div><div class="td-byline mb-4">By <b>Laurenz Albe</b> |
<time datetime=2025-02-27 class=text-body-secondary>February 27, 2025</time></div><p><a href=https://vonng.com/en/db/oracle-pg-xact/><img src=/img/hero/db/oracle-pg-xact.jpg alt=featured></a></p><p>The PG community has started punching up: Cybertec’s Laurenz Albe breaks down how Oracle’s transaction system stacks against PostgreSQL. <a href=https://vonng.com/en/db/oracle-pg-xact/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-3574d7e5711eb199ea28caa0646e9e4a>Database as Business Architecture</h1><div class=lead>Databases are the core of business architecture, but what happens if we go further and let databases become the business architecture itself?</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>)</b> |
<time datetime=2025-01-22 class=text-body-secondary>January 22, 2025</time></div><p><a href=https://vonng.com/en/db/db-is-the-arch/><img src=/img/hero/db/db-is-the-arch.jpg alt=featured></a></p><p>Databases are the core of business architecture, but what happens if we go further and let databases become the business architecture itself? <a href=https://vonng.com/en/db/db-is-the-arch/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-2f0eb2d4492366bac61fc6120846eb93>7 Databases in 7 Weeks (2025)</h1><div class=lead>Is PostgreSQL the king of boring databases? Here are seven databases worth studying in 2025: PostgreSQL, SQLite, DuckDB, ClickHouse, FoundationDB, TigerBeetle, and CockroachDB—each deserving a week of deep exploration.</div><div class="td-byline mb-4">By <b>Matt Blewitt</b> |
<time datetime=2024-12-03 class=text-body-secondary>December 03, 2024</time></div><p><a href=https://vonng.com/en/db/7-week-7-db/><img src=/img/hero/db/7-week-7-db.jpg alt=featured></a></p><p>Is PostgreSQL the king of boring databases? Here are seven databases worth studying in 2025: PostgreSQL, SQLite, DuckDB, ClickHouse, FoundationDB, TigerBeetle, and CockroachDB—each deserving a week of deep exploration. <a href=https://vonng.com/en/db/7-week-7-db/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-aaf2123d302c34b5420e80384b81f211>Solving Poker 24 with a Single SQL Query</h1><div class=lead>An interesting but tricky puzzle: solving the 24 game with SQL. The PostgreSQL solution.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2024-12-03 class=text-body-secondary>December 03, 2024</time></div><p><a href=https://vonng.com/en/db/poker-24/><img src=/img/hero/db/poker-24.jpg alt=featured></a></p><p>An interesting but tricky puzzle: solving the 24 game with SQL. The PostgreSQL solution. <a href=https://vonng.com/en/db/poker-24/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-62363462242f428e810f0ff6e9957079>Self-Hosting Supabase on PostgreSQL</h1><div class="td-byline mb-4">By <b><a href=https://vonng.com>Ruohang Feng</a> (<a href=https://vonng.com/en/>@Vonng</a>)</b> |
<time datetime=2024-11-25 class=text-body-secondary>November 25, 2024</time></div><p>Supabase is great, own your own Supabase is even better.
Here&rsquo;s a comprehensive tutorial for self-hosting production-grade supabase on local/cloud VM/BMs.</p><h2 id=what-is-supabase>What is Supabase?</h2><p><a href=https://supabase.com/>Supabase</a> is an open-source Firebase alternative, a Backend as a Service (BaaS).</p><p>Supabase wraps PostgreSQL kernel and vector extensions, alone with authentication, realtime subscriptions, edge functions, object storage, and instant REST and GraphQL APIs from your postgres schema.
It let you skip most backend work, requiring only database design and frontend skills to ship quickly.</p><p>Currently, Supabase may be the <a href=https://ossrank.com/cat/368-postgresql-extension-ecosystem>most popular</a> open-source project in the PostgreSQL ecosystem, boasting over 74,000 stars on GitHub.
And become quite popular among developers, and startups, since they have a <a href=https://supabase.com/pricing>generous free plan</a>, just like cloudflare & neon.</p><hr><h2 id=why-self-hosting>Why Self-Hosting?</h2><p>Supabase&rsquo;s slogan is: &ldquo;<strong>Build in a weekend, Scale to millions</strong>&rdquo;. It has great cost-effectiveness in small scales (4c8g) indeed.
But there is no doubt that when you really grow to millions of users, some may choose to self-hosting their own Supabase —— for functionality, performance, cost, and other reasons.</p><p>That&rsquo;s where Pigsty comes in. Pigsty provides a complete one-click self-hosting solution for Supabase.
Self-hosted Supabase can enjoy full PostgreSQL monitoring, IaC, PITR, and high availability capability,</p><p>You can run the latest PostgreSQL 17(,16,15,14) kernels, (supabase is using the 15 currently), alone with <a href=https://ext.pigsty.io/#/list>390</a> PostgreSQL extensions out-of-the-box.
Run on <a href=/docs/ref/linux>mainstream</a> Linus OS distros with production grade <a href=/docs/concept/ha>HA</a> <a href=/docs/pgsql>PostgreSQL</a>, <a href=/docs/minio>MinIO</a>, Prometheus & Grafana Stack for observability, and Nginx for reverse proxy.</p><p><a href=https://ext.pigsty.io/#/time><strong>TIME</strong></a>: <a href=https://ext.pigsty.io/#/timescaledb><code>timescaledb</code></a> <a href=https://ext.pigsty.io/#/timescaledb_toolkit><code>timescaledb_toolkit</code></a> <a href=https://ext.pigsty.io/#/timeseries><code>timeseries</code></a> <a href=https://ext.pigsty.io/#/periods><code>periods</code></a> <a href=https://ext.pigsty.io/#/temporal_tables><code>temporal_tables</code></a> <a href=https://ext.pigsty.io/#/emaj><code>emaj</code></a> <a href=https://ext.pigsty.io/#/table_version><code>table_version</code></a> <a href=https://ext.pigsty.io/#/pg_cron><code>pg_cron</code></a> <a href=https://ext.pigsty.io/#/pg_later><code>pg_later</code></a> <a href=https://ext.pigsty.io/#/pg_background><code>pg_background</code></a>
<a href=https://ext.pigsty.io/#/gis><strong>GIS</strong></a>: <a href=https://ext.pigsty.io/#/postgis><code>postgis</code></a> <a href=https://ext.pigsty.io/#/postgis_topology><code>postgis_topology</code></a> <a href=https://ext.pigsty.io/#/postgis_raster><code>postgis_raster</code></a> <a href=https://ext.pigsty.io/#/postgis_sfcgal><code>postgis_sfcgal</code></a> <a href=https://ext.pigsty.io/#/postgis_tiger_geocoder><code>postgis_tiger_geocoder</code></a> <a href=https://ext.pigsty.io/#/address_standardizer><code>address_standardizer</code></a> <a href=https://ext.pigsty.io/#/address_standardizer_data_us><code>address_standardizer_data_us</code></a> <a href=https://ext.pigsty.io/#/pgrouting><code>pgrouting</code></a> <a href=https://ext.pigsty.io/#/pointcloud><code>pointcloud</code></a> <a href=https://ext.pigsty.io/#/pointcloud_postgis><code>pointcloud_postgis</code></a> <a href=https://ext.pigsty.io/#/h3><code>h3</code></a> <a href=https://ext.pigsty.io/#/h3_postgis><code>h3_postgis</code></a> <a href=https://ext.pigsty.io/#/q3c><code>q3c</code></a> <a href=https://ext.pigsty.io/#/ogr_fdw><code>ogr_fdw</code></a> <a href=https://ext.pigsty.io/#/geoip><code>geoip</code></a> <a href=https://ext.pigsty.io/#/pg_polyline><code>pg_polyline</code></a> <a href=https://ext.pigsty.io/#/pg_geohash><code>pg_geohash</code></a> <a href=https://ext.pigsty.io/#/mobilitydb><code>mobilitydb</code></a> <a href=https://ext.pigsty.io/#/earthdistance><code>earthdistance</code></a>
<a href=https://ext.pigsty.io/#/rag><strong>RAG</strong></a>: <a href=https://ext.pigsty.io/#/vector><code>vector</code></a> <a href=https://ext.pigsty.io/#/vectorscale><code>vectorscale</code></a> <a href=https://ext.pigsty.io/#/vectorize><code>vectorize</code></a> <a href=https://ext.pigsty.io/#/pg_similarity><code>pg_similarity</code></a> <a href=https://ext.pigsty.io/#/smlar><code>smlar</code></a> <a href=https://ext.pigsty.io/#/pg_summarize><code>pg_summarize</code></a> <a href=https://ext.pigsty.io/#/pg_tiktoken><code>pg_tiktoken</code></a> <a href=https://ext.pigsty.io/#/pgml><code>pgml</code></a> <a href=https://ext.pigsty.io/#/pg4ml><code>pg4ml</code></a>
<a href=https://ext.pigsty.io/#/fts><strong>FTS</strong></a>: <a href=https://ext.pigsty.io/#/pg_search><code>pg_search</code></a> <a href=https://ext.pigsty.io/#/pg_bigm><code>pg_bigm</code></a> <a href=https://ext.pigsty.io/#/zhparser><code>zhparser</code></a> <a href=https://ext.pigsty.io/#/hunspell_cs_cz><code>hunspell_cs_cz</code></a> <a href=https://ext.pigsty.io/#/hunspell_de_de><code>hunspell_de_de</code></a> <a href=https://ext.pigsty.io/#/hunspell_en_us><code>hunspell_en_us</code></a> <a href=https://ext.pigsty.io/#/hunspell_fr><code>hunspell_fr</code></a> <a href=https://ext.pigsty.io/#/hunspell_ne_np><code>hunspell_ne_np</code></a> <a href=https://ext.pigsty.io/#/hunspell_nl_nl><code>hunspell_nl_nl</code></a> <a href=https://ext.pigsty.io/#/hunspell_nn_no><code>hunspell_nn_no</code></a> <a href=https://ext.pigsty.io/#/hunspell_pt_pt><code>hunspell_pt_pt</code></a> <a href=https://ext.pigsty.io/#/hunspell_ru_ru><code>hunspell_ru_ru</code></a> <a href=https://ext.pigsty.io/#/hunspell_ru_ru_aot><code>hunspell_ru_ru_aot</code></a> <a href=https://ext.pigsty.io/#/fuzzystrmatch><code>fuzzystrmatch</code></a> <a href=https://ext.pigsty.io/#/pg_trgm><code>pg_trgm</code></a>
<a href=https://ext.pigsty.io/#/olap><strong>OLAP</strong></a>: <a href=https://ext.pigsty.io/#/citus><code>citus</code></a> <a href=https://ext.pigsty.io/#/citus_columnar><code>citus_columnar</code></a> <a href=https://ext.pigsty.io/#/columnar><code>columnar</code></a> <a href=https://ext.pigsty.io/#/pg_analytics><code>pg_analytics</code></a> <a href=https://ext.pigsty.io/#/pg_duckdb><code>pg_duckdb</code></a> <a href=https://ext.pigsty.io/#/pg_mooncake><code>pg_mooncake</code></a> <a href=https://ext.pigsty.io/#/duckdb_fdw><code>duckdb_fdw</code></a> <a href=https://ext.pigsty.io/#/pg_parquet><code>pg_parquet</code></a> <a href=https://ext.pigsty.io/#/pg_fkpart><code>pg_fkpart</code></a> <a href=https://ext.pigsty.io/#/pg_partman><code>pg_partman</code></a> <a href=https://ext.pigsty.io/#/plproxy><code>plproxy</code></a> <a href=https://ext.pigsty.io/#/pg_strom><code>pg_strom</code></a> <a href=https://ext.pigsty.io/#/tablefunc><code>tablefunc</code></a>
<a href=https://ext.pigsty.io/#/feat><strong>FEAT</strong></a>: <a href=https://ext.pigsty.io/#/age><code>age</code></a> <a href=https://ext.pigsty.io/#/hll><code>hll</code></a> <a href=https://ext.pigsty.io/#/rum><code>rum</code></a> <a href=https://ext.pigsty.io/#/pg_graphql><code>pg_graphql</code></a> <a href=https://ext.pigsty.io/#/pg_jsonschema><code>pg_jsonschema</code></a> <a href=https://ext.pigsty.io/#/jsquery><code>jsquery</code></a> <a href=https://ext.pigsty.io/#/pg_hint_plan><code>pg_hint_plan</code></a> <a href=https://ext.pigsty.io/#/hypopg><code>hypopg</code></a> <a href=https://ext.pigsty.io/#/index_advisor><code>index_advisor</code></a> <a href=https://ext.pigsty.io/#/plan_filter><code>plan_filter</code></a> <a href=https://ext.pigsty.io/#/imgsmlr><code>imgsmlr</code></a> <a href=https://ext.pigsty.io/#/pg_ivm><code>pg_ivm</code></a> <a href=https://ext.pigsty.io/#/pgmq><code>pgmq</code></a> <a href=https://ext.pigsty.io/#/pgq><code>pgq</code></a> <a href=https://ext.pigsty.io/#/pg_cardano><code>pg_cardano</code></a> <a href=https://ext.pigsty.io/#/rdkit><code>rdkit</code></a> <a href=https://ext.pigsty.io/#/bloom><code>bloom</code></a>
<a href=https://ext.pigsty.io/#/lang><strong>LANG</strong></a>: <a href=https://ext.pigsty.io/#/pg_tle><code>pg_tle</code></a> <a href=https://ext.pigsty.io/#/plv8><code>plv8</code></a> <a href=https://ext.pigsty.io/#/pllua><code>pllua</code></a> <a href=https://ext.pigsty.io/#/hstore_pllua><code>hstore_pllua</code></a> <a href=https://ext.pigsty.io/#/plluau><code>plluau</code></a> <a href=https://ext.pigsty.io/#/hstore_plluau><code>hstore_plluau</code></a> <a href=https://ext.pigsty.io/#/plprql><code>plprql</code></a> <a href=https://ext.pigsty.io/#/pldbgapi><code>pldbgapi</code></a> <a href=https://ext.pigsty.io/#/plpgsql_check><code>plpgsql_check</code></a> <a href=https://ext.pigsty.io/#/plprofiler><code>plprofiler</code></a> <a href=https://ext.pigsty.io/#/plsh><code>plsh</code></a> <a href=https://ext.pigsty.io/#/pljava><code>pljava</code></a> <a href=https://ext.pigsty.io/#/plr><code>plr</code></a> <a href=https://ext.pigsty.io/#/pgtap><code>pgtap</code></a> <a href=https://ext.pigsty.io/#/faker><code>faker</code></a> <a href=https://ext.pigsty.io/#/dbt2><code>dbt2</code></a> <a href=https://ext.pigsty.io/#/pltcl><code>pltcl</code></a> <a href=https://ext.pigsty.io/#/pltclu><code>pltclu</code></a> <a href=https://ext.pigsty.io/#/plperl><code>plperl</code></a> <a href=https://ext.pigsty.io/#/bool_plperl><code>bool_plperl</code></a> <a href=https://ext.pigsty.io/#/hstore_plperl><code>hstore_plperl</code></a> <a href=https://ext.pigsty.io/#/jsonb_plperl><code>jsonb_plperl</code></a> <a href=https://ext.pigsty.io/#/plperlu><code>plperlu</code></a> <a href=https://ext.pigsty.io/#/bool_plperlu><code>bool_plperlu</code></a> <a href=https://ext.pigsty.io/#/jsonb_plperlu><code>jsonb_plperlu</code></a> <a href=https://ext.pigsty.io/#/hstore_plperlu><code>hstore_plperlu</code></a> <a href=https://ext.pigsty.io/#/plpgsql><code>plpgsql</code></a> <a href=https://ext.pigsty.io/#/plpython3u><code>plpython3u</code></a> <a href=https://ext.pigsty.io/#/jsonb_plpython3u><code>jsonb_plpython3u</code></a> <a href=https://ext.pigsty.io/#/ltree_plpython3u><code>ltree_plpython3u</code></a> <a href=https://ext.pigsty.io/#/hstore_plpython3u><code>hstore_plpython3u</code></a>
<a href=https://ext.pigsty.io/#/type><strong>TYPE</strong></a>: <a href=https://ext.pigsty.io/#/prefix><code>prefix</code></a> <a href=https://ext.pigsty.io/#/semver><code>semver</code></a> <a href=https://ext.pigsty.io/#/unit><code>unit</code></a> <a href=https://ext.pigsty.io/#/md5hash><code>md5hash</code></a> <a href=https://ext.pigsty.io/#/asn1oid><code>asn1oid</code></a> <a href=https://ext.pigsty.io/#/roaringbitmap><code>roaringbitmap</code></a> <a href=https://ext.pigsty.io/#/pgfaceting><code>pgfaceting</code></a> <a href=https://ext.pigsty.io/#/pg_sphere><code>pg_sphere</code></a> <a href=https://ext.pigsty.io/#/country><code>country</code></a> <a href=https://ext.pigsty.io/#/currency><code>currency</code></a> <a href=https://ext.pigsty.io/#/pgmp><code>pgmp</code></a> <a href=https://ext.pigsty.io/#/numeral><code>numeral</code></a> <a href=https://ext.pigsty.io/#/pg_rational><code>pg_rational</code></a> <a href=https://ext.pigsty.io/#/uint><code>uint</code></a> <a href=https://ext.pigsty.io/#/uint128><code>uint128</code></a> <a href=https://ext.pigsty.io/#/ip4r><code>ip4r</code></a> <a href=https://ext.pigsty.io/#/uri><code>uri</code></a> <a href=https://ext.pigsty.io/#/pgemailaddr><code>pgemailaddr</code></a> <a href=https://ext.pigsty.io/#/acl><code>acl</code></a> <a href=https://ext.pigsty.io/#/debversion><code>debversion</code></a> <a href=https://ext.pigsty.io/#/pg_rrule><code>pg_rrule</code></a> <a href=https://ext.pigsty.io/#/timestamp9><code>timestamp9</code></a> <a href=https://ext.pigsty.io/#/chkpass><code>chkpass</code></a> <a href=https://ext.pigsty.io/#/isn><code>isn</code></a> <a href=https://ext.pigsty.io/#/seg><code>seg</code></a> <a href=https://ext.pigsty.io/#/cube><code>cube</code></a> <a href=https://ext.pigsty.io/#/ltree><code>ltree</code></a> <a href=https://ext.pigsty.io/#/hstore><code>hstore</code></a> <a href=https://ext.pigsty.io/#/citext><code>citext</code></a> <a href=https://ext.pigsty.io/#/xml2><code>xml2</code></a>
<a href=https://ext.pigsty.io/#/func><strong>FUNC</strong></a>: <a href=https://ext.pigsty.io/#/topn><code>topn</code></a> <a href=https://ext.pigsty.io/#/gzip><code>gzip</code></a> <a href=https://ext.pigsty.io/#/zstd><code>zstd</code></a> <a href=https://ext.pigsty.io/#/http><code>http</code></a> <a href=https://ext.pigsty.io/#/pg_net><code>pg_net</code></a> <a href=https://ext.pigsty.io/#/pg_smtp_client><code>pg_smtp_client</code></a> <a href=https://ext.pigsty.io/#/pg_html5_email_address><code>pg_html5_email_address</code></a> <a href=https://ext.pigsty.io/#/pgsql_tweaks><code>pgsql_tweaks</code></a> <a href=https://ext.pigsty.io/#/pg_extra_time><code>pg_extra_time</code></a> <a href=https://ext.pigsty.io/#/timeit><code>timeit</code></a> <a href=https://ext.pigsty.io/#/count_distinct><code>count_distinct</code></a> <a href=https://ext.pigsty.io/#/extra_window_functions><code>extra_window_functions</code></a> <a href=https://ext.pigsty.io/#/first_last_agg><code>first_last_agg</code></a> <a href=https://ext.pigsty.io/#/tdigest><code>tdigest</code></a> <a href=https://ext.pigsty.io/#/aggs_for_vecs><code>aggs_for_vecs</code></a> <a href=https://ext.pigsty.io/#/aggs_for_arrays><code>aggs_for_arrays</code></a> <a href=https://ext.pigsty.io/#/arraymath><code>arraymath</code></a> <a href=https://ext.pigsty.io/#/quantile><code>quantile</code></a> <a href=https://ext.pigsty.io/#/lower_quantile><code>lower_quantile</code></a> <a href=https://ext.pigsty.io/#/pg_idkit><code>pg_idkit</code></a> <a href=https://ext.pigsty.io/#/pg_uuidv7><code>pg_uuidv7</code></a> <a href=https://ext.pigsty.io/#/permuteseq><code>permuteseq</code></a> <a href=https://ext.pigsty.io/#/pg_hashids><code>pg_hashids</code></a> <a href=https://ext.pigsty.io/#/sequential_uuids><code>sequential_uuids</code></a> <a href=https://ext.pigsty.io/#/pg_math><code>pg_math</code></a> <a href=https://ext.pigsty.io/#/random><code>random</code></a> <a href=https://ext.pigsty.io/#/base36><code>base36</code></a> <a href=https://ext.pigsty.io/#/base62><code>base62</code></a> <a href=https://ext.pigsty.io/#/pg_base58><code>pg_base58</code></a> <a href=https://ext.pigsty.io/#/floatvec><code>floatvec</code></a> <a href=https://ext.pigsty.io/#/financial><code>financial</code></a> <a href=https://ext.pigsty.io/#/pgjwt><code>pgjwt</code></a> <a href=https://ext.pigsty.io/#/pg_hashlib><code>pg_hashlib</code></a> <a href=https://ext.pigsty.io/#/shacrypt><code>shacrypt</code></a> <a href=https://ext.pigsty.io/#/cryptint><code>cryptint</code></a> <a href=https://ext.pigsty.io/#/pguecc><code>pguecc</code></a> <a href=https://ext.pigsty.io/#/pgpcre><code>pgpcre</code></a> <a href=https://ext.pigsty.io/#/icu_ext><code>icu_ext</code></a> <a href=https://ext.pigsty.io/#/pgqr><code>pgqr</code></a> <a href=https://ext.pigsty.io/#/envvar><code>envvar</code></a> <a href=https://ext.pigsty.io/#/pg_protobuf><code>pg_protobuf</code></a> <a href=https://ext.pigsty.io/#/url_encode><code>url_encode</code></a> <a href=https://ext.pigsty.io/#/refint><code>refint</code></a> <a href=https://ext.pigsty.io/#/autoinc><code>autoinc</code></a> <a href=https://ext.pigsty.io/#/insert_username><code>insert_username</code></a> <a href=https://ext.pigsty.io/#/moddatetime><code>moddatetime</code></a> <a href=https://ext.pigsty.io/#/tsm_system_time><code>tsm_system_time</code></a> <a href=https://ext.pigsty.io/#/dict_xsyn><code>dict_xsyn</code></a> <a href=https://ext.pigsty.io/#/tsm_system_rows><code>tsm_system_rows</code></a> <a href=https://ext.pigsty.io/#/tcn><code>tcn</code></a> <a href=https://ext.pigsty.io/#/uuid-ossp><code>uuid-ossp</code></a> <a href=https://ext.pigsty.io/#/btree_gist><code>btree_gist</code></a> <a href=https://ext.pigsty.io/#/btree_gin><code>btree_gin</code></a> <a href=https://ext.pigsty.io/#/intarray><code>intarray</code></a> <a href=https://ext.pigsty.io/#/intagg><code>intagg</code></a> <a href=https://ext.pigsty.io/#/dict_int><code>dict_int</code></a> <a href=https://ext.pigsty.io/#/unaccent><code>unaccent</code></a>
<a href=https://ext.pigsty.io/#/admin><strong>ADMIN</strong></a>: <a href=https://ext.pigsty.io/#/pg_repack><code>pg_repack</code></a> <a href=https://ext.pigsty.io/#/pg_squeeze><code>pg_squeeze</code></a> <a href=https://ext.pigsty.io/#/pg_dirtyread><code>pg_dirtyread</code></a> <a href=https://ext.pigsty.io/#/pgfincore><code>pgfincore</code></a> <a href=https://ext.pigsty.io/#/pgdd><code>pgdd</code></a> <a href=https://ext.pigsty.io/#/ddlx><code>ddlx</code></a> <a href=https://ext.pigsty.io/#/prioritize><code>prioritize</code></a> <a href=https://ext.pigsty.io/#/pg_checksums><code>pg_checksums</code></a> <a href=https://ext.pigsty.io/#/pg_readonly><code>pg_readonly</code></a> <a href=https://ext.pigsty.io/#/safeupdate><code>safeupdate</code></a> <a href=https://ext.pigsty.io/#/pg_permissions><code>pg_permissions</code></a> <a href=https://ext.pigsty.io/#/pgautofailover><code>pgautofailover</code></a> <a href=https://ext.pigsty.io/#/pg_catcheck><code>pg_catcheck</code></a> <a href=https://ext.pigsty.io/#/pre_prepare><code>pre_prepare</code></a> <a href=https://ext.pigsty.io/#/pgcozy><code>pgcozy</code></a> <a href=https://ext.pigsty.io/#/pg_orphaned><code>pg_orphaned</code></a> <a href=https://ext.pigsty.io/#/pg_crash><code>pg_crash</code></a> <a href=https://ext.pigsty.io/#/pg_cheat_funcs><code>pg_cheat_funcs</code></a> <a href=https://ext.pigsty.io/#/pg_savior><code>pg_savior</code></a> <a href=https://ext.pigsty.io/#/table_log><code>table_log</code></a> <a href=https://ext.pigsty.io/#/pg_fio><code>pg_fio</code></a> <a href=https://ext.pigsty.io/#/pgpool_adm><code>pgpool_adm</code></a> <a href=https://ext.pigsty.io/#/pgpool_recovery><code>pgpool_recovery</code></a> <a href=https://ext.pigsty.io/#/pgpool_regclass><code>pgpool_regclass</code></a> <a href=https://ext.pigsty.io/#/pgagent><code>pgagent</code></a> <a href=https://ext.pigsty.io/#/vacuumlo><code>vacuumlo</code></a> <a href=https://ext.pigsty.io/#/pg_prewarm><code>pg_prewarm</code></a> <a href=https://ext.pigsty.io/#/oid2name><code>oid2name</code></a> <a href=https://ext.pigsty.io/#/lo><code>lo</code></a> <a href=https://ext.pigsty.io/#/basic_archive><code>basic_archive</code></a> <a href=https://ext.pigsty.io/#/basebackup_to_shell><code>basebackup_to_shell</code></a> <a href=https://ext.pigsty.io/#/old_snapshot><code>old_snapshot</code></a> <a href=https://ext.pigsty.io/#/adminpack><code>adminpack</code></a> <a href=https://ext.pigsty.io/#/amcheck><code>amcheck</code></a> <a href=https://ext.pigsty.io/#/pg_surgery><code>pg_surgery</code></a>
<a href=https://ext.pigsty.io/#/stat><strong>STAT</strong></a>: <a href=https://ext.pigsty.io/#/pg_profile><code>pg_profile</code></a> <a href=https://ext.pigsty.io/#/pg_show_plans><code>pg_show_plans</code></a> <a href=https://ext.pigsty.io/#/pg_stat_kcache><code>pg_stat_kcache</code></a> <a href=https://ext.pigsty.io/#/pg_stat_monitor><code>pg_stat_monitor</code></a> <a href=https://ext.pigsty.io/#/pg_qualstats><code>pg_qualstats</code></a> <a href=https://ext.pigsty.io/#/pg_store_plans><code>pg_store_plans</code></a> <a href=https://ext.pigsty.io/#/pg_track_settings><code>pg_track_settings</code></a> <a href=https://ext.pigsty.io/#/pg_wait_sampling><code>pg_wait_sampling</code></a> <a href=https://ext.pigsty.io/#/system_stats><code>system_stats</code></a> <a href=https://ext.pigsty.io/#/meta><code>meta</code></a> <a href=https://ext.pigsty.io/#/pgnodemx><code>pgnodemx</code></a> <a href=https://ext.pigsty.io/#/pg_proctab><code>pg_proctab</code></a> <a href=https://ext.pigsty.io/#/pg_sqlog><code>pg_sqlog</code></a> <a href=https://ext.pigsty.io/#/bgw_replstatus><code>bgw_replstatus</code></a> <a href=https://ext.pigsty.io/#/pgmeminfo><code>pgmeminfo</code></a> <a href=https://ext.pigsty.io/#/toastinfo><code>toastinfo</code></a> <a href=https://ext.pigsty.io/#/explain_ui><code>explain_ui</code></a> <a href=https://ext.pigsty.io/#/pg_relusage><code>pg_relusage</code></a> <a href=https://ext.pigsty.io/#/pg_top><code>pg_top</code></a> <a href=https://ext.pigsty.io/#/pagevis><code>pagevis</code></a> <a href=https://ext.pigsty.io/#/powa><code>powa</code></a> <a href=https://ext.pigsty.io/#/pageinspect><code>pageinspect</code></a> <a href=https://ext.pigsty.io/#/pgrowlocks><code>pgrowlocks</code></a> <a href=https://ext.pigsty.io/#/sslinfo><code>sslinfo</code></a> <a href=https://ext.pigsty.io/#/pg_buffercache><code>pg_buffercache</code></a> <a href=https://ext.pigsty.io/#/pg_walinspect><code>pg_walinspect</code></a> <a href=https://ext.pigsty.io/#/pg_freespacemap><code>pg_freespacemap</code></a> <a href=https://ext.pigsty.io/#/pg_visibility><code>pg_visibility</code></a> <a href=https://ext.pigsty.io/#/pgstattuple><code>pgstattuple</code></a> <a href=https://ext.pigsty.io/#/auto_explain><code>auto_explain</code></a> <a href=https://ext.pigsty.io/#/pg_stat_statements><code>pg_stat_statements</code></a>
<a href=https://ext.pigsty.io/#/sec><strong>SEC</strong></a>: <a href=https://ext.pigsty.io/#/passwordcheck_cracklib><code>passwordcheck_cracklib</code></a> <a href=https://ext.pigsty.io/#/supautils><code>supautils</code></a> <a href=https://ext.pigsty.io/#/pgsodium><code>pgsodium</code></a> <a href=https://ext.pigsty.io/#/supabase_vault><code>supabase_vault</code></a> <a href=https://ext.pigsty.io/#/pg_session_jwt><code>pg_session_jwt</code></a> <a href=https://ext.pigsty.io/#/anon><code>anon</code></a> <a href=https://ext.pigsty.io/#/pg_tde><code>pg_tde</code></a> <a href=https://ext.pigsty.io/#/pgsmcrypto><code>pgsmcrypto</code></a> <a href=https://ext.pigsty.io/#/pgaudit><code>pgaudit</code></a> <a href=https://ext.pigsty.io/#/pgauditlogtofile><code>pgauditlogtofile</code></a> <a href=https://ext.pigsty.io/#/pg_auth_mon><code>pg_auth_mon</code></a> <a href=https://ext.pigsty.io/#/credcheck><code>credcheck</code></a> <a href=https://ext.pigsty.io/#/pgcryptokey><code>pgcryptokey</code></a> <a href=https://ext.pigsty.io/#/pg_jobmon><code>pg_jobmon</code></a> <a href=https://ext.pigsty.io/#/logerrors><code>logerrors</code></a> <a href=https://ext.pigsty.io/#/login_hook><code>login_hook</code></a> <a href=https://ext.pigsty.io/#/set_user><code>set_user</code></a> <a href=https://ext.pigsty.io/#/pg_snakeoil><code>pg_snakeoil</code></a> <a href=https://ext.pigsty.io/#/pgextwlist><code>pgextwlist</code></a> <a href=https://ext.pigsty.io/#/pg_auditor><code>pg_auditor</code></a> <a href=https://ext.pigsty.io/#/sslutils><code>sslutils</code></a> <a href=https://ext.pigsty.io/#/noset><code>noset</code></a> <a href=https://ext.pigsty.io/#/sepgsql><code>sepgsql</code></a> <a href=https://ext.pigsty.io/#/auth_delay><code>auth_delay</code></a> <a href=https://ext.pigsty.io/#/pgcrypto><code>pgcrypto</code></a> <a href=https://ext.pigsty.io/#/passwordcheck><code>passwordcheck</code></a>
<a href=https://ext.pigsty.io/#/fdw><strong>FDW</strong></a>: <a href=https://ext.pigsty.io/#/wrappers><code>wrappers</code></a> <a href=https://ext.pigsty.io/#/multicorn><code>multicorn</code></a> <a href=https://ext.pigsty.io/#/odbc_fdw><code>odbc_fdw</code></a> <a href=https://ext.pigsty.io/#/jdbc_fdw><code>jdbc_fdw</code></a> <a href=https://ext.pigsty.io/#/mysql_fdw><code>mysql_fdw</code></a> <a href=https://ext.pigsty.io/#/oracle_fdw><code>oracle_fdw</code></a> <a href=https://ext.pigsty.io/#/tds_fdw><code>tds_fdw</code></a> <a href=https://ext.pigsty.io/#/db2_fdw><code>db2_fdw</code></a> <a href=https://ext.pigsty.io/#/sqlite_fdw><code>sqlite_fdw</code></a> <a href=https://ext.pigsty.io/#/pgbouncer_fdw><code>pgbouncer_fdw</code></a> <a href=https://ext.pigsty.io/#/mongo_fdw><code>mongo_fdw</code></a> <a href=https://ext.pigsty.io/#/redis_fdw><code>redis_fdw</code></a> <a href=https://ext.pigsty.io/#/redis><code>redis</code></a> <a href=https://ext.pigsty.io/#/kafka_fdw><code>kafka_fdw</code></a> <a href=https://ext.pigsty.io/#/hdfs_fdw><code>hdfs_fdw</code></a> <a href=https://ext.pigsty.io/#/firebird_fdw><code>firebird_fdw</code></a> <a href=https://ext.pigsty.io/#/aws_s3><code>aws_s3</code></a> <a href=https://ext.pigsty.io/#/log_fdw><code>log_fdw</code></a> <a href=https://ext.pigsty.io/#/dblink><code>dblink</code></a> <a href=https://ext.pigsty.io/#/file_fdw><code>file_fdw</code></a> <a href=https://ext.pigsty.io/#/postgres_fdw><code>postgres_fdw</code></a>
<a href=https://ext.pigsty.io/#/sim><strong>SIM</strong></a>: <a href=https://ext.pigsty.io/#/orafce><code>orafce</code></a> <a href=https://ext.pigsty.io/#/pgtt><code>pgtt</code></a> <a href=https://ext.pigsty.io/#/session_variable><code>session_variable</code></a> <a href=https://ext.pigsty.io/#/pg_statement_rollback><code>pg_statement_rollback</code></a> <a href=https://ext.pigsty.io/#/pg_dbms_metadata><code>pg_dbms_metadata</code></a> <a href=https://ext.pigsty.io/#/pg_dbms_lock><code>pg_dbms_lock</code></a> <a href=https://ext.pigsty.io/#/pg_dbms_job><code>pg_dbms_job</code></a> <a href=https://ext.pigsty.io/#/babelfishpg_common><code>babelfishpg_common</code></a> <a href=https://ext.pigsty.io/#/babelfishpg_tsql><code>babelfishpg_tsql</code></a> <a href=https://ext.pigsty.io/#/babelfishpg_tds><code>babelfishpg_tds</code></a> <a href=https://ext.pigsty.io/#/babelfishpg_money><code>babelfishpg_money</code></a> <a href=https://ext.pigsty.io/#/pgmemcache><code>pgmemcache</code></a>
<a href=https://ext.pigsty.io/#/etl><strong>ETL</strong></a>: <a href=https://ext.pigsty.io/#/pglogical><code>pglogical</code></a> <a href=https://ext.pigsty.io/#/pglogical_origin><code>pglogical_origin</code></a> <a href=https://ext.pigsty.io/#/pglogical_ticker><code>pglogical_ticker</code></a> <a href=https://ext.pigsty.io/#/pgl_ddl_deploy><code>pgl_ddl_deploy</code></a> <a href=https://ext.pigsty.io/#/pg_failover_slots><code>pg_failover_slots</code></a> <a href=https://ext.pigsty.io/#/wal2json><code>wal2json</code></a> <a href=https://ext.pigsty.io/#/wal2mongo><code>wal2mongo</code></a> <a href=https://ext.pigsty.io/#/decoderbufs><code>decoderbufs</code></a> <a href=https://ext.pigsty.io/#/decoder_raw><code>decoder_raw</code></a> <a href=https://ext.pigsty.io/#/test_decoding><code>test_decoding</code></a> <a href=https://ext.pigsty.io/#/mimeo><code>mimeo</code></a> <a href=https://ext.pigsty.io/#/repmgr><code>repmgr</code></a> <a href=https://ext.pigsty.io/#/pg_fact_loader><code>pg_fact_loader</code></a> <a href=https://ext.pigsty.io/#/pg_bulkload><code>pg_bulkload</code></a></p><p>Since most of the supabase maintained extensions are not available in the official PGDG repo,
we have compiled all the RPM/DEBs for these extensions and put them in the <a href=https://ext.pigsty.io>Pigsty repo</a>:
<a href=https://ext.pigsty.io/#/pg_graphql>pg_graphql</a>, <a href=https://ext.pigsty.io/#/pg_jsonschema>pg_jsonschema</a>, <a href=https://ext.pigsty.io/#/wrappers>wrappers</a>, <a href=https://ext.pigsty.io/#/index_advisor>index_advisor</a>, <a href=https://ext.pigsty.io/#/pg_net>pg_net</a>, <a href=https://ext.pigsty.io/#/vault>vault</a>, <a href=https://ext.pigsty.io/#/pgjwt>pgjwt</a>, <a href=https://ext.pigsty.io/#/supautils>supautils</a>, <a href=https://ext.pigsty.io/#/plan_filter>pg_plan_filter</a>,</p><p>Everything is under your control, you have the ability and freedom to scale PGSQL, MinIO, and Supabase itself.
And take full advantage of the performance and cost advantages of modern hardware like Gen5 NVMe SSD.</p><p>All you need is prepare a VM with several commands and wait for 10 minutes&mldr;.</p><hr><h2 id=get-started>Get Started</h2><p>First, download & <a href=/docs/setup/install>install</a> pigsty as usual, with the <code>supa</code> config template:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash
</span></span><span style=display:flex><span>./bootstrap          <span style=color:#8f5902;font-style:italic># install deps (ansible)</span>
</span></span><span style=display:flex><span>./configure -c supa  <span style=color:#8f5902;font-style:italic># use supa config template (IMPORTANT: CHANGE PASSWORDS!)</span>
</span></span><span style=display:flex><span>./deploy.yml         <span style=color:#8f5902;font-style:italic># install pigsty, create ha postgres &amp; minio clusters </span>
</span></span></code></pre></div><blockquote><p>Please change the <code>pigsty.yml</code> config file according to your need before deploying Supabase. (<strong>Credentials</strong>)
For dev/test/demo purposes, we will just skip that, and comes back later.</p></blockquote><p>Then, run the <a href=https://github.com/pgsty/pigsty/blob/main/supabase.yml><code>supabase.yml</code></a> to launch stateless part of supabase.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./supabase.yml       <span style=color:#8f5902;font-style:italic># launch stateless supabase containers with docker compose</span>
</span></span></code></pre></div><p>You can access the supabase API / Web UI through the <code>8000/8443</code> directly.</p><p>with configured DNS, or a local <code>/etc/hosts</code> entry, you can also use the default <code>supa.pigsty</code> domain name via the 80/443 infra portal.</p><blockquote><p>Credentials for Supabase Studio: <code>supabase</code> : <code>pigsty</code></p></blockquote><p><a href=https://asciinema.org/a/692194><img src=https://asciinema.org/a/692194.svg alt=asciicast></a></p><hr><h2 id=architecture>Architecture</h2><p>Pigsty&rsquo;s supabase is based on the <a href=https://supabase.com/docs/guides/self-hosting/docker>Supabase Docker Compose Template</a>,
with some slight modifications to fit-in Pigsty&rsquo;s default <a href=/docs/pgsql/misc/acl>ACL</a> model.</p><p>The stateful part of this template is replaced by Pigsty&rsquo;s managed PostgreSQL cluster and MinIO cluster.
The container part are stateless, so you can launch / destroy / run multiple supabase containers on the same stateful PGSQL / MINIO cluster simultaneously to scale out.</p><p><img src=/img/pigsty/supa-arch.svg alt></p><p>The built-in <a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml><code>supa.yml</code></a> <a href=/docs/conf/supabase>config</a> template will create a single-node supabase, with a <a href=/docs/pgsql>singleton PostgreSQL</a> and SNSD <a href=/docs/minio>MinIO</a> server.
You can use <a href=/docs/pgsql/config#replica>Multinode PostgreSQL Clusters</a> and <a href=/docs/minio/config#multi-node-multi-drive>MNMD MinIO Clusters</a> / external S3 service instead in production, we will cover that later.</p><hr><h2 id=config-detail>Config Detail</h2><p>Here are checklists for self-hosting</p><ul><li><input checked disabled type=checkbox> <a href=/docs/deploy/prepare#node><strong>Hardware</strong></a>: necessary VM/BM resources, one node at least, 3-4 are recommended for HA.</li><li><input checked disabled type=checkbox> <a href=/docs/deploy/prepare#operating-system><strong>Linux OS</strong></a>: Linux x86_64 server with fresh installed Linux, <a href=/docs/ref/linux>check compatible distro</a></li><li><input checked disabled type=checkbox> <a href=/docs/deploy/prepare#network><strong>Network</strong></a>: Static IPv4 address which can be used as node identity</li><li><input checked disabled type=checkbox> <a href=/docs/deploy/prepare#admin-user><strong>Admin User</strong></a>: nopass ssh & sudo are recommended for admin user</li><li><input checked disabled type=checkbox> <a href=/docs/setup/config><strong>Conf Template</strong></a>: Use the <a href=/docs/conf/supabase><code>supa</code></a> config template, if you don&rsquo;t know how to manually configure pigsty</li></ul><p>The built-in <a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml><code>supa.yml</code></a> config template is shown below.</p><br><details><summary>The supa Config Template</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># infra cluster for proxy, monitor, alert, etc..</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># etcd cluster for ha postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># minio cluster, s3 compatible object storage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># pg-meta, the underlying postgres database for supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># supabase roles: anon, authenticated, dashboard_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: anon           ,login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: authenticated  ,login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dashboard_user ,login: false ,replication: true ,createdb: true ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: service_role   ,login: false ,bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># supabase users: please use the same password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_admin             ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: true   ,roles: [ dbrole_admin ] ,superuser: true ,replication: true ,createdb: true ,createrole: true ,bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: authenticator              ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin, authenticated ,anon ,service_role ] }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_auth_admin        ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles: [ dbrole_admin ] ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_storage_admin     ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles: [ dbrole_admin, authenticated ,anon ,service_role ] ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_functions_admin   ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles: [ dbrole_admin ] ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_replication_admin ,password: &#39;DBUser.Supa&#39; ,replication: true ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_read_only_user    ,password: &#39;DBUser.Supa&#39; ,bypassrls: true ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_readonly, pg_read_all_data ] }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>baseline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase.sql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase postgres database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>extensions ,auth ,realtime ,storage ,graphql_public ,supabase_functions ,_analytics ,_realtime ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgcrypto  ,schema: extensions  } # 1.3   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cryptographic functions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_net    ,schema: extensions  } # 0.9.2 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>async HTTP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgjwt     ,schema: extensions  } # 0.2.0 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>json web token API for postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: uuid-ossp ,schema: extensions  } # 1.1   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>generate universally unique identifiers (UUIDs)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgsodium        }                # 3.1.9 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsodium is a modern cryptography library for Postgres.</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_vault  }                # 0.2.8 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Supabase Vault Extension</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_graphql      }                # 1.5.9 : pg_graphql</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GraphQL support</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_jsonschema   }                # 0.3.3 : pg_jsonschema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Validate json schema</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: wrappers        }                # 0.4.3 : wrappers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>FDW collections</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: http            }                # 1.6   : http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allows web page retrieval inside the database.</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_cron         }                # 1.6   : pg_cron</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Job scheduler for PostgreSQL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: timescaledb     }                # 2.17  : timescaledb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Enables scalable inserts and complex queries for time-series data</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_tle          }                # 1.2   : pg_tle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trusted Language Extensions for PostgreSQL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: vector          }                # 0.8.0 : pgvector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>the vector similarity search</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># supabase required extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements, plpgsql, plpgsql_check, pg_cron, pg_net, timescaledb, auto_explain, pg_tle, plan_filter&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># extensions to be installed on this cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>supabase  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># essential extensions for supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>timescaledb postgis pg_graphql pg_jsonschema wrappers pg_search pg_analytics pg_parquet plv8 duckdb_fdw pg_cron pg_timetable pgqr</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>supautils pg_plan_filter passwordcheck plpgsql_check pgaudit pgsodium pg_vault pgjwt pg_ecdsa pg_session_jwt index_advisor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>pgvector pgvectorscale pg_summarize pg_tiktoken pg_tle pg_stat_monitor hypopg pg_hint_plan pg_http pg_net pg_smtp_client pg_idkit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>cron.database_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>pgsodium.enable_event_trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>off</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># supabase hba rules, require access from docker network</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all ,db: postgres  ,addr: intra         ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow supabase access from intranet&#39;</span><span style=color:#f8f8f8>    </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all ,db: postgres  ,addr: 172.17.0.0/16 ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow access from local docker network&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># make a full backup every 1am</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># launch supabase stateless part with docker compose: ./supabase.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>supa_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># instance id</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supa           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># cluster name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># enable docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># use these to pull docker images via proxy and mirror registries</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#docker_registry_mirrors: [&#39;https://docker.xxxxx.io&#39;]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#proxy_env:   # add [OPTIONAL] proxy env to /etc/docker/daemon.json configuration file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#  no_proxy: &#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.myqcloud.com,*.tsinghua.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#  #all_proxy: http://user:pass@host:port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># these configuration entries will OVERWRITE or APPEND to /opt/supabase/.env file (src template: app/supabase/.env)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># check https://github.com/pgsty/pigsty/blob/main/app/supabase/.env for default values</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># IMPORTANT: CHANGE JWT_SECRET AND REGENERATE CREDENTIAL ACCORDING!!!!!!!!!!!</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># https://supabase.com/docs/guides/self-hosting/docker#securing-your-services</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>jwt_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your-super-secret-jwt-token-with-at-least-32-characters-long</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>anon_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>service_role_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>dashboard_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>dashboard_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># postgres connection string (use the correct ip and port)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5436</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># access via the &#39;default&#39; service, which always route to the primary postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Supa </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># password for supabase_admin and multiple supabase users</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># expose supabase via domain name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>site_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>api_external_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>supabase_public_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># if using s3/minio as file storage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supa</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_access_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_force_path_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>stub</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>minio_domain_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># sss.pigsty domain name will resolve to this ip statically</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># if using SMTP (optional)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_admin_email: admin@example.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_host: supabase-mail</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_port: 2500</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_user: fake_mail_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_pass: fake_mail_password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_sender_name: fake_sender</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#enable_anonymous_users: false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v3.1.0                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pigsty version string</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># admin node ip address</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>region: default                   # upstream mirror region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default|china|europe</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune: oltp                   # node tuning specs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp,olap,tiny,crit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf: oltp.yml                 # pgsql tuning specs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#000>oltp,olap,tiny,crit}.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># domain names and upstream servers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>h.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>prometheus   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9090&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9093&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:9001&#34;</span><span style=color:#204a87;font-weight:700>, https: true, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>loki         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3100&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># expose supa studio UI and API via nginx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>supa         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Credential: CHANGE THESE PASSWORDS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#grafana_admin_username: admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>grafana_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_admin_username: dbuser_dba</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.DBA</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_monitor_username: dbuser_monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_replication_username: replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#patroni_username: postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>patroni_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Patroni.API</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#haproxy_admin_username: admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># use minio as supabase file storage, single node single driver mode for demonstration purpose</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_access_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minioadmin     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># root access key, `minioadmin` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minioadmin     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># root secret key, `minioadmin` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_buckets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }, { name: supa } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: dba , secret_key: S3User.DBA, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consoleAdmin }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest , secret_key: S3User.Backup,   policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: supabase   , secret_key: S3User.Supabase, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9000   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># explicit overwrite minio endpoint with haproxy port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_etc_hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;10.10.10.10 sss.pigsty&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># domain name to access minio from all nodes (required)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># use minio as default backup repo for PostgreSQL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_method: minio          # pgbackrest repo method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local,minio,[user-defined...]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_repo:                  # pgbackrest repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://pgbackrest.org/configuration.html#section-repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># default pgbackrest repo with local posix fs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/backup             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># local backup directory, `/pg/backup` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>count   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backups by count</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># keep 2, at most 3 full backup when using local fs repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># optional minio repo for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio is s3-compatible, so s3 is used</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss.pigsty      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio endpoint domain name, `sss.pigsty` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>us-east-1         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio region, us-east-1 by default, useless for minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio bucket name, `pgsql` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbackrest           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio user access key for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Backup </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio user secret key for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>path           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># use path style uri for minio rather than host style</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio backup path, default is `/pgbackrest`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>storage_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># minio port, 9000 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>storage_ca_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/cert/ca.crt </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio ca file path, `/pg/cert/ca.crt` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># bundle small files into a single file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># enable AES encryption for remote backup repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># AES encryption password, default is &#39;pgBackRest&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backup by time on minio repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># keep full backup for last 14 days</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># download docker and supabase related extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>17</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>node,pgsql,infra,docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-utility, docker ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_extra_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>pgsql-main</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>supabase  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># essential extensions for supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>timescaledb postgis pg_graphql pg_jsonschema wrappers pg_search pg_analytics pg_parquet plv8 duckdb_fdw pg_cron pg_timetable pgqr</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>supautils pg_plan_filter passwordcheck plpgsql_check pgaudit pgsodium pg_vault pgjwt pg_ecdsa pg_session_jwt index_advisor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>pgvector pgvectorscale pg_summarize pg_tiktoken pg_tle pg_stat_monitor hypopg pg_hint_plan pg_http pg_net pg_smtp_client pg_idkit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></details><br><p>For advanced topics, we may need to modify the configuration file to fit our needs.</p><ul><li><a href=#security-enhancement>Security Enhancement</a></li><li><a href=#domain-name-and-https>Domain Name and HTTPS</a></li><li><a href=#sending-mail-with-smtp>Sending Mail with SMTP</a></li><li><a href=#minio-or-external-s3>MinIO or External S3</a></li><li><a href=#true-high-availability>True High Availability</a></li></ul><hr><h2 id=security-enhancement>Security Enhancement</h2><p>For security reasons, you should change the default passwords in the <code>pigsty.yml</code> config file.</p><ul><li><a href=/docs/pgsql/param/#grafana_admin_password><code>grafana_admin_password</code></a>: <code>pigsty</code>, Grafana admin password</li><li><a href=/docs/pgsql/param/#pg_admin_password><code>pg_admin_password</code></a>: <code>DBUser.DBA</code>, PGSQL superuser password</li><li><a href=/docs/pgsql/param/#pg_monitor_password><code>pg_monitor_password</code></a>: <code>DBUser.Monitor</code>, PGSQL monitor user password</li><li><a href=/docs/pgsql/param/#pg_replication_password><code>pg_replication_password</code></a>: <code>DBUser.Replicator</code>, PGSQL replication user password</li><li><a href=/docs/pgsql/param/#patroni_password><code>patroni_password</code></a>: <code>Patroni.API</code>, Patroni HA Agent Password</li><li><a href=/docs/pgsql/param/#haproxy_admin_password><code>haproxy_admin_password</code></a>: <code>pigsty</code>, Load balancer admin password</li><li><a href=/docs/minio/param#grafana_admin_password><code>minio_access_key</code></a>: <code>minioadmin</code>, MinIO root username</li><li><a href=/docs/minio/param#minio_secret_key><code>minio_secret_key</code></a>: <code>minioadmin</code>, MinIO root password</li></ul><p>Supabase will use PostgreSQL & MinIO as its backend, so also change the following passwords for supabase business users:</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#L49><code>pg_users</code></a>: password for supabase business users in postgres</li><li><a href=/docs/minio/param#minio_secret_key><code>minio_users</code></a>: <code>minioadmin</code>, MinIO business user&rsquo;s password</li></ul><p>The pgbackrest will take backups and WALs to MinIO, so also change the following passwords reference</p><ul><li><a href=/docs/minio/param#pgbackrest_repo><code>pgbackrest_repo</code></a>: refer to the</li></ul><p>PLEASE check the <a href=https://supabase.com/docs/guides/self-hosting/docker#generate-api-keys>Supabase Self-Hosting: Generate API Keys</a> to generate supabase credentials:</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#L114><code>jwt_secret</code></a>: a secret key with at least 40 characters</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#L115><code>anon_key</code></a>: a jwt token generate for anonymous users, based on <code>jwt_secret</code></li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#L116><code>service_role_key</code></a>: a jwt token generate for elevated service roles, based on <code>jwt_secret</code></li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#L117><code>dashboard_username</code></a>: supabase studio web portal username, <code>supabase</code> by default</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#L128><code>dashboard_password</code></a>: supabase studio web portal password, <code>pigsty</code> by default</li></ul><p>If you have chanaged the default password for PostgreSQL and MinIO, you have to update the following parameters as well:</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#L126><code>postgres_password</code></a>, according to <a href=/docs/pgsql/admin/user><code>pg_users</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#136><code>s3_access_key</code></a> and <a href=https://github.com/pgsty/pigsty/blob/main/conf/supa.yml#137><code>s3_secret_key</code></a>, according to <a href=/docs/minio/param#minio_users><code>minio_users</code></a></li></ul><hr><h2 id=domain-name-and-https>Domain Name and HTTPS</h2><p>For local or intranet use, you can connect directly to Kong port on <code>http://&lt;IP>:8000</code> or <code>8443</code> for https.
This works but isn’t ideal. Using a domain with HTTPS is strongly recommended when serving Supabase to the public.</p><p>Pigsty has a Nginx server installed & configured on the admin node to act as a reverse proxy for all web based service. which is configured via the <code>infra_portal</code> parameter.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># global vars</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#.....</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># domain names and upstream servers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>h.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>prometheus   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9090&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9093&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:9001&#34;</span><span style=color:#204a87;font-weight:700>, https: true, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>loki         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3100&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># expose supa studio UI and API via nginx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>supa         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>On the client side, you can use the domain <code>supa.pigsty</code> to access the Supabase Studio management interface.
You can add this domain to your local <code>/etc/hosts</code> file or use a local DNS server to resolve it to the server&rsquo;s <strong>external</strong> IP address.</p><p>To use a real domain with HTTPS, you will need to modify the <code>all.vars.infra_portal.supa</code> with updated domain name (such as <code>supa.pigsty.cc</code> here).
You can obtain a free HTTPS certificate from <a href=https://letsencrypt.org/>Let’s Encrypt</a>, and just put the cert/key files in the specified path.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#supa : { domain: supa.pigsty ,endpoint: &#34;10.10.10.10:8000&#34;, websocket: true }  # add your HTTPS certs/keys and specify the path</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>supa  </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8000&#34;</span><span style=color:#204a87;font-weight:700>, websocket: true ,cert: /etc/cert/suap.pigsty.cc.crt ,key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/cert/supa.pigsty.cc.key }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>To reload the new configuration after installation, use the <code>infra.yml</code> playbook:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_config,nginx_launch   <span style=color:#8f5902;font-style:italic># reload nginx config</span>
</span></span></code></pre></div><p>You also have to update the <code>all.children.supabase.vars.supa_config</code> to tell supabase to use the new domain name:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># clusters</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># supabase group</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># supabase param</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># supabase config</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># update supabase domain names here</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>site_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty.cc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>api_external_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty.cc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>supabase_public_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty.cc</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>And reload the supabase service to apply the new configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./supabase.yml -t supa_config,supa_launch <span style=color:#8f5902;font-style:italic># reload supabase config</span>
</span></span></code></pre></div><hr><h2 id=sending-mail-with-smtp>Sending Mail with SMTP</h2><p>Some Supabase features require email. For production use, I&rsquo;d recommend using an external SMTP service.
Since self-hosted SMTP servers often result in rejected or spam-flagged emails.</p><p>To do this, modify the Supabase configuration and add SMTP credentials:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>smtp_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>smtpdm.aliyun.com:80</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>smtp_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>smtp_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>no_reply@mail.your.domain.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>smtp_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your_email_user_password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>smtp_sender_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>MySupabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>smtp_admin_email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>adminxxx@mail.your.domain.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>enable_anonymous_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>And don&rsquo;t forget to reload the supabase service with <code>./supabase.yml -t supa_config,supa_launch</code></p><hr><h2 id=minio-or-external-s3>MinIO or External S3</h2><p>Pigsty&rsquo;s self-hosting supabase will use a local <a href=/docs/minio/config#single-node-single-drive>SNSD MinIO</a> server,
which is used by Supabase itself for object storage, and by PostgreSQL for backups.
For production use, you should consider using a HA <a href=/docs/minio/config#multi-node-multi-drive>MNMD MinIO</a> cluster or an external S3 compatible service instead.</p><p>We recommend using an external S3 when:</p><ul><li>you just have one single server available, then external s3 gives you a minimal disaster recovery guarantee, with RTO in hours and RPO in MBs.</li><li>you are operating in the cloud, then using S3 directly is recommended rather than wrap expensively EBS with MinIO</li></ul><blockquote><p>The <a href=https://github.com/pgsty/pigsty/blob/main/terraform/spec/aliyun-meta-s3.tf><code>terraform/spec/aliyun-meta-s3.tf</code></a> provides an example of how to provision a single node alone with an S3 bucket.</p></blockquote><p>To use an external S3 compatible service, you&rsquo;ll have to update two related references in the <code>pigsty.yml</code> config.</p><p>For example, to use Aliyun OSS as the object storage for Supabase, you can modify the <code>all.children.supabase.vars.supa_config</code> to point to the Aliyun OSS bucket:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty-oss</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://oss-cn-beijing-internal.aliyuncs.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_access_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>xxxxxxxxxxxxxxxx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>xxxxxxxxxxxxxxxx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_force_path_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oss-cn-beijing</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Reload the supabase service with <code>./supabase.yml -t supa_config,supa_launch</code> again.</p><p>The next reference is in the PostgreSQL backup repo:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># use minio as default backup repo for PostgreSQL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_method: minio          # pgbackrest repo method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local,minio,[user-defined...]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_repo:                  # pgbackrest repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://pgbackrest.org/configuration.html#section-repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># default pgbackrest repo with local posix fs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/backup             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># local backup directory, `/pg/backup` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>count   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backups by count</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># keep 2, at most 3 full backup when using local fs repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># optional minio repo for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio is s3-compatible, so s3 is used</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># update your credentials here</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oss-cn-beijing-internal.aliyuncs.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oss-cn-beijing</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty-oss</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>xxxxxxxxxxxxxx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>xxxxxxxx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>host</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio backup path, default is `/pgbackrest`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>storage_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># minio port, 9000 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>storage_ca_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/cert/ca.crt </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio ca file path, `/pg/cert/ca.crt` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># bundle small files into a single file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># enable AES encryption for remote backup repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># AES encryption password, default is &#39;pgBackRest&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backup by time on minio repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># keep full backup for last 14 days</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>After updating the <code>pgbackrest_repo</code>, you can reset the pgBackrest backup with <code>./pgsql.yml -t pgbackrest</code>.</p><hr><h2 id=true-high-availability>True High Availability</h2><p>The default single-node deployment (with external S3) provide a minimal disaster recovery guarantee, with RTO in hours and RPO in MBs.</p><p>To achieve RTO &lt; 30s and zero data loss, you need a multi-node high availability cluster with at least 3-nodes.</p><p>Which involves high availability for these components:</p><ul><li><a href=/docs/etcd>ETCD</a>: DCS requires at least three nodes to tolerate one node failure.</li><li><a href=/docs/pgsql>PGSQL</a>: PGSQL synchronous commit mode recommends at least three nodes.</li><li><a href=/docs/infra>INFRA</a>: It&rsquo;s good to have two or three copies of observability stack.</li><li>Supabase itself can also have multiple replicas to achieve high availability.</li></ul><p>We recommend you to refer to the <a href=/docs/conf/trio>trio</a> and <a href=/docs/conf/safe>safe</a> config to upgrade your cluster to three nodes or more.</p><p>In this case, you also need to modify the access points for PostgreSQL and MinIO to use the DNS / L2 VIP / HAProxy <a href=/docs/pgsql/misc/svc>HA access points</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>supa_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>supa_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>supa_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supa           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># cluster name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.2</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># use the PG L2 VIP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5433</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># use the 5433 port to access the primary instance through pgbouncer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9002 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># If you are using MinIO through the haproxy lb port 9002</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>minio_domain_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.3</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># use the L2 VIP binds to all proxy nodes</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><details><summary>The 3-Node HA Supabase Config Template</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Clusters, Nodes, and Modules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># infra cluster for proxy, monitor, alert, etc..</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 1 ,nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra-1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 2 ,nodename: infra-2, repo_enabled: false, grafana_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 3 ,nodename: infra-3, repo_enabled: false, grafana_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vip_vrid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>haproxy_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service name, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9002</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service port, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>leastconn            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] load balancer algorithm</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] minio health check</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- <span style=color:#000>option httpchk</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- <span style=color:#000>option http-keep-alive</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- <span style=color:#000>http-check send meth OPTIONS uri /minio/health/live</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- <span style=color:#000>http-check expect status 200</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># dcs service for postgres/patroni ha consensus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 1 node for testing, 3 or 5 for production</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># etcd_seq required</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># assign from 1 ~ n</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># odd number please</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># cluster level parameter override roles/etcd</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># mark etcd cluster name etcd</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>etcd_safeguard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># safeguard against purging</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>etcd_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># purge etcd during init process</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># minio cluster 4-node</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 2 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-2 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 3 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-3 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data{1...4}&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>minio_buckets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }, { name: supa } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: dba , secret_key: S3User.DBA, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consoleAdmin }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest , secret_key: S3User.Backup,   policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: supabase   , secret_key: S3User.Supabase, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># pg-meta, the underlying postgres database for supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># supabase roles: anon, authenticated, dashboard_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: anon           ,login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: authenticated  ,login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dashboard_user ,login: false ,replication: true ,createdb: true ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: service_role   ,login: false ,bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># supabase users: please use the same password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_admin             ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: true   ,roles: [ dbrole_admin ] ,superuser: true ,replication: true ,createdb: true ,createrole: true ,bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: authenticator              ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin, authenticated ,anon ,service_role ] }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_auth_admin        ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles: [ dbrole_admin ] ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_storage_admin     ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles: [ dbrole_admin, authenticated ,anon ,service_role ] ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_functions_admin   ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles: [ dbrole_admin ] ,createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_replication_admin ,password: &#39;DBUser.Supa&#39; ,replication: true ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_read_only_user    ,password: &#39;DBUser.Supa&#39; ,bypassrls: true ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_readonly, pg_read_all_data ] }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>baseline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase.sql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase postgres database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>extensions ,auth ,realtime ,storage ,graphql_public ,supabase_functions ,_analytics ,_realtime ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgcrypto  ,schema: extensions  } # 1.3   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cryptographic functions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_net    ,schema: extensions  } # 0.9.2 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>async HTTP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgjwt     ,schema: extensions  } # 0.2.0 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>json web token API for postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: uuid-ossp ,schema: extensions  } # 1.1   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>generate universally unique identifiers (UUIDs)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgsodium        }                # 3.1.9 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsodium is a modern cryptography library for Postgres.</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: supabase_vault  }                # 0.2.8 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Supabase Vault Extension</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_graphql      }                # 1.5.9 : pg_graphql</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GraphQL support</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_jsonschema   }                # 0.3.3 : pg_jsonschema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Validate json schema</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: wrappers        }                # 0.4.3 : wrappers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>FDW collections</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: http            }                # 1.6   : http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allows web page retrieval inside the database.</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_cron         }                # 1.6   : pg_cron</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Job scheduler for PostgreSQL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: timescaledb     }                # 2.17  : timescaledb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Enables scalable inserts and complex queries for time-series data</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_tle          }                # 1.2   : pg_tle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trusted Language Extensions for PostgreSQL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: vector          }                # 0.8.0 : pgvector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>the vector similarity search</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># supabase required extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements, plpgsql, plpgsql_check, pg_cron, pg_net, timescaledb, auto_explain, pg_tle, plan_filter&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># extensions to be installed on this cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>supabase  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># essential extensions for supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>timescaledb postgis pg_graphql pg_jsonschema wrappers pg_search pg_analytics pg_parquet plv8 duckdb_fdw pg_cron pg_timetable pgqr</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>supautils pg_plan_filter passwordcheck plpgsql_check pgaudit pgsodium pg_vault pgjwt pg_ecdsa pg_session_jwt index_advisor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>pgvector pgvectorscale pg_summarize pg_tiktoken pg_tle pg_stat_monitor hypopg pg_hint_plan pg_http pg_net pg_smtp_client pg_idkit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>cron.database_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>pgsodium.enable_event_trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>off</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># supabase hba rules, require access from docker network</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all ,db: postgres  ,addr: intra         ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow supabase access from intranet&#39;</span><span style=color:#f8f8f8>    </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all ,db: postgres  ,addr: 172.17.0.0/16 ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow access from local docker network&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.2</span><span style=color:#000>/24</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># make a full backup every 1am</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># launch supabase stateless part with docker compose: ./supabase.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>supa_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># instance 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>supa_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># instance 2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>supa_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># instance 3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supa           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># cluster name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># enable docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># use these to pull docker images via proxy and mirror registries</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#docker_registry_mirrors: [&#39;https://docker.xxxxx.io&#39;]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#proxy_env:   # add [OPTIONAL] proxy env to /etc/docker/daemon.json configuration file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#  no_proxy: &#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.myqcloud.com,*.tsinghua.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>#  #all_proxy: http://user:pass@host:port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># these configuration entries will OVERWRITE or APPEND to /opt/supabase/.env file (src template: app/supabase/.env)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># check https://github.com/pgsty/pigsty/blob/main/app/supabase/.env for default values</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>supa_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># IMPORTANT: CHANGE JWT_SECRET AND REGENERATE CREDENTIAL ACCORDING!!!!!!!!!!!</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># https://supabase.com/docs/guides/self-hosting/docker#securing-your-services</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>jwt_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your-super-secret-jwt-token-with-at-least-32-characters-long</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>anon_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>service_role_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>dashboard_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>dashboard_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># postgres connection string (use the correct ip and port)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.3</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># use the pg_vip_address rather than single node ip</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5433</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># access via the &#39;default&#39; service, which always route to the primary postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>postgres_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Supa </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># password for supabase_admin and multiple supabase users</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># expose supabase via domain name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>site_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>api_external_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>supabase_public_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://supa.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># if using s3/minio as file storage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supa</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9002</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_access_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_force_path_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>stub</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>minio_domain_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.3</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># sss.pigsty domain name will resolve to this l2 vip that bind to all nodes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># if using SMTP (optional)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_admin_email: admin@example.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_host: supabase-mail</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_port: 2500</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_user: fake_mail_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_pass: fake_mail_password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#smtp_sender_name: fake_sender</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#enable_anonymous_users: false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Global Parameters</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v3.1.0                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pigsty version string</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># admin node ip address</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>region: china                     # upstream mirror region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default|china|europe</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune: oltp                   # node tuning specs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp,olap,tiny,crit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf: oltp.yml                 # pgsql tuning specs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#000>oltp,olap,tiny,crit}.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># domain names and upstream servers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>h.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>prometheus   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9090&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9093&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:9001&#34;</span><span style=color:#204a87;font-weight:700>, https: true, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>loki         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3100&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># expose supa studio UI and API via nginx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>supa         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Credential: CHANGE THESE PASSWORDS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#grafana_admin_username: admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>grafana_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_admin_username: dbuser_dba</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.DBA</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_monitor_username: dbuser_monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_replication_username: replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#patroni_username: postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>patroni_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Patroni.API</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#haproxy_admin_username: admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># use minio as supabase file storage, single node single driver mode for demonstration purpose</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_access_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minioadmin     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># root access key, `minioadmin` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minioadmin     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># root secret key, `minioadmin` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_buckets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }, { name: supa } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: dba , secret_key: S3User.DBA, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consoleAdmin }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest , secret_key: S3User.Backup,   policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: supabase   , secret_key: S3User.Supabase, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9000   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># explicit overwrite minio endpoint with haproxy port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_etc_hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;10.10.10.3 sss.pigsty&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># domain name to access minio from all nodes (required)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># use minio as default backup repo for PostgreSQL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_method: minio          # pgbackrest repo method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local,minio,[user-defined...]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_repo:                  # pgbackrest repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://pgbackrest.org/configuration.html#section-repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># default pgbackrest repo with local posix fs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/backup             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># local backup directory, `/pg/backup` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>count   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backups by count</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># keep 2, at most 3 full backup when using local fs repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># optional minio repo for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio is s3-compatible, so s3 is used</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss.pigsty      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio endpoint domain name, `sss.pigsty` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>us-east-1         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio region, us-east-1 by default, useless for minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio bucket name, `pgsql` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbackrest           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio user access key for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Backup </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio user secret key for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>path           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># use path style uri for minio rather than host style</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio backup path, default is `/pgbackrest`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>storage_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9002</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># minio port, 9000 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>storage_ca_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/cert/ca.crt </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio ca file path, `/pg/cert/ca.crt` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># bundle small files into a single file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># enable AES encryption for remote backup repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># AES encryption password, default is &#39;pgBackRest&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backup by time on minio repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># keep full backup for last 14 days</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># download docker and supabase related extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>17</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>node,pgsql,infra,docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-utility, docker ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_extra_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>pgsql-main</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>supabase  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># essential extensions for supabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>timescaledb postgis pg_graphql pg_jsonschema wrappers pg_search pg_analytics pg_parquet plv8 duckdb_fdw pg_cron pg_timetable pgqr</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>supautils pg_plan_filter passwordcheck plpgsql_check pgaudit pgsodium pg_vault pgjwt pg_ecdsa pg_session_jwt index_advisor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>pgvector pgvectorscale pg_summarize pg_tiktoken pg_tle pg_stat_monitor hypopg pg_hint_plan pg_http pg_net pg_smtp_client pg_idkit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></details><br><hr><br></div><div class=td-content style=page-break-before:always><h1 id=pg-eaa681fd37b80cda6e42dfc20bcbeaf0>Modern Hardware for Future Databases</h1><div class=lead>A survey on how hardware developments affect database design, covering key advancements in networking, storage, and computing.</div><div class="td-byline mb-4">By <b>Alex Miller</b> |
<time datetime=2024-11-20 class=text-body-secondary>November 20, 2024</time></div><blockquote><p>Author: <strong>Alex Miller</strong> (Snowflake, Apple, Google) | Original: <a href=https://transactional.blog/blog/2024-modern-database-hardware>Modern Hardware for Future Databases</a></p></blockquote><p><a href=https://vonng.com/cn/db/future-hardware/><img src=/img/hero/db/future-hardware.jpg alt=featured></a></p><p>A survey on how hardware developments affect database design, covering key advancements in networking, storage, and computing. <a href=https://vonng.com/cn/db/future-hardware/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-10c969208d55922688ef8f22e3271e25>Can MySQL Still Catch Up with PostgreSQL?</h1><div class=lead>Percona founder Peter Zaitsev discusses whether MySQL can still keep up with PostgreSQL. His views largely represent the MySQL communitys perspective.</div><div class="td-byline mb-4">By <b>Peter Zaitsev</b> |
<time datetime=2024-11-05 class=text-body-secondary>November 05, 2024</time></div><blockquote><p>Author: <strong>Peter Zaitsev</strong> (Percona Founder) | Original: <a href=https://www.percona.com/blog/can-mysql-catch-up-with-postgresql/>Can MySQL Catch Up with PostgreSQL?</a></p></blockquote><p><a href=https://vonng.com/cn/db/can-mysql-catchup/><img src=/img/hero/db/can-mysql-catchup.jpg alt=featured></a></p><p>Percona founder Peter Zaitsev discusses whether MySQL can still keep up with PostgreSQL. His views largely represent the MySQL community&rsquo;s perspective. <a href=https://vonng.com/cn/db/can-mysql-catchup/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-69a610dd2291dacefb18dc7cdcd46da2>Open-Source "Tyrant" Linus's Purge</h1><div class=lead>The Linux community is essentially imperial — and Linus himself is the earliest and most successful technical dictator. People are used to Linus&rsquo;s generosity but forget this point.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Vonng</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/IcmXCMyflqGlAPA8vFzyyA>WeChat Original</a></b> |
<time datetime=2024-10-25 class=text-body-secondary>October 25, 2024</time></div><p><a href=https://vonng.com/en/db/linus-ban-ru/><img src=/img/hero/db/linus-ban-ru.jpg alt=featured></a></p><p>The Linux community is essentially imperial — and Linus himself is the earliest and most successful technical dictator. People are used to Linus&rsquo;s generosity but forget this point. <a href=https://vonng.com/en/db/linus-ban-ru/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-a2b17ced6f6e514360c46bb14f581713>Optimize Bio Cores First, CPU Cores Second</h1><div class=lead>Programmers are expensive, scarce biological computing cores, the anchor point of software costs — please prioritize optimizing biological cores before optimizing CPU cores.</div><div class="td-byline mb-4">By <b><a href=https://world.hey.com/dhh/optimize-for-bio-cores-first-silicon-cores-second-112a6c3f>DHH</a> | <a href=https://vonng.com>Translator: Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href>WeChat Official Account</a></b> |
<time datetime=2024-09-07 class=text-body-secondary>September 07, 2024</time></div><p><a href=https://vonng.com/en/db/bio-core-cpu-core/><img src=/img/hero/db/bio-core-cpu-core.jpg alt=featured></a></p><p>Programmers are expensive, scarce biological computing cores, the anchor point of software costs — please prioritize optimizing biological cores before optimizing CPU cores. <a href=https://vonng.com/en/db/bio-core-cpu-core/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4a0eef4d9e255660adc67a5393533288>MongoDB Has No Future: Good Marketing Can't Save a Rotten Mango</h1><div class=lead>MongoDB has a terrible track record on integrity, lackluster products and technology, gets beaten by PG in correctness, performance, and functionality, with collapsing developer reputation, declining popularity, stock price halving, and expanding losses. Provocative marketing against PG can&rsquo;t save it with &ldquo;good marketing.&rdquo;</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/I3ug7Qv9jz3-uD3x_N1jKw>Chinese Original</a></b> |
<time datetime=2024-09-04 class=text-body-secondary>September 04, 2024</time></div><p><a href=https://vonng.com/en/db/bad-mongo/><img src=/img/hero/db/bad-mongo.jpg alt=featured></a></p><p>MongoDB has a terrible track record on integrity, lackluster products and technology, gets beaten by PG in correctness, performance, and functionality, with collapsing developer reputation, declining popularity, stock price halving, and expanding losses. Provocative marketing against PG can&rsquo;t save it with &ldquo;good marketing.&rdquo; <a href=https://vonng.com/en/db/bad-mongo/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-460de0fdfb5eb9112894cfe3047d5d0f>MongoDB: Now Powered by PostgreSQL?</h1><div class=lead>MongoDB 3.2&rsquo;s analytics subsystem turned out to be an embedded PostgreSQL database? A whistleblowing story from MongoDB&rsquo;s partner about betrayal and disillusionment.</div><div class="td-byline mb-4">By <b><a href=https://www.linkedin.com/in/jdegoes>John De Goes</a> <a href=https://www.linkedin.com/pulse/mongodb-32-now-powered-postgresql-john-de-goes>Original Article</a></b> |
<time datetime=2024-09-03 class=text-body-secondary>September 03, 2024</time></div><p><a href=https://vonng.com/en/db/mongo-powered-by-pg/><img src=/img/hero/db/mongo-powered-by-pg.jpg alt=featured></a></p><p>MongoDB 3.2&rsquo;s analytics subsystem turned out to be an embedded PostgreSQL database? A whistleblowing story from MongoDB&rsquo;s partner about betrayal and disillusionment. <a href=https://vonng.com/en/db/mongo-powered-by-pg/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-90c0fcdf4027da83a4744b5699d3cd9b>Switzerland Mandates Open-Source for Government Software</h1><div class=lead>Switzerland&rsquo;s government leads the way with open source legislation, showing IT developing countries how to ensure software sovereignty and control. True autonomy and control stem from &ldquo;open source communities,&rdquo; not some &ldquo;nationalist&rdquo; style &ldquo;domestic software.&rdquo;</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>)</b> |
<time datetime=2024-07-24 class=text-body-secondary>July 24, 2024</time></div><p><a href=https://vonng.com/en/db/oss-gov/><img src=/img/hero/db/oss-gov.jpg alt=featured></a></p><p>Switzerland&rsquo;s government leads the way with open source legislation, showing IT developing countries how to ensure software sovereignty and control. True autonomy and control stem from &ldquo;open source communities,&rdquo; not some &ldquo;nationalist&rdquo; style &ldquo;domestic software.&rdquo; <a href=https://vonng.com/en/db/oss-gov/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-19494097f0edd1d59fd940b2a5026866>MySQL is dead, Long live PostgreSQL!</h1><div class=lead>This July, MySQL 9.0 was finally released—a full eight years after its last major version, 8.0 (@2016-09).</div><div class="td-byline mb-4">By <b><a href=https://vonng.com/en/>Ruohang Feng</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/JgGCn9o2-DNPNqazPZXTtA>Wechat Column</a></b> |
<time datetime=2024-07-08 class=text-body-secondary>July 08, 2024</time></div><p><a href=https://vonng.com/en/db/mysql-is-dead/><img src=/img/hero/db/mysql-is-dead.jpg alt=featured></a></p><p>This July, MySQL 9.0 was finally released—a full eight years after its last major version, 8.0 (@2016-09). <a href=https://vonng.com/en/db/mysql-is-dead/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-36f375fd37b38b81fbc16f46b093587b>CVE-2024-6387 SSH Vulnerability Fix</h1><div class=lead>This vulnerability affects EL9, Ubuntu 22.04, Debian 12. Users should promptly update OpenSSH to fix this vulnerability.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/AqcYpOgVj91JnkB1B3s4sA>WeChat Public Account</a></b> |
<time datetime=2024-07-04 class=text-body-secondary>July 04, 2024</time></div><p><a href=https://vonng.com/en/db/cve-2024-6387/><img src=/img/hero/db/cve-2024-6387.jpg alt=featured></a></p><p>This vulnerability affects EL9, Ubuntu 22.04, Debian 12. Users should promptly update OpenSSH to fix this vulnerability. <a href=https://vonng.com/en/db/cve-2024-6387/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7b9962c18bde04fcc3217523fd2325f6>Can Oracle Still Save MySQL?</h1><div class=lead>Percona founder Peter Zaitsev publicly expressed disappointment with MySQL and Oracle, criticizing the declining performance with newer versions.</div><div class="td-byline mb-4">By <b>Peter Zaitsev</b> |
<time datetime=2024-06-21 class=text-body-secondary>June 21, 2024</time></div><blockquote><p>Author: <strong>Peter Zaitsev</strong> (Percona Founder) | Original: <a href=https://www.percona.com/blog/can-oracle-save-mysql/>Can Oracle Save MySQL?</a></p></blockquote><p><a href=https://vonng.com/cn/db/can-oracle-save-mysql/><img src=/img/hero/db/can-oracle-save-mysql.jpg alt=featured></a></p><p>Percona founder Peter Zaitsev publicly expressed disappointment with MySQL and Oracle, criticizing the declining performance with newer versions. <a href=https://vonng.com/cn/db/can-oracle-save-mysql/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-93ceebd0266c7994861c955faa1e194d>Oracle Finally Killed MySQL</h1><div class=lead>Peter Zaitsev, founder of Percona, criticizes how Oracles actions and inactions have killed MySQL. About 15 years after acquiring Sun and MySQL.</div><div class="td-byline mb-4">By <b>Peter Zaitsev</b> |
<time datetime=2024-06-20 class=text-body-secondary>June 20, 2024</time></div><blockquote><p>Author: <strong>Peter Zaitsev</strong> (Percona Founder) | Original: <a href=https://www.percona.com/blog/is-oracle-finally-killing-mysql/>Is Oracle Finally Killing MySQL?</a></p></blockquote><p><a href=https://vonng.com/cn/db/oracle-kill-mysql/><img src=/img/hero/db/oracle-kill-mysql.jpg alt=featured></a></p><p>Peter Zaitsev, founder of Percona, criticizes how Oracle&rsquo;s actions and inactions have killed MySQL. About 15 years after acquiring Sun and MySQL. <a href=https://vonng.com/cn/db/oracle-kill-mysql/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-aa9633901d56337ce9489e25283c0e93>MySQL Performance Declining: Where is Sakila Going?</h1><div class=lead>Higher MySQL versions mean worse performance? Percona monitoring shows slow migration from 5.7 to 8.x. PostgreSQL is pulling ahead.</div><div class="td-byline mb-4">By <b>Marco Tusa</b> |
<time datetime=2024-06-19 class=text-body-secondary>June 19, 2024</time></div><blockquote><p>Author: <strong>Marco Tusa</strong> (Percona) | Original: <a href=https://www.percona.com/blog/sakila-where-are-you-going/>Sakila, Where Are You Going?</a></p></blockquote><p><a href=https://vonng.com/cn/db/sakila-where-are-you-going/><img src=/img/hero/db/sakila-where-are-you-going.jpg alt=featured></a></p><p>Higher MySQL versions mean worse performance? Percona monitoring shows slow migration from 5.7 to 8.x. PostgreSQL is pulling ahead. <a href=https://vonng.com/cn/db/sakila-where-are-you-going/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-e0a1c2eedffe3df00d35ee7c51d671fc>Can Chinese Domestic Databases Really Compete?</h1><div class=lead>Friends often ask me, <strong>can Chinese domestic databases really compete?</strong> To be honest, <strong>it&rsquo;s a question that offends people</strong>. So let&rsquo;s try speaking with data - I hope the charts provided in this article can help readers understand the database ecosystem landscape and establish more accurate proportional awareness.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2024-04-25 class=text-body-secondary>April 25, 2024</time></div><p><a href=https://vonng.com/en/db/db-china/><img src=/img/hero/db/db-china.jpg alt=featured></a></p><p>Friends often ask me, <strong>can Chinese domestic databases really compete?</strong> To be honest, <strong>it&rsquo;s a question that offends people</strong>. So let&rsquo;s try speaking with data - I hope the charts provided in this article can help readers understand the database ecosystem landscape and establish more accurate proportional awareness. <a href=https://vonng.com/en/db/db-china/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-565d53bf218c62a92841cfa1733a4a22>The $20 Brother PolarDB: What Should Databases Actually Cost?</h1><div class=lead>Today we discuss the fair pricing of commercial databases, open-source databases, cloud databases, and domestic Chinese databases.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2024-04-25 class=text-body-secondary>April 25, 2024</time></div><p><a href=https://vonng.com/en/db/cheap-polar/><img src=/img/hero/db/cheap-polar.jpg alt=featured></a></p><p>Today we discuss the fair pricing of commercial databases, open-source databases, cloud databases, and domestic Chinese databases. <a href=https://vonng.com/en/db/cheap-polar/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-2f9d3a3c7bc34c83e43aa467cc47edce>Redis Going Non-Open-Source is a Disgrace to "Open-Source" and Public Cloud</h1><div class=lead>Redis &ldquo;going non-open source&rdquo; is not a disgrace to Redis, but a disgrace to &ldquo;open source/OSI&rdquo; and even more so to public cloud. What truly matters has always been software freedom, while open source is just one means to achieve software freedom.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/W5kOLxeJCIHjnWbIHc1Pzw>WeChat</a></b> |
<time datetime=2024-03-25 class=text-body-secondary>March 25, 2024</time></div><p><a href=https://vonng.com/en/db/redis-oss/><img src=/img/hero/db/redis-oss.jpg alt=featured></a></p><p>Redis &ldquo;going non-open source&rdquo; is not a disgrace to Redis, but a disgrace to &ldquo;open source/OSI&rdquo; and even more so to public cloud. What truly matters has always been software freedom, while open source is just one means to achieve software freedom. <a href=https://vonng.com/en/db/redis-oss/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-37de8c98e0077491a5dcc4c1bf949ec8>How Can MySQL's Correctness Be This Garbage?</h1><div class=lead>MySQL&rsquo;s transaction ACID has flaws and doesn&rsquo;t match documentation promises. This may lead to serious correctness issues - use with caution.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/gQZ3Q5JKV8gaBNhc1puPcA>WeChat Official Account</a></b> |
<time datetime=2023-12-28 class=text-body-secondary>December 28, 2023</time></div><p><a href=https://vonng.com/en/db/bad-mysql/><img src=/img/hero/db/bad-mysql.jpg alt=featured></a></p><p>MySQL&rsquo;s transaction ACID has flaws and doesn&rsquo;t match documentation promises. This may lead to serious correctness issues - use with caution. <a href=https://vonng.com/en/db/bad-mysql/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-3085215d905f9975fefe74e9dc129cba>Database in K8S: Pros & Cons</h1><div class="td-byline mb-4">By <b><a href=https://vonng.com/en/>Ruohang Feng</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://medium.com/@fengruohang/database-in-kubernetes-is-that-a-good-idea-daf5775b5c1f>Medium</a> ｜<a href=https://mp.weixin.qq.com/s/4a8Qy4O80xqsnytC4l9lRg>Wechat</a></b> |
<time datetime=2023-12-06 class=text-body-secondary>December 06, 2023</time></div><p>Whether databases should be housed in Kubernetes/Docker remains highly controversial. While Kubernetes (k8s) excels in managing stateless applications, it has fundamental drawbacks with stateful services, especially databases like PostgreSQL and MySQL.</p><p>In the previous article, &ldquo;<a href=/blog/db/pg-in-docker>Databases in Docker: Good or Bad</a>,&rdquo; we discussed the pros and cons of containerizing databases. Today, let&rsquo;s delve into the trade-offs in orchestrating databases in K8S and explore why it&rsquo;s not a wise decision.</p><hr><h2 id=summary>Summary</h2><p>Kubernetes (k8s) is an exceptional container orchestration tool aimed at helping developers better manage a vast array of complex stateless applications. Despite its offerings like StatefulSet, PV, PVC, and LocalhostPV for supporting stateful services (i.e., databases), these features are still insufficient for running production-level databases that demand higher reliability.</p><p>Databases are more like &ldquo;<strong>pets</strong>&rdquo; than &ldquo;<strong>cattle</strong>&rdquo; and require careful nurturing. Treating databases as &ldquo;cattle&rdquo; in K8S essentially turns external disk/file system/storage services into new &ldquo;database pets.&rdquo; Running databases on EBS/network storage presents significant disadvantages in reliability and performance. However, using high-performance local NVMe disks will make the database bound to nodes and non-schedulable, negating the primary purpose of putting them in K8S.</p><p>Placing databases in K8S results in a <strong>&ldquo;lose-lose&rdquo;</strong> situation - K8S loses its simplicity in statelessness, lacking the flexibility to quickly relocate, schedule, destroy, and rebuild like purely stateless use. On the other hand, databases suffer several crucial attributes: reliability, security, performance, and complexity costs, in exchange for limited &ldquo;elasticity&rdquo; and utilization - something virtual machines can also achieve. For users outside public cloud vendors, the disadvantages far outweigh the benefits.</p><p>The &ldquo;<strong>cloud-native frenzy</strong>,&rdquo; exemplified by K8S, has become a distorted phenomenon: adopting k8s for the sake of k8s. Engineers add extra complexity to increase their irreplaceability, while managers fear being left behind by the industry and getting caught up in deployment races. Using tanks for tasks that could be done with bicycles, to gain experience or prove oneself, without considering if the problem needs such &ldquo;dragon-slaying&rdquo; techniques - this kind of architectural juggling will eventually lead to adverse outcomes.</p><p>Until the reliability and performance of the network storage surpass local storage, placing databases in K8S is an unwise choice. There are other ways to seal the complexity of database management, such as RDS and open-source RDS solutions like <a href="http://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247485518&amp;idx=1&amp;sn=3d5f3c753facc829b2300a15df50d237&amp;chksm=fe4b3d95c93cb4833b8e80433cff46a893f939154be60a2a24ee96598f96b32271301abfda1f&amp;scene=21#wechat_redirect"><strong>Pigsty</strong></a>, which are based on bare Metal or bare OS. Users should make wise decisions based on their situations and needs, carefully weighing the pros and cons.</p><hr><h2 id=the-status-quo>The Status Quo</h2><p>K8S excels in orchestrating stateless application services but was initially limited to stateful services. Despite not being the intended purpose of K8S and Docker, the community&rsquo;s zeal for expansion has been unstoppable. Evangelists depict K8S as the next-generation cloud operating system, asserting that databases will inevitably become regular applications within Kubernetes. Various abstractions have emerged to support stateful services: StatefulSet, PV, PVC, and LocalhostPV.</p><p>Countless cloud-native enthusiasts have attempted to migrate existing databases into K8S, resulting in a proliferation of CRDs and Operators for databases. Taking PostgreSQL as an example, there are already more than ten different K8S deployment solutions available: PGO, StackGres, CloudNativePG, PostgresOperator, PerconaOperator, CYBERTEC-pg-operator, TemboOperator, Kubegres, KubeDB, KubeBlocks, and so on. The CNCF landscape rapidly expands, turning into a playground of complexity.</p><p>However, complexity is a cost. With &ldquo;cost reduction&rdquo; becoming mainstream, voices of reflection have begun to emerge. Could-Exit Pioneers like DHH, who deeply utilized K8S in public clouds, abandoned it due to its excessive complexity during the transition to <a href=https://mp.weixin.qq.com/s/CicctyvV1xk5B-AsKfzPjw>self-hosted open-source solutions</a>, relying only on Docker and a Ruby tool named Kamal as alternatives. Many began to question whether stateful services like databases suit Kubernetes.</p><p>K8S itself, in its effort to support stateful applications, has become increasingly complex, straying from its original intention as a container orchestration platform. Tim Hockin, a co-founder of Kubernetes, also voiced his rare concerns at this year&rsquo;s KubeCon in <a href=https://mp.weixin.qq.com/s/9Q9kze9D2LT0-G2lXSvADg>&ldquo;K8s is Cannibalizing Itself!&rdquo;</a>: &ldquo;<em><strong>Kubernetes has become too complex; it needs to learn restraint, or it will stop innovating and lose its base</strong></em>.&rdquo;</p><hr><h2 id=lose-lose-situation>Lose-Lose Situation</h2><p>In the cloud-native realm, the analogy of &ldquo;pets&rdquo; versus &ldquo;cattle&rdquo; is often used for illustrating stateful services. &ldquo;Pets,&rdquo; like databases, need careful and individual care, while &ldquo;cattle&rdquo; represent disposable, stateless applications (Disposability).</p><blockquote><p>Cloud Native Applications 12 Factors: <strong>Disposability</strong></p></blockquote><p>One of the leading architectural goals of K8S is to <strong>treat what can be treated as cattle as cattle</strong>. The attempt to &ldquo;separate storage from computation&rdquo; in databases follows this strategy: splitting stateful database services into state storage outside K8S and pure computation inside K8S. The state is stored on the EBS/cloud disk/distributed storage service, allowing the &ldquo;stateless&rdquo; database part to be freely created, destroyed, and scheduled in K8S.</p><p>Unfortunately, databases, especially OLTP databases, heavily depend on disk hardware, and network storage&rsquo;s reliability and performance still lag behind local disks by <a href=https://mp.weixin.qq.com/s/UxjiUBTpb1pRUfGtR9V3ag>orders of magnitude</a>. Thus, K8S offers the LocalhostPV option, allowing containers to use data volumes directly lies on the host operating system, utilizing high-performance/high-reliability local NVMe disk storage.</p><p>However, this presents a dilemma: should one use subpar cloud disks and tolerate poor database reliability/performance for K8S&rsquo;s scheduling and orchestration capabilities? Or use high-performance local disks tied to host nodes, virtually losing all flexible scheduling abilities? The former is like stuffing an anchor into K8S&rsquo;s small boat, slowing overall speed and agility; the latter is like anchoring and pinning the ship to a specific point.</p><p>Running a stateless K8S cluster is simple and reliable, as is running a stateful database on a physical machine&rsquo;s bare operating system. Mixing the two, however, results in a <strong>lose-lose situation</strong>: <em><strong>K8S loses its stateless flexibility and casual scheduling abilities, while the database sacrifices core attributes like reliability, security, efficiency, and simplicity in exchange for elasticity, resource utilization, and Day1 delivery speed that are not fundamentally important to databases</strong></em>.</p><p>A vivid example of the former is the performance optimization of <a href=https://mp.weixin.qq.com/s/SCImfwEvkCPqZhLGx758Sw>PostgreSQL@K8S</a>, which KubeBlocks contributed. K8S experts employed various advanced methods to solve performance issues that did not exist on bare metal/bare OS at all. A fresh case of the latter is Didi&rsquo;s <a href=https://mp.weixin.qq.com/s/FIOB_Oqefx1oez1iu7AGGg>K8S architecture juggling disaster</a>; if it weren&rsquo;t for putting the stateful MySQL in K8S, would rebuilding a stateless K8S cluster and redeploying applications take 12 hours to recover?</p><hr><h2 id=pros-and-cons>Pros and Cons</h2><p>For serious technology decisions, the most crucial aspect is weighing the pros and cons. Here, in the order of &ldquo;quality, security, performance, cost,&rdquo; let&rsquo;s discuss the technical trade-offs of placing databases in K8S versus classic bare metal/VM deployments. I don&rsquo;t want to write a comprehensive paper that covers everything. Instead, I&rsquo;ll throw some specific questions for consideration and discussion.</p><p><strong>Quality</strong></p><p>K8S, compared to physical deployments, introduces additional failure points and architectural complexity, increasing the blast radius and significantly prolonging the average recovery time of failures. In <a href=https://mp.weixin.qq.com/s/kFftay1IokBDqyMuArqOpg>&ldquo;Is it a Good Idea to Put Databases into Docker?&rdquo;</a>, we provided an argument about reliability, which can also apply to Kubernetes — K8S and Docker introduce additional and unnecessary dependencies and failure points to databases, lacking community failure knowledge accumulation and reliability track record (MTTR/MTBF).</p><p>In the cloud vendor classification system, K8S belongs to PaaS, while RDS belongs to a more fundamental layer, IaaS. <strong>Database services have higher reliability requirements than K8S</strong>; for instance, many companies&rsquo; cloud management platforms rely on an additional CMDB database. Where should this database be placed? You shouldn&rsquo;t let K8S manage things it depends on, nor should you add unnecessary extra dependencies. The <a href=https://mp.weixin.qq.com/s/OIlR0rolEQff9YfCpj3wIQ>Alibaba Cloud global epic failure</a> and <a href=https://mp.weixin.qq.com/s/FIOB_Oqefx1oez1iu7AGGg>Didi&rsquo;s K8S architecture juggling disaster</a> have taught us this lesson. Moreover, maintaining a separate database system inside K8S when there&rsquo;s already one outside is even more unjustifiable.</p><p><strong>Security</strong></p><p>The database in a multi-tenant environment introduces additional attack surfaces, bringing higher risks and more complex audit compliance challenges. Does K8S make your database more secure? Maybe the complexity of K8S architecture juggling will deter script kiddies unfamiliar with K8S, but for real attackers, more components and dependencies often mean a broader attack surface.</p><p>In <a href=https://mp.weixin.qq.com/s/Tvuy0kAiqh66sOwkr3WWMA>&ldquo;BrokenSesame Alibaba Cloud PostgreSQL Vulnerability Technical Details&rdquo;</a>, security personnel escaped to the K8S host node using their own PostgreSQL container and accessed the K8S API and other tenants&rsquo; containers and data. This is clearly a K8S-specific issue — the risk is real, such attacks have occurred, and even Alibaba Cloud, a local cloud industry leader, has been compromised.</p><blockquote><p>Source: <a href="https://www.youtube.com/watch?v=d81qnGKv4EE">The Attacker Perspective - Insights From Hacking Alibaba Cloud</a></p></blockquote><p><strong>Performance</strong></p><p>As stated in <a href=https://mp.weixin.qq.com/s/kFftay1IokBDqyMuArqOpg>&ldquo;Is it a Good Idea to Put Databases into Docker?&rdquo;</a>, whether it&rsquo;s additional network overhead, Ingress bottlenecks, or underperforming cloud disks, all negatively impact database performance. For example, as revealed in <a href=https://mp.weixin.qq.com/s/SCImfwEvkCPqZhLGx758Sw>&ldquo;PostgreSQL@K8s Performance Optimization&rdquo;</a> — you need a considerable level of technical prowess to make database performance in K8S barely match that on bare metal.</p><blockquote><p>Note: Latency is measured in <strong>ms</strong>, not <strong>µs</strong> — a significant performance difference.</p></blockquote><p>Another misconception about efficiency is resource utilization. Unlike offline analytical businesses, critical online OLTP databases should not aim to increase resource utilization but rather deliberately lower it to enhance system reliability and user experience. If there are many fragmented businesses, resource utilization can be improved through PDB/shared database clusters. K8S&rsquo;s advocated elasticity efficiency is not unique to it — KVM/EC2 can also effectively address this issue.</p><p>In terms of <strong>cost</strong>, K8S and various Operators provide a decent abstraction, encapsulating some of the complexity of database management, which is attractive for teams without DBAs. However, the complexity reduced by using it to manage databases pales in comparison to the complexity introduced by using K8S itself. For instance, random IP address drifts and automatic Pod restarts may not be a big issue for stateless applications, but for databases, they are intolerable — many companies have had to attempt to modify kubelet to avoid this behavior, thereby introducing more complexity and maintenance costs.</p><p>As stated in <a href=https://mp.weixin.qq.com/s/FIOB_Oqefx1oez1iu7AGGg>&ldquo;From Reducing Costs and Smiles to Reducing Costs and Efficiency&rdquo;</a> &ldquo;Reducing Complexity Costs&rdquo; section: <strong>Intellectual power is hard to accumulate spatially</strong>: when a database encounters problems, it needs database experts to solve them; when Kubernetes has problems, it needs K8S experts to look into them; however, when you put a database into Kubernetes, complexities combine, the state space explodes, but the intellectual bandwidth of individual database experts and K8S experts is hard to stack — you need a dual expert to solve the problem, and such experts are undoubtedly much rarer and more expensive than pure database experts. Such architectural juggling is enough to cause major setbacks for most teams, including top public clouds/big companies, in the event of a failure.</p><hr><h2 id=the-cloud-native-frenzy>The Cloud-Native Frenzy</h2><p>An interesting question arises: if K8S is unsuitable for stateful databases, why are so many companies, including big players, rushing to do this? The reasons are not technical.</p><p>Google open-sourced its K8S battleship, modeled after its internal Borg spaceship, and managers, fearing being left behind, rushed to adopt it, thinking using K8S would put them on par with Google. Ironically, Google doesn&rsquo;t use K8S; it was more likely to disrupt AWS and mislead the industry. However, most companies don&rsquo;t have the manpower like Google to operate such a battleship. More importantly, their problems might need a simple vessel. Running MySQL + PHP, PostgreSQL + Go/Python on bare metal has already taken many companies to IPO.</p><p>Under <a href=https://mp.weixin.qq.com/s/1OSRcBfd58s0tgZTUZHB9g>modern hardware conditions</a>, the complexity of most applications throughout their lifecycle doesn&rsquo;t justify using K8S. Yet, the &ldquo;cloud-native&rdquo; frenzy, epitomized by K8S, has become a distorted phenomenon: adopting k8s just for the sake of k8s. Some engineers are looking for &ldquo;advanced&rdquo; and &ldquo;cool&rdquo; technologies used by big companies to fulfill their personal goals like job hopping or promotions or to increase their job security by adding complexity, not considering if these &ldquo;dragon-slaying&rdquo; techniques are necessary for solving their problems.</p><p>The cloud-native landscape is filled with fancy projects. Every new development team wants to introduce something new: Helm today, Kubevela tomorrow. They talk big about bright futures and peak efficiency, but in reality, they create a mountain of architectural complexities and a playground for &ldquo;YAML Boys&rdquo; - tinkering with the latest tech, inventing concepts, earning experience and reputation at the expense of users who bear the complexity and maintenance costs.</p><blockquote><p>CNCF Landscape: A sprawling ecosystem of complexity</p></blockquote><p>The cloud-native movement&rsquo;s philosophy is compelling - democratizing the elastic scheduling capabilities of public clouds for every user. K8S indeed excels in stateless applications. However, excessive enthusiasm has led K8S astray from its original intent and direction - simply doing well in orchestrating stateless applications, burdened by the ill-conceived support for stateful applications.</p><hr><h2 id=making-wise-decisions>Making Wise Decisions</h2><p>Years ago, when I first encountered K8S, I too was fervent —— It was at TanTan. We had over twenty thousand cores and hundreds of database clusters, and I was eager to try putting databases in Kubernetes and testing all the available Operators. However, after two to three years of extensive research and architectural design, I calmed down and abandoned this madness. Instead, I architected our database service based on bare metal/operating systems. For us, the benefits K8S brought to databases were negligible compared to the problems and hassles it introduced.</p><p>Should databases be put into K8S? It depends: for public cloud vendors who thrive on overselling resources, elasticity and utilization are crucial, which are directly linked to revenue and profit, While reliability and performance take a back seat - after all, an availability below three nines means <a href=https://vonng.com/cn/blog/cloud/sla/>compensating 25% monthly credit</a>. But for most user, including ourselves, these trade-offs hold different: One-time Day1 Setup, elasticity, and resource utilization aren&rsquo;t their primary concerns; reliability, performance, Day2 Operation costs, these core database attributes are what matter most.</p><p>We open-sourced our database service architecture — an out-of-the-box PostgreSQL distribution and a local-first RDS alternative: <a href=https://vonng.com/cn/blog/db/pigsty-intro/>Pigsty</a>. We didn&rsquo;t choose the so-called &ldquo;build once, run anywhere&rdquo; approach of K8S and Docker. Instead, we adapted to different <a href=https://mp.weixin.qq.com/s/xHG8OURTYlmnQTorFkzioA>OS distros</a> & major versions, and used Ansible to achieve a K8S CRD IaC-like API to seal management complexity. This was arduous, but it was the right thing to do - the world does not need another clumsy attempt at putting PostgreSQL into K8S. Still, it does need a production database service architecture that maximizes hardware performance and reliability.</p><blockquote><p><a href=https://pigsty.io>Pigsty</a> vs StackGres: Different approaches to PostgreSQL deployment</p></blockquote><p>Perhaps one day, when the reliability and performance of distributed network storage surpass local storage and mainstream databases have some native support for storage-computation separation, things might change again — K8S might become suitable for databases. But for now, I believe putting serious production OLTP databases into K8S is immature and inappropriate. I hope readers will make wise choices on this matter.</p><hr><h2 id=reference>Reference</h2><p><strong><a href="http://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247486572&amp;idx=1&amp;sn=274a51976bf8ae5974beb1d3173380c1&amp;chksm=fe4b39b7c93cb0a14c4d99f8ffd1e00c36b972a8058fd99e9d06e6035c4f378b6d327892260b&amp;scene=21#wechat_redirect">Database in Docker: Is that a good idea?</a></strong></p><p><strong><a href=https://mp.weixin.qq.com/s/9Q9kze9D2LT0-G2lXSvADg>《Kubernetes is Rotten!》</a></strong></p><p><strong><a href=https://mp.weixin.qq.com/s/EWCblHU-vDC3ebV6ITE45A>《Curse of Docker?》</a></strong></p><p><strong><a href=https://mp.weixin.qq.com/s/KFZCQFP1oB5YOrT3tHBRCQ>《What can we learn from DiDi&rsquo;s Epic k8s Failure》</a></strong></p><p><strong><a href=https://mp.weixin.qq.com/s/0kbWa6AnkCr5jkN4WIgu5Q>《PostgreSQL@K8s Performance Optimization》</a></strong></p><p><strong><a href=https://questdb.io/blog/databases-on-k8s/>《Running Database on Kubernetes》</a></strong></p></div><div class=td-content style=page-break-before:always><h1 id=pg-370ebd3d2007a7dd41ff3c4fa833b7aa>Are Specialized Vector Databases Dead?</h1><div class=lead>Vector storage and retrieval is a real need, but specialized vector databases are already dead. Small needs are solved by OpenAI directly, standard needs are captured by existing mature databases with vector extensions. The ecological niche left for specialized vector databases might support one company, but trying to build an industry around AI stories is impossible.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Vonng</a> (<a href=https://vonng.com/en/>@Vonng</a>)| <a href=https://mp.weixin.qq.com/s/0eBZ4zyX6XjBQO0GqlANnw>WeChat</a></b> |
<time datetime=2023-11-21 class=text-body-secondary>November 21, 2023</time></div><p><a href=https://vonng.com/en/db/svdb-is-dead/><img src=/img/hero/db/svdb-is-dead.jpg alt=featured></a></p><p>Vector storage and retrieval is a real need, but specialized vector databases are already dead. Small needs are solved by OpenAI directly, standard needs are captured by existing mature databases with vector extensions. The ecological niche left for specialized vector databases might support one company, but trying to build an industry around AI stories is impossible. <a href=https://vonng.com/en/db/svdb-is-dead/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-38a45a64085e625531d57d4a2d04f7d5>Are Databases Really Being Strangled?</h1><div class=lead>Many &ldquo;domestic databases&rdquo; are just shoddy, inferior products that can&rsquo;t be helped. Xinchuang domestic OS/databases are essentially <strong>IT pre-made meals in schools</strong>. Users hold their noses while migrating, developers pretend to work hard, and everyone plays along with leaders who neither understand nor care about technology. The infrastructure software industry isn&rsquo;t being strangled by anyone - the real chokehold comes from the so-called &ldquo;insiders.&rdquo;</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2023-11-02 class=text-body-secondary>November 02, 2023</time></div><p><a href=https://vonng.com/en/db/db-choke/><img src=/img/hero/db/db-choke.jpg alt=featured></a></p><p>Many &ldquo;domestic databases&rdquo; are just shoddy, inferior products that can&rsquo;t be helped. Xinchuang domestic OS/databases are essentially <strong>IT pre-made meals in schools</strong>. Users hold their noses while migrating, developers pretend to work hard, and everyone plays along with leaders who neither understand nor care about technology. The infrastructure software industry isn&rsquo;t being strangled by anyone - the real chokehold comes from the so-called &ldquo;insiders.&rdquo; <a href=https://vonng.com/en/db/db-choke/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-cd7f63f1abd791104bd257d3714fd3c8>Which EL-Series OS Distribution Is Best?</h1><div class=lead>RHEL-series OS distribution compatibility level: RHEL = Rocky ≈ Anolis > Alma > Oracle &#187; Euler. Recommend using RockyLinux 8.8, or Anolis 8.8 for domestic requirements.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Vonng</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/xHG8OURTYlmnQTorFkzioA>WeChat</a> | <a href=https://zhuanlan.zhihu.com/p/660166371>Zhihu</a></b> |
<time datetime=2023-10-09 class=text-body-secondary>October 09, 2023</time></div><p><a href=https://vonng.com/en/db/rhel-compatibility/><img src=/img/hero/db/rhel-compatibility.jpg alt=featured></a></p><p>RHEL-series OS distribution compatibility level: RHEL = Rocky ≈ Anolis > Alma > Oracle &#187; Euler. Recommend using RockyLinux 8.8, or Anolis 8.8 for domestic requirements. <a href=https://vonng.com/en/db/rhel-compatibility/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-05e4c736ef6a276915b122a7c6593a4b>What Kind of Self-Reliance Do Infrastructure Software Need?</h1><div class=lead>When we talk about self-reliance and control, what are we really talking about? Operational self-reliance vs. R&amp;D self-reliance - what nations/users truly need is the former, not flashy &ldquo;self-research&rdquo;.</div><div class="td-byline mb-4">By <b>vonng</b> |
<time datetime=2023-08-31 class=text-body-secondary>August 31, 2023</time></div><p><a href=https://vonng.com/en/db/sovereign-dbos/><img src=/img/hero/db/sovereign-dbos.jpg alt=featured></a></p><p>When we talk about self-reliance and control, what are we really talking about? Operational self-reliance vs. R&amp;D self-reliance - what nations/users truly need is the former, not flashy &ldquo;self-research&rdquo;. <a href=https://vonng.com/en/db/sovereign-dbos/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-c4dc125c4dfcb370c1becf943a2038be>Back to Basics: Tech Reflection Chronicles</h1><div class=lead>The cost-cutting imperative has triggered a reevaluation of all technologies, including databases. This series critiques hot DB technologies and poses fundamental questions about their trade-offs: Are cloud databases, distributed databases, microservices, and containerization real needs or false hype?</div><div class="td-byline mb-4">By <b>Vonng</b> |
<time datetime=2023-05-29 class=text-body-secondary>May 29, 2023</time></div><p><a href=https://vonng.com/en/db/rethink/><img src=/img/hero/db/rethink.jpg alt=featured></a></p><p>The cost-cutting imperative has triggered a reevaluation of all technologies, including databases. This series critiques hot DB technologies and poses fundamental questions about their trade-offs: Are cloud databases, distributed databases, microservices, and containerization real needs or false hype? <a href=https://vonng.com/en/db/rethink/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-1ef05570d6ebab14417fb403e0bc0ce8>Database Demand Hierarchy Pyramid</h1><div class=lead>Similar to Maslow&rsquo;s hierarchy of needs, user demands for databases also have a progressive hierarchy: physiological needs, safety needs, belonging needs, esteem needs, cognitive needs, aesthetic needs, self-actualization needs, and transcendence needs.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/1xR92Z67kvvj2_NpUMie1Q>WeChat</a></b> |
<time datetime=2023-05-10 class=text-body-secondary>May 10, 2023</time></div><p><a href=https://vonng.com/en/db/demand-pyramid/><img src=/img/hero/db/demand-pyramid.jpg alt=featured></a></p><p>Similar to Maslow&rsquo;s hierarchy of needs, user demands for databases also have a progressive hierarchy: physiological needs, safety needs, belonging needs, esteem needs, cognitive needs, aesthetic needs, self-actualization needs, and transcendence needs. <a href=https://vonng.com/en/db/demand-pyramid/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-0125c5ebbbe2e9c1c12f5b8e60eabe1c>Are Microservices a Bad Idea?</h1><div class=lead>Even Amazons SOA paradigm team admits microservices and Serverless have problems. Prime Video team switched to monolith, saving 90% operational costs.</div><div class="td-byline mb-4">By <b>DHH</b> |
<time datetime=2023-05-07 class=text-body-secondary>May 07, 2023</time></div><blockquote><p>Author: <strong>DHH</strong> (David Heinemeier Hansson) | Original: <a href=https://world.hey.com/dhh/even-amazon-can-t-make-sense-of-serverless-or-microservices-59625580>Even Amazon can&rsquo;t make sense of serverless or microservices</a></p></blockquote><p><a href=https://vonng.com/cn/db/microservice-bad-idea/><img src=/img/hero/db/microservice-bad-idea.jpg alt=featured></a></p><p>Even Amazon&rsquo;s SOA paradigm team admits microservices and Serverless have problems. Prime Video team switched to monolith, saving 90% operational costs. <a href=https://vonng.com/cn/db/microservice-bad-idea/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-564f2bc59ef0064fb9b5b78f3ee282ef>NewSQL: Distributive Nonsens</h1><div class=lead>As hardware technology advances, the capacity and performance of standalone databases have reached unprecedented heights. which makes distributed (TP) databases appear utterly powerless, much like the &ldquo;data middle platform,&rdquo; donning the emperor&rsquo;s new clothes in a state of self-deception.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com/en/>Ruohang Feng</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/-eaCoZR9Z5srQ-1YZm1QJA>Wechat Column</a></b> |
<time datetime=2023-05-07 class=text-body-secondary>May 07, 2023</time></div><p><a href=https://vonng.com/en/db/distributive-bullshit/><img src=/img/hero/db/distributive-bullshit.jpg alt=featured></a></p><p>As hardware technology advances, the capacity and performance of standalone databases have reached unprecedented heights. which makes distributed (TP) databases appear utterly powerless, much like the &ldquo;data middle platform,&rdquo; donning the emperor&rsquo;s new clothes in a state of self-deception. <a href=https://vonng.com/en/db/distributive-bullshit/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-64cb6ba6751d68792d8b25958525d973>Time to Say Goodbye to GPL</h1><div class=lead>DDIA author Martin Kleppmann argues we should move away from GPL licenses. In the 2020s, the enemy of computing freedom is cloud software.</div><div class="td-byline mb-4">By <b>Martin Kleppmann</b> |
<time datetime=2021-09-16 class=text-body-secondary>September 16, 2021</time></div><blockquote><p>Author: <strong>Martin Kleppmann</strong> (DDIA Author) | Original: <a href=https://martin.kleppmann.com/2021/04/14/goodbye-gpl.html>It&rsquo;s time to say goodbye to the GPL</a></p></blockquote><p><a href=https://vonng.com/cn/db/goodbye-gpl/><img src=/img/hero/db/goodbye-gpl.jpg alt=featured></a></p><p>DDIA author Martin Kleppmann argues we should move away from GPL licenses. In the 2020s, the enemy of computing freedom is cloud software. <a href=https://vonng.com/cn/db/goodbye-gpl/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-65bb532e2949268a0bd020d4878070be>Is running postgres in docker a good idea?</h1><div class=lead>Thou shalt not run a prod database inside a container</div><div class="td-byline mb-4">By <b><a href=https://vonng.com/en/>Ruohang Feng</a> (<a href=https://vonng.com/en/>@Vonng</a>)</b> |
<time datetime=2019-01-13 class=text-body-secondary>January 13, 2019</time></div><p><a href=https://vonng.com/en/db/pg-in-docker/><img src=/img/hero/db/pg-in-docker.jpg alt=featured></a></p><p>Thou shalt not run a prod database inside a container <a href=https://vonng.com/en/db/pg-in-docker/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-f32afa47c9942c188f3de7f42228d87b>Understanding Time - Leap Years, Leap Seconds, Time and Time Zones</h1><div class=lead>A proper understanding of time is very helpful for correctly handling time-related issues in work and life. For example, time representation and processing in computers, as well as time handling in databases and programming languages.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/JNLMAzpLnk6y9lCSpClPlQ>WeChat</a></b> |
<time datetime=2018-12-11 class=text-body-secondary>December 11, 2018</time></div><p><a href=https://vonng.com/en/db/reason-about-time/><img src=/img/hero/db/reason-about-time.jpg alt=featured></a></p><p>A proper understanding of time is very helpful for correctly handling time-related issues in work and life. For example, time representation and processing in computers, as well as time handling in databases and programming languages. <a href=https://vonng.com/en/db/reason-about-time/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-d8949c62ff071aa82e551077d044affe>Understanding Character Encoding Principles</h1><div class=lead>Without understanding the basic principles of character encoding, even simple string operations like comparison, sorting, and random access can easily lead you into pitfalls. This article attempts to clarify these issues through a comprehensive explanation.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>)</b> |
<time datetime=2018-07-01 class=text-body-secondary>July 01, 2018</time></div><p><a href=https://vonng.com/en/db/character-encoding/><img src=/img/hero/db/character-encoding.jpg alt=featured></a></p><p>Without understanding the basic principles of character encoding, even simple string operations like comparison, sorting, and random access can easily lead you into pitfalls. This article attempts to clarify these issues through a comprehensive explanation. <a href=https://vonng.com/en/db/character-encoding/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-61a26df3028fb51a243921297c170783>Concurrency Anomalies Explained</h1><div class=lead>Concurrent programs are hard to write correctly and even harder to write well. Many programmers simply throw these problems at the database&mldr; But even the most sophisticated databases won&rsquo;t help if you don&rsquo;t understand concurrency anomalies and isolation levels.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://mp.weixin.qq.com/s/xw_rwxXgIuCL-pcRZHF03w>WeChat Public Account</a> | <a href=https://zhuanlan.zhihu.com/p/38217080>Zhihu Original</a></b> |
<time datetime=2018-06-19 class=text-body-secondary>June 19, 2018</time></div><p><a href=https://vonng.com/en/db/concurrent-control/><img src=/img/hero/db/concurrent-control.jpg alt=featured></a></p><p>Concurrent programs are hard to write correctly and even harder to write well. Many programmers simply throw these problems at the database&mldr; But even the most sophisticated databases won&rsquo;t help if you don&rsquo;t understand concurrency anomalies and isolation levels. <a href=https://vonng.com/en/db/concurrent-control/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-ade689d300c8e645854023963c47d580>Blockchain and Distributed Databases</h1><div class=lead>The technical essence, functionality, and evolution of blockchain is distributed databases. Specifically, it&rsquo;s a <strong>Byzantine Fault Tolerant (resistant to malicious node attacks) distributed (leaderless replication) database</strong>.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://www.zhihu.com/question/275845393/answer/386816571>Original Zhihu Article</a></b> |
<time datetime=2018-06-09 class=text-body-secondary>June 09, 2018</time></div><p><a href=https://vonng.com/en/db/blockchian/><img src=/img/hero/db/blockchian.jpg alt=featured></a></p><p>The technical essence, functionality, and evolution of blockchain is distributed databases. Specifically, it&rsquo;s a <strong>Byzantine Fault Tolerant (resistant to malicious node attacks) distributed (leaderless replication) database</strong>. <a href=https://vonng.com/en/db/blockchian/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-0deaa1202a01c3a259cae90143e4afee>Consistency: An Overloaded Term</h1><div class=lead>The term &ldquo;consistency&rdquo; is heavily overloaded, representing different concepts in different contexts. For example, the C in ACID and the C in CAP actually refer to different concepts.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a> (<a href=https://vonng.com/en/>@Vonng</a>) | <a href=https://www.zhihu.com/question/275845393/answer/386816571>Zhihu Original</a></b> |
<time datetime=2018-05-08 class=text-body-secondary>May 08, 2018</time></div><p><a href=https://vonng.com/en/db/consistency/><img src=/img/hero/db/consistency.jpg alt=featured></a></p><p>The term &ldquo;consistency&rdquo; is heavily overloaded, representing different concepts in different contexts. For example, the C in ACID and the C in CAP actually refer to different concepts. <a href=https://vonng.com/en/db/consistency/><strong>Read more</strong></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-af84b03927b12ebc4cf08b933702c27b>Why Study Database Principles</h1><div class=lead>Those who only know how to code are just programmers; <strong>learn databases well, and you can at least make a living</strong>; but for <strong>excellent</strong> engineers, merely <strong>using</strong> databases is far from enough.</div><div class="td-byline mb-4">By <b><a href=https://vonng.com>Feng Ruohang</a>（<a href=https://vonng.com/en/>@Vonng</a>） | <a href=https://mp.weixin.qq.com/s/PePSPDfyJt-ZkKjH8sUa6w>WeChat</a> | <a href=https://www.zhihu.com/question/273489729/answer/377084748>Zhihu</a></b> |
<time datetime=2018-04-20 class=text-body-secondary>April 20, 2018</time></div><p><a href=https://vonng.com/en/db/why-learn-database/><img src=/img/hero/db/why-learn-database.jpg alt=featured></a></p><p>Those who only know how to code are just programmers; <strong>learn databases well, and you can at least make a living</strong>; but for <strong>excellent</strong> engineers, merely <strong>using</strong> databases is far from enough. <a href=https://vonng.com/en/db/why-learn-database/><strong>Read more</strong></a></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>