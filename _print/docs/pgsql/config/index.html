<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/pgsql/config/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/pgsql/config/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Configuration | PIGSTY</title><meta name=description content="Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs."><meta property="og:url" content="https://pigsty.io/docs/pgsql/config/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="Configuration"><meta property="og:description" content="Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Configuration"><meta itemprop=description content="Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs."><meta itemprop=dateModified content="2026-01-08T18:48:49+08:00"><meta itemprop=wordCount content="484"><meta itemprop=keywords content="Reference,PGSQL"><meta name=twitter:card content="summary"><meta name=twitter:title content="Configuration"><meta name=twitter:description content="Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs."><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/pgsql/config/>Return to the regular view of this page</a>.</p></div><h1 class=title>Configuration</h1><div class=lead>Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs.</div><ul><li>1: <a href=#pg-01e9f6eb810a0f6072913a962bfd631d>Cluster / Instance</a></li><li>2: <a href=#pg-64c78407e33d191b14a78a9a03369255>Kernel Version</a></li><li>3: <a href=#pg-ad5d6482cea01b850636a3033b3ec973>Package Alias</a></li><li>4: <a href=#pg-f3a29e30e1bcb1622450d4b2d3604bdc>User/Role</a></li><li>5: <a href=#pg-662c4a4a95a52da3073eeed2f4407af9>Database</a></li><li>6: <a href=#pg-be500246ccc4d0aea19a8d2e848cf128>HBA Rules</a></li><li>7: <a href=#pg-f26623b2f855e9bc5073aeb50aea422a>Access Control</a></li></ul><div class=content><p>Pigsty is a &ldquo;configuration-driven&rdquo; PostgreSQL platform: all behaviors come from the combination of inventory files in <code>~/pigsty/conf/*.yml</code> and <a href=/docs/pgsql/param><code>PGSQL</code> parameters</a>.
Once you&rsquo;ve written the configuration, you can replicate a customized cluster with instances, users, databases, access control, extensions, and tuning policies in just a few minutes.</p><hr><h2 id=configuration-entry>Configuration Entry</h2><ol><li><strong>Prepare Inventory</strong>: Copy a <code>pigsty/conf/*.yml</code> template or write an Ansible Inventory from scratch, placing cluster groups (<code>all.children.&lt;cls>.hosts</code>) and global variables (<code>all.vars</code>) in the same file.</li><li><strong>Define Parameters</strong>: Override the required <a href=/docs/pgsql/param><code>PGSQL</code> parameters</a> in the <code>vars</code> block. The override order from global → cluster → host determines the final value.</li><li><strong>Apply Configuration</strong>: Run <code>./configure -c &lt;conf></code> or <code>bin/pgsql-add &lt;cls></code> and other playbooks to apply the configuration. Pigsty will generate the configuration files needed for Patroni/pgbouncer/pgbackrest based on the parameters.</li></ol><p>Pigsty&rsquo;s default demo inventory <code>conf/pgsql.yml</code> is a minimal example: one <code>pg-meta</code> cluster, global <code>pg_version: 18</code>, and a few business user and database definitions. You can expand with more clusters from this base.</p><hr><h2 id=focus-areas--documentation-index>Focus Areas & Documentation Index</h2><p>Pigsty&rsquo;s PostgreSQL configuration can be organized from the following dimensions. Subsequent documentation will explain &ldquo;how to configure&rdquo; each:</p><ul><li><strong><a href=/docs/pgsql/config/cluster>Cluster & Instances</a></strong>: Define instance topology (standalone, primary-replica, standby cluster, delayed cluster, Citus, etc.) through <code>pg_cluster / pg_role / pg_seq / pg_upstream</code>.</li><li><strong><a href=/docs/pgsql/config/kernel>Kernel Version</a></strong>: Select the core version, flavor, and tuning templates using <code>pg_version</code>, <code>pg_mode</code>, <code>pg_packages</code>, <code>pg_extensions</code>, <code>pg_conf</code>, and other parameters.</li><li><strong><a href=/docs/pgsql/config/user>Users/Roles</a></strong>: Declare system roles, business accounts, password policies, and connection pool attributes in <code>pg_default_roles</code> and <code>pg_users</code>.</li><li><strong><a href=/docs/pgsql/config/db>Database Objects</a></strong>: Create databases as needed using <code>pg_databases</code>, <code>baseline</code>, <code>schemas</code>, <code>extensions</code>, <code>pool_*</code> fields and automatically integrate with pgbouncer/Grafana.</li><li><strong><a href=/docs/pgsql/config/hba>Access Control (HBA)</a></strong>: Maintain host-based authentication policies using <code>pg_default_hba_rules</code> and <code>pg_hba_rules</code> to ensure access boundaries for different roles/networks.</li><li><strong><a href=/docs/pgsql/config/acl>Privilege Model (ACL)</a></strong>: Converge object privileges through <code>pg_default_privileges</code>, <code>pg_default_roles</code>, <code>pg_revoke_public</code> parameters, providing an out-of-the-box layered role system.</li></ul><p>After understanding these parameters, you can write declarative inventory manifests as &ldquo;configuration as infrastructure&rdquo; for any business requirement. Pigsty will handle execution and ensure idempotency.</p><hr><h2 id=a-typical-example>A Typical Example</h2><p>The following snippet shows how to control instance topology, kernel version, extensions, users, and databases in the same configuration file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-analytics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role: replica, pg_offline_query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-analytics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olap.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, pgvector ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: bi, owner: dbuser_bi, schemas: [mart], extensions: [timescaledb], pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>session }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_bi, password: DBUser.BI, roles: [dbrole_admin], pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>17</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql-main pgsql-common ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: dbuser_bi, db: bi, addr: intra, auth: ssl, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;BI only allows intranet SSL access&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li>The <code>pg-analytics</code> cluster contains one primary and one offline replica.</li><li>Global settings specify <code>pg_version: 17</code> with a set of extension examples and load <code>olap.yml</code> tuning.</li><li>Declare business objects in <code>pg_databases</code> and <code>pg_users</code>, automatically generating schema/extension and connection pool entries.</li><li>Additional <code>pg_hba_rules</code> restrict access sources and authentication methods.</li></ul><p>Modify and apply this inventory to get a customized PostgreSQL cluster without manual configuration.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-01e9f6eb810a0f6072913a962bfd631d>1 - Cluster / Instance</h1><div class=lead>Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs.</div><blockquote><p>Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs.</p></blockquote><p>You can define different types of instances and clusters. Here are several common PostgreSQL instance/cluster types in Pigsty:</p><ul><li><a href=#primary>Primary</a>: Define a single instance cluster.</li><li><a href=#replica>Replica</a>: Define a basic HA cluster with one primary and one replica.</li><li><a href=#offline>Offline</a>: Define an instance dedicated to OLAP/ETL/interactive queries</li><li><a href=#sync-standby>Sync Standby</a>: Enable synchronous commit to ensure no data loss.</li><li><a href=#quorum-commit>Quorum Commit</a>: Use quorum sync commit for a higher consistency level.</li><li><a href=#standby-cluster>Standby Cluster</a>: Clone an existing cluster and follow it</li><li><a href=#delayed-cluster>Delayed Cluster</a>: Clone an existing cluster for emergency data recovery</li><li><a href=#citus-cluster>Citus Cluster</a>: Define a Citus distributed database cluster</li></ul><hr><h2 id=primary>Primary</h2><p>We start with the simplest case: a single instance cluster consisting of one primary:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>This configuration is concise and self-describing, consisting only of <a href=/docs/pgsql/config#identity-parameters><strong>identity parameters</strong></a>. Note that the Ansible Group name should match <a href=/docs/pgsql/param#pg_cluster><code>pg_cluster</code></a>.</p><p>Use the following command to create this cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-add pg-test
</span></span></code></pre></div><p>For demos, development testing, hosting temporary requirements, or performing non-critical analytical tasks, a single database instance may not be a big problem. However, such a single-node cluster has no <a href=/docs/concept/ha>high availability</a>. When hardware failures occur, you&rsquo;ll need to use <a href=/docs/concept/pitr>PITR</a> or other recovery methods to ensure the cluster&rsquo;s RTO/RPO. For this reason, you may consider adding several <a href=#replica>read-only replicas</a> to the cluster.</p><hr><h2 id=replica>Replica</h2><p>To add a read-only replica instance, you can add a new node to <code>pg-test</code> and set its <a href=/docs/pgsql/param#pg_role><code>pg_role</code></a> to <code>replica</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- newly added replica</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>If the entire cluster doesn&rsquo;t exist, you can directly <a href=/docs/pgsql/admin#create-cluster>create</a> the complete cluster. If the cluster primary has already been initialized, you can <a href=/docs/pgsql/admin#add-instance>add</a> a replica to the existing cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-add pg-test               <span style=color:#8f5902;font-style:italic># initialize the entire cluster at once</span>
</span></span><span style=display:flex><span>bin/pgsql-add pg-test 10.10.10.12   <span style=color:#8f5902;font-style:italic># add replica to existing cluster</span>
</span></span></code></pre></div><p>When the cluster primary fails, the read-only instance (Replica) can take over the primary&rsquo;s work with the help of the high availability system. Additionally, read-only instances can be used to execute read-only queries: many businesses have far more read requests than write requests, and most read-only query loads can be handled by replica instances.</p><hr><h2 id=offline>Offline</h2><p>Offline instances are dedicated read-only replicas specifically for serving slow queries, ETL, OLAP traffic, and interactive queries. Slow queries/long transactions have adverse effects on the performance and stability of online business, so it&rsquo;s best to isolate them from online business.</p><p>To add an offline instance, assign it a new instance and set <a href=/docs/pgsql/param#pg_role><code>pg_role</code></a> to <code>offline</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>offline } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- newly added offline replica</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Dedicated offline instances work similarly to common replica instances, but they serve as backup servers in the <code>pg-test-replica</code> service. That is, only when all <code>replica</code> instances are down will the offline and primary instances provide this read-only service.</p><p>In many cases, database resources are limited, and using a separate server as an offline instance is not economical. As a compromise, you can select an existing replica instance and mark it with the <a href=/docs/pgsql/param#pg_offline_query><code>pg_offline_query</code></a> flag to indicate it can handle &ldquo;offline queries&rdquo;. In this case, this read-only replica will handle both online read-only requests and offline queries. You can use <a href=/docs/pgsql/param#pg_default_hba_rules><code>pg_default_hba_rules</code></a> and <a href=/docs/pgsql/param#pg_hba_rules><code>pg_hba_rules</code></a> for additional access control on offline instances.</p><hr><h2 id=sync-standby>Sync Standby</h2><p>When Sync Standby is enabled, PostgreSQL will select one replica as the <strong>sync standby</strong>, with all other replicas as <strong>candidates</strong>. The primary database will wait for the standby instance to flush to disk before confirming commits. The standby instance always has the latest data with no replication lag, and primary-standby switchover to the sync standby will have no data loss.</p><p>PostgreSQL uses asynchronous streaming replication by default, which may have small replication lag (on the order of 10KB/10ms). When the primary fails, there may be a small data loss window (which can be controlled using <a href=/docs/pgsql/param#pg_rpo><code>pg_rpo</code></a>), but this is acceptable for most scenarios.</p><p>However, in some critical scenarios (e.g., financial transactions), data loss is completely unacceptable, or read replication lag is unacceptable. In such cases, you can use synchronous commit to solve this problem. To enable sync standby mode, you can simply use the <code>crit.yml</code> template in <a href=/docs/pgsql/param#pg_conf><code>pg_conf</code></a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit.yml  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- use crit template</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>To enable sync standby on an existing cluster, <a href=/docs/pgsql/admin#configure-cluster>configure the cluster</a> and enable <code>synchronous_mode</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pg edit-config pg-test    <span style=color:#8f5902;font-style:italic># run as admin user on admin node</span>
</span></span><span style=display:flex><span>+++
</span></span><span style=display:flex><span>-synchronous_mode: <span style=color:#204a87>false</span>    <span style=color:#8f5902;font-style:italic># &lt;--- old value</span>
</span></span><span style=display:flex><span>+synchronous_mode: <span style=color:#204a87>true</span>     <span style=color:#8f5902;font-style:italic># &lt;--- new value</span>
</span></span><span style=display:flex><span> synchronous_mode_strict: <span style=color:#204a87>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Apply these changes? <span style=color:#ce5c00;font-weight:700>[</span>y/N<span style=color:#ce5c00;font-weight:700>]</span>: y
</span></span></code></pre></div><p>In this case, the PostgreSQL configuration parameter <a href=https://www.postgresql.org/docs/current/runtime-config-replication.html#synchronous_standby_names><code>synchronous_standby_names</code></a> is automatically managed by Patroni.
One replica will be elected as the sync standby, and its <code>application_name</code> will be written to the PostgreSQL primary configuration file and applied.</p><hr><h2 id=quorum-commit>Quorum Commit</h2><p>Quorum Commit provides more powerful control than sync standby: especially when you have multiple replicas, you can set criteria for successful commits, achieving higher/lower consistency levels (and trade-offs with availability).</p><p>If you want <strong>at least two replicas</strong> to confirm commits, you can adjust the <a href=https://patroni.readthedocs.io/en/latest/replication_modes.html#synchronous-replication-factor><code>synchronous_node_count</code></a> parameter through Patroni <a href=/docs/pgsql/admin#configure-cluster>cluster configuration</a> and apply it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>synchronous_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># ensure synchronous commit is enabled</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>synchronous_node_count</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># specify &#34;at least&#34; how many replicas must successfully commit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>If you want to use more sync replicas, modify the <code>synchronous_node_count</code> value. When the cluster size changes, you should ensure this configuration is still valid to avoid service unavailability.</p><p>In this case, the PostgreSQL configuration parameter <a href=https://www.postgresql.org/docs/current/runtime-config-replication.html#synchronous_standby_names><code>synchronous_standby_names</code></a> is automatically managed by Patroni.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>synchronous_standby_names = &#39;2 (&#34;pg-test-3&#34;,&#34;pg-test-2&#34;)&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><details><summary>Example: Using multiple sync standbys</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pg edit-config pg-test
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>+synchronous_node_count: <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Apply these changes? <span style=color:#ce5c00;font-weight:700>[</span>y/N<span style=color:#ce5c00;font-weight:700>]</span>: y
</span></span></code></pre></div><p>After applying the configuration, two sync standbys appear.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>+ Cluster: pg-test <span style=color:#ce5c00;font-weight:700>(</span>7080814403632534854<span style=color:#ce5c00;font-weight:700>)</span> +---------+----+-----------+-----------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> Member    <span style=color:#000;font-weight:700>|</span> Host        <span style=color:#000;font-weight:700>|</span> Role         <span style=color:#000;font-weight:700>|</span> State   <span style=color:#000;font-weight:700>|</span> TL <span style=color:#000;font-weight:700>|</span> Lag in MB <span style=color:#000;font-weight:700>|</span> Tags            <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-----------+-------------+--------------+---------+----+-----------+-----------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> pg-test-1 <span style=color:#000;font-weight:700>|</span> 10.10.10.10 <span style=color:#000;font-weight:700>|</span> Leader       <span style=color:#000;font-weight:700>|</span> running <span style=color:#000;font-weight:700>|</span>  <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>|</span>           <span style=color:#000;font-weight:700>|</span> clonefrom: <span style=color:#204a87>true</span> <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> pg-test-2 <span style=color:#000;font-weight:700>|</span> 10.10.10.11 <span style=color:#000;font-weight:700>|</span> Sync Standby <span style=color:#000;font-weight:700>|</span> running <span style=color:#000;font-weight:700>|</span>  <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>|</span>         <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>|</span> clonefrom: <span style=color:#204a87>true</span> <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> pg-test-3 <span style=color:#000;font-weight:700>|</span> 10.10.10.12 <span style=color:#000;font-weight:700>|</span> Sync Standby <span style=color:#000;font-weight:700>|</span> running <span style=color:#000;font-weight:700>|</span>  <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>|</span>         <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>|</span> clonefrom: <span style=color:#204a87>true</span> <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-----------+-------------+--------------+---------+----+-----------+-----------------+
</span></span></code></pre></div></details><p>Another scenario is using <strong>any n</strong> replicas to confirm commits. In this case, the configuration is slightly different. For example, if we only need any one replica to confirm commits:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>synchronous_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>quorum       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># use quorum commit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>postgresql</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># modify PostgreSQL&#39;s configuration parameter synchronous_standby_names, using `ANY n ()` syntax</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>synchronous_standby_names</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;ANY 1 (*)&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># you can specify a specific replica list or use * to wildcard all replicas.</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><details><summary>Example: Enable ANY quorum commit</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pg edit-config pg-test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+    synchronous_standby_names: <span style=color:#4e9a06>&#39;ANY 1 (*)&#39;</span> <span style=color:#8f5902;font-style:italic># in ANY mode, this parameter is needed</span>
</span></span><span style=display:flex><span>- synchronous_node_count: <span style=color:#0000cf;font-weight:700>2</span>  <span style=color:#8f5902;font-style:italic># in ANY mode, this parameter is not needed</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Apply these changes? <span style=color:#ce5c00;font-weight:700>[</span>y/N<span style=color:#ce5c00;font-weight:700>]</span>: y
</span></span></code></pre></div><p>After applying, the configuration takes effect, and all standbys become regular replicas in Patroni. However, in <code>pg_stat_replication</code>, you can see <code>sync_state</code> becomes <code>quorum</code>.</p></details><hr><h2 id=standby-cluster>Standby Cluster</h2><p>You can clone an existing cluster and create a standby cluster for data migration, horizontal splitting, multi-region deployment, or disaster recovery.</p><p>Under normal circumstances, the standby cluster will follow the upstream cluster and keep content synchronized. You can promote the standby cluster to become a truly independent cluster.</p><p>The standby cluster definition is basically the same as a normal cluster definition, except that the <a href=/docs/pgsql/param#pg_upstream><code>pg_upstream</code></a> parameter is additionally defined on the primary. The primary of the standby cluster is called the <strong>Standby Leader</strong>.</p><p>For example, below defines a <code>pg-test</code> cluster and its standby cluster <code>pg-test2</code>. The configuration inventory might look like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg-test is the original cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg-test2 is the standby cluster of pg-test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role: primary , pg_upstream</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.11</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- pg_upstream defined here</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test2 }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The primary node <code>pg-test2-1</code> of the <code>pg-test2</code> cluster will be a downstream replica of <code>pg-test</code> and serve as the Standby Leader in the <code>pg-test2</code> cluster.</p><p>Just ensure the <a href=/docs/pgsql/param#pg_upstream><code>pg_upstream</code></a> parameter is configured on the standby cluster&rsquo;s primary node to automatically pull backups from the original upstream.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-add pg-test     <span style=color:#8f5902;font-style:italic># create original cluster</span>
</span></span><span style=display:flex><span>bin/pgsql-add pg-test2    <span style=color:#8f5902;font-style:italic># create standby cluster</span>
</span></span></code></pre></div><details><summary>Example: Change replication upstream</summary><p>If necessary (e.g., upstream primary-standby switchover/failover), you can change the standby cluster&rsquo;s replication upstream through <a href=/docs/pgsql/admin#configure-cluster>cluster configuration</a>.</p><p>To do this, simply change <code>standby_cluster.host</code> to the new upstream IP address and apply.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pg edit-config pg-test2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> standby_cluster:
</span></span><span style=display:flex><span>   create_replica_methods:
</span></span><span style=display:flex><span>   - basebackup
</span></span><span style=display:flex><span>-  host: 10.10.10.13     <span style=color:#8f5902;font-style:italic># &lt;--- old upstream</span>
</span></span><span style=display:flex><span>+  host: 10.10.10.12     <span style=color:#8f5902;font-style:italic># &lt;--- new upstream</span>
</span></span><span style=display:flex><span>   port: <span style=color:#0000cf;font-weight:700>5432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> Apply these changes? <span style=color:#ce5c00;font-weight:700>[</span>y/N<span style=color:#ce5c00;font-weight:700>]</span>: y
</span></span></code></pre></div></details><details><summary>Example: Promote standby cluster</summary><p>You can promote the standby cluster to an independent cluster at any time, so the cluster can independently handle write requests and diverge from the original cluster.</p><p>To do this, you must <a href=/docs/pgsql/admin#configure-cluster>configure</a> the cluster and completely erase the <code>standby_cluster</code> section, then apply.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pg edit-config pg-test2
</span></span><span style=display:flex><span>-standby_cluster:
</span></span><span style=display:flex><span>-  create_replica_methods:
</span></span><span style=display:flex><span>-  - basebackup
</span></span><span style=display:flex><span>-  host: 10.10.10.11
</span></span><span style=display:flex><span>-  port: <span style=color:#0000cf;font-weight:700>5432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Apply these changes? <span style=color:#ce5c00;font-weight:700>[</span>y/N<span style=color:#ce5c00;font-weight:700>]</span>: y
</span></span></code></pre></div></details><details><summary>Example: Cascade replication</summary><p>If you specify <a href=/docs/pgsql/param#pg_upstream><code>pg_upstream</code></a> on a replica instead of the primary, you can configure <strong>cascade replication</strong> for the cluster.</p><p>When configuring cascade replication, you must use the IP address of an instance in the cluster as the parameter value, otherwise initialization will fail. The replica performs streaming replication from a specific instance rather than the primary.</p><p>The instance acting as a WAL relay is called a <strong>Bridge Instance</strong>. Using a bridge instance can share the burden of sending WAL from the primary. When you have dozens of replicas, using bridge instance cascade replication is a good idea.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pg-test-1 ---&gt; pg-test-2 ---&gt; pg-test-3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- bridge instance</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role: replica, pg_upstream</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.12</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># ^--- replicate from pg-test-2 (bridge) instead of pg-test-1 (primary)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></details><hr><h2 id=delayed-cluster>Delayed Cluster</h2><p>A Delayed Cluster is a special type of <a href=#standby-cluster>standby cluster</a> used to quickly recover &ldquo;accidentally deleted&rdquo; data.</p><p>For example, if you want a cluster named <code>pg-testdelay</code> whose data content is the same as the <code>pg-test</code> cluster from one hour ago:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg-test is the original cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg-testdelay is the delayed cluster of pg-test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-testdelay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role: primary , pg_upstream: 10.10.10.11, pg_delay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1d }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-testdelay }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>You can also <a href=/docs/pgsql/admin#configure-cluster>configure</a> a &ldquo;replication delay&rdquo; on an existing <a href=#standby-cluster>standby cluster</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pg edit-config pg-testdelay
</span></span><span style=display:flex><span> standby_cluster:
</span></span><span style=display:flex><span>   create_replica_methods:
</span></span><span style=display:flex><span>   - basebackup
</span></span><span style=display:flex><span>   host: 10.10.10.11
</span></span><span style=display:flex><span>   port: <span style=color:#0000cf;font-weight:700>5432</span>
</span></span><span style=display:flex><span>+  recovery_min_apply_delay: 1h    <span style=color:#8f5902;font-style:italic># &lt;--- add delay duration here, e.g. 1 hour</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Apply these changes? <span style=color:#ce5c00;font-weight:700>[</span>y/N<span style=color:#ce5c00;font-weight:700>]</span>: y
</span></span></code></pre></div><p>When some tuples and tables are accidentally deleted, you can modify this parameter to advance this delayed cluster to an appropriate point in time, read data from it, and quickly fix the original cluster.</p><p>Delayed clusters require additional resources, but are much faster than <a href=/docs/concept/pitr#recovery>PITR</a> and have much less impact on the system. For very critical clusters, consider setting up delayed clusters.</p><hr><h2 id=citus-cluster>Citus Cluster</h2><p>Pigsty natively supports Citus. You can refer to <a href=https://github.com/pgsty/pigsty/blob/main/conf/citus.yml><code>files/pigsty/citus.yml</code></a> and <a href=https://github.com/pgsty/pigsty/blob/main/conf/prod.yml#L298><code>prod.yml</code></a> as examples.</p><p>To define a Citus cluster, you need to specify the following parameters:</p><ul><li><a href=/docs/pgsql/param#pg_mode><code>pg_mode</code></a> must be set to <code>citus</code>, not the default <code>pgsql</code></li><li>The shard name <a href=/docs/pgsql/param#pg_shard><code>pg_shard</code></a> and shard number <a href=/docs/pgsql/param#pg_group><code>pg_group</code></a> must be defined on each shard cluster</li><li><a href=/docs/pgsql/param#pg_primary_db><code>pg_primary_db</code></a> must be defined to specify the database managed by Patroni.</li><li>If you want to use <a href=/docs/pgsql/param#pg_dbsu><code>pg_dbsu</code></a> <code>postgres</code> instead of the default <a href=/docs/pgsql/param#pg_admin_username><code>pg_admin_username</code></a> to execute admin commands, then <a href=/docs/pgsql/param#pg_dbsu_password><code>pg_dbsu_password</code></a> must be set to a non-empty plaintext password</li></ul><p>Additionally, extra hba rules are needed to allow SSL access from localhost and other data nodes. As shown below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus0 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus1 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus2 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus3</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.14</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus3 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                               </span><span style=color:#8f5902;font-style:italic># global parameters for all Citus clusters</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_mode: citus                    # pgsql cluster mode must be set to</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_shard: pg-citus                # citus horizontal shard name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_primary_db: meta               # citus database name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_dbsu_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Postgres</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># if using dbsu, need to configure a password for it</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ] } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta ,extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>citus }, { name: postgis }, { name: timescaledb } ] } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: &#39;all&#39; ,db: all  ,addr: 127.0.0.1/32 ,auth: ssl ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all user ssl access from localhost&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: &#39;all&#39; ,db: all  ,addr: intra        ,auth: ssl ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all user ssl access from intranet&#39;</span><span style=color:#f8f8f8>  </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>On the coordinator node, you can create distributed tables and reference tables and query them from any data node. Starting from 11.2, any Citus database node can act as a coordinator.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SELECT create_distributed_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;pgbench_accounts&#39;</span>, <span style=color:#4e9a06>&#39;aid&#39;</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span> SELECT truncate_local_data_after_distributing_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$$</span>public.pgbench_accounts<span style=color:#000>$$</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>SELECT create_reference_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;pgbench_branches&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>         <span style=color:#000;font-weight:700>;</span> SELECT truncate_local_data_after_distributing_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$$</span>public.pgbench_branches<span style=color:#000>$$</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>SELECT create_reference_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;pgbench_history&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>          <span style=color:#000;font-weight:700>;</span> SELECT truncate_local_data_after_distributing_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$$</span>public.pgbench_history<span style=color:#000>$$</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>SELECT create_reference_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;pgbench_tellers&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>          <span style=color:#000;font-weight:700>;</span> SELECT truncate_local_data_after_distributing_table<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$$</span>public.pgbench_tellers<span style=color:#000>$$</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-64c78407e33d191b14a78a9a03369255>2 - Kernel Version</h1><div class=lead>How to choose the appropriate PostgreSQL kernel and major version.</div><blockquote><p>Choosing a &ldquo;kernel&rdquo; in Pigsty means determining the PostgreSQL major version, mode/distribution, packages to install, and tuning templates to load.</p></blockquote><p>Pigsty supports PostgreSQL from version 10 onwards. The current version packages core software for versions 13-18 by default and provides a complete extension set for 17/18. The following content shows how to make these choices through configuration files.</p><hr><h2 id=major-version-and-packages>Major Version and Packages</h2><ul><li><code>pg_version</code>: Specify the PostgreSQL major version (default 18). Pigsty will automatically map to the correct package name prefix based on the version.</li><li><code>pg_packages</code>: Define the core package set to install, supports using <a href=/docs/pgsql/config/alias>package aliases</a> (default <code>pgsql-main pgsql-common</code>, includes kernel + patroni/pgbouncer/pgbackrest and other common tools).</li><li><code>pg_extensions</code>: List of additional extension packages to install, also supports aliases; defaults to empty meaning only core dependencies are installed.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>17</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql-main pgsql-common ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, pgvector, pgml ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Effect: Ansible will pull packages corresponding to <code>pg_version=17</code> during installation, pre-install extensions to the system, and database initialization scripts can then directly <code>CREATE EXTENSION</code>.</p></blockquote><p>Extension support varies across versions in Pigsty&rsquo;s offline repository: 12/13 only provide core and tier-1 extensions, while 15/17/18 cover all extensions. If an extension is not pre-packaged, it can be added via <code>repo_packages_extra</code>.</p><hr><h2 id=kernel-mode-pg_mode>Kernel Mode (pg_mode)</h2><p><code>pg_mode</code> controls the kernel &ldquo;flavor&rdquo; to deploy. Default <code>pgsql</code> indicates standard PostgreSQL. Pigsty currently supports the following modes:</p><table><thead><tr><th>Mode</th><th>Scenario</th></tr></thead><tbody><tr><td><code>pgsql</code></td><td>Standard PostgreSQL, HA + replication</td></tr><tr><td><code>citus</code></td><td>Citus distributed cluster, requires additional <code>pg_shard / pg_group</code></td></tr><tr><td><code>gpsql</code></td><td>Greenplum / MatrixDB</td></tr><tr><td><code>mssql</code></td><td>Babelfish for PostgreSQL</td></tr><tr><td><code>mysql</code></td><td>OpenGauss/HaloDB compatible with MySQL protocol</td></tr><tr><td><code>polar</code></td><td>Alibaba PolarDB (based on pg <code>polar</code> distribution)</td></tr><tr><td><code>ivory</code></td><td>IvorySQL (Oracle-compatible syntax)</td></tr><tr><td><code>oriole</code></td><td>OrioleDB storage engine</td></tr><tr><td><code>oracle</code></td><td>PostgreSQL + ora compatibility (<code>pg_mode: oracle</code>)</td></tr></tbody></table><p>After selecting a mode, Pigsty will automatically load corresponding templates, dependency packages, and Patroni configurations. For example, deploying Citus:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus0, pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus1, pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_shard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>patroni_citus_db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Effect: All members will install Citus-related packages, Patroni writes to etcd in shard mode, and automatically <code>CREATE EXTENSION citus</code> in the <code>meta</code> database.</p></blockquote><hr><h2 id=extensions-and-pre-installed-objects>Extensions and Pre-installed Objects</h2><p>Besides system packages, you can control components automatically loaded after database startup through the following parameters:</p><ul><li><code>pg_libs</code>: List to write to <code>shared_preload_libraries</code>. For example: <code>pg_libs: 'timescaledb, pg_stat_statements, auto_explain'</code>.</li><li><code>pg_default_extensions</code> / <code>pg_default_schemas</code>: Control schemas and extensions pre-created in <code>template1</code> and <code>postgres</code> by initialization scripts.</li><li><code>pg_parameters</code>: Append <code>ALTER SYSTEM SET</code> for all instances (written to <code>postgresql.auto.conf</code>).</li></ul><p>Example: Enable TimescaleDB, pgvector and customize some system parameters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-analytics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-analytics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, pgml&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_default_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>timescaledb }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>timescaledb.max_background_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>shared_preload_libraries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;&#39;timescaledb,pg_stat_statements,pgml&#39;&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Effect: During initialization, <code>template1</code> creates extensions, Patroni&rsquo;s <code>postgresql.conf</code> injects corresponding parameters, and all business databases inherit these settings.</p></blockquote><hr><h2 id=tuning-template-pg_conf>Tuning Template (<code>pg_conf</code>)</h2><p><code>pg_conf</code> points to Patroni templates in <code>roles/pgsql/templates/*.yml</code>. Pigsty includes four built-in general templates:</p><table><thead><tr><th>Template</th><th>Applicable Scenario</th></tr></thead><tbody><tr><td><code>oltp.yml</code></td><td>Default template, for 4–128 core TP workload</td></tr><tr><td><code>olap.yml</code></td><td>Optimized for analytical scenarios</td></tr><tr><td><code>crit.yml</code></td><td>Emphasizes sync commit/minimal latency, suitable for zero-loss scenarios like finance</td></tr><tr><td><code>tiny.yml</code></td><td>Lightweight machines / edge scenarios / resource-constrained environments</td></tr></tbody></table><p>You can directly replace the template or customize a YAML file in <code>templates/</code>, then specify it in cluster <code>vars</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-ledger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-ledger</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>synchronous_commit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;remote_apply&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>max_wal_senders</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>wal_keep_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;2GB&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Effect: Copy <code>crit.yml</code> as Patroni configuration, overlay <code>pg_parameters</code> written to <code>postgresql.auto.conf</code>, making instances run immediately in synchronous commit mode.</p></blockquote><hr><h2 id=combined-instance-a-complete-example>Combined Instance: A Complete Example</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-rag</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.31</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.32</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-rag</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olap.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql-main pgsql-common ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector, pgml, postgis ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements, pgvector, pgml&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>max_parallel_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>shared_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;32GB&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li>First primary + one replica, using <code>olap.yml</code> tuning.</li><li>Install PG18 + RAG common extensions, automatically load <code>pgvector/pgml</code> at system level.</li><li>Patroni/pgbouncer/pgbackrest generated by Pigsty, no manual intervention needed.</li></ul><p>Replace the above parameters according to business needs to complete all kernel-level customization.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ad5d6482cea01b850636a3033b3ec973>3 - Package Alias</h1><div class=lead>Pigsty provides a package alias translation mechanism that shields the differences in binary package details across operating systems, making installation easier.</div><p>PostgreSQL package naming conventions vary significantly across different operating systems:</p><ul><li><strong>EL systems</strong> (RHEL/Rocky/Alma/&mldr;) use formats like <code>pgvector_17</code>, <code>postgis36_17*</code></li><li><strong>Debian/Ubuntu systems</strong> use formats like <code>postgresql-17-pgvector</code>, <code>postgresql-17-postgis-3</code></li></ul><p>This difference adds cognitive burden to users: you need to remember different package name rules for different systems, and handle the embedding of PostgreSQL version numbers.</p><h2 id=package-alias>Package Alias</h2><p>Pigsty solves this problem through the <strong>Package Alias</strong> mechanism: you only need to use unified aliases, and Pigsty will handle all the details:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Using aliases - simple, unified, cross-platform</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, pgvector, timescaledb ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Equivalent to actual package names on EL9 + PG17</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis36_17*, pgvector_17*, timescaledb-tsl_17* ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Equivalent to actual package names on Ubuntu 24 + PG17</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgresql-17-postgis-3, postgresql-17-pgvector, postgresql-17-timescaledb-tsl ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=alias-translation>Alias Translation</h2><p>Aliases can also group a set of packages as a whole. For example, Pigsty&rsquo;s default installed packages - the default value of <a href=/docs/pgsql/param#pg_packages><strong><code>pg_packages</code></strong></a> is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># pg packages to be installed, alias can be used</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgsql-main pgsql-common</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty will query the current operating system alias list (assuming <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el10.x86_64.yml#L105><strong><code>el10.x86_64</code></strong></a>) and translate it to PGSQL kernel, extensions, and toolkits:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgsql-main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span><span style=color:#4e9a06>&#34;postgresql$v postgresql$v-server postgresql$v-libs postgresql$v-contrib postgresql$v-plperl postgresql$v-plpython3 postgresql$v-pltcl postgresql$v-llvmjit pg_repack_$v* wal2json_$v* pgvector_$v*&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgsql-common</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#4e9a06>&#34;patroni patroni-etcd pgbouncer pgbackrest pg_exporter pgbackrest_exporter vip-manager&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Next, Pigsty further translates <code>pgsql-main</code> using the currently specified PG major version (assuming <a href=/docs/pgsql/param#pg_version><strong><code>pg_version</code></strong></a> = <code>18</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg18-main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span><span style=color:#4e9a06>&#34;postgresql18 postgresql18-server postgresql18-libs postgresql18-contrib postgresql18-plperl postgresql18-plpython3 postgresql18-pltcl postgresql18-llvmjit pg_repack_18* wal2json_18* pgvector_18*&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Through this approach, Pigsty shields the complexity of packages, allowing users to simply specify the functional components they want.</p><hr><h2 id=which-variables-can-use-aliases>Which Variables Can Use Aliases?</h2><p>You can use package aliases in the following four parameters, and the aliases will be automatically converted to actual package names according to the translation process:</p><ul><li><a href=/docs/pgsql/param#pg_extensions><strong><code>pg_extensions</code></strong></a> - PG extension packages</li><li><a href=/docs/pgsql/param#pg_extensions><strong><code>pg_packages</code></strong></a> - PG kernel/base utility packages</li><li><a href=/docs/infra/param#repo_packages><strong><code>repo_packages</code></strong></a> - Package download parameter: packages to download to local repository</li><li><a href=/docs/pgsql/param#pg_extensions><strong><code>repo_packages_extra</code></strong></a> - Extension installation parameter: additional packages to download to local repository</li></ul><hr><h2 id=alias-list>Alias List</h2><p>You can find the alias mapping files for each operating system and architecture in the <a href=https://github.com/pgsty/pigsty/tree/main/roles/node_id/vars><code>roles/node_id/vars/</code></a> directory of the Pigsty project source code:</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el10.x86_64.yml#L85><code>el10.x86_64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el10.aarch64.yml#L85><code>el10.aarch64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el9.x86_64.yml#L85><code>el9.x86_64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el9.aarch64.yml#L85><code>el9.aarch64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el8.x86_64.yml#L85><code>el8.x86_64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el8.aarch64.yml#L85><code>el8.aarch64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/u24.x86_64.yml#L78><code>u24.x86_64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/u24.aarch64.yml#L78><code>u24.aarch64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/u22.x86_64.yml#L78><code>u22.x86_64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/u22.aarch64.yml#L78><code>u22.aarch64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/d13.x86_64.yml#L78><code>d13.x86_64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/d13.aarch64.yml#L78><code>d13.aarch64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/d12.x86_64.yml#L78><code>d12.x86_64</code></a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/d12.aarch64.yml#L78><code>d12.aarch64</code></a></li></ul><hr><h2 id=how-it-works>How It Works</h2><h3 id=alias-translation-process>Alias Translation Process</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>User config <span style=color:#204a87>alias</span> --&gt; Detect OS --&gt;  Find <span style=color:#204a87>alias</span> mapping table ---&gt; Replace <span style=color:#000>$v</span> placeholder ---&gt; Install actual packages
</span></span><span style=display:flex><span>     ↓                 ↓                   ↓                                   ↓
</span></span><span style=display:flex><span>  postgis          el9.x86_64         postgis36_<span style=color:#000>$v</span>*                   postgis36_17*
</span></span><span style=display:flex><span>  postgis          u24.x86_64         postgresql-<span style=color:#000>$v</span>-postgis-3         postgresql-17-postgis-3
</span></span></code></pre></div><h3 id=version-placeholder>Version Placeholder</h3><p>Pigsty&rsquo;s alias system uses <code>$v</code> as a placeholder for the PostgreSQL version number. When you specify a PostgreSQL version using <a href=/docs/pgsql/param#pg_version><code>pg_version</code></a>, all <code>$v</code> in aliases will be replaced with the actual version number.</p><p>For example, when <code>pg_version: 17</code>:</p><table><thead><tr><th>Alias Definition (EL)</th><th>Expanded Result</th></tr></thead><tbody><tr><td><code>postgresql$v*</code></td><td><code>postgresql17*</code></td></tr><tr><td><code>pgvector_$v*</code></td><td><code>pgvector_17*</code></td></tr><tr><td><code>timescaledb-tsl_$v*</code></td><td><code>timescaledb-tsl_17*</code></td></tr></tbody></table><table><thead><tr><th>Alias Definition (Debian/Ubuntu)</th><th>Expanded Result</th></tr></thead><tbody><tr><td><code>postgresql-$v</code></td><td><code>postgresql-17</code></td></tr><tr><td><code>postgresql-$v-pgvector</code></td><td><code>postgresql-17-pgvector</code></td></tr><tr><td><code>postgresql-$v-timescaledb-tsl</code></td><td><code>postgresql-17-timescaledb-tsl</code></td></tr></tbody></table><h3 id=wildcard-matching>Wildcard Matching</h3><p>On EL systems, many aliases use the <code>*</code> wildcard to match related subpackages. For example:</p><ul><li><code>postgis36_17*</code> will match <code>postgis36_17</code>, <code>postgis36_17-client</code>, <code>postgis36_17-utils</code>, etc.</li><li><code>postgresql17*</code> will match <code>postgresql17</code>, <code>postgresql17-server</code>, <code>postgresql17-libs</code>, <code>postgresql17-contrib</code>, etc.</li></ul><p>This design ensures you don&rsquo;t need to list each subpackage individually - one alias can install the complete extension.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f3a29e30e1bcb1622450d4b2d3604bdc>4 - User/Role</h1><div class=lead>How to define and customize PostgreSQL users and roles through configuration?</div><blockquote><p>In this document, &ldquo;user&rdquo; refers to a logical object within a database cluster created with <code>CREATE USER/ROLE</code>.</p></blockquote><p>In PostgreSQL, users belong directly to the database cluster rather than a specific database. Therefore, when creating business databases and users, follow the principle of &ldquo;users first, databases later&rdquo;.</p><p>Pigsty defines roles and users through two config parameters:</p><ul><li><a href=/docs/pgsql/param#pg_default_roles><strong><code>pg_default_roles</code></strong></a>: Define globally shared roles and users</li><li><a href=/docs/pgsql/param#pg_users><strong><code>pg_users</code></strong></a>: Define business users and roles at cluster level</li></ul><p>The former defines roles/users shared across the entire environment; the latter defines business roles/users specific to a single cluster. Both have the same format as arrays of user definition objects.
Users/roles are created sequentially in array order, so later users can belong to roles defined earlier.</p><p>By default, all users marked with <code>pgbouncer: true</code> are added to the <a href=/docs/concept/arch/pgsql#pgbouncer><strong>Pgbouncer</strong></a> connection pool user list.</p><hr><h2 id=define-users>Define Users</h2><p>Example from Pigsty demo <code>pg-meta</code> cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_meta     ,password: DBUser.Meta     ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_view     ,password: DBUser.Viewer   ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer for meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_grafana  ,password: DBUser.Grafana  ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for grafana database    }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_bytebase ,password: DBUser.Bytebase ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for bytebase database   }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_kong     ,password: DBUser.Kong     ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for kong api gateway    }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_gitea    ,password: DBUser.Gitea    ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for gitea service       }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_wiki     ,password: DBUser.Wiki     ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for wiki.js service     }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_noco     ,password: DBUser.Noco     ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for nocodb service      }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_remove   ,state: absent }  # use state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>absent to delete user</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Each user/role definition is a complex object. Only <code>name</code> is required:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_meta              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># REQUIRED, `name` is the only mandatory field</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>state: create                   # Optional, user state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>create (default), absent</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Meta          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, password, can be scram-sha-256 hash or plaintext</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># Optional, can login, default true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>superuser</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Optional, is superuser, default false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>createdb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># Optional, can create databases, default false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># Optional, can create roles, default false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>inherit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># Optional, inherit role privileges, default true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>replication</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Optional, can replicate, default false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Optional, bypass row-level security, default false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># Optional, connection limit, default -1 (unlimited)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_in</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3650</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># Optional, expire N days from creation (priority over expire_at)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_at</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;2030-12-31&#39;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Optional, expiration date in YYYY-MM-DD format</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, user comment</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, roles array</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># Optional, role-level config params</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>search_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># Optional, add to connection pool user list, default false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, pgbouncer pool mode, default transaction</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Optional, user-level max pool connections, default -1</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=parameter-overview>Parameter Overview</h2><p>The only <strong>required</strong> field is <code>name</code> - a valid, unique username within the cluster. All other params have sensible defaults.</p><table class=full-width><thead><tr><th>Field</th><th>Category</th><th>Type</th><th>Attr</th><th>Description</th></tr></thead><tbody><tr><td><a href=#name><strong><code>name</code></strong></a></td><td>Basic</td><td><code>string</code></td><td>Required</td><td>Username, must be valid and unique</td></tr><tr><td><a href=#state><strong><code>state</code></strong></a></td><td>Basic</td><td><code>enum</code></td><td>Optional</td><td>State: <code>create</code> (default), <code>absent</code></td></tr><tr><td><a href=#password><strong><code>password</code></strong></a></td><td>Basic</td><td><code>string</code></td><td>Mutable</td><td>User password, plaintext or hash</td></tr><tr><td><a href=#comment><strong><code>comment</code></strong></a></td><td>Basic</td><td><code>string</code></td><td>Mutable</td><td>User comment</td></tr><tr><td><a href=#login><strong><code>login</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Can login, default <code>true</code></td></tr><tr><td><a href=#superuser><strong><code>superuser</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Is superuser, default <code>false</code></td></tr><tr><td><a href=#createdb><strong><code>createdb</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Can create databases, default <code>false</code></td></tr><tr><td><a href=#createrole><strong><code>createrole</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Can create roles, default <code>false</code></td></tr><tr><td><a href=#inherit><strong><code>inherit</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Inherit role privileges, default <code>true</code></td></tr><tr><td><a href=#replication><strong><code>replication</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Can replicate, default <code>false</code></td></tr><tr><td><a href=#bypassrls><strong><code>bypassrls</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Bypass RLS, default <code>false</code></td></tr><tr><td><a href=#connlimit><strong><code>connlimit</code></strong></a></td><td>Privilege</td><td><code>int</code></td><td>Mutable</td><td>Connection limit, <code>-1</code> unlimited</td></tr><tr><td><a href=#expire_in><strong><code>expire_in</code></strong></a></td><td>Validity</td><td><code>int</code></td><td>Mutable</td><td>Expire N days from now (priority)</td></tr><tr><td><a href=#expire_at><strong><code>expire_at</code></strong></a></td><td>Validity</td><td><code>string</code></td><td>Mutable</td><td>Expiration date, <code>YYYY-MM-DD</code> format</td></tr><tr><td><a href=#roles><strong><code>roles</code></strong></a></td><td>Role</td><td><code>array</code></td><td>Additive</td><td>Roles array, string or object format</td></tr><tr><td><a href=#parameters><strong><code>parameters</code></strong></a></td><td>Params</td><td><code>object</code></td><td>Mutable</td><td>Role-level parameters</td></tr><tr><td><a href=#pgbouncer><strong><code>pgbouncer</code></strong></a></td><td>Pool</td><td><code>bool</code></td><td>Mutable</td><td>Add to connection pool, default <code>false</code></td></tr><tr><td><a href=#pool_mode><strong><code>pool_mode</code></strong></a></td><td>Pool</td><td><code>enum</code></td><td>Mutable</td><td>Pool mode: <code>transaction</code> (default)</td></tr><tr><td><a href=#pool_connlimit><strong><code>pool_connlimit</code></strong></a></td><td>Pool</td><td><code>int</code></td><td>Mutable</td><td>Pool user max connections</td></tr></tbody></table><hr><h2 id=parameter-details>Parameter Details</h2><h3 id=name><code>name</code></h3><p>String, required. Username - must be unique within the cluster.</p><p>Must be a valid PostgreSQL identifier matching <strong><code>^[a-z_][a-z0-9_]{0,62}$</code></strong>: starts with lowercase letter or underscore, contains only lowercase letters, digits, underscores, max 63 chars.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Standard naming</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>app_readonly      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Underscore separated</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>_internal         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Underscore prefix (for internal roles)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=state><code>state</code></h3><p>Enum for user operation: <code>create</code> or <code>absent</code>. Default <code>create</code>.</p><table class=full-width><thead><tr><th>State</th><th>Description</th></tr></thead><tbody><tr><td><code>create</code></td><td>Default, create user, update if exists</td></tr><tr><td><code>absent</code></td><td>Delete user with <code>DROP ROLE</code></td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># state defaults to create</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_old</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>absent               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Delete user</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>These system users cannot be deleted via <code>state: absent</code> (to prevent cluster failure):</p><ul><li><code>postgres</code>: Database superuser</li><li><code>replicator</code>: Replication user (or <a href=/docs/pgsql/param#pg_replication_username><strong><code>pg_replication_username</code></strong></a>)</li><li><code>dbuser_dba</code>: Admin user (or <a href=/docs/pgsql/param#pg_admin_username><strong><code>pg_admin_username</code></strong></a>)</li><li><code>dbuser_monitor</code>: Monitor user (or <a href=/docs/pgsql/param#pg_monitor_username><strong><code>pg_monitor_username</code></strong></a>)</li></ul><h3 id=password><code>password</code></h3><p>String, mutable. User password - users without password can&rsquo;t login via password auth.</p><p>Password can be:</p><table class=full-width><thead><tr><th>Format</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>Plaintext</td><td><code>DBUser.Meta</code></td><td>Not recommended, logged to config</td></tr><tr><td>SCRAM-SHA-256</td><td><code>SCRAM-SHA-256$4096:xxx$yyy:zzz</code></td><td>Recommended, PG10+ default</td></tr><tr><td>MD5 hash</td><td><code>md5...</code></td><td>Legacy compatibility</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Plaintext (not recommended, logged to config)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>MySecretPassword</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># SCRAM-SHA-256 hash (recommended)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;SCRAM-SHA-256$4096:xxx$yyy:zzz&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>When setting password, Pigsty temporarily disables logging to prevent leakage:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#000>log_statement</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>PASSWORD</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;xxx&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#000>log_statement</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>To generate SCRAM-SHA-256 hash:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Using PostgreSQL (requires pgcrypto extension)</span>
</span></span><span style=display:flex><span>psql -c <span style=color:#4e9a06>&#34;SELECT encode(digest(&#39;password&#39; || &#39;username&#39;, &#39;sha256&#39;), &#39;hex&#39;)&#34;</span>
</span></span></code></pre></div><h3 id=comment><code>comment</code></h3><p>String, mutable. User comment, defaults to <code>business user {name}</code>.</p><p>Set via <code>COMMENT ON ROLE</code>, supports special chars (quotes auto-escaped).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;Main business application account&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>COMMENT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ROLE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IS</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;Main business application account&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=login><code>login</code></h3><p>Boolean, mutable. Can login, default <code>true</code>.</p><p>Setting <code>false</code> creates a <strong>Role</strong> rather than User - typically for permission grouping.</p><p>In PostgreSQL, <code>CREATE USER</code> equals <code>CREATE ROLE ... LOGIN</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create login-able user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create role (no login, for permission grouping)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_custom</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>custom permission role</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>LOGIN</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbrole_custom&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>NOLOGIN</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=superuser><code>superuser</code></h3><p>Boolean, mutable. Is superuser, default <code>false</code>.</p><p>Superusers have full database privileges, bypassing all permission checks.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>superuser: true            # Dangerous</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>full privileges</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_admin&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>SUPERUSER</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty provides default superuser via <a href=/docs/pgsql/param#pg_admin_username><strong><code>pg_admin_username</code></strong></a> (<code>dbuser_dba</code>). Don&rsquo;t create additional superusers unless necessary.</p><h3 id=createdb><code>createdb</code></h3><p>Boolean, mutable. Can create databases, default <code>false</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_dev</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>createdb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># Allow create database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_dev&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CREATEDB</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Some applications (Gitea, Odoo, etc.) may require <code>CREATEDB</code> privilege for their admin users.</p><h3 id=createrole><code>createrole</code></h3><p>Boolean, mutable. Can create other roles, default <code>false</code>.</p><p>Users with <code>CREATEROLE</code> can create, modify, delete other non-superuser roles.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Allow manage other roles</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_admin&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>CREATEROLE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=inherit><code>inherit</code></h3><p>Boolean, mutable. Auto-inherit privileges from member roles, default <code>true</code>.</p><p>Setting <code>false</code> requires explicit <code>SET ROLE</code> to use member role privileges.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Auto-inherit role privileges (default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>inherit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readwrite]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Requires explicit SET ROLE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_special</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>inherit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_special&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>NOINHERIT</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- User must execute SET ROLE dbrole_admin to get privileges
</span></span></span></code></pre></div><h3 id=replication><code>replication</code></h3><p>Boolean, mutable. Can initiate streaming replication, default <code>false</code>.</p><p>Usually only replication users (<code>replicator</code>) need this. Normal users shouldn&rsquo;t have it unless for logical decoding subscriptions.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>replication</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Allow streaming replication</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pg_monitor, dbrole_readonly]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;replicator&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>REPLICATION</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=bypassrls><code>bypassrls</code></h3><p>Boolean, mutable. Bypass row-level security (RLS) policies, default <code>false</code>.</p><p>When enabled, user can access all rows even with RLS policies. Usually only for admins.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_myappadmin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># Bypass RLS policies</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_myappadmin&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>BYPASSRLS</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=connlimit><code>connlimit</code></h3><p>Integer, mutable. Max concurrent connections, default <code>-1</code> (unlimited).</p><p>Positive integer limits max simultaneous sessions for this user. Doesn&rsquo;t affect superusers.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># Max 100 concurrent connections</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_batch</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Limit batch user connections</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CONNECTION</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>LIMIT</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=expire_in><code>expire_in</code></h3><p>Integer, mutable. Expire N days from current date.</p><p>This param has higher priority than <a href=#expire_at><strong><code>expire_at</code></strong></a>. Expiration recalculated on each playbook run - good for temp users needing periodic renewal.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>temp_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_in</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Expire in 30 days</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>contractor_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_in</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>90</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Expire in 90 days</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Generates SQL:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- expire_in: 30, assuming current date is 2025-01-01
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;temp_user&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VALID</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>UNTIL</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;2025-01-31&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=expire_at><code>expire_at</code></h3><p>String, mutable. Expiration date in <code>YYYY-MM-DD</code> format, or special value <code>infinity</code>.</p><p>Lower priority than <a href=#expire_in><strong><code>expire_in</code></strong></a>. Use <code>infinity</code> for never-expiring users.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>contractor_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_at</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;2024-12-31&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Expire on specific date</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>permanent_user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_at</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;infinity&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Never expires</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;contractor_user&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VALID</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>UNTIL</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;2024-12-31&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;permanent_user&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VALID</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>UNTIL</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;infinity&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=roles><code>roles</code></h3><p>Array, additive. Roles this user belongs to. Elements can be strings or objects.</p><p>Simple format - strings for role names:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>pg_read_all_data</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbrole_readwrite&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;pg_read_all_data&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Full format - objects for fine-grained control:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>dbrole_readwrite                            # Simple string</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GRANT role</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin, admin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># WITH ADMIN OPTION</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_monitor, set: false }            # PG16+</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disallow SET ROLE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_signal_backend, inherit: false } # PG16+</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>don&#39;t auto-inherit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: old_role, state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>absent }          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Revoke role membership</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Object Format Parameters</strong>:</p><table class=full-width><thead><tr><th>Param</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>string</td><td>Role name (required)</td></tr><tr><td><code>state</code></td><td>enum</td><td><code>grant</code> (default) or <code>absent</code>/<code>revoke</code>: control membership</td></tr><tr><td><code>admin</code></td><td>bool</td><td><code>true</code>: WITH ADMIN OPTION, <code>false</code>: REVOKE ADMIN</td></tr><tr><td><code>set</code></td><td>bool</td><td>PG16+: <code>true</code>: WITH SET TRUE, <code>false</code>: REVOKE SET</td></tr><tr><td><code>inherit</code></td><td>bool</td><td>PG16+: <code>true</code>: WITH INHERIT TRUE, <code>false</code>: REVOKE INHERIT</td></tr></tbody></table><p><strong>PostgreSQL 16+ New Features</strong>:</p><p>PostgreSQL 16 introduced finer-grained role membership control:</p><ul><li><strong>ADMIN OPTION</strong>: Allow granting role to other users</li><li><strong>SET OPTION</strong>: Allow using <code>SET ROLE</code> to switch to this role</li><li><strong>INHERIT OPTION</strong>: Auto-inherit this role&rsquo;s privileges</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># PostgreSQL 16+ complete example</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Normal membership</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Can grant dbrole_admin to other users</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin, admin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Cannot SET ROLE to pg_monitor (only inherit privileges)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_monitor, set</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Don&#39;t auto-inherit pg_execute_server_program (need explicit SET ROLE)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_execute_server_program, inherit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Revoke old_role membership</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: old_role, state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>absent }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>set</code> and <code>inherit</code> options only work in PG16+. On earlier versions they&rsquo;re ignored with warning comments.</p><h3 id=parameters><code>parameters</code></h3><p>Object, mutable. Role-level config params via <code>ALTER ROLE ... SET</code>. Applies to all sessions for this user.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_analyst</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;256MB&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>statement_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;5min&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>search_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;analytics,public&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>log_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_analyst&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;work_mem&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;256MB&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_analyst&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;statement_timeout&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;5min&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_analyst&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;search_path&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;analytics,public&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_analyst&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;log_statement&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Use special value <code>DEFAULT</code> (case-insensitive) to reset to PostgreSQL default:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DEFAULT         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Reset to default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>statement_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;30s&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># Set new value</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;work_mem&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;statement_timeout&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;30s&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Common role-level params:</p><table class=full-width><thead><tr><th>Parameter</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>work_mem</code></td><td>Query work memory</td><td><code>'64MB'</code></td></tr><tr><td><code>statement_timeout</code></td><td>Statement timeout</td><td><code>'30s'</code></td></tr><tr><td><code>lock_timeout</code></td><td>Lock wait timeout</td><td><code>'10s'</code></td></tr><tr><td><code>idle_in_transaction_session_timeout</code></td><td>Idle transaction timeout</td><td><code>'10min'</code></td></tr><tr><td><code>search_path</code></td><td>Schema search path</td><td><code>'app,public'</code></td></tr><tr><td><code>log_statement</code></td><td>Log level</td><td><code>'ddl'</code></td></tr><tr><td><code>temp_file_limit</code></td><td>Temp file size limit</td><td><code>'10GB'</code></td></tr></tbody></table><p>Query user-level params via <a href=https://www.postgresql.org/docs/current/view-pg-db-role-setting.html><strong><code>pg_db_role_setting</code></strong></a> system view.</p><h3 id=pgbouncer><code>pgbouncer</code></h3><p>Boolean, mutable. Add user to Pgbouncer user list, default <code>false</code>.</p><p>For prod users needing connection pool access, must explicitly set <code>pgbouncer: true</code>.
Default <code>false</code> prevents accidentally exposing internal users to the pool.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Prod user: needs connection pool</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.App</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Internal user: no connection pool needed</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_internal</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Internal</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Default, can be omitted</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Users with <code>pgbouncer: true</code> are added to <code>/etc/pgbouncer/userlist.txt</code>.</p><h3 id=pool_mode><code>pool_mode</code></h3><p>Enum, mutable. User-level pool mode: <code>transaction</code>, <code>session</code>, or <code>statement</code>. Default <code>transaction</code>.</p><table class=full-width><thead><tr><th>Mode</th><th>Description</th><th>Use Case</th></tr></thead><tbody><tr><td><code>transaction</code></td><td>Return connection after txn</td><td>Most OLTP apps, default</td></tr><tr><td><code>session</code></td><td>Return connection after session</td><td>Apps needing session state</td></tr><tr><td><code>statement</code></td><td>Return after each statement</td><td>Simple stateless queries</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># DBA user: session mode (may need SET commands etc.)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_dba</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>session</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Normal business user: transaction mode</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>User-level pool params are configured via <code>/etc/pgbouncer/useropts.txt</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#c4a000>dbuser_dba</span>      <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>pool_mode=session max_user_connections=16</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dbuser_monitor</span>  <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>pool_mode=session max_user_connections=8</span>
</span></span></code></pre></div><h3 id=pool_connlimit><code>pool_connlimit</code></h3><p>Integer, mutable. User-level max pool connections, default <code>-1</code> (unlimited).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Max 50 pool connections for this user</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=acl-system>ACL System</h2><p>Pigsty provides a built-in, out-of-the-box access control / <a href=/docs/concept/sec/ac/#default-roles><strong>ACL</strong></a> system. Just assign these four default roles to business users:</p><table class=full-width><thead><tr><th>Role</th><th>Privileges</th><th>Typical Use Case</th></tr></thead><tbody><tr><td><code>dbrole_readwrite</code></td><td>Global read-write</td><td>Primary business prod accounts</td></tr><tr><td><code>dbrole_readonly</code></td><td>Global read-only</td><td>Other business read-only access</td></tr><tr><td><code>dbrole_admin</code></td><td>DDL privileges</td><td>Business admins, table creation</td></tr><tr><td><code>dbrole_offline</code></td><td>Restricted read-only (offline only)</td><td>Individual users, ETL/analytics</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Typical business user configuration</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.App</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readwrite]   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Prod account, read-write</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readonly]    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Read-only account</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Admin, can execute DDL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_etl</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.ETL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_offline]     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Offline analytics account</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>To redesign your own ACL system, customize:</p><ul><li><a href=/docs/pgsql/param#pg_default_roles><strong><code>pg_default_roles</code></strong></a>: System-wide roles and global users</li><li><a href=/docs/pgsql/param#pg_default_privileges><strong><code>pg_default_privileges</code></strong></a>: Default privileges for new objects</li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/pg-init-role.sql><strong><code>pg-init-role.sql</code></strong></a>: Role creation SQL template</li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/pg-init-template.sql><strong><code>pg-init-template.sql</code></strong></a>: Privilege SQL template</li></ul><hr><h2 id=pgbouncer-users>Pgbouncer Users</h2><p>Pgbouncer is enabled by default as connection pool middleware. Pigsty adds all users in <a href=/docs/pgsql/param#pg_users><strong><code>pg_users</code></strong></a> with explicit <code>pgbouncer: true</code> flag to the pgbouncer user list.</p><p>Users in connection pool are listed in <code>/etc/pgbouncer/userlist.txt</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#c4a000>&#34;postgres&#34; &#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>&#34;dbuser_wiki&#34; &#34;SCRAM-SHA-256$4096:+77dyhrPeFDT/TptHs7/7Q</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>=$KeatuohpKIYzHPCt/tqBu85vI11o9mar/by0hHYM2W8=:X9gig4JtjoS8Y/o1vQsIX/gY1Fns8ynTXkbWOjUfbRQ=&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>&#34;dbuser_view&#34; &#34;SCRAM-SHA-256$4096:DFoZHU/DXsHL8MJ8regdEw</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>=$gx9sUGgpVpdSM4o6A2R9PKAUkAsRPLhLoBDLBUYtKS0=:MujSgKe6rxcIUMv4GnyXJmV0YNbf39uFRZv724+X1FE=&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>&#34;dbuser_monitor&#34; &#34;SCRAM-SHA-256$4096:fwU97ZMO/KR0ScHO5+UuBg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>=$CrNsmGrx1DkIGrtrD1Wjexb/aygzqQdirTO1oBZROPY=:L8+dJ+fqlMQh7y4PmVR/gbAOvYWOr+KINjeMZ8LlFww=&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>&#34;dbuser_meta&#34; &#34;SCRAM-SHA-256$4096:leB2RQPcw1OIiRnPnOMUEg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>=$eyC+NIMKeoTxshJu314+BmbMFpCcspzI3UFZ1RYfNyU=:fJgXcykVPvOfro2MWNkl5q38oz21nSl1dTtM65uYR1Q=&#34;</span>
</span></span></code></pre></div><p>User-level pool params are maintained in <code>/etc/pgbouncer/useropts.txt</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#c4a000>dbuser_dba</span>      <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>pool_mode=session max_user_connections=16</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dbuser_monitor</span>  <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>pool_mode=session max_user_connections=8</span>
</span></span></code></pre></div><p>When <a href=/docs/pgsql/admin/user#create-user><strong>creating users</strong></a>, Pgbouncer user list is refreshed via online reload - doesn&rsquo;t affect existing connections.</p><p>Pgbouncer runs as same <code>dbsu</code> as PostgreSQL (default <code>postgres</code> OS user). Use <code>pgb</code> alias to access pgbouncer admin functions.</p><p><a href=/docs/pgsql/param#pgbouncer_auth_query><strong><code>pgbouncer_auth_query</code></strong></a> param allows dynamic query for pool user auth - convenient when you prefer not to manually manage pool users.</p><hr><h2 id=related-resources>Related Resources</h2><p>For user management operations, see <a href=/docs/pgsql/admin/user><strong>User Management</strong></a>.</p><p>For user access privileges, see <a href=/docs/concept/sec/ac/#default-roles><strong>ACL: Role Privileges</strong></a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-662c4a4a95a52da3073eeed2f4407af9>5 - Database</h1><div class=lead>How to define and customize PostgreSQL databases through configuration?</div><blockquote><p>In this document, &ldquo;database&rdquo; refers to a logical object within a database cluster created with <code>CREATE DATABASE</code>.</p></blockquote><p>A PostgreSQL cluster can serve multiple <strong>databases</strong> simultaneously. In Pigsty, you can <a href=#define-database><strong>define</strong></a> required databases in cluster configuration.</p><p>Pigsty customizes the <code>template1</code> template database - creating default schemas, installing default extensions, configuring default privileges. Newly created databases inherit these settings from <code>template1</code>.
You can also specify other template databases via <a href=#template><strong><code>template</code></strong></a> for instant <a href=/docs/pgsql/admin/db#clone-database><strong>database cloning</strong></a>.</p><p>By default, all business databases are 1:1 added to <a href=/docs/concept/arch/pgsql#pgbouncer><strong>Pgbouncer</strong></a> <a href=#connection-pool><strong>connection pool</strong></a>; <a href=/docs/concept/arch/pgsql#pg_exporter><strong><code>pg_exporter</code></strong></a> auto-discovers all business databases for in-database object monitoring.
All databases are also registered as PostgreSQL datasources in <a href=/docs/concept/arch/infra#grafana><strong>Grafana</strong></a> on all <a href=/docs/concept/arch/node#infra-node><strong>INFRA nodes</strong></a> for PGCAT dashboards.</p><hr><h2 id=define-database>Define Database</h2><p>Business databases are defined in cluster param <a href=/docs/pgsql/param#pg_databases><strong><code>pg_databases</code></strong></a>, an array of database definition objects.
During cluster initialization, databases are created <strong>in definition order</strong>, so later databases can use earlier ones as <strong>templates</strong>.</p><p>Example from Pigsty demo <code>pg-meta</code> cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span>{<span style=color:#204a87;font-weight:700>name: postgis, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public}, {name: timescaledb}]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: grafana  ,owner: dbuser_grafana  ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>grafana primary database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: bytebase ,owner: dbuser_bytebase ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>bytebase primary database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: kong     ,owner: dbuser_kong     ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>kong the api gateway database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: gitea    ,owner: dbuser_gitea    ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>gitea meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: wiki     ,owner: dbuser_wiki     ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>wiki meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: noco     ,owner: dbuser_noco     ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>nocodb database }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Each database definition is a complex object with fields below. Only <code>name</code> is required:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># REQUIRED, `name` is the only mandatory field</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>state: create                   # Optional, database state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>create (default), absent, recreate</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>baseline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cmdb.sql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, SQL baseline file path (relative to Ansible search path, e.g., files/)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># Optional, add to pgbouncer database list? default true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pigsty]              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, additional schemas to create, array of schema names</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>extensions:                     # Optional, extensions to install</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>array of extension objects</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgis , schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Can specify schema, or omit (installs to first schema in search_path)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>timescaledb }              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Some extensions create and use fixed schemas</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty meta database  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, database comment/description</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, database owner, defaults to current user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template1            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, template to use, default template1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>strategy: FILE_COPY             # Optional, clone strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>FILE_COPY or WAL_LOG (PG15+)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, inherits from template/cluster config (UTF8)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, inherits from template/cluster config (C)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>lc_collate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, inherits from template/cluster config (C)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>lc_ctype</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, inherits from template/cluster config (C)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider: libc           # Optional, locale provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>libc, icu, builtin (PG15+)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en-US              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, ICU locale rules (PG15+)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># Optional, ICU collation rules (PG16+)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>builtin_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C.UTF-8        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, builtin locale provider rules (PG17+)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tablespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_default         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, default tablespace</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>is_template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Optional, mark as template database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>allowconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># Optional, allow connections, default true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># Optional, revoke public CONNECT privilege, default false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>register_datasource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># Optional, register to grafana datasource? default true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># Optional, connection limit, -1 means unlimited</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># Optional, database-level params via ALTER DATABASE SET</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;64MB&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>statement_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;30s&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_auth_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_meta    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, auth user for pgbouncer auth_query</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, database-level pgbouncer pool mode</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># Optional, database-level pgbouncer default pool size</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_reserve</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Optional, database-level pgbouncer reserve pool</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_size_min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Optional, database-level pgbouncer min pool size</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># Optional, database-level max database connections</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=parameter-overview>Parameter Overview</h2><p>The only <strong>required</strong> field is <code>name</code> - a valid, unique database name within the cluster. All other params have sensible defaults.
Parameters marked &ldquo;<strong>Immutable</strong>&rdquo; only take effect at creation; changing them requires database recreation.</p><table class=full-width><thead><tr><th>Field</th><th>Category</th><th>Type</th><th>Attr</th><th>Description</th></tr></thead><tbody><tr><td><a href=#name><strong><code>name</code></strong></a></td><td>Basic</td><td><code>string</code></td><td>Required</td><td>Database name, must be valid and unique</td></tr><tr><td><a href=#state><strong><code>state</code></strong></a></td><td>Basic</td><td><code>enum</code></td><td>Optional</td><td>State: <code>create</code> (default), <code>absent</code>, <code>recreate</code></td></tr><tr><td><a href=#owner><strong><code>owner</code></strong></a></td><td>Basic</td><td><code>string</code></td><td>Mutable</td><td>Database owner, defaults to <code>postgres</code></td></tr><tr><td><a href=#comment><strong><code>comment</code></strong></a></td><td>Basic</td><td><code>string</code></td><td>Mutable</td><td>Database comment</td></tr><tr><td><a href=#template><strong><code>template</code></strong></a></td><td>Template</td><td><code>string</code></td><td>Immutable</td><td>Template database, default <code>template1</code></td></tr><tr><td><a href=#strategy><strong><code>strategy</code></strong></a></td><td>Template</td><td><code>enum</code></td><td>Immutable</td><td>Clone strategy: <code>FILE_COPY</code> or <code>WAL_LOG</code> (PG15+)</td></tr><tr><td><a href=#encoding><strong><code>encoding</code></strong></a></td><td>Encoding</td><td><code>string</code></td><td>Immutable</td><td>Character encoding, default inherited (<code>UTF8</code>)</td></tr><tr><td><a href=#locale><strong><code>locale</code></strong></a></td><td>Encoding</td><td><code>string</code></td><td>Immutable</td><td>Locale setting, default inherited (<code>C</code>)</td></tr><tr><td><a href=#lc_collate><strong><code>lc_collate</code></strong></a></td><td>Encoding</td><td><code>string</code></td><td>Immutable</td><td>Collation rule, default inherited (<code>C</code>)</td></tr><tr><td><a href=#lc_ctype><strong><code>lc_ctype</code></strong></a></td><td>Encoding</td><td><code>string</code></td><td>Immutable</td><td>Character classification, default inherited (<code>C</code>)</td></tr><tr><td><a href=#locale_provider><strong><code>locale_provider</code></strong></a></td><td>Encoding</td><td><code>enum</code></td><td>Immutable</td><td>Locale provider: <code>libc</code>, <code>icu</code>, <code>builtin</code> (PG15+)</td></tr><tr><td><a href=#icu_locale><strong><code>icu_locale</code></strong></a></td><td>Encoding</td><td><code>string</code></td><td>Immutable</td><td>ICU locale rules (PG15+)</td></tr><tr><td><a href=#icu_rules><strong><code>icu_rules</code></strong></a></td><td>Encoding</td><td><code>string</code></td><td>Immutable</td><td>ICU collation customization (PG16+)</td></tr><tr><td><a href=#builtin_locale><strong><code>builtin_locale</code></strong></a></td><td>Encoding</td><td><code>string</code></td><td>Immutable</td><td>Builtin locale rules (PG17+)</td></tr><tr><td><a href=#tablespace><strong><code>tablespace</code></strong></a></td><td>Storage</td><td><code>string</code></td><td>Mutable</td><td>Default tablespace, change triggers data migration</td></tr><tr><td><a href=#is_template><strong><code>is_template</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Mark as template database</td></tr><tr><td><a href=#allowconn><strong><code>allowconn</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Allow connections, default <code>true</code></td></tr><tr><td><a href=#revokeconn><strong><code>revokeconn</code></strong></a></td><td>Privilege</td><td><code>bool</code></td><td>Mutable</td><td>Revoke PUBLIC CONNECT privilege</td></tr><tr><td><a href=#connlimit><strong><code>connlimit</code></strong></a></td><td>Privilege</td><td><code>int</code></td><td>Mutable</td><td>Connection limit, <code>-1</code> for unlimited</td></tr><tr><td><a href=#baseline><strong><code>baseline</code></strong></a></td><td>Init</td><td><code>string</code></td><td>Mutable</td><td>SQL baseline file path, runs only on first create</td></tr><tr><td><a href=#schemas><strong><code>schemas</code></strong></a></td><td>Init</td><td><code>(string|object)[]</code></td><td>Mutable</td><td>Schema definitions to create</td></tr><tr><td><a href=#extensions><strong><code>extensions</code></strong></a></td><td>Init</td><td><code>(string|object)[]</code></td><td>Mutable</td><td>Extension definitions to install</td></tr><tr><td><a href=#parameters><strong><code>parameters</code></strong></a></td><td>Init</td><td><code>object</code></td><td>Mutable</td><td>Database-level parameters</td></tr><tr><td><a href=#pgbouncer><strong><code>pgbouncer</code></strong></a></td><td>Pool</td><td><code>bool</code></td><td>Mutable</td><td>Add to connection pool, default <code>true</code></td></tr><tr><td><a href=#pool_mode><strong><code>pool_mode</code></strong></a></td><td>Pool</td><td><code>enum</code></td><td>Mutable</td><td>Pool mode: <code>transaction</code> (default)</td></tr><tr><td><a href=#pool_size><strong><code>pool_size</code></strong></a></td><td>Pool</td><td><code>int</code></td><td>Mutable</td><td>Default pool size, default <code>64</code></td></tr><tr><td><a href=#pool_size_min><strong><code>pool_size_min</code></strong></a></td><td>Pool</td><td><code>int</code></td><td>Mutable</td><td>Min pool size, default <code>0</code></td></tr><tr><td><a href=#pool_reserve><strong><code>pool_reserve</code></strong></a></td><td>Pool</td><td><code>int</code></td><td>Mutable</td><td>Reserve pool size, default <code>32</code></td></tr><tr><td><a href=#pool_connlimit><strong><code>pool_connlimit</code></strong></a></td><td>Pool</td><td><code>int</code></td><td>Mutable</td><td>Max database connections, default <code>100</code></td></tr><tr><td><a href=#pool_auth_user><strong><code>pool_auth_user</code></strong></a></td><td>Pool</td><td><code>string</code></td><td>Mutable</td><td>Auth query user</td></tr><tr><td><a href=#register_datasource><strong><code>register_datasource</code></strong></a></td><td>Monitor</td><td><code>bool</code></td><td>Mutable</td><td>Register to Grafana datasource, default <code>true</code></td></tr></tbody></table><hr><h2 id=parameter-details>Parameter Details</h2><h3 id=name><code>name</code></h3><p>String, required. Database name - must be unique within the cluster.</p><p>Must be a valid PostgreSQL identifier: max 63 chars, no SQL keywords, starts with letter or underscore, followed by letters, digits, or underscores. Must match: <strong><code>^[A-Za-z_][A-Za-z0-9_$]{0,62}$</code></strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Simple naming</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>my_application    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Underscore separated</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>app_v2            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Version included</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=state><code>state</code></h3><p>Enum for database operation: <code>create</code>, <code>absent</code>, or <code>recreate</code>. Default <code>create</code>.</p><table class=full-width><thead><tr><th>State</th><th>Description</th></tr></thead><tbody><tr><td><code>create</code></td><td>Default, create or modify database, adjust mutable params if exists</td></tr><tr><td><code>absent</code></td><td>Delete database with <code>DROP DATABASE WITH (FORCE)</code></td></tr><tr><td><code>recreate</code></td><td>Drop then create, for database reset</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># state defaults to create</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olddb</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>absent             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Delete database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>testdb</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>recreate           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Rebuild database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=owner><code>owner</code></h3><p>String. Database owner, defaults to <a href=/docs/pgsql/param#pg_dbsu><strong><code>pg_dbsu</code></strong></a> (<code>postgres</code>) if not specified.</p><p>Target user must exist. Changing owner executes (old owner retains existing privileges):</p><p>Database owner has full control including creating schemas, tables, extensions - useful for multi-tenant scenarios.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;myapp&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>OWNER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;new_owner&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>PRIVILEGES</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;myapp&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;new_owner&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=comment><code>comment</code></h3><p>String. Database comment, defaults to <code>business database {name}</code>.</p><p>Set via <code>COMMENT ON DATABASE</code>, supports Chinese and special chars (Pigsty auto-escapes quotes). Stored in <code>pg_database.datacl</code>, viewable via <code>\l+</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>COMMENT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;myapp&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IS</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;my main application database&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>my main application database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=template><code>template</code></h3><p>String, <strong>immutable</strong>. Template database for creation, default <code>template1</code>.</p><p>PostgreSQL&rsquo;s <code>CREATE DATABASE</code> clones the template - new database inherits all objects, extensions, schemas, permissions. Pigsty customizes <code>template1</code> during cluster init, so new databases inherit these settings.</p><table class=full-width><thead><tr><th>Template</th><th>Description</th></tr></thead><tbody><tr><td><code>template1</code></td><td>Default, includes Pigsty pre-configured extensions/schemas/perms</td></tr><tr><td><code>template0</code></td><td>Clean template, required for non-default locale providers</td></tr><tr><td>Custom database</td><td>Use existing database as template for cloning</td></tr></tbody></table><p>When using <code>icu</code> or <code>builtin</code> locale provider, must specify <code>template: template0</code> since <code>template1</code> locale settings can&rsquo;t be overridden.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp_icu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Required for ICU</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>icu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>zh-Hans</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Using <code>template0</code> skips monitoring extensions/schemas and default privileges - allowing fully custom database.</p><h3 id=strategy><code>strategy</code></h3><p>Enum, immutable. Clone strategy: <code>FILE_COPY</code> or <code>WAL_LOG</code>. Available PG15+.</p><table class=full-width><thead><tr><th>Strategy</th><th>Description</th><th>Use Case</th></tr></thead><tbody><tr><td><code>FILE_COPY</code></td><td>Direct file copy, PG15+ default</td><td>Large templates, general</td></tr><tr><td><code>WAL_LOG</code></td><td>Clone via WAL logging</td><td>Small templates, non-blocking</td></tr></tbody></table><p><code>WAL_LOG</code> doesn&rsquo;t block template connections during clone but less efficient for large templates. Ignored on PG14 and earlier.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cloned_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>source_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>WAL_LOG         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># WAL-based cloning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=encoding><code>encoding</code></h3><p>String, immutable. Character encoding, inherits from template if unspecified (usually <code>UTF8</code>).</p><p>Strongly recommend <code>UTF8</code> unless special requirements. Cannot be changed after creation.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>legacy_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Use template0 for non-default encoding</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LATIN1</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=locale><code>locale</code></h3><p>String, immutable. Locale setting - sets both <code>lc_collate</code> and <code>lc_ctype</code>. Inherits from template (usually <code>C</code>).</p><p>Determines string sort order and character classification. Use <code>C</code> or <code>POSIX</code> for best performance and cross-platform consistency; use language-specific locales (e.g., <code>zh_CN.UTF-8</code>) for proper language sorting.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>chinese_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>zh_CN.UTF-8       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Chinese locale</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=lc_collate><code>lc_collate</code></h3><p>String, immutable. String collation rule. Inherits from template (usually <code>C</code>).</p><p>Determines <code>ORDER BY</code> and comparison results. Common values: <code>C</code> (byte order, fastest), <code>C.UTF-8</code>, <code>en_US.UTF-8</code>, <code>zh_CN.UTF-8</code>. Cannot be changed after creation.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>lc_collate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en_US.UTF-8   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># English collation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>lc_ctype</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en_US.UTF-8</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=lc_ctype><code>lc_ctype</code></h3><p>String, immutable. Character classification rule for upper/lower case, digits, letters. Inherits from template (usually <code>C</code>).</p><p>Affects <code>upper()</code>, <code>lower()</code>, regex <code>\w</code>, etc. Cannot be changed after creation.</p><h3 id=locale_provider><code>locale_provider</code></h3><p>Enum, immutable. Locale implementation provider: <code>libc</code>, <code>icu</code>, or <code>builtin</code>. Available PG15+, default <code>libc</code>.</p><table class=full-width><thead><tr><th>Provider</th><th>Version</th><th>Description</th></tr></thead><tbody><tr><td><code>libc</code></td><td>-</td><td>OS C library, traditional default, varies by system</td></tr><tr><td><code>icu</code></td><td>PG15+</td><td>ICU library, cross-platform consistent, more langs</td></tr><tr><td><code>builtin</code></td><td>PG17+</td><td>PostgreSQL builtin, most efficient, C/C.UTF-8 only</td></tr></tbody></table><p>Using <code>icu</code> or <code>builtin</code> requires <code>template: template0</code> with corresponding <code>icu_locale</code> or <code>builtin_locale</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fast_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>builtin  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Builtin provider, most efficient</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>builtin_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C.UTF-8</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=icu_locale><code>icu_locale</code></h3><p>String, immutable. ICU locale identifier. Available PG15+ when <code>locale_provider: icu</code>.</p><p>ICU identifiers follow BCP 47. Common values:</p><table class=full-width><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>en-US</code></td><td>US English</td></tr><tr><td><code>en-GB</code></td><td>British English</td></tr><tr><td><code>zh-Hans</code></td><td>Simplified Chinese</td></tr><tr><td><code>zh-Hant</code></td><td>Traditional Chinese</td></tr><tr><td><code>ja-JP</code></td><td>Japanese</td></tr><tr><td><code>ko-KR</code></td><td>Korean</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>chinese_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>icu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>zh-Hans       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Simplified Chinese ICU collation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=icu_rules><code>icu_rules</code></h3><p>String, immutable. Custom ICU collation rules. Available PG16+.</p><p>Allows fine-tuning default sort behavior using <a href=https://unicode-org.github.io/icu/userguide/collation/customization/><strong>ICU Collation Customization</strong></a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>custom_sort_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>icu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en-US</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&amp;V &lt;&lt; w &lt;&lt;&lt; W&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Custom V/W sort order</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=builtin_locale><code>builtin_locale</code></h3><p>String, immutable. Builtin locale provider rules. Available PG17+ when <code>locale_provider: builtin</code>. Values: <code>C</code> or <code>C.UTF-8</code>.</p><p><code>builtin</code> provider is PG17&rsquo;s new builtin implementation - faster than <code>libc</code> with consistent cross-platform behavior. Suitable for C/C.UTF-8 collation only.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fast_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>builtin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>builtin_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C.UTF-8   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Builtin UTF-8 support</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=tablespace><code>tablespace</code></h3><p>String, mutable. Default tablespace, default <code>pg_default</code>.</p><p>Changing tablespace triggers physical data migration - PostgreSQL moves all objects to new tablespace. Can take long time for large databases, use cautiously.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>archive_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tablespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>slow_hdd      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Archive data on slow storage</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;archive_db&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#000>TABLESPACE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;slow_hdd&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=is_template><code>is_template</code></h3><p>Boolean, mutable. Mark database as template, default <code>false</code>.</p><p>When <code>true</code>, any user with <code>CREATEDB</code> privilege can use this database as template for cloning. Template databases typically pre-install standard schemas, extensions, and data.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>app_template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>is_template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Mark as template, allow user cloning</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>core, api]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>postgis, pg_trgm]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Deleting <code>is_template: true</code> databases: Pigsty first executes <code>ALTER DATABASE ... IS_TEMPLATE false</code> then drops.</p><h3 id=allowconn><code>allowconn</code></h3><p>Boolean, mutable. Allow connections, default <code>true</code>.</p><p>Setting <code>false</code> completely disables connections at database level - no user (including superuser) can connect. Used for maintenance or archival purposes.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>archive_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>allowconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Disallow all connections</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;archive_db&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>ALLOW_CONNECTIONS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=revokeconn><code>revokeconn</code></h3><p>Boolean, mutable. Revoke PUBLIC <code>CONNECT</code> privilege, default <code>false</code>.</p><p>When <code>true</code>, Pigsty executes:</p><ul><li>Revoke PUBLIC CONNECT, regular users can&rsquo;t connect</li><li>Grant connect to replication user (<code>replicator</code>) and monitor user (<code>dbuser_monitor</code>)</li><li>Grant connect to admin user (<code>dbuser_dba</code>) and owner with <code>WITH GRANT OPTION</code></li></ul><p>Setting <code>false</code> restores PUBLIC CONNECT privilege.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>secure_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_secure</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Revoke public connect, only specified users</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=connlimit><code>connlimit</code></h3><p>Integer, mutable. Max concurrent connections, default <code>-1</code> (unlimited).</p><p>Positive integer limits max simultaneous sessions. Doesn&rsquo;t affect superusers.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>limited_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Max 50 concurrent connections</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;limited_db&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CONNECTION</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>LIMIT</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=baseline><code>baseline</code></h3><p>String, one-time. SQL baseline file path executed after database creation.</p><p>Baseline files typically contain schema definitions, initial data, stored procedures. Path is relative to Ansible search path, usually in <code>files/</code>.</p><p>Baseline runs only on first creation; skipped if database exists. <code>state: recreate</code> re-runs baseline.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>baseline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp_schema.sql </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Looks for files/myapp_schema.sql</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=schemas><code>schemas</code></h3><p>Array, mutable (add/remove). Schema definitions to create or drop. Elements can be strings or objects.</p><p>Simple format - strings for schema names (create only):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>api</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>core</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Full format - objects for owner and drop operations:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>app               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Schema name (required)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Schema owner (optional), generates AUTHORIZATION clause</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>deprecated</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>absent           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Drop schema (CASCADE)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Create uses <code>IF NOT EXISTS</code>; drop uses <code>CASCADE</code> (deletes all objects in schema).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;app&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AUTHORIZATION</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbuser_app&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;deprecated&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=extensions><code>extensions</code></h3><p>Array, mutable (add/remove). Extension definitions to install or uninstall. Elements can be strings or objects.</p><p>Simple format - strings for extension names (install only):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>postgis</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pg_trgm</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>vector</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Full format - objects for schema, version, and uninstall:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>vector            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Extension name (required)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Install to schema (optional)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.5.1&#39;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Specific version (optional)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>old_extension</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>absent           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Uninstall extension (CASCADE)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Install uses <code>CASCADE</code> to auto-install dependencies; uninstall uses <code>CASCADE</code> (deletes dependent objects).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;vector&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WITH</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;public&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VERSION</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.5.1&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;old_extension&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=parameters><code>parameters</code></h3><p>Object, mutable. Database-level config params via <code>ALTER DATABASE ... SET</code>. Applies to all sessions connecting to this database.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>analytics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;256MB&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>maintenance_work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;512MB&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>statement_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;5min&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>search_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;analytics,public&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Use special value <code>DEFAULT</code> (case-insensitive) to reset to PostgreSQL default:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DEFAULT         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Reset to default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>statement_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;30s&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># Set new value</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;myapp&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;work_mem&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;myapp&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;statement_timeout&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;30s&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pgbouncer><code>pgbouncer</code></h3><p>Boolean, mutable. Add database to Pgbouncer pool list, default <code>true</code>.</p><p>Setting <code>false</code> excludes database from Pgbouncer - clients can&rsquo;t access via connection pool. For internal management databases or direct-connect scenarios.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>internal_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># No connection pool access</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pool_mode><code>pool_mode</code></h3><p>Enum, mutable. Pgbouncer pool mode: <code>transaction</code>, <code>session</code>, or <code>statement</code>. Default <code>transaction</code>.</p><table class=full-width><thead><tr><th>Mode</th><th>Description</th><th>Use Case</th></tr></thead><tbody><tr><td><code>transaction</code></td><td>Return connection after txn</td><td>Most OLTP apps, default</td></tr><tr><td><code>session</code></td><td>Return connection after session</td><td>Apps needing session state</td></tr><tr><td><code>statement</code></td><td>Return after each statement</td><td>Simple stateless queries</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>session_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>session        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Session-level pooling</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pool_size><code>pool_size</code></h3><p>Integer, mutable. Pgbouncer default pool size, default <code>64</code>.</p><p>Pool size determines backend connections reserved for this database. Adjust based on workload.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>high_load_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># Larger pool for high load</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pool_size_min><code>pool_size_min</code></h3><p>Integer, mutable. Pgbouncer minimum pool size, default <code>0</code>.</p><p>Values > 0 pre-create specified backend connections for connection warming, reducing first-request latency.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>latency_sensitive</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_size_min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Pre-warm 10 connections</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pool_reserve><code>pool_reserve</code></h3><p>Integer, mutable. Pgbouncer reserve pool size, default <code>32</code>.</p><p>When default pool exhausted, Pgbouncer can allocate up to <code>pool_reserve</code> additional connections for burst traffic.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>bursty_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_reserve</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Allow burst to 128 connections</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pool_connlimit><code>pool_connlimit</code></h3><p>Integer, mutable. Max connections via Pgbouncer pool, default <code>100</code>.</p><p>This is Pgbouncer-level limit, independent of database&rsquo;s <code>connlimit</code> param.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>limited_pool_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Pool max 50 connections</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pool_auth_user><code>pool_auth_user</code></h3><p>String, mutable. User for Pgbouncer auth query.</p><p>Requires <a href=/docs/pgsql/param#pgbouncer_auth_query><strong><code>pgbouncer_auth_query</code></strong></a> enabled. When set, all Pgbouncer connections to this database use specified user for auth query password verification.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_auth_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_monitor </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Use monitor user for auth query</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=register_datasource><code>register_datasource</code></h3><p>Boolean, mutable. Register database to Grafana as PostgreSQL datasource, default <code>true</code>.</p><p>Set <code>false</code> to skip Grafana registration. For temp databases, test databases, or internal databases not needed in monitoring.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>temp_db</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>register_datasource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Don&#39;t register to Grafana</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=template-inheritance>Template Inheritance</h2><p>Many parameters inherit from template database if not explicitly specified. Default template is <code>template1</code>, whose encoding settings are determined by cluster init params:</p><table class=full-width><thead><tr><th>Cluster Param</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><a href=/docs/pgsql/param#pg_encoding><strong><code>pg_encoding</code></strong></a></td><td><code>UTF8</code></td><td>Cluster encoding</td></tr><tr><td><a href=/docs/pgsql/param#pg_locale><strong><code>pg_locale</code></strong></a></td><td><code>C</code> / <code>C-UTF-8</code> (if supported)</td><td>Cluster locale</td></tr><tr><td><a href=/docs/pgsql/param#pg_lc_collate><strong><code>pg_lc_collate</code></strong></a></td><td><code>C</code> / <code>C-UTF-8</code> (if supported)</td><td>Cluster collation</td></tr><tr><td><a href=/docs/pgsql/param#pg_lc_ctype><strong><code>pg_lc_ctype</code></strong></a></td><td><code>C</code> / <code>C-UTF-8</code> (if supported)</td><td>Cluster ctype</td></tr></tbody></table><p>New databases fork from <code>template1</code>, which is customized during <a href=/docs/pgsql/param#pg_provision><strong><code>PG_PROVISION</code></strong></a> with extensions, schemas, and default privileges. Unless you explicitly use another template.</p><hr><h2 id=deep-customization>Deep Customization</h2><p>Pigsty provides rich customization params. To customize template database, refer to:</p><ul><li><a href=/docs/pgsql/param#pg_default_roles><strong><code>pg_default_roles</code></strong></a>: Default predefined roles and system users</li><li><a href=/docs/pgsql/param#pg_default_privileges><strong><code>pg_default_privileges</code></strong></a>: Default privileges for objects created by admin user</li><li><a href=/docs/pgsql/param#pg_default_schemas><strong><code>pg_default_schemas</code></strong></a>: Default schemas to create</li><li><a href=/docs/pgsql/param#pg_default_extensions><strong><code>pg_default_extensions</code></strong></a>: Default extensions to create</li><li><a href=/docs/pgsql/param#pg_default_hba_rules><strong><code>pg_default_hba_rules</code></strong></a>: Default PostgreSQL HBA rules</li><li><a href=/docs/pgsql/param#pgb_default_hba_rules><strong><code>pgb_default_hba_rules</code></strong></a>: Default Pgbouncer HBA rules</li></ul><p>If above configurations don&rsquo;t meet your needs, use <a href=/docs/pgsql/param#pg_init><strong><code>pg_init</code></strong></a> to specify custom cluster init scripts:</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/pg-init><strong><code>pg-init</code></strong></a>: Cluster init script</li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/pg-init-template.sql><strong><code>pg-init-template.sql</code></strong></a>: Template customization SQL</li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/pg-init-roles.sql><strong><code>pg-init-roles.sql</code></strong></a>: Default roles SQL</li></ul><hr><h2 id=locale-providers>Locale Providers</h2><p>PostgreSQL 15+ introduced <strong><code>locale_provider</code></strong> for different locale implementations. These are immutable after creation.</p><p>Pigsty&rsquo;s <a href=/docs/concept/iac/configure><strong><code>configure</code></strong></a> wizard selects builtin C.UTF-8/C locale provider based on PG and OS versions.
Databases inherit cluster locale by default. To specify different locale provider, you must use <code>template0</code>.</p><p><strong>Using ICU provider (PG15+)</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp_icu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># ICU requires template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>icu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en-US         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># ICU locale rules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Using builtin provider (PG17+)</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp_builtin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>builtin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>builtin_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C.UTF-8   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Builtin locale rules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Provider comparison</strong>: <code>libc</code> (traditional, OS-dependent), <code>icu</code> (PG15+, cross-platform, feature-rich), <code>builtin</code> (PG17+, most efficient C/C.UTF-8).</p><hr><h2 id=connection-pool>Connection Pool</h2><p><a href=/docs/concept/arch/pgsql#pgbouncer><strong>Pgbouncer</strong></a> connection pool optimizes short-connection performance, reduces contention, prevents excessive connections from overwhelming database, and provides flexibility during migrations.</p><p>Pigsty configures 1:1 connection pool for each PostgreSQL instance, running as same <a href=/docs/pgsql/param#pg_dbsu><strong><code>pg_dbsu</code></strong></a> (default <code>postgres</code> OS user). Pool communicates with database via <code>/var/run/postgresql</code> Unix socket.</p><p>Pigsty adds all databases in <a href=/docs/pgsql/param#pg_databases><strong><code>pg_databases</code></strong></a> to pgbouncer by default.
Set <a href=#pgbouncer><strong><code>pgbouncer: false</code></strong></a> to exclude specific databases.
Pgbouncer database list and config params are defined in <code>/etc/pgbouncer/database.txt</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>meta                        = host=/var/run/postgresql mode=session</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>grafana                     = host=/var/run/postgresql mode=transaction</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>bytebase                    = host=/var/run/postgresql auth_user=dbuser_meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>kong                        = host=/var/run/postgresql pool_size=32 reserve_pool=64</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>gitea                       = host=/var/run/postgresql min_pool_size=10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>wiki                        = host=/var/run/postgresql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>noco                        = host=/var/run/postgresql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>mongo                       = host=/var/run/postgresql</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>When <a href=/docs/pgsql/admin/db#create-database><strong>creating databases</strong></a>, Pgbouncer database list is refreshed via online reload - doesn&rsquo;t affect existing connections.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-be500246ccc4d0aea19a8d2e848cf128>6 - HBA Rules</h1><div class=lead>Detailed explanation of PostgreSQL and Pgbouncer Host-Based Authentication (HBA) rules configuration in Pigsty.</div><h2 id=overview>Overview</h2><p>HBA (Host-Based Authentication) controls &ldquo;who can connect to the database from where and how&rdquo;.
Pigsty manages HBA rules declaratively through <a href=#pg_default_hba_rules><strong><code>pg_default_hba_rules</code></strong></a> and <a href=#pg_hba_rules><strong><code>pg_hba_rules</code></strong></a>.</p><p>Pigsty renders the following config files during cluster init or HBA refresh:</p><table><thead><tr><th style=text-align:left>Config File</th><th style=text-align:left>Path</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>PostgreSQL HBA</td><td style=text-align:left><code>/pg/data/pg_hba.conf</code></td><td style=text-align:left>PostgreSQL server HBA rules</td></tr><tr><td style=text-align:left>Pgbouncer HBA</td><td style=text-align:left><code>/etc/pgbouncer/pgb_hba.conf</code></td><td style=text-align:left>Connection pool HBA rules</td></tr></tbody></table><p>HBA rules are controlled by these parameters:</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_default_hba_rules><code>pg_default_hba_rules</code></a></td><td style=text-align:left>G</td><td style=text-align:left>PostgreSQL global default HBA</td></tr><tr><td style=text-align:left><a href=#pg_hba_rules><code>pg_hba_rules</code></a></td><td style=text-align:left>G/C/I</td><td style=text-align:left>PostgreSQL cluster/instance add</td></tr><tr><td style=text-align:left><a href=#pgb_default_hba_rules><code>pgb_default_hba_rules</code></a></td><td style=text-align:left>G</td><td style=text-align:left>Pgbouncer global default HBA</td></tr><tr><td style=text-align:left><a href=#pgb_hba_rules><code>pgb_hba_rules</code></a></td><td style=text-align:left>G/C/I</td><td style=text-align:left>Pgbouncer cluster/instance add</td></tr></tbody></table><p>Rule features:</p><ul><li><strong>Role filtering</strong>: Rules support <code>role</code> field, auto-filter based on instance&rsquo;s <code>pg_role</code></li><li><strong>Order sorting</strong>: Rules support <code>order</code> field, controls position in final config file</li><li><strong>Two syntaxes</strong>: Supports alias form (simplified) and raw form (direct HBA text)</li></ul><hr><h2 id=refresh-hba>Refresh HBA</h2><p>After modifying config, re-render config files and reload services:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-hba &lt;cls&gt;                   <span style=color:#8f5902;font-style:italic># Refresh entire cluster HBA (recommended)</span>
</span></span><span style=display:flex><span>bin/pgsql-hba &lt;cls&gt; &lt;ip&gt;...           <span style=color:#8f5902;font-style:italic># Refresh specific instances in cluster</span>
</span></span></code></pre></div><p>Script executes the following playbook:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -l &lt;cls&gt; -t pg_hba,pg_reload,pgbouncer_hba,pgbouncer_reload -e <span style=color:#000>pg_reload</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><p><strong>PostgreSQL only</strong>: <code>./pgsql.yml -l &lt;cls> -t pg_hba,pg_reload -e pg_reload=true</code></p><p><strong>Pgbouncer only</strong>: <code>./pgsql.yml -l &lt;cls> -t pgbouncer_hba,pgbouncer_reload</code></p><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>Don't edit config files directly</div><p>Don&rsquo;t directly edit <code>/pg/data/pg_hba.conf</code> or <code>/etc/pgbouncer/pgb_hba.conf</code> - they&rsquo;ll be overwritten on next playbook run.
All changes should be made in <code>pigsty.yml</code>, then execute <code>bin/pgsql-hba</code> to refresh.</p></div><hr><h2 id=parameter-details>Parameter Details</h2><p><strong><code>pg_default_hba_rules</code></strong></p><p>PostgreSQL global default HBA rule list, usually defined in <code>all.vars</code>, provides base access control for all clusters.</p><ul><li>Type: <code>rule[]</code>, Level: Global (G)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: local     ,auth: ident ,title: &#39;dbsu access via local os user ident&#39;  ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: local     ,auth: ident ,title: &#39;dbsu replication from local os ident&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>150</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: localhost ,auth: pwd   ,title: &#39;replicator replication from localhost&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: intra     ,auth: pwd   ,title: &#39;replicator replication from intranet&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: postgres    ,addr: intra     ,auth: pwd   ,title: &#39;replicator postgres db from intranet&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>300</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: localhost ,auth: pwd   ,title: &#39;monitor from localhost with password&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>350</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: pwd   ,title: &#39;monitor from infra host with password&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: ssl   ,title: &#39;admin @ infra nodes with pwd &amp; ssl&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>450</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: ssl   ,title: &#39;admin @ everywhere with ssl &amp; pwd&#39;    ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: localhost ,auth: pwd   ,title: &#39;pgbouncer read/write via local socket&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>550</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: intra     ,auth: pwd   ,title: &#39;read/write biz user via password&#39;     ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>600</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_offline&#39; ,db: all    ,addr: intra     ,auth: pwd   ,title: &#39;allow etl offline tasks from intranet&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>650</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong><code>pg_hba_rules</code></strong></p><p>PostgreSQL cluster/instance-level additional HBA rules, can override at cluster or instance level, merged with default rules and sorted by <code>order</code>.</p><ul><li>Type: <code>rule[]</code>, Level: Global/Cluster/Instance (G/C/I), Default: <code>[]</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: app_user, db: app_db, addr: intra, auth: pwd, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;app user access&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong><code>pgb_default_hba_rules</code></strong></p><p>Pgbouncer global default HBA rule list, usually defined in <code>all.vars</code>.</p><ul><li>Type: <code>rule[]</code>, Level: Global (G)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgb_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: pgbouncer   ,addr: local     ,auth: peer  ,title: &#39;dbsu local admin access with os ident&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;all&#39;        ,db: all         ,addr: localhost ,auth: pwd   ,title: &#39;allow all user local access with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>150</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: pgbouncer   ,addr: intra     ,auth: pwd   ,title: &#39;monitor access via intranet with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: deny  ,title: &#39;reject all other monitor access addr&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: intra     ,auth: pwd   ,title: &#39;admin access via intranet with pwd&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>300</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: deny  ,title: &#39;reject all other admin access addr&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>350</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;all&#39;        ,db: all         ,addr: intra     ,auth: pwd   ,title: &#39;allow all user intra access with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong><code>pgb_hba_rules</code></strong></p><p>Pgbouncer cluster/instance-level additional HBA rules.</p><ul><li>Type: <code>rule[]</code>, Level: Global/Cluster/Instance (G/C/I), Default: <code>[]</code></li></ul><blockquote><p><strong>Note</strong>: Pgbouncer HBA does not support <code>db: replication</code>.</p></blockquote><hr><h2 id=rule-fields>Rule Fields</h2><p>Each HBA rule is a YAML dict supporting these fields:</p><table><thead><tr><th style=text-align:left>Field</th><th style=text-align:left>Type</th><th style=text-align:left>Required</th><th style=text-align:left>Default</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>user</code></td><td style=text-align:left>string</td><td style=text-align:left>No</td><td style=text-align:left><code>all</code></td><td style=text-align:left>Username, supports <code>all</code>, placeholders, <code>+rolename</code></td></tr><tr><td style=text-align:left><code>db</code></td><td style=text-align:left>string</td><td style=text-align:left>No</td><td style=text-align:left><code>all</code></td><td style=text-align:left>Database name, supports <code>all</code>, <code>replication</code>, db name</td></tr><tr><td style=text-align:left><code>addr</code></td><td style=text-align:left>string</td><td style=text-align:left>Yes*</td><td style=text-align:left>-</td><td style=text-align:left>Address alias or CIDR, see <a href=#address-aliases><strong>Address Aliases</strong></a></td></tr><tr><td style=text-align:left><code>auth</code></td><td style=text-align:left>string</td><td style=text-align:left>No</td><td style=text-align:left><code>pwd</code></td><td style=text-align:left>Auth method alias, see <a href=#auth-methods><strong>Auth Methods</strong></a></td></tr><tr><td style=text-align:left><code>title</code></td><td style=text-align:left>string</td><td style=text-align:left>No</td><td style=text-align:left>-</td><td style=text-align:left>Rule description, rendered as comment in config</td></tr><tr><td style=text-align:left><code>role</code></td><td style=text-align:left>string</td><td style=text-align:left>No</td><td style=text-align:left><code>common</code></td><td style=text-align:left>Instance role filter, see <a href=#role-filtering><strong>Role Filtering</strong></a></td></tr><tr><td style=text-align:left><code>order</code></td><td style=text-align:left>int</td><td style=text-align:left>No</td><td style=text-align:left><code>1000</code></td><td style=text-align:left>Sort weight, lower first, see <a href=#order-sorting><strong>Order Sorting</strong></a></td></tr><tr><td style=text-align:left><code>rules</code></td><td style=text-align:left>list</td><td style=text-align:left>Yes*</td><td style=text-align:left>-</td><td style=text-align:left>Raw HBA text lines, mutually exclusive with <code>addr</code></td></tr></tbody></table><blockquote><p>Either <code>addr</code> or <code>rules</code> must be specified. Use <code>rules</code> to write raw HBA format directly.</p></blockquote><hr><h2 id=address-aliases>Address Aliases</h2><p>Pigsty provides address aliases to simplify HBA rule writing:</p><table><thead><tr><th style=text-align:left>Alias</th><th style=text-align:left>Expands To</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>local</code></td><td style=text-align:left>Unix socket</td><td style=text-align:left>Local Unix socket</td></tr><tr><td style=text-align:left><code>localhost</code></td><td style=text-align:left>Unix socket + <code>127.0.0.1/32</code> + <code>::1/128</code></td><td style=text-align:left>Loopback addresses</td></tr><tr><td style=text-align:left><code>admin</code></td><td style=text-align:left><code>${admin_ip}/32</code></td><td style=text-align:left>Admin IP address</td></tr><tr><td style=text-align:left><code>infra</code></td><td style=text-align:left>All infra group node IPs</td><td style=text-align:left>Infrastructure nodes</td></tr><tr><td style=text-align:left><code>cluster</code></td><td style=text-align:left>All current cluster member IPs</td><td style=text-align:left>Same cluster instances</td></tr><tr><td style=text-align:left><code>intra</code> / <code>intranet</code></td><td style=text-align:left><code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code></td><td style=text-align:left>Intranet CIDRs</td></tr><tr><td style=text-align:left><code>world</code> / <code>all</code></td><td style=text-align:left><code>0.0.0.0/0</code> + <code>::/0</code></td><td style=text-align:left>Any address (IPv4 + IPv6)</td></tr><tr><td style=text-align:left><code>&lt;CIDR></code></td><td style=text-align:left>Direct use</td><td style=text-align:left>e.g., <code>192.168.1.0/24</code></td></tr></tbody></table><p>Intranet CIDRs can be customized via <code>node_firewall_intranet</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_firewall_intranet</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>10.0.0.0</span><span style=color:#000>/8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>172.16.0.0</span><span style=color:#000>/12</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>192.168.0.0</span><span style=color:#000>/16</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=auth-methods>Auth Methods</h2><p>Pigsty provides auth method aliases for simplified config:</p><table><thead><tr><th style=text-align:left>Alias</th><th style=text-align:left>Actual Method</th><th style=text-align:left>Connection Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>pwd</code></td><td style=text-align:left><code>scram-sha-256</code> or <code>md5</code></td><td style=text-align:left><code>host</code></td><td style=text-align:left>Auto-select based on <code>pg_pwd_enc</code></td></tr><tr><td style=text-align:left><code>ssl</code></td><td style=text-align:left><code>scram-sha-256</code> or <code>md5</code></td><td style=text-align:left><code>hostssl</code></td><td style=text-align:left>Force SSL + password</td></tr><tr><td style=text-align:left><code>ssl-sha</code></td><td style=text-align:left><code>scram-sha-256</code></td><td style=text-align:left><code>hostssl</code></td><td style=text-align:left>Force SSL + SCRAM-SHA-256</td></tr><tr><td style=text-align:left><code>ssl-md5</code></td><td style=text-align:left><code>md5</code></td><td style=text-align:left><code>hostssl</code></td><td style=text-align:left>Force SSL + MD5</td></tr><tr><td style=text-align:left><code>cert</code></td><td style=text-align:left><code>cert</code></td><td style=text-align:left><code>hostssl</code></td><td style=text-align:left>Client certificate auth</td></tr><tr><td style=text-align:left><code>trust</code></td><td style=text-align:left><code>trust</code></td><td style=text-align:left><code>host</code></td><td style=text-align:left>Unconditional trust (dangerous)</td></tr><tr><td style=text-align:left><code>deny</code> / <code>reject</code></td><td style=text-align:left><code>reject</code></td><td style=text-align:left><code>host</code></td><td style=text-align:left>Reject connection</td></tr><tr><td style=text-align:left><code>ident</code></td><td style=text-align:left><code>ident</code></td><td style=text-align:left><code>host</code></td><td style=text-align:left>OS user mapping (PostgreSQL)</td></tr><tr><td style=text-align:left><code>peer</code></td><td style=text-align:left><code>peer</code></td><td style=text-align:left><code>local</code></td><td style=text-align:left>OS user mapping (Pgbouncer/local)</td></tr></tbody></table><blockquote><p><code>pg_pwd_enc</code> defaults to <code>scram-sha-256</code>, can be set to <code>md5</code> for legacy client compatibility.</p></blockquote><hr><h2 id=user-variables>User Variables</h2><p>HBA rules support these user placeholders, auto-replaced with actual usernames during rendering:</p><table><thead><tr><th style=text-align:left>Placeholder</th><th style=text-align:left>Default</th><th style=text-align:left>Corresponding Param</th></tr></thead><tbody><tr><td style=text-align:left><code>${dbsu}</code></td><td style=text-align:left><code>postgres</code></td><td style=text-align:left><code>pg_dbsu</code></td></tr><tr><td style=text-align:left><code>${repl}</code></td><td style=text-align:left><code>replicator</code></td><td style=text-align:left><code>pg_replication_username</code></td></tr><tr><td style=text-align:left><code>${monitor}</code></td><td style=text-align:left><code>dbuser_monitor</code></td><td style=text-align:left><code>pg_monitor_username</code></td></tr><tr><td style=text-align:left><code>${admin}</code></td><td style=text-align:left><code>dbuser_dba</code></td><td style=text-align:left><code>pg_admin_username</code></td></tr></tbody></table><hr><h2 id=role-filtering>Role Filtering</h2><p>The <code>role</code> field in HBA rules controls which instances the rule applies to:</p><table><thead><tr><th style=text-align:left>Role</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>common</code></td><td style=text-align:left>Default, applies to all instances</td></tr><tr><td style=text-align:left><code>primary</code></td><td style=text-align:left>Primary instance only</td></tr><tr><td style=text-align:left><code>replica</code></td><td style=text-align:left>Replica instance only</td></tr><tr><td style=text-align:left><code>offline</code></td><td style=text-align:left>Offline instance only (<code>pg_role: offline</code> or <code>pg_offline_query: true</code>)</td></tr><tr><td style=text-align:left><code>standby</code></td><td style=text-align:left>Standby instance</td></tr><tr><td style=text-align:left><code>delayed</code></td><td style=text-align:left>Delayed replica instance</td></tr></tbody></table><p>Role filtering matches based on instance&rsquo;s <code>pg_role</code> variable. Non-matching rules are commented out (prefixed with <code>#</code>).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Only applies on primary: writer can only connect to primary</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: writer, db: all, addr: intra, auth: pwd, role: primary, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;writer only on primary&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Only applies on offline instances: ETL dedicated network</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_offline&#39;, db: all, addr: &#39;172.20.0.0/16&#39;, auth: ssl, role: offline, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;offline dedicated&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=order-sorting>Order Sorting</h2><p>PostgreSQL HBA is <strong>first-match-wins</strong>, rule order is critical. Pigsty controls rule rendering order via the <code>order</code> field.</p><p><strong>Order Interval Convention</strong></p><table><thead><tr><th style=text-align:left>Interval</th><th style=text-align:left>Usage</th></tr></thead><tbody><tr><td style=text-align:left><code>0 - 99</code></td><td style=text-align:left>User high-priority rules (before all defaults)</td></tr><tr><td style=text-align:left><code>100 - 650</code></td><td style=text-align:left>Default rule zone (spaced by 50 for insertion)</td></tr><tr><td style=text-align:left><code>1000+</code></td><td style=text-align:left>User rule default (rules without <code>order</code>)</td></tr></tbody></table><p><strong>PostgreSQL Default Rules Order</strong></p><table><thead><tr><th style=text-align:left>Order</th><th style=text-align:left>Rule Description</th></tr></thead><tbody><tr><td style=text-align:left>100</td><td style=text-align:left>dbsu local ident</td></tr><tr><td style=text-align:left>150</td><td style=text-align:left>dbsu replication local</td></tr><tr><td style=text-align:left>200</td><td style=text-align:left>replicator localhost</td></tr><tr><td style=text-align:left>250</td><td style=text-align:left>replicator intra replication</td></tr><tr><td style=text-align:left>300</td><td style=text-align:left>replicator intra postgres</td></tr><tr><td style=text-align:left>350</td><td style=text-align:left>monitor localhost</td></tr><tr><td style=text-align:left>400</td><td style=text-align:left>monitor infra</td></tr><tr><td style=text-align:left>450</td><td style=text-align:left>admin infra ssl</td></tr><tr><td style=text-align:left>500</td><td style=text-align:left>admin world ssl</td></tr><tr><td style=text-align:left>550</td><td style=text-align:left>dbrole_readonly localhost</td></tr><tr><td style=text-align:left>600</td><td style=text-align:left>dbrole_readonly intra</td></tr><tr><td style=text-align:left>650</td><td style=text-align:left>dbrole_offline intra</td></tr></tbody></table><p><strong>Pgbouncer Default Rules Order</strong></p><table><thead><tr><th style=text-align:left>Order</th><th style=text-align:left>Rule Description</th></tr></thead><tbody><tr><td style=text-align:left>100</td><td style=text-align:left>dbsu local peer</td></tr><tr><td style=text-align:left>150</td><td style=text-align:left>all localhost pwd</td></tr><tr><td style=text-align:left>200</td><td style=text-align:left>monitor pgbouncer intra</td></tr><tr><td style=text-align:left>250</td><td style=text-align:left>monitor world deny</td></tr><tr><td style=text-align:left>300</td><td style=text-align:left>admin intra pwd</td></tr><tr><td style=text-align:left>350</td><td style=text-align:left>admin world deny</td></tr><tr><td style=text-align:left>400</td><td style=text-align:left>all intra pwd</td></tr></tbody></table><hr><h2 id=syntax-examples>Syntax Examples</h2><p><strong>Alias Form</strong>: Using Pigsty simplified syntax</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow grafana view access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_view</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>addr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ssl</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Rendered result:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#8f5902;font-style:italic># allow grafana view access [primary]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>hostssl  meta               dbuser_view        10.10.10.10/32     scram-sha-256</span>
</span></span></code></pre></div><p><strong>Raw Form</strong>: Using PostgreSQL HBA syntax directly</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow intranet password access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host all all 10.0.0.0/8 scram-sha-256</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host all all 172.16.0.0/12 scram-sha-256</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host all all 192.168.0.0/16 scram-sha-256</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Rendered result:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#8f5902;font-style:italic># allow intranet password access [common]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>host all all 10.0.0.0/8 scram-sha-256</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>host all all 172.16.0.0/12 scram-sha-256</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>host all all 192.168.0.0/16 scram-sha-256</span>
</span></span></code></pre></div><hr><h2 id=common-scenarios>Common Scenarios</h2><p><strong>Blacklist IP</strong>: Use <code>order: 0</code> to ensure first match</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: all, db: all, addr: &#39;10.1.1.100/32&#39;, auth: deny, order: 0, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;block bad ip&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Whitelist App Server</strong>: High priority for specific IP</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: app_user, db: app_db, addr: &#39;192.168.1.10/32&#39;, auth: ssl, order: 50, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;app server&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Admin Force Certificate</strong>: Override default SSL password auth</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#204a87;font-weight:700>, db: all, addr: world, auth: cert, order: 10, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;admin cert only&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Offline Instance Dedicated Network</strong>: Only on offline instances</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_offline&#39;, db: all, addr: &#39;172.20.0.0/16&#39;, auth: ssl-sha, role: offline, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;etl network&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Restrict Access by Database</strong>: Sensitive databases limited to specific networks</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: fin_user, db: finance_db, addr: &#39;10.20.0.0/16&#39;, auth: ssl, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;finance only&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: hr_user, db: hr_db, addr: &#39;10.30.0.0/16&#39;, auth: ssl, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;hr only&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Pgbouncer Dedicated Rules</strong>: Note no <code>db: replication</code> support</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgb_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readwrite&#39;, db: all, addr: world, auth: ssl, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;app via pgbouncer&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=complete-cluster-example>Complete Cluster Example</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-prod</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>offline}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-prod</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Blacklist: known malicious IP (highest priority)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: all, db: all, addr: &#39;10.1.1.100/32&#39;, auth: deny, order: 0, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;blacklist&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># App server whitelist (high priority)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: app_user, db: app_db, addr: &#39;192.168.1.0/24&#39;, auth: ssl, order: 50, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;app servers&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># ETL tasks: offline instances only</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: etl_user, db: all, addr: &#39;172.20.0.0/16&#39;, auth: pwd, role: offline, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;etl tasks&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Cluster internal monitoring</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#204a87;font-weight:700>, db: all, addr: cluster, auth: pwd, order: 380, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;cluster monitor&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgb_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># App via connection pool</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readwrite&#39;, db: all, addr: &#39;192.168.1.0/24&#39;, auth: ssl, title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;app via pgbouncer&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=verification--troubleshooting>Verification & Troubleshooting</h2><p><strong>View Current HBA Rules</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql -c <span style=color:#4e9a06>&#34;TABLE pg_hba_file_rules&#34;</span>         <span style=color:#8f5902;font-style:italic># View via SQL (recommended)</span>
</span></span><span style=display:flex><span>cat /pg/data/pg_hba.conf                  <span style=color:#8f5902;font-style:italic># View PostgreSQL HBA file</span>
</span></span><span style=display:flex><span>cat /etc/pgbouncer/pgb_hba.conf           <span style=color:#8f5902;font-style:italic># View Pgbouncer HBA file</span>
</span></span><span style=display:flex><span>grep <span style=color:#4e9a06>&#39;^#&#39;</span> /pg/data/pg_hba.conf <span style=color:#000;font-weight:700>|</span> head -20 <span style=color:#8f5902;font-style:italic># View rule titles (verify order)</span>
</span></span></code></pre></div><p><strong>Test Connection Auth</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql -h &lt;host&gt; -p <span style=color:#0000cf;font-weight:700>5432</span> -U &lt;user&gt; -d &lt;db&gt; -c <span style=color:#4e9a06>&#34;SELECT 1&#34;</span>
</span></span></code></pre></div><p><strong>Common Issues</strong></p><table><thead><tr><th style=text-align:left>Error Message</th><th style=text-align:left>Possible Cause</th><th style=text-align:left>Solution</th></tr></thead><tbody><tr><td style=text-align:left><code>no pg_hba.conf entry for host...</code></td><td style=text-align:left>No matching HBA rule</td><td style=text-align:left>Add corresponding rule and refresh</td></tr><tr><td style=text-align:left><code>password authentication failed</code></td><td style=text-align:left>Wrong password or enc</td><td style=text-align:left>Check password and <code>pg_pwd_enc</code></td></tr><tr><td style=text-align:left>Rule not taking effect</td><td style=text-align:left>Not refreshed or order</td><td style=text-align:left>Run <code>bin/pgsql-hba</code>, check order</td></tr></tbody></table><hr><h2 id=important-notes>Important Notes</h2><ol><li><strong>Order sensitive</strong>: PostgreSQL HBA is first-match-wins, use <code>order</code> wisely</li><li><strong>Role matching</strong>: Ensure <code>role</code> field matches target instance&rsquo;s <code>pg_role</code></li><li><strong>Address format</strong>: CIDR must be correct, e.g., <code>10.0.0.0/8</code> not <code>10.0.0.0/255.0.0.0</code></li><li><strong>Pgbouncer limitation</strong>: Does not support <code>db: replication</code></li><li><strong>SSL prerequisite</strong>: Ensure SSL is configured before using <code>ssl</code>, <code>cert</code> auth</li><li><strong>Test first</strong>: Validate in test environment before modifying HBA</li><li><strong>Refresh on scale</strong>: Rules using <code>addr: cluster</code> need refresh after cluster membership changes</li></ol><hr><h2 id=related-documentation>Related Documentation</h2><ul><li><a href=/docs/pgsql/admin/hba/><strong>HBA Management</strong></a>: Daily HBA rule management operations</li><li><a href=/docs/pgsql/config/user/><strong>User Config</strong></a>: User and role configuration</li><li><a href=/docs/pgsql/config/acl/><strong>Access Control</strong></a>: Role system and permission model</li><li><a href=/docs/concept/sec/><strong>Security & Compliance</strong></a>: PostgreSQL cluster security features</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f26623b2f855e9bc5073aeb50aea422a>7 - Access Control</h1><div class=lead>Default role system and privilege model provided by Pigsty</div><blockquote><p>Access control is determined by the combination of &ldquo;role system + privilege templates + HBA&rdquo;. This section focuses on how to declare roles and object privileges through configuration parameters.</p></blockquote><p>Pigsty provides a streamlined ACL model, fully described by the following parameters:</p><ul><li><code>pg_default_roles</code>: System roles and system users.</li><li><code>pg_users</code>: Business users and roles.</li><li><code>pg_default_privileges</code>: Default privileges for objects created by administrators/owners.</li><li><code>pg_revoke_public</code>, <code>pg_default_schemas</code>, <code>pg_default_extensions</code>: Control the default behavior of <code>template1</code>.</li></ul><p>After understanding these parameters, you can write fully reproducible privilege configurations.</p><hr><h2 id=default-role-system-pg_default_roles>Default Role System (pg_default_roles)</h2><p>By default, it includes 4 business roles + 4 system users:</p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>dbrole_readonly</code></td><td><code>NOLOGIN</code></td><td>Shared by all business, has SELECT/USAGE</td></tr><tr><td><code>dbrole_readwrite</code></td><td><code>NOLOGIN</code></td><td>Inherits read-only role, with INSERT/UPDATE/DELETE</td></tr><tr><td><code>dbrole_admin</code></td><td><code>NOLOGIN</code></td><td>Inherits <code>pg_monitor</code> + read-write role, can create objects and triggers</td></tr><tr><td><code>dbrole_offline</code></td><td><code>NOLOGIN</code></td><td>Restricted read-only role, only allowed to access offline instances</td></tr><tr><td><code>postgres</code></td><td>User</td><td>System superuser, same as <code>pg_dbsu</code></td></tr><tr><td><code>replicator</code></td><td>User</td><td>Used for streaming replication and backup, inherits monitoring and read-only privileges</td></tr><tr><td><code>dbuser_dba</code></td><td>User</td><td>Primary admin account, also synced to pgbouncer</td></tr><tr><td><code>dbuser_monitor</code></td><td>User</td><td>Monitoring account, has <code>pg_monitor</code> privilege, records slow SQL by default</td></tr></tbody></table><p>These definitions are in <code>pg_default_roles</code>. They can theoretically be customized, but if you replace names, you must synchronize updates in HBA/ACL/script references.</p><p>Example: Add an additional <code>dbrole_etl</code> for offline tasks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_etl, login: false, roles: [dbrole_offline], comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;etl read-only role&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin, login: false, roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pg_monitor, dbrole_readwrite, dbrole_etl] }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Effect: All users inheriting <code>dbrole_admin</code> automatically have <code>dbrole_etl</code> privileges, can access offline instances and execute ETL.</p></blockquote><hr><h2 id=default-users-and-credential-parameters>Default Users and Credential Parameters</h2><p>System user usernames/passwords are controlled by the following parameters:</p><table><thead><tr><th>Parameter</th><th>Default Value</th><th>Purpose</th></tr></thead><tbody><tr><td><code>pg_dbsu</code></td><td><code>postgres</code></td><td>Database/system superuser</td></tr><tr><td><code>pg_dbsu_password</code></td><td>Empty string</td><td>dbsu password (disabled by default)</td></tr><tr><td><code>pg_replication_username</code></td><td><code>replicator</code></td><td>Replication username</td></tr><tr><td><code>pg_replication_password</code></td><td><code>DBUser.Replicator</code></td><td>Replication user password</td></tr><tr><td><code>pg_admin_username</code></td><td><code>dbuser_dba</code></td><td>Admin username</td></tr><tr><td><code>pg_admin_password</code></td><td><code>DBUser.DBA</code></td><td>Admin password</td></tr><tr><td><code>pg_monitor_username</code></td><td><code>dbuser_monitor</code></td><td>Monitoring user</td></tr><tr><td><code>pg_monitor_password</code></td><td><code>DBUser.Monitor</code></td><td>Monitoring user password</td></tr></tbody></table><blockquote><p>If you modify these parameters, please synchronize updates to the corresponding user definitions in <code>pg_default_roles</code> to avoid role attribute inconsistencies.</p></blockquote><hr><h2 id=business-roles-and-authorization-pg_users>Business Roles and Authorization (pg_users)</h2><p>Business users are declared through <code>pg_users</code> (see <a href=/docs/pgsql/config/user>User Configuration</a> for detailed fields), where the <code>roles</code> field controls the granted business roles.</p><p>Example: Create one read-only and one read-write user:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: app_reader,  password: DBUser.Reader,  roles: [dbrole_readonly],  pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: app_writer,  password: DBUser.Writer,  roles: [dbrole_readwrite], pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>By inheriting <code>dbrole_*</code> to control access privileges, no need to GRANT for each database separately. Combined with <a href=/docs/pgsql/config/hba><code>pg_hba_rules</code></a>, you can distinguish access sources.</p></blockquote><p>For finer-grained ACL, you can use standard <code>GRANT/REVOKE</code> in <code>baseline</code> SQL or subsequent playbooks. Pigsty won&rsquo;t prevent you from granting additional privileges.</p><hr><h2 id=default-privilege-templates-pg_default_privileges>Default Privilege Templates (pg_default_privileges)</h2><p><code>pg_default_privileges</code> will set DEFAULT PRIVILEGE on <code>postgres</code>, <code>dbuser_dba</code>, <code>dbrole_admin</code> (after business admin <code>SET ROLE</code>). The default template is as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_privileges</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT INSERT     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT UPDATE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT DELETE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT UPDATE     ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT TRUNCATE   ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT REFERENCES ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT TRIGGER    ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT CREATE     ON SCHEMAS   TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>As long as objects are created by the above administrators, they will automatically carry the corresponding privileges without manual GRANT. If business needs a custom template, simply replace this array.</p></blockquote><p>Additional notes:</p><ul><li><code>pg_revoke_public</code> defaults to <code>true</code>, meaning automatic revocation of <code>PUBLIC</code>&rsquo;s <code>CREATE</code> privilege on databases and the <code>public</code> schema.</li><li><code>pg_default_schemas</code> and <code>pg_default_extensions</code> control pre-created schemas/extensions in <code>template1/postgres</code>, typically used for monitoring objects (<code>monitor</code> schema, <code>pg_stat_statements</code>, etc.).</li></ul><hr><h2 id=common-configuration-scenarios>Common Configuration Scenarios</h2><h3 id=provide-read-only-account-for-partners>Provide Read-Only Account for Partners</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>partner_ro</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Partner.Read</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readonly]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: partner_ro, db: analytics, addr: 203.0.113.0/24, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ssl }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Effect: Partner account only has default read-only privileges after login, and can only access the <code>analytics</code> database via TLS from the specified network segment.</p></blockquote><h3 id=grant-ddl-capability-to-business-administrators>Grant DDL Capability to Business Administrators</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>app_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.AppAdmin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Business administrators can inherit the default DDL privilege template by <code>SET ROLE dbrole_admin</code> or logging in directly as <code>app_admin</code>.</p></blockquote><h3 id=customize-default-privileges>Customize Default Privileges</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_privileges</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT INSERT,UPDATE,DELETE ON TABLES TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT,UPDATE ON SEQUENCES TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT ON TABLES TO reporting_group</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>After replacing the default template, all objects created by administrators will carry the new privilege definitions, avoiding per-object authorization.</p></blockquote><hr><h2 id=coordination-with-other-components>Coordination with Other Components</h2><ul><li><strong>HBA Rules</strong>: Use <code>pg_hba_rules</code> to bind roles with sources (e.g., only allow <code>dbrole_offline</code> to access offline instances).</li><li><strong>Pgbouncer</strong>: Users with <code>pgbouncer: true</code> will be written to <code>userlist.txt</code>, and <code>pool_mode/pool_connlimit</code> can control connection pool-level quotas.</li><li><strong>Grafana/Monitoring</strong>: <code>dbuser_monitor</code>&rsquo;s privileges come from <code>pg_default_roles</code>. If you add a new monitoring user, remember to grant <code>pg_monitor</code> + access to the <code>monitor</code> schema.</li></ul><p>Through these parameters, you can version the privilege system along with code, truly achieving &ldquo;configuration as policy&rdquo;.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>