<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/pgsql/template/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/pgsql/template/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Param Templates | PIGSTY</title><meta name=description content="Use Pigsty's built-in Patroni config templates or customize your own"><meta property="og:url" content="https://pigsty.io/docs/pgsql/template/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="Param Templates"><meta property="og:description" content="Use Pigsty's built-in Patroni config templates or customize your own"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Param Templates"><meta itemprop=description content="Use Pigsty's built-in Patroni config templates or customize your own"><meta itemprop=dateModified content="2026-01-15T00:33:11+08:00"><meta itemprop=wordCount content="621"><meta itemprop=keywords content="Reference,PGSQL"><meta name=twitter:card content="summary"><meta name=twitter:title content="Param Templates"><meta name=twitter:description content="Use Pigsty's built-in Patroni config templates or customize your own"><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/pgsql/template/>Return to the regular view of this page</a>.</p></div><h1 class=title>Param Templates</h1><div class=lead>Use Pigsty&rsquo;s built-in Patroni config templates or customize your own</div><ul><li>1: <a href=#pg-c343b4e12cd241ebdb244700f6f7ae20>Parameter Optimization Policy</a></li><li>2: <a href=#pg-04bbfb111fd00b28b14a77c5a5a92955>OLTP Template</a></li><li>3: <a href=#pg-571aa5133064fa24ac707a69e4d84659>OLAP Template</a></li><li>4: <a href=#pg-7cf828587f72da3b425e1bd025ccbacf>CRIT Template</a></li><li>5: <a href=#pg-609856237df74f1f0f6e5fba1111e545>TINY Template</a></li></ul><div class=content><p>Pigsty provides four preset Patroni/PostgreSQL config templates optimized for different workloads:</p><table class=full-width><thead><tr><th style=text-align:left>Template</th><th style=text-align:left>CPU Cores</th><th style=text-align:left>Use Case</th><th style=text-align:left>Characteristics</th></tr></thead><tbody><tr><td style=text-align:left><a href=oltp><strong><code>oltp.yml</code></strong></a></td><td style=text-align:left>4-128C</td><td style=text-align:left>OLTP transactions</td><td style=text-align:left>High concurrency, low latency</td></tr><tr><td style=text-align:left><a href=olap><strong><code>olap.yml</code></strong></a></td><td style=text-align:left>4-128C</td><td style=text-align:left>OLAP analytics</td><td style=text-align:left>Large queries, high parallelism</td></tr><tr><td style=text-align:left><a href=crit><strong><code>crit.yml</code></strong></a></td><td style=text-align:left>4-128C</td><td style=text-align:left>Critical/Finance</td><td style=text-align:left>Data safety, audit, zero-loss</td></tr><tr><td style=text-align:left><a href=tiny><strong><code>tiny.yml</code></strong></a></td><td style=text-align:left>1-3C</td><td style=text-align:left>Tiny instances</td><td style=text-align:left>Resource-constrained envs</td></tr></tbody></table><p>Use <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> to select a template; default is <a href=oltp><strong><code>oltp.yml</code></strong></a>.</p><blockquote><p>The database tuning template <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> should be paired with the OS tuning template <a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a>.</p></blockquote><hr><h2 id=usage>Usage</h2><p>Set <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> in your cluster definition.
It&rsquo;s recommended to set <a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a> accordingly for OS-level tuning:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL config template (default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS tuning template (default)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>For critical financial workloads, use <a href=crit><strong><code>crit.yml</code></strong></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-finance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.22</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.23</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-finance</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL critical template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS critical tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>For low-spec VMs or dev environments, use <a href=tiny><strong><code>tiny.yml</code></strong></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-dev</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.31</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-dev</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL tiny template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS tiny tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=comparison>Comparison</h2><p>The four templates differ significantly in key parameters:</p><h3 id=connections--memory>Connections & Memory</h3><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>OLTP</th><th style=text-align:left>OLAP</th><th style=text-align:left>CRIT</th><th style=text-align:left>TINY</th></tr></thead><tbody><tr><td style=text-align:left><strong>max_connections</strong></td><td style=text-align:left>500/1000</td><td style=text-align:left>500</td><td style=text-align:left>500/1000</td><td style=text-align:left>250</td></tr><tr><td style=text-align:left><strong>work_mem</strong> range</td><td style=text-align:left>64MB-1GB</td><td style=text-align:left>64MB-8GB</td><td style=text-align:left>64MB-1GB</td><td style=text-align:left>16MB-256MB</td></tr><tr><td style=text-align:left><strong>maintenance_work_mem</strong></td><td style=text-align:left>25% shmem</td><td style=text-align:left>50% shmem</td><td style=text-align:left>25% shmem</td><td style=text-align:left>25% shmem</td></tr><tr><td style=text-align:left><strong>max_locks_per_transaction</strong></td><td style=text-align:left>1-2x maxconn</td><td style=text-align:left>2-4x maxconn</td><td style=text-align:left>1-2x maxconn</td><td style=text-align:left>1-2x maxconn</td></tr></tbody></table><h3 id=parallel-query>Parallel Query</h3><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>OLTP</th><th style=text-align:left>OLAP</th><th style=text-align:left>CRIT</th><th style=text-align:left>TINY</th></tr></thead><tbody><tr><td style=text-align:left><strong>max_worker_processes</strong></td><td style=text-align:left>cpu+8</td><td style=text-align:left>cpu+12</td><td style=text-align:left>cpu+8</td><td style=text-align:left>cpu+4</td></tr><tr><td style=text-align:left><strong>max_parallel_workers</strong></td><td style=text-align:left>50% cpu</td><td style=text-align:left>80% cpu</td><td style=text-align:left>50% cpu</td><td style=text-align:left>50% cpu</td></tr><tr><td style=text-align:left><strong>max_parallel_workers_per_gather</strong></td><td style=text-align:left>20% cpu (max 8)</td><td style=text-align:left>50% cpu</td><td style=text-align:left>0 (off)</td><td style=text-align:left>0 (off)</td></tr><tr><td style=text-align:left><strong>parallel_setup_cost</strong></td><td style=text-align:left>2000</td><td style=text-align:left>1000</td><td style=text-align:left>2000</td><td style=text-align:left>1000</td></tr><tr><td style=text-align:left><strong>parallel_tuple_cost</strong></td><td style=text-align:left>0.2</td><td style=text-align:left>0.1</td><td style=text-align:left>0.2</td><td style=text-align:left>0.1</td></tr></tbody></table><h3 id=sync-replication>Sync Replication</h3><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>OLTP</th><th style=text-align:left>OLAP</th><th style=text-align:left>CRIT</th><th style=text-align:left>TINY</th></tr></thead><tbody><tr><td style=text-align:left><strong>synchronous_mode</strong></td><td style=text-align:left>depends pg_rpo</td><td style=text-align:left>depends pg_rpo</td><td style=text-align:left>forced on</td><td style=text-align:left>depends pg_rpo</td></tr><tr><td style=text-align:left><strong>data_checksums</strong></td><td style=text-align:left>optional</td><td style=text-align:left>optional</td><td style=text-align:left>forced on</td><td style=text-align:left>optional</td></tr></tbody></table><h3 id=vacuum-config>Vacuum Config</h3><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>OLTP</th><th style=text-align:left>OLAP</th><th style=text-align:left>CRIT</th><th style=text-align:left>TINY</th></tr></thead><tbody><tr><td style=text-align:left><strong>vacuum_cost_delay</strong></td><td style=text-align:left>20ms</td><td style=text-align:left>10ms</td><td style=text-align:left>20ms</td><td style=text-align:left>20ms</td></tr><tr><td style=text-align:left><strong>vacuum_cost_limit</strong></td><td style=text-align:left>2000</td><td style=text-align:left>10000</td><td style=text-align:left>2000</td><td style=text-align:left>2000</td></tr><tr><td style=text-align:left><strong>autovacuum_max_workers</strong></td><td style=text-align:left>3</td><td style=text-align:left>3</td><td style=text-align:left>3</td><td style=text-align:left>2</td></tr></tbody></table><h3 id=timeout--security>Timeout & Security</h3><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>OLTP</th><th style=text-align:left>OLAP</th><th style=text-align:left>CRIT</th><th style=text-align:left>TINY</th></tr></thead><tbody><tr><td style=text-align:left><strong>idle_in_transaction_session_timeout</strong></td><td style=text-align:left>10min</td><td style=text-align:left>off</td><td style=text-align:left>1min</td><td style=text-align:left>10min</td></tr><tr><td style=text-align:left><strong>log_min_duration_statement</strong></td><td style=text-align:left>100ms</td><td style=text-align:left>1000ms</td><td style=text-align:left>100ms</td><td style=text-align:left>100ms</td></tr><tr><td style=text-align:left><strong>default_statistics_target</strong></td><td style=text-align:left>400</td><td style=text-align:left>1000</td><td style=text-align:left>400</td><td style=text-align:left>200</td></tr><tr><td style=text-align:left><strong>track_activity_query_size</strong></td><td style=text-align:left>8KB</td><td style=text-align:left>8KB</td><td style=text-align:left>32KB</td><td style=text-align:left>8KB</td></tr><tr><td style=text-align:left><strong>log_connections</strong></td><td style=text-align:left>auth</td><td style=text-align:left>auth</td><td style=text-align:left>full</td><td style=text-align:left>default</td></tr></tbody></table><h3 id=io-config-pg17>IO Config (PG17+)</h3><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>OLTP</th><th style=text-align:left>OLAP</th><th style=text-align:left>CRIT</th><th style=text-align:left>TINY</th></tr></thead><tbody><tr><td style=text-align:left><strong>io_workers</strong></td><td style=text-align:left>25% cpu (4-16)</td><td style=text-align:left>50% cpu (4-32)</td><td style=text-align:left>25% cpu (4-8)</td><td style=text-align:left>3</td></tr><tr><td style=text-align:left><strong>temp_file_limit</strong></td><td style=text-align:left>1/20 disk</td><td style=text-align:left>1/5 disk</td><td style=text-align:left>1/20 disk</td><td style=text-align:left>1/20 disk</td></tr></tbody></table><hr><h2 id=selection-guide>Selection Guide</h2><ul><li><p><a href=oltp><strong>OLTP Template</strong></a>: Default choice for most transaction processing. Ideal for e-commerce, social, gaming apps.</p></li><li><p><a href=olap><strong>OLAP Template</strong></a>: For data warehouses, BI reports, ETL. Allows large queries, high parallelism, relaxed timeouts.</p></li><li><p><a href=crit><strong>CRIT Template</strong></a>: For financial transactions, core accounting with strict consistency/security requirements. Forced sync replication, checksums, full audit.</p></li><li><p><a href=tiny><strong>TINY Template</strong></a>: For dev/test environments, resource-constrained VMs, Raspberry Pi. Minimizes resource usage, disables parallel queries.</p></li></ul><hr><h2 id=custom-templates>Custom Templates</h2><p>Create custom templates based on existing ones. Templates are in <code>roles/pgsql/templates/</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roles/pgsql/templates/
</span></span><span style=display:flex><span>├── oltp.yml    <span style=color:#8f5902;font-style:italic># OLTP template (default)</span>
</span></span><span style=display:flex><span>├── olap.yml    <span style=color:#8f5902;font-style:italic># OLAP template</span>
</span></span><span style=display:flex><span>├── crit.yml    <span style=color:#8f5902;font-style:italic># CRIT critical template</span>
</span></span><span style=display:flex><span>└── tiny.yml    <span style=color:#8f5902;font-style:italic># TINY micro template</span>
</span></span></code></pre></div><p>Steps to create a custom template:</p><ol><li>Copy an existing template as base</li><li>Modify parameters as needed</li><li>Place in <code>roles/pgsql/templates/</code></li><li>Reference via <a href=/docs/pgsql/param#pg_conf><code>pg_conf</code></a></li></ol><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp roles/pgsql/templates/oltp.yml roles/pgsql/templates/myapp.yml
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Edit myapp.yml as needed</span>
</span></span></code></pre></div><p>Then use in your cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-myapp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>myapp.yml</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Templates use Jinja2 syntax; parameters are dynamically computed based on node resources (CPU, memory, disk).</p><hr><h2 id=tuning-strategy>Tuning Strategy</h2><p>For technical details on template parameter optimization, see <a href=tune><strong>Tuning Strategy</strong></a>:</p><ul><li>Memory tuning (shared buffers, work mem, max connections)</li><li>CPU tuning (parallel query worker config)</li><li>Storage tuning (WAL size, temp file limits)</li><li>Manual parameter adjustment</li></ul><hr><h2 id=related-parameters>Related Parameters</h2><ul><li><a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a>: PostgreSQL config template</li><li><a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a>: OS tuning template, should match <code>pg_conf</code></li><li><a href=/docs/pgsql/param#pg_rto><strong><code>pg_rto</code></strong></a>: Recovery time objective, affects failover timeout</li><li><a href=/docs/pgsql/param#pg_rpo><strong><code>pg_rpo</code></strong></a>: Recovery point objective, affects sync replication</li><li><a href=/docs/pgsql/param#pg_max_conn><strong><code>pg_max_conn</code></strong></a>: Override template max connections</li><li><a href=/docs/pgsql/param#pg_shared_buffer_ratio><strong><code>pg_shared_buffer_ratio</code></strong></a>: Shared buffer memory ratio</li><li><a href=/docs/pgsql/param#pg_storage_type><strong><code>pg_storage_type</code></strong></a>: Storage type, affects IO params</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-c343b4e12cd241ebdb244700f6f7ae20>1 - Parameter Optimization Policy</h1><div class=lead>Learn the parameter optimization strategies Pigsty uses for the 4 different PostgreSQL workload scenarios.</div><p>Pigsty provides four scenario-based parameter templates by default, which can be specified and used through the <a href=/docs/pgsql/param#pg_conf><code>pg_conf</code></a> parameter.</p><ul><li><code>tiny.yml</code>: Optimized for small nodes, VMs, and small demos (1-8 cores, 1-16GB)</li><li><code>oltp.yml</code>: Optimized for OLTP workloads and latency-sensitive applications (4C8GB+) (default template)</li><li><code>olap.yml</code>: Optimized for OLAP workloads and throughput (4C8G+)</li><li><code>crit.yml</code>: Optimized for data consistency and critical applications (4C8G+)</li></ul><p>Pigsty adopts different parameter optimization strategies for these four default scenarios, as shown below:</p><hr><h2 id=memory-parameter-tuning>Memory Parameter Tuning</h2><p>Pigsty automatically detects the system&rsquo;s memory size and uses it as the basis for setting the maximum number of connections and memory-related parameters.</p><ul><li><a href=/docs/pgsql/param#pg_max_conn><code>pg_max_conn</code></a>: PostgreSQL maximum connections, <code>auto</code> will use recommended values for different scenarios</li><li><a href=/docs/pgsql/param#pg_shared_buffer_ratio><code>pg_shared_buffer_ratio</code></a>: Shared buffer memory ratio, default is 0.25</li></ul><p>By default, Pigsty uses 25% of memory as PostgreSQL shared buffers, with the remaining 75% as the operating system cache.</p><p>By default, if the user has not set a <a href=/docs/pgsql/param#pg_max_conn><code>pg_max_conn</code></a> maximum connections value, Pigsty will use defaults according to the following rules:</p><ul><li>oltp: 500 (pgbouncer) / 1000 (postgres)</li><li>crit: 500 (pgbouncer) / 1000 (postgres)</li><li>tiny: 300</li><li>olap: 300</li></ul><p>For OLTP and CRIT templates, if the service is not pointing to the pgbouncer connection pool but directly connects to the postgres database, the maximum connections will be doubled to 1000.</p><p>After determining the maximum connections, <code>work_mem</code> is calculated from shared memory size / maximum connections and limited to the range of 64MB ~ 1GB.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#000>% raw %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% if pg_max_conn != &#39;auto&#39; and pg_max_conn|int &gt;= 20 %}{% set pg_max_connections = pg_max_conn|int %}{% else %}{% if pg_default_service_dest|default(&#39;postgres&#39;) == &#39;pgbouncer&#39; %}{% set pg_max_connections = 500 %}{% else %}{% set pg_max_connections = 1000 %}{% endif %}{% endif %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% set pg_max_prepared_transactions = pg_max_connections if &#39;citus&#39; in pg_libs else 0 %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% set pg_max_locks_per_transaction = (2 * pg_max_connections)|int if &#39;citus&#39; in pg_libs or &#39;timescaledb&#39; in pg_libs else pg_max_connections %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% set pg_shared_buffers = (node_mem_mb|int * pg_shared_buffer_ratio|float) | round(0, &#39;ceil&#39;) | int %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% set pg_maintenance_mem = (pg_shared_buffers|int * 0.25)|round(0, &#39;ceil&#39;)|int %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% set pg_effective_cache_size = node_mem_mb|int - pg_shared_buffers|int  %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% set pg_workmem =  ([ ([ (pg_shared_buffers / pg_max_connections)|round(0,&#39;floor&#39;)|int , 64 ])|max|int , 1024])|min|int %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% endraw %}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=cpu-parameter-tuning>CPU Parameter Tuning</h2><p>In PostgreSQL, there are 4 important parameters related to parallel queries. Pigsty automatically optimizes parameters based on the current system&rsquo;s CPU cores.
In all strategies, the total number of parallel processes (total budget) is usually set to CPU cores + 8, with a minimum of 16, to reserve enough background workers for logical replication and extensions. The OLAP and TINY templates vary slightly based on scenarios.</p><table><thead><tr><th>OLTP</th><th>Setting Logic</th><th>Range Limits</th></tr></thead><tbody><tr><td><code>max_worker_processes</code></td><td>max(100% CPU + 8, 16)</td><td>CPU cores + 4, minimum 12</td></tr><tr><td><code>max_parallel_workers</code></td><td>max(ceil(50% CPU), 2)</td><td>1/2 CPU rounded up, minimum 2</td></tr><tr><td><code>max_parallel_maintenance_workers</code></td><td>max(ceil(33% CPU), 2)</td><td>1/3 CPU rounded up, minimum 2</td></tr><tr><td><code>max_parallel_workers_per_gather</code></td><td>min(max(ceil(20% CPU), 2),8)</td><td>1/5 CPU rounded down, minimum 2, max 8</td></tr></tbody></table><table><thead><tr><th>OLAP</th><th>Setting Logic</th><th>Range Limits</th></tr></thead><tbody><tr><td><code>max_worker_processes</code></td><td>max(100% CPU + 12, 20)</td><td>CPU cores + 12, minimum 20</td></tr><tr><td><code>max_parallel_workers</code></td><td>max(ceil(80% CPU, 2))</td><td>4/5 CPU rounded up, minimum 2</td></tr><tr><td><code>max_parallel_maintenance_workers</code></td><td>max(ceil(33% CPU), 2)</td><td>1/3 CPU rounded up, minimum 2</td></tr><tr><td><code>max_parallel_workers_per_gather</code></td><td>max(floor(50% CPU), 2)</td><td>1/2 CPU rounded up, minimum 2</td></tr></tbody></table><table><thead><tr><th>CRIT</th><th>Setting Logic</th><th>Range Limits</th></tr></thead><tbody><tr><td><code>max_worker_processes</code></td><td>max(100% CPU + 8, 16)</td><td>CPU cores + 8, minimum 16</td></tr><tr><td><code>max_parallel_workers</code></td><td>max(ceil(50% CPU), 2)</td><td>1/2 CPU rounded up, minimum 2</td></tr><tr><td><code>max_parallel_maintenance_workers</code></td><td>max(ceil(33% CPU), 2)</td><td>1/3 CPU rounded up, minimum 2</td></tr><tr><td><code>max_parallel_workers_per_gather</code></td><td>0, enable as needed</td><td></td></tr></tbody></table><table><thead><tr><th>TINY</th><th>Setting Logic</th><th>Range Limits</th></tr></thead><tbody><tr><td><code>max_worker_processes</code></td><td>max(100% CPU + 4, 12)</td><td>CPU cores + 4, minimum 12</td></tr><tr><td><code>max_parallel_workers</code></td><td>max(ceil(50% CPU) 1)</td><td>50% CPU rounded down, minimum 1</td></tr><tr><td><code>max_parallel_maintenance_workers</code></td><td>max(ceil(33% CPU), 1)</td><td>33% CPU rounded down, minimum 1</td></tr><tr><td><code>max_parallel_workers_per_gather</code></td><td>0, enable as needed</td><td></td></tr></tbody></table><p>Note that the CRIT and TINY templates disable parallel queries by setting <code>max_parallel_workers_per_gather = 0</code>.
Users can enable parallel queries as needed by setting this parameter.</p><p>Both OLTP and CRIT templates additionally set the following parameters, doubling the parallel query cost to reduce the tendency to use parallel queries.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>parallel_setup_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2000</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># double from 100 to increase parallel cost</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>parallel_tuple_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># double from 0.1 to increase parallel cost</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_parallel_table_scan_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>16MB </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># double from 8MB to increase parallel cost</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_parallel_index_scan_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># double from 512 to increase parallel cost</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Note that adjustments to the <code>max_worker_processes</code> parameter only take effect after a restart. Additionally, when a replica&rsquo;s configuration value for this parameter is higher than the primary&rsquo;s, the replica will fail to start.
This parameter must be adjusted through Patroni configuration management, which ensures consistent primary-replica configuration and prevents new replicas from failing to start during failover.</p><hr><h2 id=storage-space-parameters>Storage Space Parameters</h2><p>Pigsty automatically detects the total space of the disk where the <code>/data/postgres</code> main data directory is located and uses it as the basis for specifying the following parameters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#000>% raw %}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_wal_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{{<span style=color:#f8f8f8> </span><span style=color:#000>([pg_size_twentieth, 200])|min }}GB                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 1/20 disk size, max 200GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_wal_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{{<span style=color:#f8f8f8> </span><span style=color:#000>([pg_size_twentieth * 4, 2000])|min }}GB            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 2/10 disk size, max 2000GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_slot_wal_keep_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{{<span style=color:#f8f8f8> </span><span style=color:#000>([pg_size_twentieth * 6, 3000])|min }}GB  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 3/10 disk size, max 3000GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>temp_file_limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{{<span style=color:#f8f8f8> </span><span style=color:#000>([pg_size_twentieth, 200])|min }}GB              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 1/20 of disk size, max 200GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>{<span style=color:#000>% endraw %}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li><code>temp_file_limit</code> defaults to 5% of disk space, capped at 200GB.</li><li><code>min_wal_size</code> defaults to 5% of disk space, capped at 200GB.</li><li><code>max_wal_size</code> defaults to 20% of disk space, capped at 2TB.</li><li><code>max_slot_wal_keep_size</code> defaults to 30% of disk space, capped at 3TB.</li></ul><p>As a special case, the OLAP template allows 20% for <code>temp_file_limit</code>, capped at 2TB.</p><hr><h2 id=manual-parameter-tuning>Manual Parameter Tuning</h2><p>In addition to using Pigsty&rsquo;s automatically configured parameters, you can also manually tune PostgreSQL parameters.</p><p>Use the <code>pg edit-config &lt;cluster></code> command to interactively edit cluster configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pg edit-config pg-meta
</span></span></code></pre></div><p>Or use the <code>-p</code> parameter to directly set parameters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pg edit-config -p <span style=color:#000>log_min_duration_statement</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1000</span> pg-meta
</span></span><span style=display:flex><span>pg edit-config --force -p <span style=color:#000>shared_preload_libraries</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;timescaledb, pg_cron, pg_stat_statements, auto_explain&#39;</span> pg-meta
</span></span></code></pre></div><p>You can also use the Patroni REST API to modify configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -u <span style=color:#4e9a06>&#39;postgres:Patroni.API&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    -d <span style=color:#4e9a06>&#39;{&#34;postgresql&#34;:{&#34;parameters&#34;: {&#34;log_min_duration_statement&#34;:200}}}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    -s -X PATCH http://10.10.10.10:8008/config <span style=color:#000;font-weight:700>|</span> jq .
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-04bbfb111fd00b28b14a77c5a5a92955>2 - OLTP Template</h1><div class=lead>PostgreSQL config template optimized for online transaction processing workloads</div><p><code>oltp.yml</code> is Pigsty&rsquo;s default config template, optimized for <strong>online transaction processing</strong> (OLTP). Designed for 4-128 core CPUs with high concurrency, low latency, and high throughput.</p><blockquote><p>Pair with <a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a> = <code>oltp</code> for OS-level tuning.</p></blockquote><hr><h2 id=use-cases>Use Cases</h2><p>OLTP template is ideal for:</p><ul><li><strong>E-commerce</strong>: Order processing, inventory, user transactions</li><li><strong>Social apps</strong>: User feeds, messaging, following relationships</li><li><strong>Gaming backends</strong>: Player data, leaderboards, game state</li><li><strong>SaaS applications</strong>: Multi-tenant business systems</li><li><strong>Web apps</strong>: CRUD-intensive workloads</li></ul><p><strong>Workload characteristics</strong>:</p><ul><li>Many short transactions (millisecond-level)</li><li>High concurrent connections (hundreds to thousands)</li><li>Read/write ratio typically 7:3 to 9:1</li><li>Latency-sensitive, requires fast response</li><li>High data consistency requirements</li></ul><hr><h2 id=usage>Usage</h2><p><a href=oltp><strong><code>oltp.yml</code></strong></a> is the default template, no explicit specification needed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-oltp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-oltp</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># pg_conf: oltp.yml  # PostgreSQL config template (default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># node_tune: oltp    # OS tuning template (default)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Or explicitly specify:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-oltp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL config template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS tuning template</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=parameter-details>Parameter Details</h2><h3 id=connection-management>Connection Management</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500</span><span style=color:#000>/1000  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># depends on pgbouncer usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>superuser_reserved_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li>When <a href=/docs/pgsql/param#pg_default_service_dest><code>pg_default_service_dest</code></a> is <code>pgbouncer</code>, <code>max_connections</code> is set to 500</li><li>When traffic connects directly to PostgreSQL, <code>max_connections</code> is set to 1000</li><li>Override via <a href=/docs/pgsql/param#pg_max_conn><code>pg_max_conn</code></a> parameter</li></ul><h3 id=memory-config>Memory Config</h3><p>OLTP template memory allocation strategy:</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>Formula</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>shared_buffers</code></td><td style=text-align:left>mem × <code>pg_shared_buffer_ratio</code></td><td style=text-align:left>Default ratio 0.25</td></tr><tr><td style=text-align:left><code>maintenance_work_mem</code></td><td style=text-align:left>shared_buffers × 25%</td><td style=text-align:left>For VACUUM, CREATE INDEX</td></tr><tr><td style=text-align:left><code>work_mem</code></td><td style=text-align:left>64MB - 1GB</td><td style=text-align:left>Based on shared_buffers/max_connections</td></tr><tr><td style=text-align:left><code>effective_cache_size</code></td><td style=text-align:left>total mem - shared_buffers</td><td style=text-align:left>Estimated cache memory</td></tr></tbody></table><p><strong>work_mem calculation</strong>:</p><pre tabindex=0><code>work_mem = min(max(shared_buffers / max_connections, 64MB), 1GB)
</code></pre><p>Ensures each connection has sufficient sort/hash memory without over-allocation.</p><h3 id=parallel-query>Parallel Query</h3><p>OLTP template moderately limits parallel queries to prevent resource contention:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_worker_processes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cpu + 8 (min 16)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#000>% × cpu (min 2)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_workers_per_gather</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000>% × cpu (2-8)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_maintenance_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000>% × cpu (min 2)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Parallel cost estimates are increased to favor serial execution:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>parallel_setup_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2000</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># 2x default (1000)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>parallel_tuple_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># 2x default (0.1)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_parallel_table_scan_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>16MB  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 2x default (8MB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_parallel_index_scan_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 2x default (512)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=wal-config>WAL Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_wal_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disk/20 (max 200GB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_wal_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disk/5 (max 2000GB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_slot_wal_keep_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disk×3/10 (max 3000GB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>wal_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>16MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>wal_writer_delay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>wal_writer_flush_after</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>commit_delay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>commit_siblings</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>checkpoint_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>15min</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>checkpoint_completion_target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.80</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Balances data safety and write performance.</p><h3 id=vacuum-config>Vacuum Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vacuum_cost_delay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20ms        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># sleep after each vacuum round</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vacuum_cost_limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2000</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># cost limit per vacuum round</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_max_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_naptime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1min</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_vacuum_scale_factor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.08</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 8% table change triggers vacuum</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_analyze_scale_factor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.04</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 4% table change triggers analyze</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_freeze_max_age</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1000000000</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Conservative vacuum settings avoid impacting online transaction performance.</p><h3 id=query-optimization>Query Optimization</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>random_page_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1.1</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># SSD optimized</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>effective_io_concurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># SSD concurrent IO</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>default_statistics_target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Statistics precision</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Enables planner to generate better query plans.</p><h3 id=logging--monitoring>Logging & Monitoring</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_min_duration_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># log queries &gt; 100ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ddl                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># log DDL statements</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_checkpoints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_lock_waits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_temp_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># log temp files &gt; 1MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_autovacuum_min_duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_io_timing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_functions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_activity_query_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8192</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=client-timeouts>Client Timeouts</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>deadlock_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>50ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>idle_in_transaction_session_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>10min</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>10-minute idle transaction timeout prevents zombie transactions holding locks.</p><h3 id=extension-config>Extension Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>shared_preload_libraries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># auto_explain</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>auto_explain.log_min_duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>auto_explain.log_analyze</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>auto_explain.log_verbose</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>auto_explain.log_timing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>auto_explain.log_nested_statements</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_stat_statements</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.max</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.track</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.track_utility</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>off</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.track_planning</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>off</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=template-comparison>Template Comparison</h2><table><thead><tr><th style=text-align:left>Feature</th><th style=text-align:left><a href=oltp><strong>OLTP</strong></a></th><th style=text-align:left><a href=olap><strong>OLAP</strong></a></th><th style=text-align:left><a href=crit><strong>CRIT</strong></a></th></tr></thead><tbody><tr><td style=text-align:left>max_connections</td><td style=text-align:left>500-1000</td><td style=text-align:left>500</td><td style=text-align:left>500-1000</td></tr><tr><td style=text-align:left>work_mem</td><td style=text-align:left>64MB-1GB</td><td style=text-align:left>64MB-8GB</td><td style=text-align:left>64MB-1GB</td></tr><tr><td style=text-align:left>Parallel query</td><td style=text-align:left>Moderate limit</td><td style=text-align:left>Aggressive</td><td style=text-align:left>Disabled</td></tr><tr><td style=text-align:left>Vacuum intensity</td><td style=text-align:left>Conservative</td><td style=text-align:left>Aggressive</td><td style=text-align:left>Conservative</td></tr><tr><td style=text-align:left>Txn timeout</td><td style=text-align:left>10min</td><td style=text-align:left>Disabled</td><td style=text-align:left>1min</td></tr><tr><td style=text-align:left>Slow query threshold</td><td style=text-align:left>100ms</td><td style=text-align:left>1000ms</td><td style=text-align:left>100ms</td></tr></tbody></table><h3 id=why-oltp-over-olap>Why OLTP over OLAP?</h3><ul><li>Queries are mostly simple point/range lookups</li><li>Transaction response time requires milliseconds</li><li>High concurrent connections</li><li>No complex analytical queries</li></ul><h3 id=why-oltp-over-crit>Why OLTP over CRIT?</h3><ul><li>Small probability of data loss acceptable (async replication)</li><li>Complete audit logs not required</li><li>Better write performance desired</li></ul><hr><h2 id=performance-tuning-tips>Performance Tuning Tips</h2><h3 id=connection-pooling>Connection Pooling</h3><p>For high concurrency, use PgBouncer connection pool:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-oltp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_default_service_dest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbouncer </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer_poolmode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># transaction-level pooling</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=read-separation>Read Separation</h3><p>Use read replicas to share read load:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-oltp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=monitoring-metrics>Monitoring Metrics</h3><p>Focus on these metrics:</p><ul><li><strong>Connections</strong>: Active/waiting connection counts</li><li><strong>Transaction rate</strong>: TPS, commit/rollback ratio</li><li><strong>Response time</strong>: Query latency percentiles (p50/p95/p99)</li><li><strong>Lock waits</strong>: Lock wait time, deadlock counts</li><li><strong>Replication lag</strong>: Replica delay time and bytes</li></ul><hr><h2 id=references>References</h2><ul><li><a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a>: PostgreSQL config template selection</li><li><a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a>: OS tuning template, should match <code>pg_conf</code></li><li><a href=olap><strong>OLAP Template</strong></a>: Analytics template comparison</li><li><a href=crit><strong>CRIT Template</strong></a>: Critical business template comparison</li><li><a href=tiny><strong>TINY Template</strong></a>: Micro instance template comparison</li><li><a href=/docs/pgsql/config/cluster>Cluster Config</a>: PostgreSQL cluster type configuration</li><li><a href=/docs/concept/ha>High Availability</a>: HA architecture design</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-571aa5133064fa24ac707a69e4d84659>3 - OLAP Template</h1><div class=lead>PostgreSQL config template optimized for online analytical processing workloads</div><p><code>olap.yml</code> is optimized for <strong>online analytical processing</strong> (OLAP). Designed for 4-128 core CPUs with support for large queries, high parallelism, relaxed timeouts, and aggressive vacuum.</p><blockquote><p>Pair with <a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a> = <code>olap</code> for OS-level tuning.</p></blockquote><hr><h2 id=use-cases>Use Cases</h2><p>OLAP template is ideal for:</p><ul><li><strong>Data warehouses</strong>: Historical data storage, multidimensional analysis</li><li><strong>BI reports</strong>: Complex report queries, dashboard data sources</li><li><strong>ETL processing</strong>: Data extraction, transformation, loading</li><li><strong>Data analysis</strong>: Ad-hoc queries, data exploration</li><li><strong>HTAP mixed workloads</strong>: Analytical replicas</li></ul><p><strong>Workload characteristics</strong>:</p><ul><li>Complex queries (seconds to minutes)</li><li>Low concurrent connections (tens to hundreds)</li><li>Read-intensive, writes typically batch operations</li><li>Throughput-sensitive, tolerates higher latency</li><li>Scans large data volumes</li></ul><hr><h2 id=usage>Usage</h2><p>Specify <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> = <code>olap.yml</code> in cluster definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-olap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-olap</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olap.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL analytics template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olap     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS analytics tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Use <a href=olap><strong><code>olap.yml</code></strong></a> template for dedicated offline replicas:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-mixed</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role: offline, pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olap.yml } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># offline analytics replica</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-mixed</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># primary and online replicas use OLTP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS OLTP tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=parameter-details>Parameter Details</h2><h3 id=connection-management>Connection Management</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>superuser_reserved_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>OLAP scenarios typically don&rsquo;t need many connections; 500 is sufficient for most analytical workloads.</p><h3 id=memory-config>Memory Config</h3><p>OLAP template uses more aggressive memory allocation:</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>Formula</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>shared_buffers</code></td><td style=text-align:left>mem × <code>pg_shared_buffer_ratio</code></td><td style=text-align:left>Default ratio 0.25</td></tr><tr><td style=text-align:left><code>maintenance_work_mem</code></td><td style=text-align:left>shared_buffers × <strong>50%</strong></td><td style=text-align:left>Faster index creation and VACUUM</td></tr><tr><td style=text-align:left><code>work_mem</code></td><td style=text-align:left>64MB - <strong>8GB</strong></td><td style=text-align:left>Larger sort/hash memory</td></tr><tr><td style=text-align:left><code>effective_cache_size</code></td><td style=text-align:left>total mem - shared_buffers</td><td style=text-align:left>Estimated cache memory</td></tr></tbody></table><p><strong>work_mem calculation</strong> (differs from OLTP):</p><pre tabindex=0><code>work_mem = min(max(shared_buffers / max_connections, 64MB), 8GB)
</code></pre><p>Larger <code>work_mem</code> allows bigger sort and hash operations in memory, avoiding disk spill.</p><h3 id=locks--transactions>Locks & Transactions</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_locks_per_transaction: 2-4x maxconn   # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span>-<span style=color:#000>2x</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>OLAP queries may involve more tables (partitions, many JOINs), requiring more lock slots.</p><h3 id=parallel-query>Parallel Query</h3><p>OLAP template aggressively enables parallel queries:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_worker_processes: cpu + 12 (min 20)      # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cpu + 8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_workers: 80% × cpu (min 2)      # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#000>%</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_workers_per_gather: 50% × cpu   # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000>% (max 8)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_maintenance_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000>% × cpu</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Parallel cost estimates use defaults to favor parallel plans:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># parallel_setup_cost: 1000    # default, not doubled</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># parallel_tuple_cost: 0.1     # default, not doubled</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Partition-wise optimization enabled:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>enable_partitionwise_join</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># smart partition JOIN</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>enable_partitionwise_aggregate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># smart partition aggregation</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=io-config-pg17>IO Config (PG17+)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>io_workers: 50% × cpu (4-32)    # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>% (4-16)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>More IO workers support parallel large table scans.</p><h3 id=wal-config>WAL Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_wal_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disk/20 (max 200GB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_wal_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disk/5 (max 2000GB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_slot_wal_keep_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disk×3/10 (max 3000GB)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>temp_file_limit: disk/5 (max 2000GB)   # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disk/20</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Larger <code>temp_file_limit</code> allows bigger intermediate results to spill to disk.</p><h3 id=vacuum-config>Vacuum Config</h3><p>OLAP template uses aggressive vacuum settings:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vacuum_cost_delay: 10ms         # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20ms, faster vacuum</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vacuum_cost_limit: 10000        # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2000</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>more work per round</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_max_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_naptime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1min</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_vacuum_scale_factor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.08</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_analyze_scale_factor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.04</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Analytical databases often have bulk writes requiring aggressive vacuum to reclaim space.</p><h3 id=query-optimization>Query Optimization</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>random_page_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1.1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>effective_io_concurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>default_statistics_target: 1000    # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>more precise stats</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Higher <code>default_statistics_target</code> provides more accurate query plans, crucial for complex analytics.</p><h3 id=logging--monitoring>Logging & Monitoring</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_min_duration_statement: 1000    # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>100ms, relaxed threshold</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ddl</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_checkpoints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_lock_waits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_temp_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_autovacuum_min_duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_io_timing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_cost_delay_timing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># PG18+, track vacuum cost delay</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_functions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_activity_query_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8192</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=client-timeouts>Client Timeouts</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>deadlock_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>50ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>idle_in_transaction_session_timeout: 0   # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>10min, disabled</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Analytical queries may need to hold transactions for extended periods, so idle timeout is disabled.</p><hr><h2 id=key-differences-from-oltp>Key Differences from OLTP</h2><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left><a href=olap><strong>OLAP</strong></a></th><th style=text-align:left><a href=oltp><strong>OLTP</strong></a></th><th style=text-align:left>Reason</th></tr></thead><tbody><tr><td style=text-align:left>max_connections</td><td style=text-align:left>500</td><td style=text-align:left>500-1000</td><td style=text-align:left>Fewer analytical connections</td></tr><tr><td style=text-align:left>work_mem limit</td><td style=text-align:left>8GB</td><td style=text-align:left>1GB</td><td style=text-align:left>Support larger in-memory sorts</td></tr><tr><td style=text-align:left>maintenance_work_mem</td><td style=text-align:left>50% buffer</td><td style=text-align:left>25% buffer</td><td style=text-align:left>Faster index creation</td></tr><tr><td style=text-align:left>max_locks_per_transaction</td><td style=text-align:left>2-4x</td><td style=text-align:left>1-2x</td><td style=text-align:left>More tables in queries</td></tr><tr><td style=text-align:left>max_parallel_workers</td><td style=text-align:left>80% cpu</td><td style=text-align:left>50% cpu</td><td style=text-align:left>Aggressive parallelism</td></tr><tr><td style=text-align:left>max_parallel_workers_per_gather</td><td style=text-align:left>50% cpu</td><td style=text-align:left>20% cpu</td><td style=text-align:left>Aggressive parallelism</td></tr><tr><td style=text-align:left>parallel_setup_cost</td><td style=text-align:left>1000</td><td style=text-align:left>2000</td><td style=text-align:left>Default, encourages parallel</td></tr><tr><td style=text-align:left>parallel_tuple_cost</td><td style=text-align:left>0.1</td><td style=text-align:left>0.2</td><td style=text-align:left>Default, encourages parallel</td></tr><tr><td style=text-align:left>enable_partitionwise_join</td><td style=text-align:left>on</td><td style=text-align:left>off</td><td style=text-align:left>Partition optimization</td></tr><tr><td style=text-align:left>enable_partitionwise_aggregate</td><td style=text-align:left>on</td><td style=text-align:left>off</td><td style=text-align:left>Partition optimization</td></tr><tr><td style=text-align:left>vacuum_cost_delay</td><td style=text-align:left>10ms</td><td style=text-align:left>20ms</td><td style=text-align:left>Aggressive vacuum</td></tr><tr><td style=text-align:left>vacuum_cost_limit</td><td style=text-align:left>10000</td><td style=text-align:left>2000</td><td style=text-align:left>Aggressive vacuum</td></tr><tr><td style=text-align:left>temp_file_limit</td><td style=text-align:left>1/5 disk</td><td style=text-align:left>1/20 disk</td><td style=text-align:left>Allow larger temp files</td></tr><tr><td style=text-align:left>io_workers</td><td style=text-align:left>50% cpu</td><td style=text-align:left>25% cpu</td><td style=text-align:left>More parallel IO</td></tr><tr><td style=text-align:left>log_min_duration_statement</td><td style=text-align:left>1000ms</td><td style=text-align:left>100ms</td><td style=text-align:left>Relaxed slow query threshold</td></tr><tr><td style=text-align:left>default_statistics_target</td><td style=text-align:left>1000</td><td style=text-align:left>400</td><td style=text-align:left>More precise stats</td></tr><tr><td style=text-align:left>idle_in_transaction_session_timeout</td><td style=text-align:left>Disabled</td><td style=text-align:left>10min</td><td style=text-align:left>Allow long transactions</td></tr></tbody></table><hr><h2 id=performance-tuning-tips>Performance Tuning Tips</h2><h3 id=with-timescaledb>With TimescaleDB</h3><p>OLAP template works great with TimescaleDB:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-timeseries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olap.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>timescaledb</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=with-pg_duckdb>With pg_duckdb</h3><p>For ultimate analytical performance, combine with pg_duckdb:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-analytics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>olap.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_duckdb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=columnar-storage>Columnar Storage</h3><p>Consider columnar storage extensions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>citus_columnar </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># or pg_mooncake</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=resource-isolation>Resource Isolation</h3><p>For mixed workloads, isolate analytics to dedicated replicas:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-mixed</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OLTP writes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OLTP reads</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>offline }              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OLAP analytics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-mixed</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=monitoring-metrics>Monitoring Metrics</h3><p>Focus on these metrics:</p><ul><li><strong>Query time</strong>: Long query execution time distribution</li><li><strong>Parallelism</strong>: Parallel worker utilization</li><li><strong>Temp files</strong>: Temp file size and count</li><li><strong>Disk IO</strong>: Sequential and index scan IO volume</li><li><strong>Cache hit ratio</strong>: shared_buffers and OS cache hit rates</li></ul><hr><h2 id=references>References</h2><ul><li><a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a>: PostgreSQL config template selection</li><li><a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a>: OS tuning template, should match <code>pg_conf</code></li><li><a href=oltp><strong>OLTP Template</strong></a>: Transaction template comparison</li><li><a href=crit><strong>CRIT Template</strong></a>: Critical business template comparison</li><li><a href=tiny><strong>TINY Template</strong></a>: Micro instance template comparison</li><li><a href=/docs/pgsql/config/cluster#offline-replica>Offline Replica</a>: Dedicated analytics instances</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-7cf828587f72da3b425e1bd025ccbacf>4 - CRIT Template</h1><div class=lead>PostgreSQL config template optimized for critical/financial workloads with data safety and audit compliance</div><p><code>crit.yml</code> is optimized for <strong>critical/financial workloads</strong>. Designed for 4-128 core CPUs with forced sync replication, data checksums, full audit logging, and strict security. Trades performance for maximum data safety.</p><blockquote><p>Pair with <a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a> = <code>crit</code> for OS-level tuning, optimizing dirty page management.</p></blockquote><hr><h2 id=use-cases>Use Cases</h2><p>CRIT template is ideal for:</p><ul><li><strong>Financial transactions</strong>: Bank transfers, payment settlement, securities trading</li><li><strong>Core accounting</strong>: General ledger systems, accounting systems</li><li><strong>Compliance audit</strong>: Businesses requiring complete operation records</li><li><strong>Critical business</strong>: Any scenario that cannot tolerate data loss</li></ul><p><strong>Requirements</strong>:</p><ul><li>Zero data loss (RPO = 0)</li><li>Data integrity verification</li><li>Complete audit logs</li><li>Strict security policies</li><li>Acceptable performance trade-offs</li></ul><hr><h2 id=usage>Usage</h2><p>Specify <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> = <code>crit.yml</code> in cluster definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-finance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-finance</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL critical template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS critical tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Recommendation</strong>: Critical clusters should have at least 3 nodes to maintain sync replication when one node fails.</p><hr><h2 id=core-features>Core Features</h2><h3 id=forced-sync-replication>Forced Sync Replication</h3><p>CRIT template <strong>forces sync replication</strong> regardless of <a href=/docs/pgsql/param#pg_rpo><code>pg_rpo</code></a> setting:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>synchronous_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># forced on, ignores pg_rpo</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Every transaction commit waits for at least one replica confirmation, ensuring <strong>RPO = 0</strong> (zero data loss).</p><p><strong>Cost</strong>: Write latency increases (typically 1-5ms depending on network).</p><h3 id=forced-data-checksums>Forced Data Checksums</h3><p>CRIT template <strong>forces data checksums</strong> regardless of <a href=/docs/pgsql/param#pg_checksum><code>pg_checksum</code></a> setting:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>initdb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>data-checksums  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># forced on, ignores pg_checksum</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Data checksums detect silent disk corruption (bit rot), critical for financial data.</p><h3 id=disabled-parallel-query>Disabled Parallel Query</h3><p>CRIT template disables parallel query gather operations:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_workers_per_gather</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># parallel queries disabled</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Parallel cost estimates are also increased:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>parallel_setup_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>parallel_tuple_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_parallel_table_scan_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>16MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_parallel_index_scan_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Reason</strong>: Parallel queries may cause unstable latency. For latency-sensitive financial transactions, predictable stable performance is more important.</p><hr><h2 id=parameter-details>Parameter Details</h2><h3 id=connection-management>Connection Management</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500</span><span style=color:#000>/1000  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># depends on pgbouncer usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>superuser_reserved_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Same as OLTP template.</p><h3 id=memory-config>Memory Config</h3><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>Formula</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>shared_buffers</code></td><td style=text-align:left>mem × <code>pg_shared_buffer_ratio</code></td><td style=text-align:left>Default ratio 0.25</td></tr><tr><td style=text-align:left><code>maintenance_work_mem</code></td><td style=text-align:left>shared_buffers × 25%</td><td style=text-align:left>For VACUUM, CREATE INDEX</td></tr><tr><td style=text-align:left><code>work_mem</code></td><td style=text-align:left>64MB - 1GB</td><td style=text-align:left>Same as OLTP</td></tr><tr><td style=text-align:left><code>effective_cache_size</code></td><td style=text-align:left>total mem - shared_buffers</td><td style=text-align:left>Estimated cache memory</td></tr></tbody></table><h3 id=wal-config-key-differences>WAL Config (Key Differences)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>wal_writer_delay: 10ms              # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20ms, more frequent flush</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>wal_writer_flush_after: 0           # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1MB, immediate flush, no buffer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>idle_replication_slot_timeout: 3d   # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>7d, stricter slot cleanup</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>wal_writer_flush_after: 0</code> ensures every WAL write flushes to disk immediately, minimizing data loss risk.</p><h3 id=replication-config-pg15->Replication Config (PG15-)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vacuum_defer_cleanup_age</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500000</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># PG15 and below only</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Preserves 500K recent transactions from vacuum cleanup, providing more catchup buffer for replicas.</p><h3 id=audit-logging-key-differences>Audit Logging (Key Differences)</h3><p>CRIT template enables full connection audit:</p><p><strong>PostgreSQL 18+</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;receipt,authentication,authorization&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>PostgreSQL 17 and below</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;on&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_disconnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;on&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Records complete connection lifecycle:</p><ul><li>Connection receipt</li><li>Authentication process</li><li>Authorization result</li><li>Disconnection</li></ul><h3 id=query-logging>Query Logging</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_min_duration_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># log queries &gt; 100ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ddl                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># log all DDL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_activity_query_size: 32768    # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8192</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>capture full queries</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>32KB <code>track_activity_query_size</code> ensures capturing complete long query text.</p><h3 id=statistics-tracking>Statistics Tracking</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_io_timing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_cost_delay_timing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># PG18+, track vacuum cost delay</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_functions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>track_activity_query_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>32768</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=client-timeouts-key-differences>Client Timeouts (Key Differences)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>idle_in_transaction_session_timeout: 1min   # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>10min, stricter</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>1-minute idle transaction timeout quickly releases zombie transactions holding locks.</p><h3 id=extension-config>Extension Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>shared_preload_libraries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;$libdir/passwordcheck, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Note</strong>: CRIT template loads <code>passwordcheck</code> by default, enforcing password complexity.</p><hr><h2 id=key-differences-from-oltp>Key Differences from OLTP</h2><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left><a href=crit><strong>CRIT</strong></a></th><th style=text-align:left><a href=oltp><strong>OLTP</strong></a></th><th style=text-align:left>Reason</th></tr></thead><tbody><tr><td style=text-align:left>synchronous_mode</td><td style=text-align:left><strong>Forced true</strong></td><td style=text-align:left>Depends on pg_rpo</td><td style=text-align:left>Zero data loss</td></tr><tr><td style=text-align:left>data-checksums</td><td style=text-align:left><strong>Forced on</strong></td><td style=text-align:left>Optional</td><td style=text-align:left>Data integrity</td></tr><tr><td style=text-align:left>max_parallel_workers_per_gather</td><td style=text-align:left><strong>0</strong></td><td style=text-align:left>20% cpu</td><td style=text-align:left>Stable latency</td></tr><tr><td style=text-align:left>wal_writer_delay</td><td style=text-align:left>10ms</td><td style=text-align:left>20ms</td><td style=text-align:left>More frequent flush</td></tr><tr><td style=text-align:left>wal_writer_flush_after</td><td style=text-align:left><strong>0</strong></td><td style=text-align:left>1MB</td><td style=text-align:left>Immediate flush</td></tr><tr><td style=text-align:left>idle_replication_slot_timeout</td><td style=text-align:left>3d</td><td style=text-align:left>7d</td><td style=text-align:left>Stricter cleanup</td></tr><tr><td style=text-align:left>idle_in_transaction_session_timeout</td><td style=text-align:left><strong>1min</strong></td><td style=text-align:left>10min</td><td style=text-align:left>Quick lock release</td></tr><tr><td style=text-align:left>track_activity_query_size</td><td style=text-align:left><strong>32KB</strong></td><td style=text-align:left>8KB</td><td style=text-align:left>Complete query capture</td></tr><tr><td style=text-align:left>log_connections</td><td style=text-align:left><strong>Full logging</strong></td><td style=text-align:left>Auth only</td><td style=text-align:left>Audit compliance</td></tr><tr><td style=text-align:left>log_disconnections</td><td style=text-align:left><strong>on</strong></td><td style=text-align:left>off</td><td style=text-align:left>Audit compliance</td></tr><tr><td style=text-align:left>passwordcheck</td><td style=text-align:left><strong>Enabled</strong></td><td style=text-align:left>Not enabled</td><td style=text-align:left>Password security</td></tr><tr><td style=text-align:left>vacuum_defer_cleanup_age</td><td style=text-align:left>500000</td><td style=text-align:left>0</td><td style=text-align:left>Replica catchup buffer</td></tr></tbody></table><hr><h2 id=performance-impact>Performance Impact</h2><p>Using CRIT template has these impacts:</p><h3 id=increased-write-latency>Increased Write Latency</h3><p>Sync replication adds 1-5ms write latency (network-dependent):</p><pre tabindex=0><code>Async replication: commit -&gt; local flush -&gt; return to client
Sync replication:  commit -&gt; local flush -&gt; wait replica confirm -&gt; return to client
</code></pre><h3 id=reduced-write-throughput>Reduced Write Throughput</h3><p>Due to replica confirmation wait, write TPS may drop 10-30%.</p><h3 id=more-stable-query-latency>More Stable Query Latency</h3><p>With parallel queries disabled, query latency is more predictable without parallel startup overhead variance.</p><h3 id=slightly-increased-resource-overhead>Slightly Increased Resource Overhead</h3><p>More frequent WAL flushes and complete audit logs add extra IO overhead.</p><hr><h2 id=ha-configuration>HA Configuration</h2><h3 id=minimum-recommended-setup>Minimum Recommended Setup</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-critical</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-critical</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL critical template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS critical tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>3-node setup ensures sync replication continues when one node fails.</p><h3 id=cross-dc-deployment>Cross-DC Deployment</h3><p>For financial-grade disaster recovery:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-critical</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role: primary, pg_weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># DC A</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role: replica, pg_weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># DC A</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.20.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role: replica, pg_weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># DC B (standby)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-critical</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL critical template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>crit     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS critical tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=quorum-commit>Quorum Commit</h3><p>For higher consistency, configure multiple sync replicas:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pg edit-config pg-critical
</span></span><span style=display:flex><span>synchronous_mode: <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>synchronous_node_count: <span style=color:#0000cf;font-weight:700>2</span>    <span style=color:#8f5902;font-style:italic># require 2 replica confirmations</span>
</span></span></code></pre></div><hr><h2 id=security-hardening-tips>Security Hardening Tips</h2><h3 id=password-policy>Password Policy</h3><p>CRIT template has <code>passwordcheck</code> enabled; further configure:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Set password encryption
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SYSTEM</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#000>password_encryption</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;scram-sha-256&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=audit-extension>Audit Extension</h3><p>Consider <code>pgaudit</code> for detailed auditing:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements, auto_explain, pgaudit&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgaudit.log</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;ddl, role, write&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=network-isolation>Network Isolation</h3><p>Ensure database network is isolated; use <a href=/docs/pgsql/config/hba>HBA rules</a> to restrict access.</p><hr><h2 id=monitoring-metrics>Monitoring Metrics</h2><p>For critical clusters, focus on:</p><ul><li><strong>Replication lag</strong>: Sync lag should be near zero</li><li><strong>Transaction commit time</strong>: p99 latency</li><li><strong>Lock waits</strong>: Long lock waits may impact business</li><li><strong>Checkpoints</strong>: Checkpoint duration and frequency</li><li><strong>WAL generation rate</strong>: Predict disk space needs</li></ul><hr><h2 id=references>References</h2><ul><li><a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a>: PostgreSQL config template selection</li><li><a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a>: OS tuning template, should match <code>pg_conf</code></li><li><a href=/docs/pgsql/param#pg_rpo><strong><code>pg_rpo</code></strong></a>: Recovery point objective parameter</li><li><a href=oltp><strong>OLTP Template</strong></a>: Transaction template comparison</li><li><a href=olap><strong>OLAP Template</strong></a>: Analytics template comparison</li><li><a href=tiny><strong>TINY Template</strong></a>: Micro instance template comparison</li><li><a href=/docs/pgsql/config/cluster#sync-standby>Sync Standby</a>: Sync replication configuration</li><li><a href=/docs/pgsql/config/cluster#quorum-commit>Quorum Commit</a>: Higher consistency level</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-609856237df74f1f0f6e5fba1111e545>5 - TINY Template</h1><div class=lead>PostgreSQL config template optimized for micro instances and resource-constrained environments</div><p><code>tiny.yml</code> is optimized for <strong>micro instances</strong> and resource-constrained environments. Designed for 1-3 core CPUs with minimal resource usage, conservative memory allocation, and disabled parallel queries.</p><blockquote><p>Pair with <a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a> = <code>tiny</code> for OS-level tuning.</p></blockquote><hr><h2 id=use-cases>Use Cases</h2><p>TINY template is ideal for:</p><ul><li><strong>Dev/test</strong>: Local development, CI/CD testing</li><li><strong>Low-spec VMs</strong>: 1-2 core CPU, 1-4GB RAM cloud instances</li><li><strong>Edge computing</strong>: Raspberry Pi, embedded devices</li><li><strong>Demos</strong>: Quick Pigsty experience</li><li><strong>Personal projects</strong>: Resource-limited blogs, small apps</li></ul><p><strong>Resource constraints</strong>:</p><ul><li>1-3 CPU cores</li><li>1-8 GB RAM</li><li>Limited disk space</li><li>May share resources with other services</li></ul><hr><h2 id=usage>Usage</h2><p>Specify <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> = <code>tiny.yml</code> in cluster definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-dev</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-dev</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL micro instance template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS micro instance tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Single-node development:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>127.0.0.1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-local</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL micro instance template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS micro instance tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=parameter-details>Parameter Details</h2><h3 id=connection-management>Connection Management</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_connections: 250   # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500-1000</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>reduced connection overhead</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>superuser_reserved_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Micro instances don&rsquo;t need many concurrent connections; 250 is sufficient for dev/test.</p><h3 id=memory-config>Memory Config</h3><p>TINY template uses conservative memory allocation:</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>Formula</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>shared_buffers</code></td><td style=text-align:left>mem × <code>pg_shared_buffer_ratio</code></td><td style=text-align:left>Default ratio 0.25</td></tr><tr><td style=text-align:left><code>maintenance_work_mem</code></td><td style=text-align:left>shared_buffers × 25%</td><td style=text-align:left>For VACUUM, CREATE INDEX</td></tr><tr><td style=text-align:left><code>work_mem</code></td><td style=text-align:left>16MB - <strong>256MB</strong></td><td style=text-align:left>Smaller sort/hash memory</td></tr><tr><td style=text-align:left><code>effective_cache_size</code></td><td style=text-align:left>total mem - shared_buffers</td><td style=text-align:left>Estimated cache memory</td></tr></tbody></table><p><strong>work_mem calculation</strong> (differs from OLTP):</p><pre tabindex=0><code>work_mem = min(max(shared_buffers / max_connections, 16MB), 256MB)
</code></pre><p>Smaller <code>work_mem</code> limit (256MB vs OLTP&rsquo;s 1GB) prevents memory exhaustion.</p><h3 id=parallel-query-fully-disabled>Parallel Query (Fully Disabled)</h3><p>TINY template completely disables parallel queries:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_worker_processes: cpu + 4 (min 12)      # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cpu + 8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_workers: 50% × cpu (min 1)      # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#000>% (min 2)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_workers_per_gather</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># parallel queries disabled</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_parallel_maintenance_workers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000>% × cpu (min 1)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>max_parallel_workers_per_gather: 0</code> ensures queries won&rsquo;t spawn parallel workers, avoiding resource contention on low-core systems.</p><h3 id=io-config-pg17>IO Config (PG17+)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>io_workers: 3   # fixed value, OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000>% cpu (4-16)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Fixed low IO worker count suitable for resource-constrained environments.</p><h3 id=vacuum-config>Vacuum Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vacuum_cost_delay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vacuum_cost_limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_max_workers: 2          # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>one fewer worker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>autovacuum_naptime</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1min</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># autovacuum_vacuum_scale_factor uses default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># autovacuum_analyze_scale_factor uses default</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Fewer autovacuum workers reduce background resource usage.</p><h3 id=query-optimization>Query Optimization</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>random_page_cost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1.1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>effective_io_concurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>default_statistics_target: 200     # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>lower precision saves space</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Lower <code>default_statistics_target</code> reduces <code>pg_statistic</code> table size.</p><h3 id=logging-config>Logging Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_min_duration_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># same as OLTP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ddl</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_checkpoints</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_lock_waits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_temp_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># log_connections uses default (no extra logging)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>TINY template doesn&rsquo;t enable extra connection logging to reduce log volume.</p><h3 id=client-timeouts>Client Timeouts</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>deadlock_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>50ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>idle_in_transaction_session_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>10min  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># same as OLTP</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=extension-config>Extension Config</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>shared_preload_libraries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.max: 2500      # OLTP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10000</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>reduced memory usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.track</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.track_utility</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>off</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements.track_planning</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>off</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>pg_stat_statements.max</code> reduced from 10000 to 2500, saving ~75% memory.</p><hr><h2 id=key-differences-from-oltp>Key Differences from OLTP</h2><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left><a href=tiny><strong>TINY</strong></a></th><th style=text-align:left><a href=oltp><strong>OLTP</strong></a></th><th style=text-align:left>Reason</th></tr></thead><tbody><tr><td style=text-align:left>max_connections</td><td style=text-align:left><strong>250</strong></td><td style=text-align:left>500-1000</td><td style=text-align:left>Reduce connection overhead</td></tr><tr><td style=text-align:left>work_mem limit</td><td style=text-align:left><strong>256MB</strong></td><td style=text-align:left>1GB</td><td style=text-align:left>Prevent memory exhaustion</td></tr><tr><td style=text-align:left>max_worker_processes</td><td style=text-align:left>cpu+4</td><td style=text-align:left>cpu+8</td><td style=text-align:left>Fewer background processes</td></tr><tr><td style=text-align:left>max_parallel_workers_per_gather</td><td style=text-align:left><strong>0</strong></td><td style=text-align:left>20% cpu</td><td style=text-align:left>Disable parallel queries</td></tr><tr><td style=text-align:left>autovacuum_max_workers</td><td style=text-align:left><strong>2</strong></td><td style=text-align:left>3</td><td style=text-align:left>Reduce background load</td></tr><tr><td style=text-align:left>default_statistics_target</td><td style=text-align:left><strong>200</strong></td><td style=text-align:left>400</td><td style=text-align:left>Save space</td></tr><tr><td style=text-align:left>pg_stat_statements.max</td><td style=text-align:left><strong>2500</strong></td><td style=text-align:left>10000</td><td style=text-align:left>Reduce memory usage</td></tr><tr><td style=text-align:left>io_workers</td><td style=text-align:left><strong>3</strong></td><td style=text-align:left>25% cpu</td><td style=text-align:left>Fixed low value</td></tr></tbody></table><hr><h2 id=resource-estimates>Resource Estimates</h2><p>TINY template resource usage by configuration:</p><h3 id=1-core-1gb-ram>1 Core 1GB RAM</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>shared_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~256MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~16MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>maintenance_work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~64MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_worker_processes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~12</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>PostgreSQL process memory</strong>: ~400-600MB</p><h3 id=2-core-4gb-ram>2 Core 4GB RAM</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>shared_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~1GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~32MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>maintenance_work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~256MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_worker_processes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>~12</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>PostgreSQL process memory</strong>: ~1.5-2GB</p><h3 id=4-core-8gb-ram>4 Core 8GB RAM</h3><p>Consider using OLTP template instead:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-small</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp.yml  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 4C8G can use OLTP template</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=performance-tuning-tips>Performance Tuning Tips</h2><h3 id=further-resource-reduction>Further Resource Reduction</h3><p>For extremely constrained resources:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>max_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># further reduce</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>shared_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>128MB         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># further reduce</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>maintenance_work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>32MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>8MB</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=disable-unnecessary-extensions>Disable Unnecessary Extensions</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># keep only essential extensions</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=disable-unnecessary-features>Disable Unnecessary Features</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>track_io_timing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>off</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># disable IO timing tracking</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>track_functions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>none         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># disable function tracking</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=use-external-connection-pool>Use External Connection Pool</h3><p>Even on micro instances, PgBouncer significantly improves concurrency:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-tiny</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_default_service_dest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbouncer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer_poolmode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=cloud-platform-recommendations>Cloud Platform Recommendations</h2><h3 id=aws>AWS</h3><ul><li><strong>t3.micro</strong>: 1 vCPU, 1GB RAM - suitable for TINY</li><li><strong>t3.small</strong>: 2 vCPU, 2GB RAM - suitable for TINY</li><li><strong>t3.medium</strong>: 2 vCPU, 4GB RAM - consider OLTP</li></ul><h3 id=alibaba-cloud>Alibaba Cloud</h3><ul><li><strong>ecs.t6-c1m1.small</strong>: 1 vCPU, 1GB RAM - suitable for TINY</li><li><strong>ecs.t6-c1m2.small</strong>: 1 vCPU, 2GB RAM - suitable for TINY</li><li><strong>ecs.t6-c1m4.small</strong>: 1 vCPU, 4GB RAM - suitable for TINY</li></ul><h3 id=tencent-cloud>Tencent Cloud</h3><ul><li><strong>SA2.SMALL1</strong>: 1 vCPU, 1GB RAM - suitable for TINY</li><li><strong>SA2.SMALL2</strong>: 1 vCPU, 2GB RAM - suitable for TINY</li><li><strong>SA2.SMALL4</strong>: 1 vCPU, 4GB RAM - suitable for TINY</li></ul><hr><h2 id=edge-device-deployment>Edge Device Deployment</h2><h3 id=raspberry-pi-4>Raspberry Pi 4</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-pi</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>192.168.1.100</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-pi</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny.yml      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL micro instance template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS micro instance tuning</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_storage_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>SSD   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># SSD storage recommended</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=docker-container>Docker Container</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-docker</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>172.17.0.2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny.yml      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PostgreSQL micro instance template</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tiny        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># OS micro instance tuning</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=upgrading-to-oltp>Upgrading to OLTP</h2><p>When your application grows and needs more resources, easily upgrade to <a href=oltp><strong>OLTP template</strong></a>:</p><ol><li>Upgrade VM specs (4 core 8GB+)</li><li>Modify cluster config:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-growing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># change from tiny.yml to oltp.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># change from tiny to oltp</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ol start=3><li><a href=/docs/pgsql/admin#configure-cluster>Reconfigure cluster</a> or redeploy</li></ol><hr><h2 id=references>References</h2><ul><li><a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a>: PostgreSQL config template selection</li><li><a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a>: OS tuning template, should match <code>pg_conf</code></li><li><a href=oltp><strong>OLTP Template</strong></a>: Transaction template, upgrade for 4C8G+</li><li><a href=olap><strong>OLAP Template</strong></a>: Analytics template</li><li><a href=crit><strong>CRIT Template</strong></a>: Critical business template</li><li><a href=/docs/setup/install#single-node-install>Single-Node Install</a>: Pigsty single-node installation guide</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>