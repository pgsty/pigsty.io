<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/pg_exporter/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/pg_exporter/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>PG Exporter | PIGSTY</title><meta name=description content="Advanced PostgreSQL & pgBouncer Metrics Exporter for Prometheus"><meta property="og:url" content="https://pigsty.io/docs/pg_exporter/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="PG Exporter"><meta property="og:description" content="Advanced PostgreSQL & pgBouncer Metrics Exporter for Prometheus"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="PG Exporter"><meta itemprop=description content="Advanced PostgreSQL & pgBouncer Metrics Exporter for Prometheus"><meta itemprop=dateModified content="2026-01-16T00:53:35+08:00"><meta itemprop=wordCount content="407"><meta name=twitter:card content="summary"><meta name=twitter:title content="PG Exporter"><meta name=twitter:description content="Advanced PostgreSQL & pgBouncer Metrics Exporter for Prometheus"><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/pg_exporter/>Return to the regular view of this page</a>.</p></div><h1 class=title>PG Exporter</h1><div class=lead>Advanced PostgreSQL & pgBouncer Metrics Exporter for Prometheus</div><ul><li>1: <a href=#pg-416779b927fdf2fa5bc082ae68cec4fa>Getting Started</a></li><li>2: <a href=#pg-b9b6ba4bbd74b45a60bb542f3916c5e9>Installation</a></li><li>3: <a href=#pg-2f867767b775498210979b35165c4390>Configuration</a></li><li>4: <a href=#pg-675a152e2a26dbcc46c98b2d6b49d625>API Reference</a></li><li>5: <a href=#pg-403a539868ecb0c6cbcc02f03ee09c43>Deployment</a></li><li>6: <a href=#pg-6422ba42493572f811549fcad2c81178>Release Notes</a></li></ul><div class=content><p>The ultimate monitoring experience for PostgreSQL with <strong>600+ metrics</strong>, <strong>declarative configuration</strong>, and <strong>dynamic planning</strong> capabilities.</p><p><a href=start><strong>Get Started</strong></a> | <a href=https://github.com/pgsty/pg_exporter><strong>GitHub</strong></a> | <a href=https://g.pgsty.com><strong>Live Demo</strong></a></p><hr><h2 id=features>Features</h2><table><thead><tr><th>Feature</th><th>Description</th></tr></thead><tbody><tr><td><strong>Comprehensive Metrics</strong></td><td>Monitor PostgreSQL (10-18+) and pgBouncer (1.8-1.24+) with 600+ metrics and ~3K time series per instance</td></tr><tr><td><strong>Declarative Configuration</strong></td><td>Define custom metrics through YAML configs with fine-grained control over timeout, caching, and skip conditions</td></tr><tr><td><strong>Custom Collectors</strong></td><td>Define your own metrics with declarative YAML configuration and dynamic query planning</td></tr><tr><td><strong>Auto-Discovery</strong></td><td>Automatically discover and monitor multiple databases within a PostgreSQL instance</td></tr><tr><td><strong>Dynamic Planning</strong></td><td>Automatically adapt metric collection based on PostgreSQL version, extensions, and server characteristics</td></tr><tr><td><strong>Production Ready</strong></td><td>Battle-tested in real-world environments across 12K+ cores for 6+ years with enterprise reliability</td></tr><tr><td><strong>Health Check APIs</strong></td><td>Comprehensive HTTP endpoints for service health and traffic routing with primary/replica detection</td></tr><tr><td><strong>Smart Caching</strong></td><td>Built-in caching mechanism with configurable TTL to reduce database load and improve performance</td></tr><tr><td><strong>Extension Aware</strong></td><td>Native support for TimescaleDB, Citus, pg_stat_statements, pg_wait_sampling and automatic detection</td></tr></tbody></table><hr><h2 id=installation>Installation</h2><p>PG Exporter provides multiple <a href=install>install</a> methods to fit your infrastructure:</p><ul class="nav nav-tabs" id=tabs-0 role=tablist><li class=nav-item><button class="nav-link disabled" id=tabs-00-00-tab data-bs-toggle=tab data-bs-target=#tabs-00-00 role=tab aria-controls=tabs-00-00 aria-selected=false>
Installation</button></li><li class=nav-item><button class="nav-link active" id=tabs-00-01-tab data-bs-toggle=tab data-bs-target=#tabs-00-01 role=tab aria-controls=tabs-00-01 aria-selected=true>
Docker</button></li><li class=nav-item><button class=nav-link id=tabs-00-02-tab data-bs-toggle=tab data-bs-target=#tabs-00-02 role=tab aria-controls=tabs-00-02 aria-selected=false>
YUM</button></li><li class=nav-item><button class=nav-link id=tabs-00-03-tab data-bs-toggle=tab data-bs-target=#tabs-00-03 role=tab aria-controls=tabs-00-03 aria-selected=false>
APT</button></li><li class=nav-item><button class=nav-link id=tabs-00-04-tab data-bs-toggle=tab data-bs-target=#tabs-00-04 role=tab aria-controls=tabs-00-04 aria-selected=false>
Binary</button></li><li class=nav-item><button class=nav-link id=tabs-00-05-tab data-bs-toggle=tab data-bs-target=#tabs-00-05 role=tab aria-controls=tabs-00-05 aria-selected=false>
Source</button></li></ul><div class=tab-content id=tabs-0-content><div class="tab-pane fade" id=tabs-00-00 role=tabpanel aria-labelled-by=tabs-00-00-tab tabindex=0><pre tabindex=0><code></code></pre></div><div class="tab-pane fade show active" id=tabs-00-01 role=tabpanel aria-labelled-by=tabs-00-01-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name pg_exporter -p 9630:9630 -e <span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:pass@host:5432/postgres&#34;</span> pgsty/pg_exporter:latest</span></span></code></pre></div></div><div class="tab-pane fade" id=tabs-00-02 role=tabpanel aria-labelled-by=tabs-00-02-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># RPM-based systems</span>
</span></span><span style=display:flex><span>sudo tee /etc/yum.repos.d/pigsty-infra.repo &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>[pigsty-infra]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>name=Pigsty Infra for $basearch
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>baseurl=https://repo.pigsty.io/yum/infra/$basearch
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>enabled = 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>gpgcheck = 0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>module_hotfixes=1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo yum makecache<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>sudo yum install -y pg_exporter</span></span></code></pre></div></div><div class="tab-pane fade" id=tabs-00-03 role=tabpanel aria-labelled-by=tabs-00-03-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tee /etc/apt/sources.list.d/pigsty-infra.list &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deb [trusted=yes] https://repo.pigsty.io/apt/infra generic main
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt update<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>sudo apt install -y pg-exporter</span></span></code></pre></div></div><div class="tab-pane fade" id=tabs-00-04 role=tabpanel aria-labelled-by=tabs-00-04-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>tar -xf pg_exporter-1.1.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>sudo install pg_exporter-1.1.2.linux-amd64/pg_exporter /usr/bin/
</span></span><span style=display:flex><span>sudo install pg_exporter-1.1.2.linux-amd64/pg_exporter.yml /etc/pg_exporter.yml</span></span></code></pre></div></div><div class="tab-pane fade" id=tabs-00-05 role=tabpanel aria-labelled-by=tabs-00-05-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build from source</span>
</span></span><span style=display:flex><span>git clone https://github.com/pgsty/pg_exporter.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> pg_exporter
</span></span><span style=display:flex><span>make build</span></span></code></pre></div></div></div><hr><h2 id=quick-start>Quick Start</h2><p>Get PG Exporter up and running in minutes, <a href=start>Getting Started</a> with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run with PostgreSQL URL</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://user:pass@localhost:5432/postgres&#39;</span> pg_exporter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Access metrics</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/metrics
</span></span></code></pre></div><hr><h2 id=documentation>Documentation</h2><ul><li><a href=start><strong>Getting Started</strong></a> - Quick start guide and basic concepts</li><li><a href=install><strong>Installation</strong></a> - Installation instructions for all platforms</li><li><a href=config><strong>Configuration</strong></a> - Configuration reference and examples</li><li><a href=deploy><strong>Deployment</strong></a> - Production deployment best practices</li><li><a href=https://github.com/pgsty/pg_exporter/tree/main/config><strong>Collectors</strong></a> - Detailed documentation for all metric collectors</li></ul><hr><h2 id=live-demo>Live Demo</h2><p>Experience PG Exporter in action with our live demo environment: <strong><a href=https://g.pgsty.com>https://g.pgsty.com</a></strong></p><p>The demo showcases real PostgreSQL clusters monitored by PG Exporter, featuring:</p><ul><li>Real-time metrics visualization with Grafana</li><li>Multiple PostgreSQL versions and configurations</li><li>Extension-specific metrics and monitoring</li><li>Complete observability stack powered by <a href=https://pgsty.com>Pigsty</a></li></ul><hr><h2 id=community--support>Community & Support</h2><ul><li><a href=https://github.com/pgsty/pg_exporter><strong>GitHub</strong></a> - Source code, issues, and contributions</li><li><a href=https://github.com/pgsty/pg_exporter/discussions><strong>Discussions</strong></a> - Ask questions and share experiences</li><li><a href=https://pgsty.com><strong>Pigsty</strong></a> - Complete PostgreSQL Distro with PG Exporter</li></ul><hr><h2 id=license>License</h2><p>PG Exporter is open-source software licensed under the <a href=https://github.com/pgsty/pg_exporter/blob/main/LICENSE>Apache License 2.0</a>.</p><p>Copyright 2018-2025 © <a href=https://vonng.com/en>Ruohang Feng</a> / <a href=mailto:rh@vonng.com>rh@vonng.com</a></p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-416779b927fdf2fa5bc082ae68cec4fa>1 - Getting Started</h1><p>PG Exporter is an advanced PostgreSQL and pgBouncer metrics exporter for Prometheus. This guide will help you get up and running quickly.</p><h2 id=prerequisites>Prerequisites</h2><p>Before you begin, ensure you have:</p><ul><li>PostgreSQL 10+ or pgBouncer 1.8+ instance to monitor</li><li>A user account with appropriate permissions for monitoring</li><li>Prometheus Compatible System (for metrics scraping)</li><li>Basic understanding of PostgreSQL connection strings</li></ul><h2 id=quick-start>Quick Start</h2><p>The fastest way to get started with PG Exporter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Download and install the latest release</span>
</span></span><span style=display:flex><span>curl -L https://github.com/pgsty/pg_exporter/releases/latest/download/pg_exporter-<span style=color:#204a87;font-weight:700>$(</span>uname -s<span style=color:#204a87;font-weight:700>)</span>-<span style=color:#204a87;font-weight:700>$(</span>uname -m<span style=color:#204a87;font-weight:700>)</span>.tar.gz <span style=color:#000;font-weight:700>|</span> tar xz
</span></span><span style=display:flex><span>sudo install pg_exporter /usr/bin/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run with PostgreSQL connection URL</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://user:pass@localhost:5432/postgres&#39;</span> pg_exporter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Verify metrics are available</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/metrics
</span></span></code></pre></div><h2 id=understanding-the-basics>Understanding the Basics</h2><h3 id=connection-string>Connection String</h3><p>PG Exporter uses standard PostgreSQL connection URLs:</p><pre tabindex=0><code>postgres://[user][:password]@[host][:port]/[database][?param=value]
</code></pre><p>Examples:</p><ul><li>Local PostgreSQL: <code>postgres:///postgres</code></li><li>Remote with auth: <code>postgres://monitor:password@db.example.com:5432/postgres</code></li><li>With SSL: <code>postgres://user:pass@host/db?sslmode=require</code></li><li>pgBouncer: <code>postgres://pgbouncer:password@localhost:6432/pgbouncer</code></li></ul><h3 id=built-in-metrics>Built-in Metrics</h3><p>PG Exporter provides 4 core built-in metrics out of the box:</p><table><thead><tr><th>Metric</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>pg_up</code></td><td>Gauge</td><td>1 if exporter can connect to PostgreSQL, 0 otherwise</td></tr><tr><td><code>pg_version</code></td><td>Gauge</td><td>PostgreSQL server version number</td></tr><tr><td><code>pg_in_recovery</code></td><td>Gauge</td><td>1 if server is in recovery mode (replica), 0 if primary</td></tr><tr><td><code>pg_exporter_build_info</code></td><td>Gauge</td><td>Exporter version and build information</td></tr></tbody></table><h3 id=configuration-file>Configuration File</h3><p>All other metrics (600+) are defined in the <code>pg_exporter.yml</code> configuration file. By default, PG Exporter looks for this file in:</p><ol><li>Path specified by <code>--config</code> flag</li><li>Path in <code>PG_EXPORTER_CONFIG</code> environment variable</li><li>Current directory (<code>./pg_exporter.yml</code>)</li><li>System config (<code>/etc/pg_exporter.yml</code> or <code>/etc/pg_exporter/</code>)</li></ol><h2 id=your-first-monitoring-setup>Your First Monitoring Setup</h2><h3 id=step-1-create-a-monitoring-user>Step 1: Create a Monitoring User</h3><p>Create a dedicated PostgreSQL user for monitoring:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Create monitoring user
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WITH</span><span style=color:#f8f8f8> </span><span style=color:#000>PASSWORD</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;secure_password&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Grant necessary permissions
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CONNECT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- For PostgreSQL 10+, pg_monitor role provides read access to monitoring views
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- For older versions, you may need additional grants
</span></span></span></code></pre></div><h3 id=step-2-test-connection>Step 2: Test Connection</h3><p>Verify the exporter can connect to your database:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set connection URL</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://pg_monitor:secure_password@localhost:5432/postgres&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run in dry-run mode to test configuration</span>
</span></span><span style=display:flex><span>pg_exporter --dry-run
</span></span></code></pre></div><h3 id=step-3-run-the-exporter>Step 3: Run the Exporter</h3><p>Start PG Exporter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Run with default settings</span>
</span></span><span style=display:flex><span>pg_exporter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Or with custom flags</span>
</span></span><span style=display:flex><span>pg_exporter <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --url<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://pg_monitor:secure_password@localhost:5432/postgres&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --web.listen-address<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;:9630&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --log.level<span style=color:#ce5c00;font-weight:700>=</span>info
</span></span></code></pre></div><h3 id=step-4-configure-prometheus>Step 4: Configure Prometheus</h3><p>Add PG Exporter as a target in your <code>prometheus.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>scrape_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>job_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;postgresql&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>static_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>targets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;localhost:9630&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>instance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;postgres-primary&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=step-5-verify-metrics>Step 5: Verify Metrics</h3><p>Check that metrics are being collected:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View raw metrics</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/metrics <span style=color:#000;font-weight:700>|</span> grep pg_
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check exporter statistics</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/stat
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Verify server detection</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/explain
</span></span></code></pre></div><h2 id=auto-discovery-mode>Auto-Discovery Mode</h2><p>PG Exporter can automatically discover and monitor all databases in a PostgreSQL instance:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Enable auto-discovery (default behavior)</span>
</span></span><span style=display:flex><span>pg_exporter --auto-discovery
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Exclude specific databases</span>
</span></span><span style=display:flex><span>pg_exporter --auto-discovery <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --exclude-database<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;template0,template1,postgres&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Include only specific databases</span>
</span></span><span style=display:flex><span>pg_exporter --auto-discovery <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --include-database<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;app_db,analytics_db&#34;</span>
</span></span></code></pre></div><p>When auto-discovery is enabled:</p><ul><li>Cluster-level metrics (1xx-5xx) are collected once per instance</li><li>Database-level metrics (6xx-8xx) are collected for each discovered database</li><li>Metrics are labeled with <code>datname</code> to distinguish between databases</li></ul><h2 id=monitoring-pgbouncer>Monitoring pgBouncer</h2><p>To monitor pgBouncer instead of PostgreSQL:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Connect to pgBouncer admin database</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://pgbouncer:password@localhost:6432/pgbouncer&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>pg_exporter --config<span style=color:#ce5c00;font-weight:700>=</span>/etc/pg_exporter.yml
</span></span></code></pre></div><p>The exporter automatically detects pgBouncer and:</p><ul><li>Uses <code>pgbouncer</code> namespace for metrics</li><li>Executes pgBouncer-specific collectors (9xx series)</li><li>Provides pgBouncer-specific health checks</li></ul><h2 id=using-docker>Using Docker</h2><p>Run PG Exporter in a container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --name pg_exporter <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -p 9630:9630 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:pass@host.docker.internal:5432/postgres&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  pgsty/pg_exporter:latest
</span></span></code></pre></div><p>With custom configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --name pg_exporter <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -p 9630:9630 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -v /path/to/pg_exporter.yml:/etc/pg_exporter.yml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:pass@db:5432/postgres&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  pgsty/pg_exporter:latest
</span></span></code></pre></div><h2 id=health-checks>Health Checks</h2><p>PG Exporter provides health check endpoints for load balancers and orchestrators:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Basic health check</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/up
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Returns: 200 if connected, 503 if not</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Primary detection</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/primary
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Returns: 200 if primary, 404 if replica, 503 if unknown</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replica detection</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/replica
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Returns: 200 if replica, 404 if primary, 503 if unknown</span>
</span></span></code></pre></div><h2 id=troubleshooting>Troubleshooting</h2><h3 id=connection-issues>Connection Issues</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test with detailed logging</span>
</span></span><span style=display:flex><span>pg_exporter --log.level<span style=color:#ce5c00;font-weight:700>=</span>debug --dry-run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check server planning</span>
</span></span><span style=display:flex><span>pg_exporter --explain
</span></span></code></pre></div><h3 id=permission-errors>Permission Errors</h3><p>Ensure the monitoring user has necessary permissions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Check current permissions
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_roles</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>rolname</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_monitor&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Grant additional permissions if needed
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USAGE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_catalog</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#f8f8f8> </span><span style=color:#000>TABLES</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_catalog</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=slow-scrapes>Slow Scrapes</h3><p>If scrapes are timing out:</p><ol><li>Check slow queries: <code>curl http://localhost:9630/stat</code></li><li>Adjust collector timeouts in configuration</li><li>Use caching for expensive queries (set <code>ttl</code> in collector config)</li><li>Disable expensive collectors if not needed</li></ol><h2 id=next-steps>Next Steps</h2><ul><li><a href=install>Installation Guide</a> - Detailed installation instructions for all platforms</li><li><a href=config>Configuration Reference</a> - Complete configuration documentation</li><li><a href=deploy>Deployment Guide</a> - Production deployment best practices</li><li><a href=api>API Reference</a> - Full API endpoint documentation</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b9b6ba4bbd74b45a60bb542f3916c5e9>2 - Installation</h1><div class=lead>How to download and install the pg_exporter</div><p>PG Exporter provides multiple installation methods to suit different deployment scenarios.
This guide covers all available installation options with detailed instructions for each platform.</p><h2 id=pigsty>Pigsty</h2><p>The easiest way to get started with <code>pg_exporter</code> is to use <a href=https://pigsty.io>Pigsty</a>,
which is a complete PostgreSQL distribution with built-in Observability best practices based on <code>pg_exporter</code>, Prometheus, and Grafana.
You don&rsquo;t even need to know any details about <code>pg_exporter</code>, it just gives you all the metrics and dashboard panels</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><h2 id=release>Release</h2><p>You can also download <code>pg_exporter</code> package (<code>RPM</code>/<code>DEB</code>/ Tarball) directly from the <a href=https://github.com/pgsty/pg_exporter/releases/latest>Latest GitHub Release Page</a>:</p><p><strong>v1.1.2 Release Files:</strong></p><table><thead><tr><th>Type</th><th>File</th></tr></thead><tbody><tr><td>DEB (amd64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg-exporter_1.1.2-1_amd64.deb>pg-exporter_1.1.2-1_amd64.deb</a></td></tr><tr><td>DEB (arm64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg-exporter_1.1.2-1_arm64.deb>pg-exporter_1.1.2-1_arm64.deb</a></td></tr><tr><td>DEB (ppc64le)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg-exporter_1.1.2-1_ppc64le.deb>pg-exporter_1.1.2-1_ppc64le.deb</a></td></tr><tr><td>RPM (aarch64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2-1.aarch64.rpm>pg_exporter-1.1.2-1.aarch64.rpm</a></td></tr><tr><td>RPM (x86_64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2-1.x86_64.rpm>pg_exporter-1.1.2-1.x86_64.rpm</a></td></tr><tr><td>RPM (ppc64le)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2-1.ppc64le.rpm>pg_exporter-1.1.2-1.ppc64le.rpm</a></td></tr><tr><td>Tarball (Linux amd64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2.linux-amd64.tar.gz>pg_exporter-1.1.2.linux-amd64.tar.gz</a></td></tr><tr><td>Tarball (Linux arm64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2.linux-arm64.tar.gz>pg_exporter-1.1.2.linux-arm64.tar.gz</a></td></tr><tr><td>Tarball (Linux ppc64le)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2.linux-ppc64le.tar.gz>pg_exporter-1.1.2.linux-ppc64le.tar.gz</a></td></tr><tr><td>Tarball (macOS amd64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2.darwin-amd64.tar.gz>pg_exporter-1.1.2.darwin-amd64.tar.gz</a></td></tr><tr><td>Tarball (macOS arm64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2.darwin-arm64.tar.gz>pg_exporter-1.1.2.darwin-arm64.tar.gz</a></td></tr><tr><td>Tarball (Windows amd64)</td><td><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/pg_exporter-1.1.2.windows-amd64.tar.gz>pg_exporter-1.1.2.windows-amd64.tar.gz</a></td></tr></tbody></table><p>You can install it directly with your OS package manager (<code>rpm</code>/<code>dpkg</code>), or even put the binary in your <code>$PATH</code>.</p><h2 id=repository>Repository</h2><p>The pig package is also available in the <a href=https://ext.pgsty.com/repo/infra><code>pigsty-infra</code></a> repo,
You can add the repo to your system, and install it with OS package manager:</p><h3 id=yum>YUM</h3><p>For EL distribution such as RHEL，RockyLinux，CentOS，Alma Linux，OracleLinux,&mldr;:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tee /etc/yum.repos.d/pigsty-infra.repo &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>[pigsty-infra]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>name=Pigsty Infra for $basearch
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>baseurl=https://repo.pigsty.io/yum/infra/$basearch
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>enabled = 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>gpgcheck = 0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>module_hotfixes=1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo yum makecache<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>sudo yum install -y pg_exporter
</span></span></code></pre></div><h3 id=apt>APT</h3><p>For Debian, Ubuntu and compatible Linux Distributions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tee /etc/apt/sources.list.d/pigsty-infra.list &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deb [trusted=yes] https://repo.pigsty.io/apt/infra generic main
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt update<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>sudo apt install -y pg-exporter
</span></span></code></pre></div><h2 id=docker>Docker</h2><p>We have prebuilt docker images for <code>amd64</code> and <code>arm64</code> architectures on docker hub: <a href=https://hub.docker.com/r/pgsty/pg_exporter>pgsty/pg_exporter</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Basic usage</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --name pg_exporter <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -p 9630:9630 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:password@host:5432/postgres&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  pgsty/pg_exporter:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># With custom configuration</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --name pg_exporter <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -p 9630:9630 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -v /path/to/pg_exporter.yml:/etc/pg_exporter.yml:ro <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_CONFIG</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/etc/pg_exporter.yml&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:password@host:5432/postgres&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  pgsty/pg_exporter:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># With auto-discovery enabled</span>
</span></span><span style=display:flex><span>docker run -d <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --name pg_exporter <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -p 9630:9630 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:password@host:5432/postgres&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_AUTO_DISCOVERY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>PG_EXPORTER_EXCLUDE_DATABASE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;template0,template1&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  pgsty/pg_exporter:latest
</span></span></code></pre></div><h2 id=binary>Binary</h2><p>The <code>pg_exporter</code> can be installed as a standalone binary.</p><h2 id=compatibility>Compatibility</h2><p>The current pg_exporter support PostgreSQL version 10 and above.
While it is designed to work with any PostgreSQL major version (back to 9.x).</p><p>The only problem to use with legacy version (9.6 and below) is that
we removed older metrics collector branches definition due to EOL.</p><p>You can always retrieve these legacy version of config files and use against historic versions of PostgreSQL</p><table><thead><tr><th>PostgreSQL Version</th><th>Support Status</th></tr></thead><tbody><tr><td>10 ~ 17</td><td>✅ Full Support</td></tr><tr><td>9.6-</td><td>⚠️ Legacy Conf</td></tr></tbody></table><p>pg_exporter works with pgbouncer 1.8+, Since <code>v1.8</code> is the first version with <code>SHOW</code> command support.</p><table><thead><tr><th>pgBouncer Version</th><th>Support Status</th></tr></thead><tbody><tr><td>1.8.x ~ 1.24.x</td><td>✅ Full Support</td></tr><tr><td>before 1.8.x</td><td>⚠️ No Metrics</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-2f867767b775498210979b35165c4390>3 - Configuration</h1><p>PG Exporter uses a powerful and flexible configuration system that allows you to define custom metrics, control collection behavior, and optimize performance.
This guide covers all aspects of configuration from basic setup to advanced customization.</p><h2 id=metrics-collectors>Metrics Collectors</h2><p>PG Exporter uses a declarative YAML configuration system that provides incredible flexibility and control over metric collection. This guide covers all aspects of configuring PG Exporter for your specific monitoring needs.</p><h2 id=configuration-overview>Configuration Overview</h2><p>PG Exporter&rsquo;s configuration is centered around <strong>collectors</strong> - individual metric queries with associated metadata. The configuration can be:</p><ul><li>A single monolithic YAML file (<code>pg_exporter.yml</code>)</li><li>A directory containing multiple YAML files (merged alphabetically)</li><li>Custom path specified via command-line or environment variable</li></ul><h2 id=configuration-loading>Configuration Loading</h2><p>PG Exporter searches for configuration in the following order:</p><ol><li>Command-line argument: <code>--config=/path/to/config</code></li><li>Environment variable: <code>PG_EXPORTER_CONFIG=/path/to/config</code></li><li>Current directory: <code>./pg_exporter.yml</code></li><li>System config file: <code>/etc/pg_exporter.yml</code></li><li>System config directory: <code>/etc/pg_exporter/</code></li></ol><h2 id=collector-structure>Collector Structure</h2><p>Each collector is a top-level object in the YAML configuration with a unique name and various properties:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>collector_branch_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Unique identifier for this collector</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>metric_namespace        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Metric prefix (defaults to branch name)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>desc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Collector description&#34;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Human-readable description</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>|                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># SQL query to execute</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>SELECT column1, column2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>FROM table</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Execution Control</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># Cache time-to-live in seconds</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># Query timeout in seconds</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>fatal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># If true, failure fails entire scrape</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>skip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># If true, collector is disabled</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Version Compatibility</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>min_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100000</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># Minimum PostgreSQL version (inclusive)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>max_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>999999</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># Maximum PostgreSQL version (exclusive)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Execution Tags</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>cluster, primary]      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Conditions for execution</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Predicate Queries (optional)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>predicate_queries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;check_function&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>predicate_query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        SELECT EXISTS (...)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Metric Definitions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>column_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GAUGE            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># GAUGE, COUNTER, LABEL, or DISCARD</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>rename: metric_name      # Optional</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>rename the metric</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Help text&#34;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Metric description</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># Default value if NULL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>scale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1000</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Scale factor for the value</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=core-configuration-elements>Core Configuration Elements</h2><h3 id=collector-branch-name>Collector Branch Name</h3><p>The top-level key uniquely identifies a collector across the entire configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_database</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Must be unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_db     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Actual metric namespace</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=query-definition>Query Definition</h3><p>The SQL query that retrieves metrics:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  SELECT 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    datname,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    numbackends,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    xact_commit,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    xact_rollback,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    blks_read,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    blks_hit
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  FROM pg_stat_database
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  WHERE datname NOT IN (&#39;template0&#39;, &#39;template1&#39;)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=metric-types>Metric Types</h3><p>Each column in the query result must be mapped to a metric type:</p><table><thead><tr><th>Usage</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>GAUGE</code></td><td>Instantaneous value that can go up or down</td><td>Current connections</td></tr><tr><td><code>COUNTER</code></td><td>Cumulative value that only increases</td><td>Total transactions</td></tr><tr><td><code>LABEL</code></td><td>Use as a Prometheus label</td><td>Database name</td></tr><tr><td><code>DISCARD</code></td><td>Ignore this column</td><td>Internal values</td></tr></tbody></table><h3 id=cache-control-ttl>Cache Control (TTL)</h3><p>The <code>ttl</code> parameter controls result caching:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Fast queries - minimal caching</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_activity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Cache for 1 second</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Expensive queries - longer caching</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_table_bloat</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3600</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Cache for 1 hour</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Best practices:</p><ul><li>Set TTL less than your scrape interval</li><li>Use longer TTL for expensive queries</li><li>TTL of 0 disables caching</li></ul><h3 id=timeout-control>Timeout Control</h3><p>Prevent queries from running too long:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.1</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 100ms default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 1 second for complex queries</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Disable timeout (not recommended)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=version-compatibility>Version Compatibility</h3><p>Control which PostgreSQL versions can run this collector:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>min_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100000</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># PostgreSQL 10.0+</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>max_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>140000</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Below PostgreSQL 14.0</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Version format: <code>MMMMMMPP00</code> where:</p><ul><li><code>MMMMMM</code> = Major version (6 digits)</li><li><code>PP</code> = Minor version (2 digits)</li><li>Examples: <code>100000</code> = 10.0, <code>130200</code> = 13.2, <code>160100</code> = 16.1</li></ul><h2 id=tag-system>Tag System</h2><p>Tags control when and where collectors execute:</p><h3 id=built-in-tags>Built-in Tags</h3><table><thead><tr><th>Tag</th><th>Description</th></tr></thead><tbody><tr><td><code>cluster</code></td><td>Execute once per PostgreSQL cluster</td></tr><tr><td><code>primary</code> / <code>master</code></td><td>Only on primary servers</td></tr><tr><td><code>standby</code> / <code>replica</code></td><td>Only on replica servers</td></tr><tr><td><code>pgbouncer</code></td><td>Only for pgBouncer connections</td></tr></tbody></table><h3 id=prefixed-tags>Prefixed Tags</h3><table><thead><tr><th>Prefix</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td><code>dbname:</code></td><td><code>dbname:postgres</code></td><td>Only on specific database</td></tr><tr><td><code>username:</code></td><td><code>username:monitor</code></td><td>Only with specific user</td></tr><tr><td><code>extension:</code></td><td><code>extension:pg_stat_statements</code></td><td>Only if extension installed</td></tr><tr><td><code>schema:</code></td><td><code>schema:public</code></td><td>Only if schema exists</td></tr><tr><td><code>not:</code></td><td><code>not:slow</code></td><td>NOT when exporter has tag</td></tr></tbody></table><h3 id=custom-tags>Custom Tags</h3><p>Pass custom tags to the exporter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pg_exporter --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;production,critical&#34;</span>
</span></span></code></pre></div><p>Then use in configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>expensive_metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>critical] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Only runs with &#39;critical&#39; tag</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=predicate-queries>Predicate Queries</h2><p>Execute conditional checks before main query:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>predicate_queries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Check pg_stat_statements&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>predicate_query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      SELECT EXISTS (
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        SELECT 1 FROM pg_extension 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        WHERE extname = &#39;pg_stat_statements&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      )</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The main query only executes if all predicates return <code>true</code>.</p><h2 id=metric-definition>Metric Definition</h2><h3 id=basic-definition>Basic Definition</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>numbackends</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GAUGE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Number of backends connected&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=advanced-options>Advanced Options</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>checkpoint_write_time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>COUNTER</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>rename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>write_time       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Rename metric</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>scale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.001</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># Convert ms to seconds</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Use 0 if NULL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Checkpoint write time in seconds&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=collector-organization>Collector Organization</h2><p>PG Exporter ships with pre-organized collectors:</p><table><thead><tr><th>Range</th><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>0xx</td><td>Documentation</td><td>Examples and documentation</td></tr><tr><td>1xx</td><td>Basic</td><td>Server info, settings, metadata</td></tr><tr><td>2xx</td><td>Replication</td><td>Replication, slots, receivers</td></tr><tr><td>3xx</td><td>Persistence</td><td>I/O, checkpoints, WAL</td></tr><tr><td>4xx</td><td>Activity</td><td>Connections, locks, queries</td></tr><tr><td>5xx</td><td>Progress</td><td>Vacuum, index creation progress</td></tr><tr><td>6xx</td><td>Database</td><td>Per-database statistics</td></tr><tr><td>7xx</td><td>Objects</td><td>Tables, indexes, functions</td></tr><tr><td>8xx</td><td>Optional</td><td>Expensive/optional metrics</td></tr><tr><td>9xx</td><td>pgBouncer</td><td>Connection pooler metrics</td></tr><tr><td>10xx+</td><td>Extensions</td><td>Extension-specific metrics</td></tr></tbody></table><h2 id=real-world-examples>Real-World Examples</h2><h3 id=simple-gauge-collector>Simple Gauge Collector</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>desc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Current database connections&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    SELECT 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      count(*) as total,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      count(*) FILTER (WHERE state = &#39;active&#39;) as active,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      count(*) FILTER (WHERE state = &#39;idle&#39;) as idle,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      count(*) FILTER (WHERE state = &#39;idle in transaction&#39;) as idle_in_transaction
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    FROM pg_stat_activity
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WHERE pid != pg_backend_pid()</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>total</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Total connections&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>active</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Active connections&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>idle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Idle connections&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>idle_in_transaction</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Idle in transaction&#34;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=counter-with-labels>Counter with Labels</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_table_stats</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>desc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Table statistics&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    SELECT 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      schemaname,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      tablename,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      n_tup_ins,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      n_tup_upd,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      n_tup_del,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      n_live_tup,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      n_dead_tup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    FROM pg_stat_user_tables</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>schemaname</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LABEL}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>tablename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LABEL}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>n_tup_ins</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: COUNTER, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Tuples inserted&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>n_tup_upd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: COUNTER, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Tuples updated&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>n_tup_del</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: COUNTER, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Tuples deleted&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>n_live_tup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Live tuples&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>n_dead_tup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Dead tuples&#34;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=version-specific-collector>Version-Specific Collector</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_wal_stats</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>desc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;WAL statistics (PG 14+)&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>min_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>140000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    SELECT 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      wal_records,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      wal_bytes,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      wal_buffers_full,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      wal_write_time,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      wal_sync_time
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    FROM pg_stat_wal</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>cluster]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>wal_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>COUNTER}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>wal_bytes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>COUNTER}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>wal_buffers_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>COUNTER}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>wal_write_time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: COUNTER, scale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.001</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>wal_sync_time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: COUNTER, scale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.001</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=extension-dependent-collector>Extension-Dependent Collector</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_stat_statements_metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>desc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Query performance statistics&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>extension:pg_stat_statements]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    SELECT 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      sum(calls) as total_calls,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      sum(total_exec_time) as total_time,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      sum(mean_exec_time * calls) / sum(calls) as mean_time
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    FROM pg_stat_statements</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>total_calls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>COUNTER}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>total_time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: COUNTER, scale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.001</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>mean_time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, scale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.001</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=custom-collectors>Custom Collectors</h2><h3 id=creating-your-own-metrics>Creating Your Own Metrics</h3><ol><li>Create a new YAML file in your config directory:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># /etc/pg_exporter/custom_metrics.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>app_metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>desc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Application-specific metrics&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    SELECT 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      (SELECT count(*) FROM users WHERE active = true) as active_users,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      (SELECT count(*) FROM orders WHERE created_at &gt; NOW() - &#39;1 hour&#39;::interval) as recent_orders,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      (SELECT avg(processing_time) FROM jobs WHERE completed_at &gt; NOW() - &#39;5 minutes&#39;::interval) as avg_job_time</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>active_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Currently active users&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>recent_orders</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Orders in last hour&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>avg_job_time</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage: GAUGE, description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Average job processing time&#34;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><ol start=2><li>Test your collector:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pg_exporter --explain --config<span style=color:#ce5c00;font-weight:700>=</span>/etc/pg_exporter/
</span></span></code></pre></div><h3 id=conditional-metrics>Conditional Metrics</h3><p>Use predicate queries for conditional metrics:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>partition_metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>desc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Partitioned table metrics&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>predicate_queries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Check if partitioning is used&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>predicate_query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        SELECT EXISTS (
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          SELECT 1 FROM pg_class 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          WHERE relkind = &#39;p&#39; LIMIT 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        )</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    SELECT 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      parent.relname as parent_table,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      count(*) as partition_count,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      sum(pg_relation_size(child.oid)) as total_size
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    FROM pg_inherits
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    JOIN pg_class parent ON parent.oid = pg_inherits.inhparent
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    JOIN pg_class child ON child.oid = pg_inherits.inhrelid
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WHERE parent.relkind = &#39;p&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    GROUP BY parent.relname</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ttl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>300</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>metrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>parent_table</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LABEL}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>partition_count</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GAUGE}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>total_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>usage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GAUGE}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=performance-optimization>Performance Optimization</h2><h3 id=query-optimization-tips>Query Optimization Tips</h3><ol><li><p><strong>Use appropriate TTL values</strong>:</p><ul><li>Fast queries: 1-10 seconds</li><li>Medium queries: 10-60 seconds</li><li>Expensive queries: 300-3600 seconds</li></ul></li><li><p><strong>Set realistic timeouts</strong>:</p><ul><li>Default: 100ms</li><li>Complex queries: 500ms-1s</li><li>Never disable timeout in production</li></ul></li><li><p><strong>Use cluster-level tags</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>cluster] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Run once per cluster, not per database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li><li><p><strong>Disable expensive collectors</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_table_bloat</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>skip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Disable if not needed</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li></ol><h3 id=monitoring-collector-performance>Monitoring Collector Performance</h3><p>Check collector execution statistics:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># View collector statistics</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/stat
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check which collectors are slow</span>
</span></span><span style=display:flex><span>curl http://localhost:9630/metrics <span style=color:#000;font-weight:700>|</span> grep pg_exporter_collector_duration
</span></span></code></pre></div><h2 id=troubleshooting-configuration>Troubleshooting Configuration</h2><h3 id=validate-configuration>Validate Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Dry run - shows parsed configuration</span>
</span></span><span style=display:flex><span>pg_exporter --dry-run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Explain - shows planned queries</span>
</span></span><span style=display:flex><span>pg_exporter --explain
</span></span></code></pre></div><h3 id=common-issues>Common Issues</h3><table><thead><tr><th>Problem</th><th>Solution</th></tr></thead><tbody><tr><td>Metrics missing</td><td>Check tags and version compatibility</td></tr><tr><td>Slow scrapes</td><td>Increase TTL, add timeout, disable expensive queries</td></tr><tr><td>High memory usage</td><td>Reduce result set size, use LIMIT</td></tr><tr><td>Permission errors</td><td>Verify query permissions for monitoring user</td></tr></tbody></table><h3 id=debug-logging>Debug Logging</h3><p>Enable debug logging to troubleshoot:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pg_exporter --log.level<span style=color:#ce5c00;font-weight:700>=</span>debug
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-675a152e2a26dbcc46c98b2d6b49d625>4 - API Reference</h1><p>PG Exporter provides a comprehensive REST API for metrics collection, health checking, traffic routing, and operational control. All endpoints are exposed via HTTP on the configured port (default: 9630).</p><h2 id=endpoint-overview>Endpoint Overview</h2><table><thead><tr><th>Endpoint</th><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><a href=#metrics><code>/metrics</code></a></td><td>GET</td><td>Prometheus metrics endpoint</td></tr><tr><td><a href=#health-checks><code>/up</code></a></td><td>GET</td><td>Basic aliveness check</td></tr><tr><td><a href=#health-checks><code>/health</code></a></td><td>GET</td><td>Detailed health status</td></tr><tr><td><a href=#traffic-routing><code>/primary</code></a></td><td>GET</td><td>Primary server check</td></tr><tr><td><a href=#traffic-routing><code>/replica</code></a></td><td>GET</td><td>Replica server check</td></tr><tr><td><a href=#traffic-routing><code>/read</code></a></td><td>GET</td><td>Read traffic routing</td></tr><tr><td><a href=#operational><code>/reload</code></a></td><td>GET</td><td>Reload configuration</td></tr><tr><td><a href=#operational><code>/explain</code></a></td><td>GET</td><td>Explain query planning</td></tr><tr><td><a href=#operational><code>/stat</code></a></td><td>GET</td><td>Runtime statistics</td></tr></tbody></table><h2 id=metrics-endpoint>Metrics Endpoint</h2><h3 id=get-metrics>GET /metrics</h3><p>The primary endpoint that exposes all collected metrics in Prometheus format.</p><h4 id=request>Request</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://localhost:9630/metrics
</span></span></code></pre></div><h4 id=response>Response</h4><pre tabindex=0><code class=language-prometheus data-lang=prometheus># HELP pg_up PostgreSQL server is up and accepting connections
# TYPE pg_up gauge
pg_up 1

# HELP pg_version PostgreSQL server version number
# TYPE pg_version gauge
pg_version 140000

# HELP pg_in_recovery PostgreSQL server is in recovery mode
# TYPE pg_in_recovery gauge
pg_in_recovery 0

# HELP pg_exporter_build_info PG Exporter build information
# TYPE pg_exporter_build_info gauge
pg_exporter_build_info{version=&#34;1.1.2&#34;,branch=&#34;main&#34;,revision=&#34;abc123&#34;} 1

# ... additional metrics
</code></pre><h4 id=response-format>Response Format</h4><p>Metrics follow the Prometheus exposition format:</p><pre tabindex=0><code># HELP &lt;metric_name&gt; &lt;description&gt;
# TYPE &lt;metric_name&gt; &lt;type&gt;
&lt;metric_name&gt;{&lt;label_name&gt;=&#34;&lt;label_value&gt;&#34;,...} &lt;value&gt; &lt;timestamp&gt;
</code></pre><h2 id=health-check-endpoints>Health Check Endpoints</h2><p>Health check endpoints provide various ways to monitor PG Exporter and the target database status.</p><h3 id=get-up>GET /up</h3><p>Simple binary health check.</p><h4 id=response-codes>Response Codes</h4><table><thead><tr><th>Code</th><th>Status</th><th>Description</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>Exporter and database are up</td></tr><tr><td>503</td><td>Service Unavailable</td><td>Database is down or unreachable</td></tr></tbody></table><h4 id=example>Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check if service is up</span>
</span></span><span style=display:flex><span>curl -I http://localhost:9630/up
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0000cf;font-weight:700>200</span> OK
</span></span><span style=display:flex><span>Content-Type: text/plain<span style=color:#000;font-weight:700>;</span> <span style=color:#000>charset</span><span style=color:#ce5c00;font-weight:700>=</span>utf-8
</span></span></code></pre></div><h3 id=get-health>GET /health</h3><p>Alias for <code>/up</code> with same behavior.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://localhost:9630/health
</span></span></code></pre></div><h3 id=get-liveness>GET /liveness</h3><p>Kubernetes liveness probe endpoint.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Liveness probe configuration</span>
</span></span><span style=display:flex><span>livenessProbe:
</span></span><span style=display:flex><span>  httpGet:
</span></span><span style=display:flex><span>    path: /liveness
</span></span><span style=display:flex><span>    port: <span style=color:#0000cf;font-weight:700>9630</span>
</span></span><span style=display:flex><span>  initialDelaySeconds: <span style=color:#0000cf;font-weight:700>30</span>
</span></span><span style=display:flex><span>  periodSeconds: <span style=color:#0000cf;font-weight:700>10</span>
</span></span></code></pre></div><h3 id=get-readiness>GET /readiness</h3><p>Kubernetes readiness probe endpoint.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Readiness probe configuration</span>
</span></span><span style=display:flex><span>readinessProbe:
</span></span><span style=display:flex><span>  httpGet:
</span></span><span style=display:flex><span>    path: /readiness
</span></span><span style=display:flex><span>    port: <span style=color:#0000cf;font-weight:700>9630</span>
</span></span><span style=display:flex><span>  initialDelaySeconds: <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>  periodSeconds: <span style=color:#0000cf;font-weight:700>5</span>
</span></span></code></pre></div><h2 id=traffic-routing-endpoints>Traffic Routing Endpoints</h2><p>These endpoints are designed for load balancers and proxies to route traffic based on server role.</p><h3 id=get-primary>GET /primary</h3><p>Check if the server is a primary (master) instance.</p><h4 id=response-codes-1>Response Codes</h4><table><thead><tr><th>Code</th><th>Status</th><th>Description</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>Server is primary and accepting writes</td></tr><tr><td>404</td><td>Not Found</td><td>Server is not primary (is replica)</td></tr><tr><td>503</td><td>Service Unavailable</td><td>Server is down</td></tr></tbody></table><h4 id=aliases>Aliases</h4><ul><li><code>/leader</code></li><li><code>/master</code></li><li><code>/read-write</code></li><li><code>/rw</code></li></ul><h4 id=example-1>Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check if server is primary</span>
</span></span><span style=display:flex><span>curl -I http://localhost:9630/primary
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Use in HAProxy configuration</span>
</span></span><span style=display:flex><span>backend pg_primary
</span></span><span style=display:flex><span>  option httpchk GET /primary
</span></span><span style=display:flex><span>  server pg1 10.0.0.1:5432 check port <span style=color:#0000cf;font-weight:700>9630</span>
</span></span><span style=display:flex><span>  server pg2 10.0.0.2:5432 check port <span style=color:#0000cf;font-weight:700>9630</span>
</span></span></code></pre></div><h3 id=get-replica>GET /replica</h3><p>Check if the server is a replica (standby) instance.</p><h4 id=response-codes-2>Response Codes</h4><table><thead><tr><th>Code</th><th>Status</th><th>Description</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>Server is replica and in recovery</td></tr><tr><td>404</td><td>Not Found</td><td>Server is not replica (is primary)</td></tr><tr><td>503</td><td>Service Unavailable</td><td>Server is down</td></tr></tbody></table><h4 id=aliases-1>Aliases</h4><ul><li><code>/standby</code></li><li><code>/slave</code></li><li><code>/read-only</code></li><li><code>/ro</code></li></ul><h4 id=example-2>Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check if server is replica</span>
</span></span><span style=display:flex><span>curl -I http://localhost:9630/replica
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Use in load balancer configuration</span>
</span></span><span style=display:flex><span>backend pg_replicas
</span></span><span style=display:flex><span>  option httpchk GET /replica
</span></span><span style=display:flex><span>  server pg2 10.0.0.2:5432 check port <span style=color:#0000cf;font-weight:700>9630</span>
</span></span><span style=display:flex><span>  server pg3 10.0.0.3:5432 check port <span style=color:#0000cf;font-weight:700>9630</span>
</span></span></code></pre></div><h3 id=get-read>GET /read</h3><p>Check if the server can handle read traffic (both primary and replica).</p><h4 id=response-codes-3>Response Codes</h4><table><thead><tr><th>Code</th><th>Status</th><th>Description</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>Server is up and can handle reads</td></tr><tr><td>503</td><td>Service Unavailable</td><td>Server is down</td></tr></tbody></table><h4 id=example-3>Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check if server can handle reads</span>
</span></span><span style=display:flex><span>curl -I http://localhost:9630/read
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Route read traffic to any available server</span>
</span></span><span style=display:flex><span>backend pg_read
</span></span><span style=display:flex><span>  option httpchk GET /read
</span></span><span style=display:flex><span>  server pg1 10.0.0.1:5432 check port <span style=color:#0000cf;font-weight:700>9630</span>
</span></span><span style=display:flex><span>  server pg2 10.0.0.2:5432 check port <span style=color:#0000cf;font-weight:700>9630</span>
</span></span><span style=display:flex><span>  server pg3 10.0.0.3:5432 check port <span style=color:#0000cf;font-weight:700>9630</span>
</span></span></code></pre></div><h2 id=operational-endpoints>Operational Endpoints</h2><h3 id=post-reload>POST /reload</h3><p>Reload configuration without restarting the exporter.</p><h4 id=request-1>Request</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST http://localhost:9630/reload
</span></span></code></pre></div><h4 id=response-1>Response</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;status&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;success&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Configuration reloaded successfully&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;timestamp&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2024-01-15T10:30:00Z&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=response-codes-4>Response Codes</h4><table><thead><tr><th>Code</th><th>Status</th><th>Description</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>Configuration reloaded successfully</td></tr><tr><td>500</td><td>Internal Server Error</td><td>Reload failed</td></tr></tbody></table><h4 id=use-cases>Use Cases</h4><ul><li>Update collector definitions</li><li>Change query parameters</li><li>Modify cache TTL values</li><li>Add or remove collectors</li></ul><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>Note</div><p>Configuration reload does not affect the database connection. To change connection parameters, restart the exporter.</p></div><h3 id=get-explain>GET /explain</h3><p>Display query execution planning information for all configured collectors.</p><h4 id=request-2>Request</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://localhost:9630/explain
</span></span></code></pre></div><h4 id=response-2>Response</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Collector: pg_stat_database
</span></span><span style=display:flex><span>  Query: SELECT datname, numbackends FROM pg_stat_database
</span></span><span style=display:flex><span>  Tags: [cluster]
</span></span><span style=display:flex><span>  TTL: 10s
</span></span><span style=display:flex><span>  Timeout: 100ms
</span></span><span style=display:flex><span>  Version: 100000-999999
</span></span><span style=display:flex><span>  Status: Active
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Collector: pg_stat_replication
</span></span><span style=display:flex><span>  Query: SELECT client_addr, state FROM pg_stat_replication
</span></span><span style=display:flex><span>  Tags: [primary]
</span></span><span style=display:flex><span>  TTL: 5s
</span></span><span style=display:flex><span>  Timeout: 100ms
</span></span><span style=display:flex><span>  Version: 100000-999999
</span></span><span style=display:flex><span>  Status: Active (primary only)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-403a539868ecb0c6cbcc02f03ee09c43>5 - Deployment</h1><p>This guide covers production deployment strategies, best practices, and real-world configurations for PG Exporter.</p><p>pg_exporter itself can be configured through:</p><ol><li><strong>Command-line arguments</strong> (higher priority)</li><li><strong>Environment variables</strong> (lower priority)</li></ol><p>The metrics collectors are configured with a YAML configuration file (dir/files):</p><ul><li><code>/etc/pg_exporter.yml</code> (default)</li><li><code>/etc/pg_exporter/</code> (directory with multiple files)</li></ul><p>The configuration file uses YAML format and consists of <strong>collector definitions</strong> that specify what metrics to collect and how to collect them.</p><h3 id=cli-arg>CLI Arg</h3><p>All configuration options can be specified via command-line flags:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pg_exporter <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --url<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;postgres://user:pass@localhost:5432/postgres&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --config<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/etc/pg_exporter/pg_exporter.yml&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --web.listen-address<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;:9630&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --auto-discovery <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --exclude-database<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;template0,template1&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --log.level<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;info&#34;</span>
</span></span></code></pre></div><p>Run <code>pg_exporter --help</code> for a complete list of available flags:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Flags:
</span></span><span style=display:flex><span>  -h, --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span><span style=color:#204a87>help</span>                Show context-sensitive <span style=color:#204a87>help</span> <span style=color:#ce5c00;font-weight:700>(</span>also try --help-long and --help-man<span style=color:#ce5c00;font-weight:700>)</span>.
</span></span><span style=display:flex><span>  -u, --url<span style=color:#ce5c00;font-weight:700>=</span>URL                  postgres target url
</span></span><span style=display:flex><span>  -c, --config<span style=color:#ce5c00;font-weight:700>=</span>CONFIG            path to config dir or file
</span></span><span style=display:flex><span>      --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>web.systemd-socket  Use systemd socket activation listeners instead of port listeners <span style=color:#ce5c00;font-weight:700>(</span>Linux only<span style=color:#ce5c00;font-weight:700>)</span>.
</span></span><span style=display:flex><span>      --web.listen-address<span style=color:#ce5c00;font-weight:700>=</span>:9630 ...
</span></span><span style=display:flex><span>                                 Addresses on which to expose metrics and web interface. Repeatable <span style=color:#204a87;font-weight:700>for</span> multiple addresses. Examples: <span style=color:#4e9a06>`</span>:9100<span style=color:#4e9a06>`</span> or <span style=color:#4e9a06>`</span><span style=color:#ce5c00;font-weight:700>[</span>::1<span style=color:#ce5c00;font-weight:700>]</span>:9100<span style=color:#4e9a06>`</span> <span style=color:#204a87;font-weight:700>for</span> http, <span style=color:#4e9a06>`</span>vsock://:9100<span style=color:#4e9a06>`</span> <span style=color:#204a87;font-weight:700>for</span> vsock
</span></span><span style=display:flex><span>      --web.config.file<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>       Path to configuration file that can <span style=color:#204a87>enable</span> TLS or authentication. See: https://github.com/prometheus/exporter-toolkit/blob/master/docs/web-configuration.md
</span></span><span style=display:flex><span>  -l, --label<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>                 constant lables:comma separated list of <span style=color:#000>label</span><span style=color:#ce5c00;font-weight:700>=</span>value pair <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_LABEL</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -t, --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>                   tags,comma separated list of server tag <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_TAG</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -C, --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>disable-cache       force not using cache <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_DISABLE_CACHE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -m, --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>disable-intro       disable collector level introspection metrics <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_DISABLE_INTRO</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -a, --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>auto-discovery      automatically scrape all database <span style=color:#204a87;font-weight:700>for</span> given server <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_AUTO_DISCOVERY</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -x, --exclude-database<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;template0,template1,postgres&#34;</span>
</span></span><span style=display:flex><span>                                 excluded databases when enabling auto-discovery <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_EXCLUDE_DATABASE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -i, --include-database<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>      included databases when enabling auto-discovery <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_INCLUDE_DATABASE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -n, --namespace<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>             prefix of built-in metrics, <span style=color:#ce5c00;font-weight:700>(</span>pg<span style=color:#000;font-weight:700>|</span>pgbouncer<span style=color:#ce5c00;font-weight:700>)</span> by default <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -f, --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>fail-fast           fail fast instead of waiting during start-up <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_FAIL_FAST</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -T, --connect-timeout<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>100</span>      connect timeout in ms, <span style=color:#0000cf;font-weight:700>100</span> by default <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_CONNECT_TIMEOUT</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -P, --web.telemetry-path<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/metrics&#34;</span>
</span></span><span style=display:flex><span>                                 URL path under which to expose metrics. <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$PG_EXPORTER_TELEMETRY_PATH</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  -D, --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>dry-run             dry run and print raw configs
</span></span><span style=display:flex><span>  -E, --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>explain             explain server planned queries
</span></span><span style=display:flex><span>      --log.level<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;info&#34;</span>         log level: debug<span style=color:#000;font-weight:700>|</span>info<span style=color:#000;font-weight:700>|</span>warn<span style=color:#000;font-weight:700>|</span>error<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>      --log.format<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;logfmt&#34;</span>      log format: logfmt<span style=color:#000;font-weight:700>|</span>json
</span></span><span style=display:flex><span>      --<span style=color:#ce5c00;font-weight:700>[</span>no-<span style=color:#ce5c00;font-weight:700>]</span>version             Show application version.
</span></span></code></pre></div><h3 id=environment-variables>Environment Variables</h3><p>All command-line arguments have corresponding environment variables:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://:5432/?sslmode=disable&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_CONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/etc/pg_exporter.yml
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_LABEL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_TAG</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_DISABLE_CACHE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_AUTO_DISCOVERY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_EXCLUDE_DATABASE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;template0,template1,postgres&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_INCLUDE_DATABASE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;pg&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_FAIL_FAST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_CONNECT_TIMEOUT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>100</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_TELEMETRY_PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/metrics&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_OPTS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;--log.level=info&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pg_exporter
</span></span></code></pre></div><h2 id=deployment-architecture>Deployment Architecture</h2><p>The simplest deployment with one exporter per PostgreSQL instance:</p><pre tabindex=0><code>┌─────────────┐     ┌──────────────┐     ┌────────────┐
│ Prometheus  │────▶│ PG Exporter  │────▶│ PostgreSQL │
└─────────────┘     └──────────────┘     └────────────┘
                         :9630                :5432
</code></pre><h3 id=multi-database-environment>Multi-Database Environment</h3><p>Using auto-discovery to monitor multiple databases, which is enabled by default</p><pre tabindex=0><code>┌─────────────┐     ┌────────────────┐     ┌────────────┐
│ Prometheus  │────▶│ PG Exporter    │────▶│ PostgreSQL │
└─────────────┘     │     with       │     │  ├─ db1    │
                    │ auto-discovery │     │  ├─ db2    │
                    └────────────────┘     │  └─ db3    │
                                           └────────────┘
</code></pre><h2 id=production-configuration>Production Configuration</h2><h3 id=postgresql-user-setup>PostgreSQL User Setup</h3><p>Create a dedicated monitoring user with minimal required permissions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Create monitoring role
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ROLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WITH</span><span style=color:#f8f8f8> </span><span style=color:#000>LOGIN</span><span style=color:#f8f8f8> </span><span style=color:#000>PASSWORD</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;strong_password&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CONNECTION</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>LIMIT</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Grant necessary permissions
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>-- PostgreSQL 10+ built-in role
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CONNECT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- For specific databases
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CONNECT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATABASE</span><span style=color:#f8f8f8> </span><span style=color:#000>app_db</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USAGE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- Additional permissions for extended monitoring
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#f8f8f8> </span><span style=color:#000>TABLES</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_catalog</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>GRANT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#f8f8f8> </span><span style=color:#000>SEQUENCES</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_catalog</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_monitor</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=connection-security>Connection Security</h3><h4 id=using-ssltls>Using SSL/TLS</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Connection string with SSL</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://pg_monitor:password@db.example.com:5432/postgres?sslmode=require&amp;sslcert=/path/to/client.crt&amp;sslkey=/path/to/client.key&amp;sslrootcert=/path/to/ca.crt&#39;</span>
</span></span></code></pre></div><h4 id=using-pgpass-file>Using .pgpass File</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create .pgpass file</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;db.example.com:5432:*:pg_monitor:password&#34;</span> &gt; ~/.pgpass
</span></span><span style=display:flex><span>chmod <span style=color:#0000cf;font-weight:700>600</span> ~/.pgpass
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Use without password in URL</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://pg_monitor@db.example.com:5432/postgres&#39;</span>
</span></span></code></pre></div><h2 id=systemd-service-configuration>Systemd Service Configuration</h2><p>Complete production systemd setup:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Unit]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Description</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Prometheus exporter for PostgreSQL/Pgbouncer server metrics</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Documentation</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>https://github.com/pgsty/pg_exporter</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>After</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>network.target</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Service]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>EnvironmentFile</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>-/etc/default/pg_exporter</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>User</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>prometheus</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>ExecStart</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/usr/bin/pg_exporter $PG_EXPORTER_OPTS</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Restart</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>on-failure</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Install]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>WantedBy</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>multi-user.target</span>
</span></span></code></pre></div><p>Environment file <code>/etc/default/pg_exporter</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>PG_EXPORTER_URL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;postgres://:5432/?sslmode=disable&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_CONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/etc/pg_exporter.yml
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_LABEL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_TAG</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_DISABLE_CACHE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_AUTO_DISCOVERY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_EXCLUDE_DATABASE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;template0,template1,postgres&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_INCLUDE_DATABASE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_NAMESPACE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;pg&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_FAIL_FAST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_CONNECT_TIMEOUT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>100</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_TELEMETRY_PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/metrics&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_OPTS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;--log.level=info&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-6422ba42493572f811549fcad2c81178>6 - Release Notes</h1><p>The latest stable version of <code>pg_exporter</code> is <a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.1.2>v1.1.2</a></p><table><thead><tr><th style=text-align:center>Version</th><th style=text-align:center>Date</th><th>Summary</th><th style=text-align:center>GitHub</th></tr></thead><tbody><tr><td style=text-align:center><a href=#v112>v1.1.2</a></td><td style=text-align:center>2026-01-16</td><td>fix pg_timeline conf issue, build with latest deps</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.1.2>v1.1.2</a></td></tr><tr><td style=text-align:center><a href=#v111>v1.1.1</a></td><td style=text-align:center>2025-12-30</td><td>New pg_timeline collector, pg_sub_16 branch, bug fixes</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.1.1>v1.1.1</a></td></tr><tr><td style=text-align:center><a href=#v110>v1.1.0</a></td><td style=text-align:center>2025-12-15</td><td>Update default metrics collectors, bump to go 1.25.5</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.1.0>v1.1.0</a></td></tr><tr><td style=text-align:center><a href=#v103>v1.0.3</a></td><td style=text-align:center>2025-11-20</td><td>Routine update on 1.25.4, fix unsupported libpq env</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.3>v1.0.3</a></td></tr><tr><td style=text-align:center><a href=#v102>v1.0.2</a></td><td style=text-align:center>2025-08-14</td><td>Build for more os arch with goreleaser</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.2>v1.0.2</a></td></tr><tr><td style=text-align:center><a href=#v101>v1.0.1</a></td><td style=text-align:center>2025-07-17</td><td>DockerHub images, Go 1.24.5, disable pg_tsdb_hypertable</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.1>v1.0.1</a></td></tr><tr><td style=text-align:center><a href=#v100>v1.0.0</a></td><td style=text-align:center>2025-05-06</td><td>PostgreSQL 18 support, new WAL/checkpointer/I/O metrics</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.0>v1.0.0</a></td></tr><tr><td style=text-align:center><a href=#v090>v0.9.0</a></td><td style=text-align:center>2025-04-26</td><td>TimescaleDB, Citus, pg_wait_sampling collectors</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.9.0>v0.9.0</a></td></tr><tr><td style=text-align:center><a href=#v081>v0.8.1</a></td><td style=text-align:center>2025-02-14</td><td>Dependencies update, docker image tags</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.8.1>v0.8.1</a></td></tr><tr><td style=text-align:center><a href=#v080>v0.8.0</a></td><td style=text-align:center>2025-02-14</td><td>PgBouncer 1.24 support, Go 1.24, logging refactor</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.8.0>v0.8.0</a></td></tr><tr><td style=text-align:center><a href=#v071>v0.7.1</a></td><td style=text-align:center>2024-12-29</td><td>Routine update, configuration as Reader support</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.7.1>v0.7.1</a></td></tr><tr><td style=text-align:center><a href=#v070>v0.7.0</a></td><td style=text-align:center>2024-08-13</td><td>PostgreSQL 17 support, predicate queries feature</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.7.0>v0.7.0</a></td></tr><tr><td style=text-align:center><a href=#v060>v0.6.0</a></td><td style=text-align:center>2023-10-18</td><td>PostgreSQL 16 support, ARM64 packages, security fixes</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.6.0>v0.6.0</a></td></tr><tr><td style=text-align:center><a href=#v050>v0.5.0</a></td><td style=text-align:center>2022-04-27</td><td>RPM/DEB builds, column scaling, metrics enhancements</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.5.0>v0.5.0</a></td></tr><tr><td style=text-align:center><a href=#v041>v0.4.1</a></td><td style=text-align:center>2022-03-08</td><td>Collector updates, connect-timeout parameter</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.4.1>v0.4.1</a></td></tr><tr><td style=text-align:center><a href=#v040>v0.4.0</a></td><td style=text-align:center>2021-07-12</td><td>PostgreSQL 14 support, auto-discovery feature</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.4.0>v0.4.0</a></td></tr><tr><td style=text-align:center><a href=#v032>v0.3.2</a></td><td style=text-align:center>2021-02-01</td><td>Shadow DSN fixes, documentation updates</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.3.2>v0.3.2</a></td></tr><tr><td style=text-align:center><a href=#v031>v0.3.1</a></td><td style=text-align:center>2020-12-04</td><td>Configuration fixes for older PostgreSQL versions</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.3.1>v0.3.1</a></td></tr><tr><td style=text-align:center><a href=#v030>v0.3.0</a></td><td style=text-align:center>2020-10-29</td><td>PostgreSQL 13 support, REST APIs, dummy server</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.3.0>v0.3.0</a></td></tr><tr><td style=text-align:center><a href=#v020>v0.2.0</a></td><td style=text-align:center>2020-03-21</td><td>YUM packages, configuration reload support</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.2.0>v0.2.0</a></td></tr><tr><td style=text-align:center><a href=#v012>v0.1.2</a></td><td style=text-align:center>2020-02-20</td><td>Dynamic configuration reload, bulky mode</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.1.2>v0.1.2</a></td></tr><tr><td style=text-align:center><a href=#v011>v0.1.1</a></td><td style=text-align:center>2020-01-10</td><td>Startup hang bug fix</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.1.1>v0.1.1</a></td></tr><tr><td style=text-align:center><a href=#v010>v0.1.0</a></td><td style=text-align:center>2020-01-08</td><td>Initial stable release</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.1.0>v0.1.0</a></td></tr><tr><td style=text-align:center><a href=#v004>v0.0.4</a></td><td style=text-align:center>2019-12-20</td><td>Production tested release</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.4>v0.0.4</a></td></tr><tr><td style=text-align:center><a href=#v003>v0.0.3</a></td><td style=text-align:center>2019-12-14</td><td>Production environment testing</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.3>v0.0.3</a></td></tr><tr><td style=text-align:center><a href=#v002>v0.0.2</a></td><td style=text-align:center>2019-12-09</td><td>Early testing release</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.2>v0.0.2</a></td></tr><tr><td style=text-align:center><a href=#v001>v0.0.1</a></td><td style=text-align:center>2019-12-06</td><td>Initial release with PgBouncer mode</td><td style=text-align:center><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.1>v0.0.1</a></td></tr></tbody></table><h2 id=v112>v1.1.2</h2><p>Minor release fixing pg_timeline configuration issue and building with latest go deps</p><p><strong>Checksums</strong></p><p><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/checksums.txt>https://github.com/pgsty/pg_exporter/releases/download/v1.1.2/checksums.txt</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>8cddd57a843914a3145a80a3220bc875047b9bcac0664357c01ba86485436236  pg-exporter_1.1.2-1_amd64.deb
</span></span><span style=display:flex><span>f5b25a8ae5c022867a54c17ba1c6493eba20dcb292340460390289336df24f04  pg-exporter_1.1.2-1_arm64.deb
</span></span><span style=display:flex><span>4da2c287f6717681b25befda0d59a89b9d1b258281ce94f3a6bc21d02f70c83c  pg-exporter_1.1.2-1_ppc64le.deb
</span></span><span style=display:flex><span>b26355f3c1a5b8a147291a51e2d7ada204deed6d52877c146a8b3e499defa5e8  pg_exporter-1.1.2-1.aarch64.rpm
</span></span><span style=display:flex><span>42ef89716ba99dd918b0e9c77ef3236129d613f68bb8ae5929668a5a2596cca5  pg_exporter-1.1.2-1.ppc64le.rpm
</span></span><span style=display:flex><span>a8f4a2d5c7b6701c7bac788a7ed7183b6c4b74a334326cd389f3a695fb77675d  pg_exporter-1.1.2-1.x86_64.rpm
</span></span><span style=display:flex><span>775f5ea3188a6acb1327c001c4ba9a0651424c3bb37d800e6f67972c904c4750  pg_exporter-1.1.2.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>7f2bbcc2db1e16dc78c3edd8e67e20e4ec81f2972c8c37135cba6f6afbf91003  pg_exporter-1.1.2.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>33c34b1f9ef6b6e7615f241a95059a8137a2337a454930b668180a9329d12b98  pg_exporter-1.1.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>2b91a5818d780e38692ab6446cacb496695e67388676c18012be582e8ddfbdd8  pg_exporter-1.1.2.linux-arm64.tar.gz
</span></span><span style=display:flex><span>adcb5f229f4a5d641f6430b9a2dfb0377a2e4310efad242730867d6cdf5e27ee  pg_exporter-1.1.2.linux-ppc64le.tar.gz
</span></span><span style=display:flex><span>90b7c7e4b2b94936b5faa3cf2d35509b62ebc0d60b3afe1abaaf03efcd415a4a  pg_exporter-1.1.2.windows-amd64.tar.gz
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.1.2>https://github.com/pgsty/pg_exporter/releases/tag/v1.1.2</a></p><h2 id=v111>v1.1.1</h2><p>Minor release with new collectors and bug fixes.</p><p><strong>New Features:</strong></p><ul><li>New <code>pg_timeline</code> collector for timeline monitoring</li><li>New <code>pg_sub_16</code> collector branch to exclude parallel operations in subscriptions (PostgreSQL 16+ compatibility)</li></ul><p><strong>Bug Fixes:</strong></p><ul><li>Fix: Add coalesce for slotname in <code>pg_recv</code> collector to handle NULL values</li></ul><p><strong>Checksums</strong></p><p><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.1.1/checksums.txt>https://github.com/pgsty/pg_exporter/releases/download/v1.1.1/checksums.txt</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>fd5ee96511676fc11b975115a4870ed0c811056519f79ad7f24ab7ec538fa278  pg-exporter_1.1.1-1_amd64.deb
</span></span><span style=display:flex><span>b90a08d16a6e4707d82f8f3ae282cb76acb331de607e7544532fd0b774b7aa27  pg-exporter_1.1.1-1_arm64.deb
</span></span><span style=display:flex><span>163955f59a71da48901ffa26bb2f2db0712d31d8aeb1ab3fa463683f719a6d3a  pg-exporter_1.1.1-1_ppc64le.deb
</span></span><span style=display:flex><span>cf4f8bc12bb8a2d1e55553f891fd31c43324e4348249727972eb44f82cd4e6c8  pg_exporter-1.1.1-1.aarch64.rpm
</span></span><span style=display:flex><span>5a425b2f61f308b32f2d107372830c34eb685bfb312ee787f11877a20f1c4a2e  pg_exporter-1.1.1-1.ppc64le.rpm
</span></span><span style=display:flex><span>23606ccea565368971ac2e7f39766455b507021f09457bcf61db13cb10501a16  pg_exporter-1.1.1-1.x86_64.rpm
</span></span><span style=display:flex><span>ce74624eba92573318f50764cee4f355fa1f35697d209f70a4240f8f9d976188  pg_exporter-1.1.1.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>35fba12521dbdcc54a3792278ed4822e4ca9e951665b5e53dff7c2a0f7014ae3  pg_exporter-1.1.1.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>7699bdef15dd306289645beee8d40a123ca75dc988e46d89cdd75a1c1f650bef  pg_exporter-1.1.1.linux-amd64.tar.gz
</span></span><span style=display:flex><span>f4baba59d27a8eb67f0c5209fed7b9f00f78db796e583cc3487701e7803671c6  pg_exporter-1.1.1.linux-arm64.tar.gz
</span></span><span style=display:flex><span>810c3817c27358fa667714f8bfe8d52840a7ea010035e29547919ccb7c9fa781  pg_exporter-1.1.1.linux-ppc64le.tar.gz
</span></span><span style=display:flex><span>3f6df693b3eb92fdaeaeccf99ea7e5977b2c65028a4f00bdfabbc0405b9f5f93  pg_exporter-1.1.1.windows-amd64.tar.gz
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.1.1>https://github.com/pgsty/pg_exporter/releases/tag/v1.1.1</a></p><h2 id=v110>v1.1.0</h2><p>Build with Go 1.25.5 and latest dependencies, collector updates:</p><p><strong>Collector Changes:</strong></p><ul><li><code>pg_setting</code>: Major refactor for PG10-18 compatibility with <code>missing_ok</code> support<ul><li>Add 13 new metrics: <code>max_parallel_workers</code>, <code>max_parallel_workers_per_gather</code>, <code>max_parallel_maintenance_workers</code>, <code>shared_buffers</code>, <code>maintenance_work_mem</code>, <code>effective_cache_size</code>, <code>fsync</code>, <code>full_page_writes</code>, <code>autovacuum</code>, <code>autovacuum_max_workers</code>, <code>checkpoint_timeout</code>, <code>checkpoint_completion_target</code>, <code>hot_standby</code>, <code>synchronous_commit</code>, <code>io_method</code></li><li>Rename <code>work_memory_size</code> to <code>work_mem</code></li><li>Change min_version from 9.6 to 10, explicit <code>::int</code> type casting</li></ul></li><li><code>pg_size</code>: Fix log directory size detection, use <code>logging_collector</code> check instead of path pattern matching</li><li><code>pg_table</code>: Performance optimization, replace LATERAL subqueries with JOIN for better query performance; fix <code>tuples</code> and <code>frozenxid</code> metric type from COUNTER to GAUGE; increase timeout from 1s to 2s</li><li><code>pg_vacuuming</code>: Add PG17 collector branch with new metrics <code>indexes_total</code>, <code>indexes_processed</code>, <code>dead_tuple_bytes</code> for index vacuum progress tracking</li><li><code>pg_query</code>: Increase timeout from 1s to 2s for high-load scenarios</li><li><code>pg_io</code>: Fix typo in <code>reuses</code> description (&ldquo;in reused&rdquo; -> &ldquo;is reused&rdquo;)</li><li><code>pg_checkpointer</code>: Fix description for pg_checkpointer_10 (&ldquo;9.4+&rdquo; -> &ldquo;9.4-17&rdquo;)</li><li><code>pg_db_confl</code>: Fix description for pg_db_confl_15 (&ldquo;9.1 - 16&rdquo; -> &ldquo;9.1 - 15&rdquo;)</li><li>Format alignment fixes for <code>pg_db</code>, <code>pg_indexing</code>, <code>pg_clustering</code>, <code>pg_backup</code></li></ul><p><strong>Other Changes:</strong></p><ul><li>Fix release year by <a href=https://github.com/anayrat>@anayrat</a></li></ul><p><strong>Checksums</strong></p><p><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.0.3/checksums.txt>https://github.com/pgsty/pg_exporter/releases/download/v1.0.3/checksums.txt</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>9c65f43e76213bb8a49d1eab2c76a27d9ab694e67bc79f0ad12769ea362b5ca2  pg-exporter_1.1.0-1_amd64.deb
</span></span><span style=display:flex><span>bcd2cacb4febc5fb92f9eda8e733c161c8c6721416e16ec91a773503241c972d  pg-exporter_1.1.0-1_arm64.deb
</span></span><span style=display:flex><span>2c9d4a9cb06d07af0b6dd9dd6e568af073dc9f6775abde63b45f0aae34d171b1  pg-exporter_1.1.0-1_ppc64le.deb
</span></span><span style=display:flex><span>2934ab5b0fb16dca5a96ec1e8f230e32c72b30ca076b5e5ddf8ec553c821f7b8  pg_exporter-1.1.0-1.aarch64.rpm
</span></span><span style=display:flex><span>3c9955f31ba93532cc7f95ff60b0658f4b6eca6a827710e2f70c0716b34eab43  pg_exporter-1.1.0-1.ppc64le.rpm
</span></span><span style=display:flex><span>9fdefbd8e7660dcb130207901a27762e0a381857ba8cf12b63184744f92dea05  pg_exporter-1.1.0-1.x86_64.rpm
</span></span><span style=display:flex><span>7159002016754309e0ed625a9a48049d21177883fa11d1e448eb7655ceb690cc  pg_exporter-1.1.0.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>7d55ac5cda0b1fd8ffbd5e76b9c1c1784ac8e353104a206caaadce89adda6d65  pg_exporter-1.1.0.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>8211ec24277554b9b1a36920d7865153e21c2621031d3d08f22d94cdd2ddf02f  pg_exporter-1.1.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>d17ab7f9bf04442e642483d432d005d25bb62e0c9caa73cb7e69ee19eb89b3ae  pg_exporter-1.1.0.linux-arm64.tar.gz
</span></span><span style=display:flex><span>c074aeb345cc30f7b6e16aa153ae3d9a12789e4425987590c3fd77c4e68a40b6  pg_exporter-1.1.0.linux-ppc64le.tar.gz
</span></span><span style=display:flex><span>13d653e2abb023ce9526bdc2815135b82f49c044d237030f3f56b09fb016fcb7  pg_exporter-1.1.0.windows-amd64.tar.gz
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.1.0>https://github.com/pgsty/pg_exporter/releases/tag/v1.1.0</a></p><h2 id=v103>v1.0.3</h2><ul><li>Build with Go 1.25.4 and latest dependencies</li><li>Fix <a href=https://github.com/pgsty/pg_exporter/issues/80>#80</a> Conflict with libpq env variables</li><li>Chanage default value of <code>auto-discovery</code> to <code>true</code> by <a href=https://github.com/kadaffy>@kadaffy</a></li></ul><p><strong>Checksums</strong></p><p><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.0.3/checksums.txt>https://github.com/pgsty/pg_exporter/releases/download/v1.0.3/checksums.txt</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>7efa1a77dfd5b94813c32c7ac015b1d479b1f04fb958f6b1ed5af333e354d015  pg-exporter_1.0.3-1_amd64.deb
</span></span><span style=display:flex><span>41e18bf18eba2ab90ac371bfb46e9152da9fe628ebd8e26766cac08325eb3b07  pg-exporter_1.0.3-1_arm64.deb
</span></span><span style=display:flex><span>7da8ed738d254c120d42aa51d6137f84e7f4e3188bc764d4f9a1438220363a43  pg-exporter_1.0.3-1_ppc64le.deb
</span></span><span style=display:flex><span>a214b555981156da7b7d248b1f728f8ac88a07ac8f77a66c5d8e43b40670d6b4  pg_exporter-1.0.3-1.aarch64.rpm
</span></span><span style=display:flex><span>d876fc66e208612ebffe3c43dabce88b088d915f92584260d710b85a3a131413  pg_exporter-1.0.3-1.ppc64le.rpm
</span></span><span style=display:flex><span>75f62d314fec50c836c534996c884d25ecea77810ab33e7ba0e9c4b783e775b4  pg_exporter-1.0.3-1.x86_64.rpm
</span></span><span style=display:flex><span>47829a19707284bcee1b8dc47cc7d0172398bb533e6b4043950f787486712769  pg_exporter-1.0.3.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>38b6ccb72315cadea542b1f2a7b7022d0e8d48ffd4ab177bb69a0a909b99af6b  pg_exporter-1.0.3.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>36e8dff84d61a7593ff1fcec567ca4ffeaecd0be2f9eabd227ceac71b12a919a  pg_exporter-1.0.3.linux-amd64.tar.gz
</span></span><span style=display:flex><span>6477e8ef873773a09c4f39a29444f21b5b2c71e717e52ca425bcc8e8e5448791  pg_exporter-1.0.3.linux-arm64.tar.gz
</span></span><span style=display:flex><span>a083b51ebed2b280e2eaa0f19558494e7fa6f122a0a86a1d117206fcd090820c  pg_exporter-1.0.3.linux-ppc64le.tar.gz
</span></span><span style=display:flex><span>a1f9b27b7190f478726d96f270a72d9dc4d3f2bcc3b0326b7c4a2607e62ea588  pg_exporter-1.0.3.windows-amd64.tar.gz
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.3>https://github.com/pgsty/pg_exporter/releases/tag/v1.0.3</a></p><h2 id=v102>v1.0.2</h2><ul><li>Build with Go 1.25.0 and latest dependencies</li><li>Dedicate website and homepage: <a href=https://exp.pgsty.com>https://exp.pgsty.com</a></li><li>Release with goreleaser for more os/arch with CI/CD pipeline:<ul><li>add windows amd64 support</li><li>add linux ppc64le support</li></ul></li></ul><p><strong>Checksums</strong></p><p><a href=https://github.com/pgsty/pg_exporter/releases/download/v1.0.2/checksums.txt>https://github.com/pgsty/pg_exporter/releases/download/v1.0.2/checksums.txt</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>683bf97f22173f2f2ec319a88e136939c2958a1f5ced4f4aa09a1357fc1c44c5  pg-exporter_1.0.2-1_amd64.deb
</span></span><span style=display:flex><span>f62d479a92be2d03211c162b8419f968cea87ceef5b1f25f2bcd390e0b72ccb5  pg-exporter_1.0.2-1_arm64.deb
</span></span><span style=display:flex><span>e1bbfc5a4c1b93e6f92bc7adcb4364583ab763e76e156aa5c979d6d1040f4c7a  pg-exporter_1.0.2-1_ppc64le.deb
</span></span><span style=display:flex><span>f51d5b45448e6bbec3467d1d1dc049b1e16976f723af713c4262541ac55a039c  pg_exporter-1.0.2-1.aarch64.rpm
</span></span><span style=display:flex><span>18380011543674e4c48b2410266b41165974d780cbc8918fc562152ba623939e  pg_exporter-1.0.2-1.ppc64le.rpm
</span></span><span style=display:flex><span>198372d894b9598c166a0e91ca36d3c9271cb65298415f63dbffcf6da611f2bb  pg_exporter-1.0.2-1.x86_64.rpm
</span></span><span style=display:flex><span>cbe7e07df6d180507c830cdab4cf86d40ccd62774723946307b5331d4270477d  pg_exporter-1.0.2.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>20c4a35fa244287766c1d1a19cd2e393b3fa451a96a81e5635401e69bef04b97  pg_exporter-1.0.2.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>d742111185f6a89fff34bfd304b851c8eb7a8e38444f0220786e11ed1934eff1  pg_exporter-1.0.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>0b1f4c97c1089c4767d92eb22419b8f29c9f46fb90ddfd1e8514cc42dc41054f  pg_exporter-1.0.2.linux-arm64.tar.gz
</span></span><span style=display:flex><span>895083fd2c7fc5409cc1a2dbaaef1e47ac7aa6a3fd5db2359012922d90bcdcc3  pg_exporter-1.0.2.linux-ppc64le.tar.gz
</span></span><span style=display:flex><span>5f751228e7120604af9a482fb70197489fa633c38a0f2b6a3489393fbc6a10aa  pg_exporter-1.0.2.windows-amd64.tar.gz
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.2>https://github.com/pgsty/pg_exporter/releases/tag/v1.0.2</a></p><h2 id=v101>v1.0.1</h2><ul><li>Add dockerhub images: <a href=https://hub.docker.com/r/pgsty/pg_exporter>pgsty/pg_exporter</a></li><li>Bump go dependencies to the latest version, build with go 1.24.5</li><li>Disable <code>pg_tsdb_hypertable</code> collector by default, since <code>timescaledb</code> catalog is changed.</li></ul><p><strong>Checksums</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>d5e2d6a656eef0ae1b29cd49695f9773  pg_exporter-1.0.1-1.aarch64.rpm
</span></span><span style=display:flex><span>cb01bb78d7b216a235363e9342803cb3  pg_exporter-1.0.1-1.x86_64.rpm
</span></span><span style=display:flex><span>67093a756b04845f69ad333b6d458e81  pg_exporter-v1.0.1.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>2d3fdc10045d1cf494b9c1ee7f94f127  pg_exporter-v1.0.1.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>e242314461becfa99c3978ae72838ab0  pg_exporter-v1.0.1.linux-amd64.tar.gz
</span></span><span style=display:flex><span>63de91da9ef711a53718bc60b89c82a6  pg_exporter-v1.0.1.linux-arm64.tar.gz
</span></span><span style=display:flex><span>718f6afc004089f12c1ca6553f9b9ba5  pg-exporter_1.0.1_amd64.deb
</span></span><span style=display:flex><span>57da7a8005cdf91ba8c1fb348e0d7367  pg-exporter_1.0.1_arm64.deb
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.1>https://github.com/pgsty/pg_exporter/releases/tag/v1.0.1</a></p><h2 id=v100>v1.0.0</h2><p>Add PostgreSQL 18 metrics support</p><ul><li>new collector branch <code>pg_wal_18</code>:</li><li>remove <code>write</code>, <code>sync</code>, <code>write_time</code>, <code>sync_time</code> metrics</li><li>move to <code>pg_stat_io</code></li><li>new collector branch <code>pg_checkpointer_18</code>:</li><li>new metric <code>num_done</code></li><li>new metric <code>slru_written</code></li><li>new collector branch <code>pg_db_18</code>:</li><li>new metric <code>parallel_workers_to_launch</code></li><li>new metric <code>parallel_workers_launched</code></li><li>new collector branch <code>pg_table_18</code>:</li><li><code>table_parallel_workers_to_launch</code></li><li><code>table_parallel_workers_launched</code></li><li>new collector branch <code>pg_io_18</code>:</li><li>new series about WAL statistics</li><li>new metric <code>read_bytes</code></li><li>new metric <code>write_bytes</code></li><li>new metric <code>extend_bytes</code></li><li>remove <code>op_bytes</code> due to fixed value</li><li>new collector branch <code>pg_vacuuming_18</code></li><li>new metric <code>delay_time</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>8637bc1a05b93eedfbfd3816cca468dd  pg_exporter-1.0.0-1.aarch64.rpm
</span></span><span style=display:flex><span>a28c4c0dcdd3bf412268a2dbff79f5b9  pg_exporter-1.0.0-1.x86_64.rpm
</span></span><span style=display:flex><span>229129209b8e6bc356c28043c7c22359  pg_exporter-v1.0.0.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>d941c2c28301269e62a8853c93facf12  pg_exporter-v1.0.0.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>5bbb94db46cacca4075d4c341c54db37  pg_exporter-v1.0.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>da9ad428a50546a507a542d808f1c0fa  pg_exporter-v1.0.0.linux-arm64.tar.gz
</span></span><span style=display:flex><span>0fa2395d9d7a43ab87e5c87e5b06ffcc  pg-exporter_1.0.0_amd64.deb
</span></span><span style=display:flex><span>fed56f8a37e30cc59e85f03c81fce3f5  pg-exporter_1.0.0_arm64.deb
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.0>https://github.com/pgsty/pg_exporter/releases/tag/v1.0.0</a></p><h2 id=v090>v0.9.0</h2><p><strong>Default Collectors</strong></p><ul><li>new metrics collector for <code>timescaledb</code> hypertable</li><li>new metrics collector for <code>citus</code> dist node</li><li>new metrics collector for <code>pg_wait_sampling</code> wait event profile</li><li><code>pg_slot</code> overhaul: Add 16/17 pg_replication_slot metrics</li><li>allow <code>pg_slot</code> collector run on replica since 16/17</li><li>refactor <code>pg_wait</code> collector to agg from all processes</li><li>restrict pg_clustering, pg_indexing, pg_vacuuming run on primary</li><li>mark all <code>reset_time</code> as <code>GAUGE</code> rather than <code>COUNTER</code></li><li>fix <code>pg_recovery_prefetch_skip_fpw</code> type from <code>GAUGE</code> to <code>COUNTER</code></li><li>fix <code>pg_recv.state</code> type from <code>LABEL</code> to <code>GAUGE</code></li><li>Format collector in compact mode</li><li>new default metric <code>pg_exporter_build_info</code> / <code>pgbouncer_exporter_build_info</code></li><li>add <code>server_encoding</code> to <code>pg_meta</code> collector</li><li>add 12 new setting metrics to <code>pg_setting</code> collector</li></ul><ul><li>wal_block_size</li><li>segment_size</li><li>wal_segment_size</li><li>wal_level</li><li>wal_log_hints</li><li>work_mem</li><li>hugepage_count</li><li>hugepage_status</li><li>max_wal_size</li><li>min_wal_size</li><li>max_slot_wal_keep_size</li></ul><p><strong>Exporter Codebase</strong></p><ul><li>normalize collector branch name with min pg ver suffix</li><li>Add license file to binary packages</li><li>move <code>pgsty/pg_exporter</code> repo to <code>pgsty/pg_exporter</code></li><li>refactor <code>server.go</code> to reduce <code>Compatible</code> and <code>PostgresPrecheck</code> complexity</li><li>rename metrics collector with extra number prefix for better sorting</li><li>bump dependencies to the latest version</li><li>execute fatal collectors ahead of all non-fatal collectors, and fail fast</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.9.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.9.0</a></p><h2 id=v081>v0.8.1</h2><ul><li>Bump dependencies to the latest version</li><li><a href=https://github.com/pgsty/pg_exporter/pull/67>Bump golang.org/x/net from 0.35.0 to 0.36.0 #67</a></li><li>Update docker images building tags</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.8.1>https://github.com/pgsty/pg_exporter/releases/tag/v0.8.1</a></p><h2 id=v080>v0.8.0</h2><ul><li>Add PgBouncer 1.24 new metrics support (stat, pool, database)</li><li>Fix: <code>310-pg_size.yml</code> fails if log dir not set properly <a href=https://github.com/pgsty/pg_exporter/issues/64>#64</a> by <a href=https://github.com/suikast42>@Süleyman Vurucu</a></li><li>Build with the latest Go 1.24 and bump all dependencies</li><li>Refactor logging with the standard <code>log/slog</code> instead of <code>go-kit</code></li><li><strong>Full Changelog</strong>: <a href=https://github.com/pgsty/pg_exporter/compare/v0.7.1...v0.8.0>https://github.com/pgsty/pg_exporter/compare/v0.7.1...v0.8.0</a></li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.8.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.8.0</a></p><h2 id=v071>v0.7.1</h2><p>Routine update with dependabot</p><ul><li>Feat: support specifying configuration as Reader by <a href=https://github.com/ringerc>@ringerc</a> in <a href=https://github.com/pgsty/pg_exporter/pull/62>#62</a></li><li>Bump golang.org/x/crypto from 0.21.0 to 0.31.0 by <a href=https://github.com/dependabot>@dependabot</a> in <a href=https://github.com/pgsty/pg_exporter/pull/63>#63</a></li><li>Fix some typos</li><li><strong>Full Changelog</strong>: <a href=https://github.com/pgsty/pg_exporter/compare/v0.7.0...v0.7.1>https://github.com/pgsty/pg_exporter/compare/v0.7.0...v0.7.1</a></li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.7.1>https://github.com/pgsty/pg_exporter/releases/tag/v0.7.1</a></p><h2 id=v070>v0.7.0</h2><p>Refactor codebase for the latest go version.</p><ul><li><a href=https://github.com/pgsty/pg_exporter/issues/53>PostgreSQL 17 Metrics Support</a> by @Vonng</li><li><a href=https://github.com/pgsty/pg_exporter/pull/47>pg_exporter: predicate queries feature</a> by <a href=https://github.com/ringerc>@ringerc</a></li><li><a href=https://github.com/pgsty/pg_exporter/pull/54>Do a clean build in the dockerfile</a> by <a href=https://github.com/ringerc>@ringerc</a> by <a href=https://github.com/ringerc>@ringerc</a></li><li><a href=https://github.com/pgsty/pg_exporter/pull/46>pg_exporter: don&rsquo;t panic after &ldquo;bind: address already in use&rdquo;</a> by <a href=https://github.com/ringerc>@ringerc</a></li><li><a href=https://github.com/pgsty/pg_exporter/pull/48>pg_exporter: fix /stat endpoint formatting</a> by <a href=https://github.com/ringerc>@ringerc</a></li><li><a href=https://github.com/pgsty/pg_exporter/pull/49>pg_exporter: omit default query properties on yaml export</a> by <a href=https://github.com/ringerc>@ringerc</a></li><li><a href=https://github.com/pgsty/pg_exporter/pull/50>Exclude template DBs from discovery and schema-qualify discovery query</a> by <a href=https://github.com/ringerc>@ringerc</a></li><li><a href=https://github.com/pgsty/pg_exporter/pull/51>Fix some typos and some metric description mistakes</a> by <a href=https://github.com/ringerc>@ringerc</a></li><li><a href=https://github.com/pgsty/pg_exporter/pull/52>Switch from unmaintained lib/pq driver to pgx with stdlib wrapper</a> by <a href=https://github.com/ringerc>@ringerc</a></li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.7.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.7.0</a></p><h2 id=v060>v0.6.0</h2><ul><li><p>Security Enhancement: Fix <a href="https://github.com/pgsty/pg_exporter/security/dependabot?q=is%3Aclosed">security</a>
dependent-bot issue</p></li><li><p>Add pg16 collectors</p></li><li><p>Add <code>arm64</code> & <code>aarch64</code> packages</p></li><li><p>Remove the <code>monitor</code> schema requirement for <code>pg_query</code> collectors (you have to ensure it with search_path or just
install <code>pg_stat_statements</code> in the default <code>public</code> schema)</p></li><li><p>Fix pgbouncer version parsing message level from info to debug</p></li><li><p>Fix <code>pg_table_10_12</code> collector missing <code>relid</code> issue.</p></li><li><p><a href=https://github.com/pgsty/pg_exporter/pull/34>Recognize the files with yml suffix in config directory</a> by <a href=https://github.com/japinli>@Japin Li</a></p></li><li><p><a href=https://github.com/pgsty/pg_exporter/pull/35>Support PostgreSQL 15 and higher</a> by <a href=https://github.com/japinli>@Japin Li</a></p></li><li><p><a href=https://github.com/pgsty/pg_exporter/pull/37/files>Fix connect-timeout propagation</a> by <a href=https://github.com/mouchar>@mouchar</a></p></li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.6.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.6.0</a></p><h2 id=v050>v0.5.0</h2><p><strong>Exporter Enhancement</strong></p><ul><li>Build rpm & deb with <code>nfpm</code></li><li>Add <code>column.default</code>, replace when metric value is NULL</li><li>Add <code>column.scale</code>, multiply scale factor when metric value is float/int (e.g µs to second)</li><li>Fix <code>/stat</code> endpoint output</li><li>Add docker container <a href=https://hub.docker.com/r/pgsty/pg_exporter><code>pgsty/pg_exporter</code></a></li></ul><p><strong>Metrics Collector</strong></p><ul><li>scale bgwriter & pg_wal time unit to second</li><li>remove pg_class collector and move it to pg_table & pg_inex</li><li>add pg_class metrics to pg_table</li><li>add pg_class metrics to pg_index</li><li>enable pg_table_size by default</li><li>scale pg_query pg_db pg_bgwriter pg_ssl pgbouncer_stat time metrics to second</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.5.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.5.0</a></p><h2 id=v041>v0.4.1</h2><ul><li>update default collectors<ul><li>omit citus & timescaledb schemas on object monitoring</li><li>avoid duplicate pg_statio tuples</li><li>support pgbouncer v1.16</li><li>bug fix: <code>pg_repl</code> collector overlap on pg 12</li></ul></li><li>new parameter: <code>-T</code> <code>connect-timeout</code> <code>PG_EXPORTER_CONNECT_TIMEOUT</code>
this can be useful when monitoring remote Postgres instances.</li><li>now <code>pg_exporter.yaml</code> are renamed as <code>pg_exporter.yml</code> in rpm package.</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.4.1>https://github.com/pgsty/pg_exporter/releases/tag/v0.4.1</a></p><h2 id=v040>v0.4.0</h2><ul><li>Add PG 14 support</li><li>Default metrics configuration overhaul. (BUT you can still use the old configuration)</li><li>add <code>auto-discovery</code> , <code>include-database</code> and <code>exclude-database</code> option</li><li>Add multiple database monitoring implementations (with <code>auto-discovery = on</code>)</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.4.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.4.0</a></p><h2 id=v032>v0.3.2</h2><ul><li>fix shadow DSN corner case</li><li>fix typo & docs</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.3.2>https://github.com/pgsty/pg_exporter/releases/tag/v0.3.2</a></p><h2 id=v031>v0.3.1</h2><p>fix default configuration problems (especially for versions lower than 13)</p><ul><li>setting <code>primary_conninfo</code> not exists until PG13</li><li>add <code>funcid</code> label to <code>pg_func</code> collector to avoid func name duplicate label</li><li>fix version string to <code>pg_exporter</code></li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.3.1>https://github.com/pgsty/pg_exporter/releases/tag/v0.3.1</a></p><h2 id=v030>v0.3.0</h2><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.3.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.3.0</a></p><ul><li>Change default configuration, Support PostgreSQL 13 new metrics (<code>pg_slru</code>, <code>pg_shmem</code>, <code>pg_query13</code>,<code>pg_backup</code>,
etc&mldr;)</li><li>Add a series of new REST APIs for health / recovery status check</li><li>Add a dummy server with fake <code>pg_up 0</code> metric, which serves before PgExporter is initialized.</li><li>Add <code>sslmode=disable</code> to URL if <code>sslmode</code> is not given</li><li>fix typos and bugs</li></ul><h2 id=v020>v0.2.0</h2><ul><li>add yum package and linux service definition</li><li>add a &lsquo;skip&rsquo; flag into query config</li><li>fix <code>pgbouncer_up</code> metrics</li><li>add conf reload support</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.2.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.2.0</a></p><h2 id=v012>v0.1.2</h2><ul><li>fix pgbouncer_up metrics</li><li>add dynamic configuration reload</li><li>remove &lsquo;shard&rsquo; related logic</li><li>add a &lsquo;bulky&rsquo; mode to default settings</li></ul><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.1.2>https://github.com/pgsty/pg_exporter/releases/tag/v0.1.2</a></p><h2 id=v011>v0.1.1</h2><p>Fix the bug that pg_exporter will hang during start-up if any query is failed.</p><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.1.1>https://github.com/pgsty/pg_exporter/releases/tag/v0.1.1</a></p><h2 id=v010>v0.1.0</h2><p>It works, looks good to me.</p><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.1.0>https://github.com/pgsty/pg_exporter/releases/tag/v0.1.0</a></p><h2 id=v004>v0.0.4</h2><p>Tested in real world production environment with 200+ nodes for about 2 weeks. Looks good !</p><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.4>https://github.com/pgsty/pg_exporter/releases/tag/v0.0.4</a></p><h2 id=v003>v0.0.3</h2><p>v0.0.3 Release, Tested in Production Environment</p><p>This version is already tested in a production environment.</p><p>This project is still under rapid evolution, I would say if you want use it in production , try with caution.</p><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.3>https://github.com/pgsty/pg_exporter/releases/tag/v0.0.3</a></p><h2 id=v002>v0.0.2</h2><p>It&rsquo;s ok to try now</p><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.2>https://github.com/pgsty/pg_exporter/releases/tag/v0.0.2</a></p><h2 id=v001>v0.0.1</h2><p>Add pgbouncer mode</p><p><a href=https://github.com/pgsty/pg_exporter/releases/tag/v0.0.1>https://github.com/pgsty/pg_exporter/releases/tag/v0.0.1</a></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>