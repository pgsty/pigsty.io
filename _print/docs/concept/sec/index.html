<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/concept/sec/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/concept/sec/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Security and Compliance | PIGSTY</title><meta name=description content="Authentication, access control, encrypted communication, audit logs—meeting SOC2 compliance requirements."><meta property="og:url" content="https://pigsty.io/docs/concept/sec/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="Security and Compliance"><meta property="og:description" content="Authentication, access control, encrypted communication, audit logs—meeting SOC2 compliance requirements."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Security and Compliance"><meta itemprop=description content="Authentication, access control, encrypted communication, audit logs—meeting SOC2 compliance requirements."><meta itemprop=dateModified content="2026-01-11T15:00:02+08:00"><meta itemprop=wordCount content="1121"><meta itemprop=keywords content="Concept,PIGSTY,PGSQL"><meta name=twitter:card content="summary"><meta name=twitter:title content="Security and Compliance"><meta name=twitter:description content="Authentication, access control, encrypted communication, audit logs—meeting SOC2 compliance requirements."><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/concept/sec/>Return to the regular view of this page</a>.</p></div><h1 class=title>Security and Compliance</h1><div class=lead>Authentication, access control, encrypted communication, audit logs—meeting SOC2 compliance requirements.</div><ul><li>1: <a href=#pg-8b790153f8312a89aef83b802d30c481>Local CA</a></li><li>2: <a href=#pg-42af3045c7ebee43d7c66fbe8a4cd267>Seven-Layer Security Model</a></li><li>3: <a href=#pg-6a3742ed82b65fb5a722f76337bf835d>Access Control</a></li></ul><div class=content><h3 id=pigstys-security-philosophy>Pigsty&rsquo;s Security Philosophy</h3><p><strong>Secure by Default</strong>: Out-of-the-box security configuration—basic protection without additional setup.</p><p><strong>Progressive Configuration</strong>: Enterprise users can gradually enhance security measures through configuration.</p><p><strong>Defense in Depth</strong>: Multiple security layers—even if one layer is breached, others remain protective.</p><p><strong>Least Privilege</strong>: Grant users only the minimum permissions needed to complete tasks, reducing risk.</p><hr><h2 id=default-security-configuration>Default Security Configuration</h2><p>Pigsty enables these security features by default:</p><table><thead><tr><th style=text-align:left>Feature</th><th style=text-align:left>Default Config</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Password Encryption</strong></td><td style=text-align:left><code>scram-sha-256</code></td><td style=text-align:left>PostgreSQL&rsquo;s most secure password hash algorithm</td></tr><tr><td style=text-align:left><strong>SSL Support</strong></td><td style=text-align:left>Enabled</td><td style=text-align:left>Clients can optionally use SSL encrypted connections</td></tr><tr><td style=text-align:left><strong>Local CA</strong></td><td style=text-align:left>Auto-generated</td><td style=text-align:left>Self-signed CA issues server certificates</td></tr><tr><td style=text-align:left><strong>HBA Layering</strong></td><td style=text-align:left>Source-based control</td><td style=text-align:left>Different auth strength for different sources</td></tr><tr><td style=text-align:left><strong>Role System</strong></td><td style=text-align:left>Four-tier permissions</td><td style=text-align:left>Read-only/Read-write/Admin/Offline</td></tr><tr><td style=text-align:left><strong>Data Checksums</strong></td><td style=text-align:left>Enabled</td><td style=text-align:left>Detects storage-layer data corruption</td></tr><tr><td style=text-align:left><strong>Audit Logs</strong></td><td style=text-align:left>Enabled</td><td style=text-align:left>Records connections and slow queries</td></tr></tbody></table><h3 id=enhanced-configuration>Enhanced Configuration</h3><p>Additional configuration enables higher security levels:</p><table><thead><tr><th style=text-align:left>Feature</th><th style=text-align:left>Configuration Method</th><th style=text-align:left>Security Level</th></tr></thead><tbody><tr><td style=text-align:left>Password strength check</td><td style=text-align:left>Enable <code>passwordcheck</code> extension</td><td style=text-align:left>Enterprise</td></tr><tr><td style=text-align:left>Enforce SSL</td><td style=text-align:left>HBA uses <code>hostssl</code></td><td style=text-align:left>Enterprise</td></tr><tr><td style=text-align:left>Client certificates</td><td style=text-align:left>HBA uses <code>cert</code> auth</td><td style=text-align:left>Financial-grade</td></tr><tr><td style=text-align:left>Backup encryption</td><td style=text-align:left>Configure <code>cipher_type</code></td><td style=text-align:left>Compliance</td></tr><tr><td style=text-align:left>Firewall</td><td style=text-align:left>Configure <code>node_firewall_mode</code></td><td style=text-align:left>Infrastructure</td></tr></tbody></table><p>If you only have one minute, remember this diagram:</p><pre class=mermaid>flowchart TB
    subgraph L1[&#34;Layer 1: Network Security&#34;]
        L1A[&#34;Firewall &#43; SSL/TLS Encryption &#43; HAProxy Proxy&#34;]
        L1B[&#34;Who can connect? Is the connection encrypted?&#34;]
    end

    subgraph L2[&#34;Layer 2: Authentication&#34;]
        L2A[&#34;HBA Rules &#43; SCRAM-SHA-256 Passwords &#43; Certificate Auth&#34;]
        L2B[&#34;Who are you? How do you prove it?&#34;]
    end

    subgraph L3[&#34;Layer 3: Access Control&#34;]
        L3A[&#34;Role System &#43; Object Permissions &#43; Database Isolation&#34;]
        L3B[&#34;What can you do? What data can you access?&#34;]
    end

    subgraph L4[&#34;Layer 4: Data Security&#34;]
        L4A[&#34;Data Checksums &#43; Backup Encryption &#43; Audit Logs&#34;]
        L4B[&#34;Is data intact? Are operations logged?&#34;]
    end

    L1 --&gt; L2 --&gt; L3 --&gt; L4</pre><p><strong>Core Value</strong>: Enterprise-grade security configuration out of the box, best practices enabled by default, additional configuration achieves SOC 2 compliance.</p><hr><h2 id=contents>Contents</h2><table><thead><tr><th style=text-align:left>Section</th><th style=text-align:left>Description</th><th style=text-align:left>Core Question</th></tr></thead><tbody><tr><td style=text-align:left><strong>Security Overview</strong></td><td style=text-align:left>Security capability overview and checklist</td><td style=text-align:left>What&rsquo;s the overall security architecture?</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/config/hba><strong>Authentication</strong></a></td><td style=text-align:left>HBA rules, password policies, certificate auth</td><td style=text-align:left>How to verify user identity?</td></tr><tr><td style=text-align:left><a href=ac/><strong>Access Control</strong></a></td><td style=text-align:left>Role system, permission model, database isolation</td><td style=text-align:left>How to control user permissions?</td></tr><tr><td style=text-align:left><a href=ca/><strong>Encrypted Communication</strong></a></td><td style=text-align:left>SSL/TLS, local CA, certificate management</td><td style=text-align:left>How to protect data in transit?</td></tr><tr><td style=text-align:left><strong>Compliance Checklist</strong></td><td style=text-align:left>Detailed SOC2 mapping</td><td style=text-align:left>How to meet compliance requirements?</td></tr></tbody></table><hr><h2 id=why-security-matters>Why Security Matters</h2><h3 id=the-cost-of-data-breaches>The Cost of Data Breaches</h3><pre class=mermaid>flowchart LR
    Breach[&#34;Data Breach&#34;]

    subgraph Direct[&#34;Direct Losses&#34;]
        D1[&#34;Regulatory Fines&lt;br/&gt;GDPR up to 4% global revenue&#34;]
        D2[&#34;Legal Costs&#34;]
        D3[&#34;Customer Compensation&#34;]
    end

    subgraph Indirect[&#34;Indirect Losses&#34;]
        I1[&#34;Brand Reputation Damage&#34;]
        I2[&#34;Customer Trust Loss&#34;]
        I3[&#34;Business Disruption&#34;]
    end

    subgraph Compliance[&#34;Compliance Risk&#34;]
        C1[&#34;Liability&#34;]
        C2[&#34;SOC 2: Certification Revocation&#34;]
        C3[&#34;Industry Access: Banned from Operating&#34;]
    end

    Breach --&gt; Direct
    Breach --&gt; Indirect
    Breach --&gt; Compliance</pre><hr><h2 id=default-users-and-passwords>Default Users and Passwords</h2><p>Pigsty creates these system users by default:</p><table><thead><tr><th style=text-align:left>User</th><th style=text-align:left>Purpose</th><th style=text-align:left>Default Password</th><th style=text-align:left>Post-Deploy Action</th></tr></thead><tbody><tr><td style=text-align:left><code>postgres</code></td><td style=text-align:left>System superuser</td><td style=text-align:left>No password (local only)</td><td style=text-align:left>Keep passwordless</td></tr><tr><td style=text-align:left><code>dbuser_dba</code></td><td style=text-align:left>Admin user</td><td style=text-align:left><code>DBUser.DBA</code></td><td style=text-align:left><strong>Must change</strong></td></tr><tr><td style=text-align:left><code>dbuser_monitor</code></td><td style=text-align:left>Monitor user</td><td style=text-align:left><code>DBUser.Monitor</code></td><td style=text-align:left><strong>Must change</strong></td></tr><tr><td style=text-align:left><code>replicator</code></td><td style=text-align:left>Replication user</td><td style=text-align:left><code>DBUser.Replicator</code></td><td style=text-align:left><strong>Must change</strong></td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pigsty.yml - Change default passwords</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;YourSecurePassword123!&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;AnotherSecurePass456!&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;ReplicationPass789!&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Important</strong>: After production deployment, <strong>immediately</strong> change these default passwords!</p><hr><h2 id=role-and-permission-system>Role and Permission System</h2><p>Pigsty provides a four-tier role system out of the box:</p><pre class=mermaid>flowchart TB
    subgraph Admin[&#34;dbrole_admin (Admin)&#34;]
        A1[&#34;Inherits dbrole_readwrite&#34;]
        A2[&#34;Can CREATE/DROP/ALTER objects (DDL)&#34;]
        A3[&#34;For: Business admins, apps needing table creation&#34;]
    end

    subgraph RW[&#34;dbrole_readwrite (Read-Write)&#34;]
        RW1[&#34;Inherits dbrole_readonly&#34;]
        RW2[&#34;Can INSERT/UPDATE/DELETE&#34;]
        RW3[&#34;For: Production business accounts&#34;]
    end

    subgraph RO[&#34;dbrole_readonly (Read-Only)&#34;]
        RO1[&#34;Can SELECT all tables&#34;]
        RO2[&#34;For: Reporting, data analysis&#34;]
    end

    subgraph Offline[&#34;dbrole_offline (Offline)&#34;]
        OFF1[&#34;Can only access offline instances&#34;]
        OFF2[&#34;For: ETL, personal analysis, slow queries&#34;]
    end

    Admin --&gt; |inherits| RW
    RW --&gt; |inherits| RO</pre><h3 id=creating-business-users>Creating Business Users</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Read-only user - for reporting</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_report</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ReportUser123</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readonly]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Read-write user - for production</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>AppUser456</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readwrite]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Admin user - for DDL operations</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>AdminUser789</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=hba-access-control>HBA Access Control</h2><p>HBA (Host-Based Authentication) controls &ldquo;who can connect from where&rdquo;:</p><pre class=mermaid>flowchart LR
    subgraph Sources[&#34;Connection Sources&#34;]
        S1[&#34;Local Socket&#34;]
        S2[&#34;localhost&#34;]
        S3[&#34;Intranet CIDR&#34;]
        S4[&#34;Admin Nodes&#34;]
        S5[&#34;External&#34;]
    end

    subgraph Auth[&#34;Auth Methods&#34;]
        A1[&#34;ident/peer&lt;br/&gt;OS user mapping, most secure&#34;]
        A2[&#34;scram-sha-256&lt;br/&gt;Password auth&#34;]
        A3[&#34;scram-sha-256 &#43; SSL&lt;br/&gt;Enforce SSL&#34;]
    end

    S1 --&gt; A1
    S2 --&gt; A2
    S3 --&gt; A2
    S4 --&gt; A3
    S5 --&gt; A3

    Note[&#34;Rules matched in order&lt;br/&gt;First matching rule applies&#34;]</pre><h3 id=custom-hba-rules>Custom HBA Rules</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Allow app servers from intranet</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: dbuser_app, db: mydb, addr: &#39;10.10.10.0/24&#39;, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>scram-sha-256}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Force SSL for certain users</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: admin, db: all, addr: world, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ssl}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Require certificate auth (highest security)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: secure_user, db: all, addr: world, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cert}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=encrypted-communication>Encrypted Communication</h2><h3 id=ssltls-architecture>SSL/TLS Architecture</h3><pre class=mermaid>sequenceDiagram
    participant Client as Client
    participant Server as PostgreSQL

    Client-&gt;&gt;Server: 1. ClientHello
    Server-&gt;&gt;Client: 2. ServerHello
    Server-&gt;&gt;Client: 3. Server Certificate
    Client-&gt;&gt;Server: 4. Client Key
    Client-&gt;&gt;Server: 5. Encrypted Channel Established
    Server-&gt;&gt;Client: 5. Encrypted Channel Established

    rect rgb(200, 255, 200)
        Note over Client,Server: Encrypted Data Transfer
        Client-&gt;&gt;Server: 6. Application Data (encrypted)
        Server-&gt;&gt;Client: 6. Application Data (encrypted)
    end

    Note over Client,Server: Prevents eavesdropping, tampering, verifies server identity</pre><h3 id=local-ca>Local CA</h3><p>Pigsty automatically generates a local CA and issues certificates:</p><pre tabindex=0><code>/etc/pki/
├── ca.crt              # CA certificate (public)
├── ca.key              # CA private key (keep secret!)
└── server.crt/key      # Server certificate/key
</code></pre><p><strong>Important</strong>: Securely back up <code>ca.key</code>—if lost, all certificates must be reissued!</p><hr><h2 id=compliance-mapping>Compliance Mapping</h2><h3 id=soc-2-type-ii>SOC 2 Type II</h3><table><thead><tr><th style=text-align:left>Control Point</th><th style=text-align:center>Pigsty Support</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>CC6.1 Logical Access Control</td><td style=text-align:center>Yes</td><td style=text-align:left>HBA + Role System</td></tr><tr><td style=text-align:left>CC6.6 Transmission Encryption</td><td style=text-align:center>Yes</td><td style=text-align:left>SSL/TLS</td></tr><tr><td style=text-align:left>CC7.2 System Monitoring</td><td style=text-align:center>Yes</td><td style=text-align:left>Prometheus + Grafana</td></tr><tr><td style=text-align:left>CC9.1 Business Continuity</td><td style=text-align:center>Yes</td><td style=text-align:left>HA + PITR</td></tr><tr><td style=text-align:left>A1.2 Data Recovery</td><td style=text-align:center>Yes</td><td style=text-align:left>pgBackRest Backup</td></tr></tbody></table><p><strong>Legend</strong>: Yes = Default satisfaction · Partial = Needs additional config</p><hr><h2 id=security-checklist>Security Checklist</h2><h3 id=before-deployment>Before Deployment</h3><ul><li><input disabled type=checkbox> Prepare strong passwords (use password manager)</li><li><input disabled type=checkbox> Plan network partitions (intranet/external CIDRs)</li><li><input disabled type=checkbox> Decide SSL strategy (self-signed/external CA)</li></ul><h3 id=after-deployment-required>After Deployment (Required)</h3><ul><li><input disabled type=checkbox> <strong>Change all default passwords</strong></li><li><input disabled type=checkbox> Verify HBA rules match expectations</li><li><input disabled type=checkbox> Test SSL connections work</li><li><input disabled type=checkbox> Configure auth failure alerts</li><li><input disabled type=checkbox> Securely back up CA private key</li></ul><h3 id=regular-maintenance>Regular Maintenance</h3><ul><li><input disabled type=checkbox> Audit user permissions</li><li><input disabled type=checkbox> Check for expired accounts</li><li><input disabled type=checkbox> Update certificates (if needed)</li><li><input disabled type=checkbox> Review audit logs</li></ul><hr><h2 id=quick-config-examples>Quick Config Examples</h2><h3 id=production-security-configuration>Production Security Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pigsty.yml - Production security config example</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Change default passwords (required!)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;SecureDBAPassword2024!&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;SecureMonitorPass2024!&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;SecureReplPass2024!&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Enable password strength check</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;passwordcheck, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Custom HBA rules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># App servers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: app, db: appdb, addr: &#39;10.10.10.0/24&#39;, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>scram-sha-256}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Admin enforce SSL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: dbuser_dba, db: all, addr: world, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ssl}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=financial-grade-security-configuration>Financial-Grade Security Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Financial-grade config - enable certificate auth</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Trading system uses certificate auth</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: trade_user, db: trade, addr: world, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cert}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Other systems use SSL + password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: all, db: all, addr: world, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ssl}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Enable backup encryption</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;YourBackupEncryptionKey&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=next-steps>Next Steps</h2><p>Deep dive into security configuration details:</p><ul><li><strong>Security Overview</strong>: Overall security architecture and checklist</li><li><a href=/docs/pgsql/config/hba><strong>Authentication</strong></a>: HBA rules and password policies</li><li><a href=ac/><strong>Access Control</strong></a>: Role system and permission model</li><li><a href=ca/><strong>Encrypted Communication</strong></a>: SSL/TLS and certificate management</li><li><strong>Compliance Checklist</strong>: Detailed SOC2 mapping</li></ul><p>Related topics:</p><ul><li><a href=/docs/concept/ha/><strong>High Availability</strong></a>: Business continuity assurance</li><li><a href=/docs/concept/pitr/><strong>Backup & Recovery</strong></a>: Data recovery capabilities</li><li><a href=/docs/concept/monitor><strong>Observability</strong></a>: Security event monitoring</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8b790153f8312a89aef83b802d30c481>1 - Local CA</h1><div class=lead>Pigsty includes a self-signed CA PKI infrastructure for issuing SSL certificates and encrypting network traffic.</div><p>Pigsty enables security best practices by default: using SSL to encrypt network traffic and HTTPS for web interfaces.</p><p>To achieve this, Pigsty includes a local self-signed CA for issuing SSL certificates and encrypting network communications.</p><p>By default, SSL and HTTPS are enabled but not enforced. For environments with higher security requirements, you can enforce SSL and HTTPS usage.</p><hr><h2 id=local-ca>Local CA</h2><p>During initialization, Pigsty generates a self-signed CA in the Pigsty source directory (<code>~/pigsty</code>) on the <a href=/docs/node/#admin-node>ADMIN node</a>. This CA can be used for SSL, HTTPS, digital signatures, issuing database client certificates, and advanced security features.</p><p>Each Pigsty deployment uses a unique CA—CAs from different Pigsty deployments are not mutually trusted.</p><p>The local CA consists of two files, located in the <code>files/pki/ca</code> directory by default:</p><ul><li><code>ca.crt</code>: Self-signed CA root certificate, distributed to all managed nodes for certificate verification.</li><li><code>ca.key</code>: CA private key for issuing certificates and verifying CA identity—<strong>keep this file secure and prevent leakage!</strong></li></ul><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>Protect the CA Private Key</div><p>Keep the CA private key file safe—don&rsquo;t lose it or leak it. We recommend encrypting and backing up this file after completing Pigsty installation.</p></div><hr><h2 id=using-an-existing-ca>Using an Existing CA</h2><p>If you already have your own CA PKI infrastructure, Pigsty can be configured to use your existing CA.</p><p>Simply place your CA public key and private key files in the <code>files/pki/ca</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>files/pki/ca/ca.key     <span style=color:#8f5902;font-style:italic># Core CA private key file, must exist; if missing, a new one is randomly generated</span>
</span></span><span style=display:flex><span>files/pki/ca/ca.crt     <span style=color:#8f5902;font-style:italic># If certificate file is missing, Pigsty auto-generates a new root certificate from the CA private key</span>
</span></span></code></pre></div><p>When Pigsty executes the <a href=/docs/infra/#installyml><strong><code>deploy.yml</code></strong></a> or <a href=/docs/infra/#infrayml><strong><code>infra.yml</code></strong></a> playbooks, if a <code>ca.key</code> private key file exists in <code>files/pki/ca</code>, the existing CA will be used. Since <code>ca.crt</code> can be generated from the <code>ca.key</code> private key, Pigsty will automatically regenerate the root certificate file if it&rsquo;s missing.</p><div class="alert alert-secondary" role=alert><div class="h4 alert-heading" role=heading>Note When Using Existing CA</div><p>You can set the <a href=/docs/infra/param#ca_method><strong><code>ca_method</code></strong></a> parameter to <code>copy</code> to ensure Pigsty errors out and stops if it can&rsquo;t find a local CA, rather than auto-generating a new self-signed CA.</p></div><hr><h2 id=trusting-the-ca>Trusting the CA</h2><p>During Pigsty installation, <code>ca.crt</code> is distributed to all nodes at <code>/etc/pki/ca.crt</code> during the <code>node_ca</code> task in the <a href=/docs/node/#nodeyml><strong><code>node.yml</code></strong></a> playbook.</p><p>EL-family and Debian-family operating systems have different default trusted CA certificate paths, so the distribution path and update methods differ:</p><ul class="nav nav-tabs" id=tabs-2 role=tablist><li class=nav-item><button class="nav-link disabled" id=tabs-02-00-tab data-bs-toggle=tab data-bs-target=#tabs-02-00 role=tab aria-controls=tabs-02-00 aria-selected=false>
Trust CA Certificate</button></li><li class=nav-item><button class="nav-link active" id=tabs-02-01-tab data-bs-toggle=tab data-bs-target=#tabs-02-01 role=tab aria-controls=tabs-02-01 aria-selected=true>
EL</button></li><li class=nav-item><button class=nav-link id=tabs-02-02-tab data-bs-toggle=tab data-bs-target=#tabs-02-02 role=tab aria-controls=tabs-02-02 aria-selected=false>
Debian / Ubuntu</button></li></ul><div class=tab-content id=tabs-2-content><div class="tab-pane fade" id=tabs-02-00 role=tabpanel aria-labelled-by=tabs-02-00-tab tabindex=2><pre tabindex=0><code></code></pre></div><div class="tab-pane fade show active" id=tabs-02-01 role=tabpanel aria-labelled-by=tabs-02-01-tab tabindex=2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash><span style=display:flex><span>rm -rf /etc/pki/ca-trust/source/anchors/ca.crt
</span></span><span style=display:flex><span>ln -s /etc/pki/ca.crt /etc/pki/ca-trust/source/anchors/ca.crt
</span></span><span style=display:flex><span>/bin/update-ca-trust</span></span></code></pre></div></div><div class="tab-pane fade" id=tabs-02-02 role=tabpanel aria-labelled-by=tabs-02-02-tab tabindex=2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash><span style=display:flex><span>rm -rf /usr/local/share/ca-certificates/ca.crt
</span></span><span style=display:flex><span>ln -s /etc/pki/ca.crt /usr/local/share/ca-certificates/ca.crt
</span></span><span style=display:flex><span>/usr/sbin/update-ca-certificates</span></span></code></pre></div></div></div><p>Pigsty issues HTTPS certificates for domain names used by web systems on infrastructure nodes by default, allowing HTTPS access to Pigsty&rsquo;s web interfaces.</p><p>If you want to avoid &ldquo;untrusted CA certificate&rdquo; warnings in client browsers, distribute <code>ca.crt</code> to the trusted certificate directory on client machines.</p><p>You can double-click the <code>ca.crt</code> file to add it to your system keychain. For example, on MacOS, open &ldquo;Keychain Access,&rdquo; search for <code>pigsty-ca</code>, and set it to &ldquo;trust&rdquo; this root certificate.</p><hr><h2 id=viewing-certificate-contents>Viewing Certificate Contents</h2><p>Use the following command to view the Pigsty CA certificate contents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl x509 -text -in /etc/pki/ca.crt
</span></span></code></pre></div><details><summary>Local CA Root Certificate Content Example</summary><pre tabindex=0><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            50:29:e3:60:96:93:f4:85:14:fe:44:81:73:b5:e1:09:2a:a8:5c:0a
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: O=pigsty, OU=ca, CN=pigsty-ca
        Validity
            Not Before: Feb  7 00:56:27 2023 GMT
            Not After : Jan 14 00:56:27 2123 GMT
        Subject: O=pigsty, OU=ca, CN=pigsty-ca
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (4096 bit)
                Modulus:
                    00:c1:41:74:4f:28:c3:3c:2b:13:a2:37:05:87:31:
                    ....
                    e6:bd:69:a5:5b:e3:b4:c0:65:09:6e:84:14:e9:eb:
                    90:f7:61
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Alternative Name:
                DNS:pigsty-ca
            X509v3 Key Usage:
                Digital Signature, Certificate Sign, CRL Sign
            X509v3 Basic Constraints: critical
                CA:TRUE, pathlen:1
            X509v3 Subject Key Identifier:
                C5:F6:23:CE:BA:F3:96:F6:4B:48:A5:B1:CD:D4:FA:2B:BD:6F:A6:9C
    Signature Algorithm: sha256WithRSAEncryption
    Signature Value:
        89:9d:21:35:59:6b:2c:9b:c7:6d:26:5b:a9:49:80:93:81:18:
        ....
        9e:dd:87:88:0d:c4:29:9e
-----BEGIN CERTIFICATE-----
...
cXyWAYcvfPae3YeIDcQpng==
-----END CERTIFICATE-----
</code></pre></details><hr><h2 id=issuing-certificates>Issuing Certificates</h2><p>If you want to use client certificate authentication, you can use the local CA and the <a href=https://github.com/pgsty/pigsty/blob/main/cert.yml><strong><code>cert.yml</code></strong></a> playbook to manually issue PostgreSQL client certificates.</p><p>Set the certificate&rsquo;s <code>CN</code> field to the database username:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_dba
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_monitor
</span></span></code></pre></div><p>Issued certificates are generated in <code>files/pki/misc/&lt;cn>.{key,crt}</code> by default.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-42af3045c7ebee43d7c66fbe8a4cd267>2 - Seven-Layer Security Model</h1><div class=lead>How Pigsty provides defense-in-depth across seven security layers, from physical security to user security.</div><p>Security is not a wall, but a fortress. Pigsty adopts a <strong>defense-in-depth</strong> strategy, building multiple protections across seven layers. Even if one layer is breached, other layers still provide protection.</p><hr><h2 id=overview>Overview</h2><div id=infographic-5c882599098b83b429f94bd07a85bb52 class="infographic-container td-max-width-on-larger-screens"></div><script>(function(){var e,t="infographic-5c882599098b83b429f94bd07a85bb52",s=`\`\`\`\`
infographic sequence-pyramid-simple
data
  title Seven-Layer Security Model
  desc Pigsty Defense-in-Depth: Multi-layer protection from physical to user security
  items
    - label Physical Security
      value 100
      desc Data Checksums · PGTDE Transparent Encryption
      time L1
      icon mingcute/building-4-fill
      illus server-cluster
    - label Network Security
      value 95
      desc Firewall · SSL/TLS Encryption · Local CA
      time L2
      icon mingcute/earth-2-fill
      illus secure-server
    - label Perimeter Security
      value 90
      desc HAProxy Proxy · Nginx Gateway
      time L3
      icon mingcute/shield-fill
      illus firewall-protection
    - label Host Security
      value 85
      desc SELinux · Least Privilege · System Hardening
      time L4
      icon mingcute/computer-fill
      illus server-status
    - label Application Security
      value 80
      desc HBA Rules · Password Policy · Connection Pool
      time L5
      icon mingcute/safe-box-fill
      illus database-security
    - label Data Security
      value 75
      desc Backup Encryption · Audit Logs · PITR
      time L6
      icon mingcute/lock-fill
      illus data-encryption
    - label User Security
      value 70
      desc Four-Role Model · RBAC · Certificate Auth
      time L7
      icon mingcute/user-security-fill
      illus user-flow
theme light
  palette pigsty
\`\`\`\``;function n(){var n,e=document.getElementById(t);if(!e){console.error("Infographic: container not found:",t);return}try{n=new AntVInfographic.Infographic({container:"#"+t,width:e.offsetWidth||"100%",height:"auto"}),n.render(s)}catch(t){console.error("Infographic render error:",t),e.innerHTML='<pre style="color: red;">Infographic Error: '+t.message+"</pre>"}}typeof AntVInfographic!="undefined"?n():window._infographicLoading?window._infographicCallbacks.push(n):(window._infographicLoading=!0,window._infographicCallbacks=[n],e=document.createElement("script"),e.src="/js/infographic.min.js",e.onload=function(){window._infographicCallbacks.forEach(function(e){e()})},document.head.appendChild(e))})()</script><hr><h2 id=physical-security>Physical Security</h2><blockquote><p>If physical access is compromised, other layers are rendered useless.</p></blockquote><p>Physical security is the most basic layer, involving data center access control, surveillance, environmental control, equipment theft prevention, power protection, etc. As a software solution, Pigsty provides the following protection mechanisms at the physical layer:</p><h3 id=data-checksums>Data Checksums</h3><p>Enabling data checksums can detect silent data corruption at the storage layer (e.g., bad disk blocks, memory errors, firmware bugs):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_checksum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Default enabled since v3.5+</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Principle</strong>: PostgreSQL calculates checksums when writing each data page and validates when reading. Reports error instead of returning corrupt data when corruption is detected.</p><p><strong>Fallback mechanism</strong>: Replica provides bad block fallback; damaged data pages on primary can be recovered from replica.</p><h3 id=transparent-data-encryption>Transparent Data Encryption</h3><p>For compliance-required scenarios, use <strong>PGTDE</strong> (PostgreSQL Transparent Data Encryption) extension:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pg_tde </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Transparent data encryption extension</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Effect</strong>: Data is stored encrypted on disk; data cannot be read even if physical media is stolen.</p><hr><h2 id=network-security>Network Security</h2><blockquote><p>Control access and filtering at the packet layer.</p></blockquote><h3 id=firewall>Firewall</h3><p>Pigsty supports node-level firewall configuration, controlling which ports are exposed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_firewall_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>zone      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># off | none | zone</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_firewall_intranet</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Intranet CIDR (trust zone)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>10.0.0.0</span><span style=color:#000>/8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>172.16.0.0</span><span style=color:#000>/12</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>192.168.0.0</span><span style=color:#000>/16</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_firewall_public_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># Public exposed ports</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># SSH</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># HTTP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#0000cf;font-weight:700>443</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># HTTPS</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Three Modes</strong>:</p><table><thead><tr><th style=text-align:left>Mode</th><th style=text-align:left>Description</th><th style=text-align:left>Use Case</th></tr></thead><tbody><tr><td style=text-align:left><code>off</code></td><td style=text-align:left>Don&rsquo;t configure firewall (default)</td><td style=text-align:left>Dev environment, existing security groups</td></tr><tr><td style=text-align:left><code>none</code></td><td style=text-align:left>Disable firewalld</td><td style=text-align:left>Using external firewall</td></tr><tr><td style=text-align:left><code>zone</code></td><td style=text-align:left>Zone mode: trust intranet, restrict public</td><td style=text-align:left>Production recommended</td></tr></tbody></table><h3 id=ssltls-encryption>SSL/TLS Encryption</h3><p>Pigsty provides SSL/TLS encryption at multiple layers:</p><table><thead><tr><th style=text-align:left>Component</th><th style=text-align:left>Parameter</th><th style=text-align:left>Default</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>PostgreSQL</td><td style=text-align:left>HBA <code>auth</code></td><td style=text-align:left><code>pwd</code></td><td style=text-align:left>Supports <code>ssl</code> (enforced), <code>cert</code> (certificate)</td></tr><tr><td style=text-align:left>Pgbouncer</td><td style=text-align:left><code>pgbouncer_sslmode</code></td><td style=text-align:left><code>disable</code></td><td style=text-align:left>Optional <code>require</code> / <code>verify-full</code></td></tr><tr><td style=text-align:left>Patroni</td><td style=text-align:left><code>patroni_ssl_enabled</code></td><td style=text-align:left><code>false</code></td><td style=text-align:left>REST API encryption</td></tr><tr><td style=text-align:left>Nginx</td><td style=text-align:left><code>nginx_sslmode</code></td><td style=text-align:left><code>enable</code></td><td style=text-align:left>Optional <code>enforce</code> (force HTTPS)</td></tr><tr><td style=text-align:left>MinIO</td><td style=text-align:left>Enabled by default</td><td style=text-align:left>enabled</td><td style=text-align:left>Uses local CA certificate</td></tr><tr><td style=text-align:left>etcd</td><td style=text-align:left>Enabled by default</td><td style=text-align:left>enabled</td><td style=text-align:left>TLS encrypted communication</td></tr></tbody></table><p><strong>Security Hardening Configuration</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_ssl_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Enable Patroni SSL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_sslmode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>require  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Force Pgbouncer SSL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_sslmode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>enforce      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Force HTTPS</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=local-ca-certificate-infrastructure>Local CA Certificate Infrastructure</h3><p>Pigsty automatically generates a local CA and issues certificates, no commercial certificates needed:</p><pre tabindex=0><code>files/pki/ca/
├── ca.crt              # CA certificate (public, distributed to all nodes)
└── ca.key              # CA private key (⚠️ Keep secret! Backup securely!)

/etc/pki/               # Certificate directory on nodes
├── ca.crt              # CA certificate
├── server.crt          # Server certificate
└── server.key          # Server private key
</code></pre><p><strong>⚠️ Important</strong>: Please securely backup <code>ca.key</code>. If lost, all certificates need to be re-issued!</p><hr><h2 id=perimeter-security>Perimeter Security</h2><blockquote><p>Handle security policies at internal/external network boundaries.</p></blockquote><h3 id=haproxy-security>HAProxy Security</h3><p>HAProxy serves as the unified entry point for database traffic, providing these security features:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;StrongPassword123&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Admin interface password</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Security Features</strong>:</p><ul><li>Health checks and traffic control to prevent split-brain</li><li>Connection limits and rate limiting</li><li>Admin interface password protection</li></ul><h3 id=nginx-security>Nginx Security</h3><p>Nginx serves as the unified gateway for web services, providing:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_sslmode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>enforce </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Force HTTPS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Configure component domains</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>g.pigsty.io }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>a.pigsty.io }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Security Features</strong>:</p><ul><li>Unified HTTPS entry, easy to audit</li><li>Reverse proxy protects backend services</li><li>Can integrate external authentication (OAuth, LDAP)</li></ul><hr><h2 id=host-security>Host Security</h2><blockquote><p>OS hardening, patch management, minimal installation.</p></blockquote><h3 id=selinux-configuration>SELinux Configuration</h3><p>Pigsty correctly configures SELinux policies to ensure PostgreSQL and other services run properly:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_selinux_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>permissive </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># disabled | permissive | enforcing</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><table><thead><tr><th style=text-align:left>Mode</th><th style=text-align:left>Description</th><th style=text-align:left>Use Case</th></tr></thead><tbody><tr><td style=text-align:left><code>disabled</code></td><td style=text-align:left>Completely disabled</td><td style=text-align:left>Dev environment</td></tr><tr><td style=text-align:left><code>permissive</code></td><td style=text-align:left>Permissive mode (log but don&rsquo;t block)</td><td style=text-align:left>Production recommended</td></tr><tr><td style=text-align:left><code>enforcing</code></td><td style=text-align:left>Enforcing mode</td><td style=text-align:left>High security environments</td></tr></tbody></table><h3 id=os-hardening>OS Hardening</h3><p>Pigsty follows the principle of least privilege in design:</p><ul><li><strong>File permissions</strong>: Sensitive files (e.g., CA private key) have strictly controlled permissions</li><li><strong>User groups</strong>: PostgreSQL, etcd, etc. run with dedicated users</li><li><strong>Admin configuration</strong>:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_admin_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dba       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Admin username</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_admin_sudo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>nopasswd      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># sudo policy</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=system-updates>System Updates</h3><p>Keep critical security components updated:</p><ul><li><code>openssh</code>: SSH service</li><li><code>ca-certificates</code>: System root certificates</li><li><code>openssl</code>: Encryption library</li></ul><hr><h2 id=application-security>Application Security</h2><blockquote><p>Database configuration, authentication/authorization, input validation.</p></blockquote><h3 id=password-policy>Password Policy</h3><h4 id=password-encryption-algorithm>Password Encryption Algorithm</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_pwd_enc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>scram-sha-256 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Most secure password hash algorithm</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><table><thead><tr><th style=text-align:left>Algorithm</th><th style=text-align:left>Security</th><th style=text-align:left>Compatibility</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>scram-sha-256</code></td><td style=text-align:left>⭐⭐⭐</td><td style=text-align:left>PostgreSQL 10+</td><td style=text-align:left>Recommended, default</td></tr><tr><td style=text-align:left><code>md5</code></td><td style=text-align:left>⭐</td><td style=text-align:left>All versions</td><td style=text-align:left>Only for legacy clients</td></tr></tbody></table><h4 id=password-strength-check>Password Strength Check</h4><p>Enable <code>passwordcheck</code> extension to enforce password complexity:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;$libdir/passwordcheck, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>passwordcheck </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Enforce password complexity</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>credcheck     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Additional password checks</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=password-expiration>Password Expiration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_app, password: &#39;SecurePass123&#39;, expire_in</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>365</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Expires in 1 year</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=hba-rules>HBA Rules</h3><p>HBA (Host-Based Authentication) controls &ldquo;who can connect from where, using what authentication method&rdquo;:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: local     ,auth: ident ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;dbsu local via ident&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: local     ,auth: ident ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;dbsu repl via ident&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: localhost ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;repl via localhost&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;repl from intranet&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#204a87;font-weight:700>,db: postgres    ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;repl from intranet&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: localhost ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor via localhost&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor from infra&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: ssl   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;admin from infra&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: ssl   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;admin from world&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all     ,addr: localhost ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;read from localhost&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all     ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;read from intranet&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_offline&#39; ,db: all     ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;offline from intranet&#39;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Authentication Methods</strong>:</p><table><thead><tr><th style=text-align:left>Alias</th><th style=text-align:left>Description</th><th style=text-align:left>Security Level</th></tr></thead><tbody><tr><td style=text-align:left><code>ident/peer</code></td><td style=text-align:left>OS user mapping</td><td style=text-align:left>⭐⭐⭐ Local only</td></tr><tr><td style=text-align:left><code>pwd</code></td><td style=text-align:left>Password auth (scram-sha-256)</td><td style=text-align:left>⭐⭐</td></tr><tr><td style=text-align:left><code>ssl</code></td><td style=text-align:left>Forced SSL + password</td><td style=text-align:left>⭐⭐⭐</td></tr><tr><td style=text-align:left><code>cert</code></td><td style=text-align:left>Client certificate auth</td><td style=text-align:left>⭐⭐⭐⭐ Highest</td></tr><tr><td style=text-align:left><code>deny</code></td><td style=text-align:left>Deny access</td><td style=text-align:left>-</td></tr></tbody></table><h3 id=listen-address>Listen Address</h3><p>Limit network interfaces PostgreSQL listens on:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_listen</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${ip},${vip},${lo}&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Only listen on specific IPs, not 0.0.0.0</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=data-security>Data Security</h2><blockquote><p>Encryption, backup, audit, integrity protection.</p></blockquote><h3 id=backup-encryption>Backup Encryption</h3><p>pgBackRest supports AES-256 encrypted backups:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># AES-256-CBC encryption</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pgBR.${pg_cluster}&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Use cluster name as part of password</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Effect</strong>: Backup files are stored encrypted; data cannot be read even if storage is compromised.</p><h3 id=audit-logs>Audit Logs</h3><h4 id=postgresql-audit-extensions>PostgreSQL Audit Extensions</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgaudit          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># SQL audit logs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgauditlogtofile </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Audit logs to file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pg_auth_mon      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Authentication monitoring</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pg_auditor       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Audit helper</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=connection-logs>Connection Logs</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Configure in pg_parameters</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_connections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Log connection establishment</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_disconnections</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>on</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># Log connection termination</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=slow-query-logs>Slow Query Logs</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>log_min_duration_statement</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1000</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Log queries &gt;1s</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=point-in-time-recovery-pitr>Point-in-Time Recovery (PITR)</h3><p>Pigsty configures pgBackRest for PITR by default:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                           </span><span style=color:#8f5902;font-style:italic># Local backup</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/backup</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                           </span><span style=color:#8f5902;font-style:italic># Remote backup</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># Retain 14 days</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=user-security>User Security</h2><blockquote><p>Identity authentication, permission management, behavior audit.</p></blockquote><h3 id=four-role-model>Four-Role Model</h3><p>Pigsty provides out-of-box four-tier permission roles:</p><pre class=mermaid>flowchart TB
    subgraph Admin[&#34;🔴 dbrole_admin (Administrator)&#34;]
        A1[&#34;Inherits dbrole_readwrite&#34;]
        A2[&#34;Can CREATE/DROP/ALTER (DDL)&#34;]
        A3[&#34;Use case: Business admins, schema-creating apps&#34;]
    end
    subgraph RW[&#34;🟡 dbrole_readwrite (Read-Write)&#34;]
        RW1[&#34;Inherits dbrole_readonly&#34;]
        RW2[&#34;Can INSERT/UPDATE/DELETE&#34;]
        RW3[&#34;Use case: Production business accounts&#34;]
    end
    subgraph RO[&#34;🟢 dbrole_readonly (Read-Only)&#34;]
        RO1[&#34;Can SELECT all tables&#34;]
        RO2[&#34;Use case: Reporting, data analysis&#34;]
    end
    subgraph Offline[&#34;🔵 dbrole_offline (Offline)&#34;]
        OFF1[&#34;Can only access offline instances&#34;]
        OFF2[&#34;Use case: ETL, slow queries, personal analysis&#34;]
    end

    Admin --&gt; |inherits| RW
    RW --&gt; |inherits| RO</pre><p><strong>Creating Business Users</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_report, password: &#39;ReportPass123&#39;, roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readonly] }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_app, password: &#39;AppPass456&#39;, roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readwrite] }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_admin, password: &#39;AdminPass789&#39;, roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin] }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=default-users-and-passwords>Default Users and Passwords</h3><table><thead><tr><th style=text-align:left>User</th><th style=text-align:left>Default Password</th><th style=text-align:left>Purpose</th><th style=text-align:left>Post-Deploy Action</th></tr></thead><tbody><tr><td style=text-align:left><code>postgres</code></td><td style=text-align:left>No password (local only)</td><td style=text-align:left>System superuser</td><td style=text-align:left>Keep without password</td></tr><tr><td style=text-align:left><code>dbuser_dba</code></td><td style=text-align:left><code>DBUser.DBA</code></td><td style=text-align:left>Admin user</td><td style=text-align:left><strong>Must change</strong></td></tr><tr><td style=text-align:left><code>dbuser_monitor</code></td><td style=text-align:left><code>DBUser.Monitor</code></td><td style=text-align:left>Monitor user</td><td style=text-align:left><strong>Must change</strong></td></tr><tr><td style=text-align:left><code>replicator</code></td><td style=text-align:left><code>DBUser.Replicator</code></td><td style=text-align:left>Replication user</td><td style=text-align:left><strong>Must change</strong></td></tr></tbody></table><p><strong>Auto-Generate Strong Passwords</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -g  <span style=color:#8f5902;font-style:italic># Automatically generate random strong passwords</span>
</span></span></code></pre></div><h3 id=certificate-authentication>Certificate Authentication</h3><p>Highest security level, requires clients to provide valid certificates:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: admin, db: all, addr: world, auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cert} </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Admin uses cert auth</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=etcd-and-minio-security>ETCD and MinIO Security</h3><p>Auxiliary components also use RBAC model and TLS encryption:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ETCD</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>etcd_root_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;Etcd.Root.Strong&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Must change</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MinIO</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_access_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minioadmin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;S3User.MinIO.Strong&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Must change</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest, secret_key: &#39;Min10.bAckup&#39;, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: dba, secret_key: &#39;S3User.DBA.Strong&#39;, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consoleAdmin }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=watchdog-protection>Watchdog Protection</h3><p>Prevents split-brain, ensures primary forced shutdown during failover:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_watchdog_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>required </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># off | automatic | required</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Effect</strong>: When Patroni process is abnormal, watchdog forces node restart to avoid dual-primary split-brain.</p><hr><h2 id=compliance-mapping>Compliance Mapping</h2><h3 id=china-mlps-level-3-gbt-22239-2019>China MLPS Level 3 (GB/T 22239-2019)</h3><table class=full-width><thead><tr><th style=text-align:left>Requirement</th><th style=text-align:center>Default</th><th style=text-align:center>Configurable</th><th style=text-align:left>Implementation</th></tr></thead><tbody><tr><td style=text-align:left>Unique Identity</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:left>Unique username identifier</td></tr><tr><td style=text-align:left>Password Complexity</td><td style=text-align:center>⚠️</td><td style=text-align:center>✅</td><td style=text-align:left><code>passwordcheck</code> extension</td></tr><tr><td style=text-align:left>Password Rotation</td><td style=text-align:center>⚠️</td><td style=text-align:center>✅</td><td style=text-align:left><code>expire_in</code> attribute</td></tr><tr><td style=text-align:left>Two-Factor Auth</td><td style=text-align:center>⚠️</td><td style=text-align:center>✅</td><td style=text-align:left>Certificate + password (<code>auth: cert</code>)</td></tr><tr><td style=text-align:left>Access Control</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:left>HBA + Four-role model</td></tr><tr><td style=text-align:left>Least Privilege</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:left><code>dbrole_readonly/readwrite/admin</code></td></tr><tr><td style=text-align:left>Encrypted Communication</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:left>SSL/TLS</td></tr><tr><td style=text-align:left>Audit Logs</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:left><code>pgaudit</code> + connection logs</td></tr><tr><td style=text-align:left>Data Integrity</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:left><code>pg_checksum: true</code></td></tr><tr><td style=text-align:left>Backup & Recovery</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:left>pgBackRest + PITR</td></tr></tbody></table><h3 id=soc-2-type-ii>SOC 2 Type II</h3><table class=full-width><thead><tr><th style=text-align:left>Control Point</th><th style=text-align:center>Pigsty Support</th><th style=text-align:left>Implementation</th></tr></thead><tbody><tr><td style=text-align:left>CC6.1 Logical Access Control</td><td style=text-align:center>✅</td><td style=text-align:left>HBA + RBAC</td></tr><tr><td style=text-align:left>CC6.6 Transmission Encryption</td><td style=text-align:center>✅</td><td style=text-align:left>SSL/TLS (can enforce)</td></tr><tr><td style=text-align:left>CC7.2 System Monitoring</td><td style=text-align:center>✅</td><td style=text-align:left>Prometheus + Grafana</td></tr><tr><td style=text-align:left>CC9.1 Business Continuity</td><td style=text-align:center>✅</td><td style=text-align:left>HA + PITR</td></tr><tr><td style=text-align:left>A1.2 Data Recovery</td><td style=text-align:center>✅</td><td style=text-align:left>pgBackRest backup</td></tr></tbody></table><p><strong>Legend</strong>: ✅ Default satisfied · ⚠️ Requires additional configuration</p><hr><h2 id=security-checklist>Security Checklist</h2><h3 id=pre-deployment>Pre-Deployment</h3><ul><li><input disabled type=checkbox> Prepare strong passwords (use <code>./configure -g</code> to auto-generate)</li><li><input disabled type=checkbox> Plan network partitioning (intranet/public CIDR)</li><li><input disabled type=checkbox> Determine SSL policy (self-signed CA or external CA)</li><li><input disabled type=checkbox> Determine whether to enable firewall</li></ul><h3 id=post-deployment-required>Post-Deployment (Required)</h3><ul><li><input disabled type=checkbox> <strong>Change all default passwords</strong></li><li><input disabled type=checkbox> Verify HBA rules meet expectations</li><li><input disabled type=checkbox> Test SSL connections work properly</li><li><input disabled type=checkbox> Configure authentication failure alerts</li><li><input disabled type=checkbox> Securely backup CA private key</li></ul><h3 id=security-enhancement-optional>Security Enhancement (Optional)</h3><ul><li><input disabled type=checkbox> Enable <code>passwordcheck</code> extension</li><li><input disabled type=checkbox> Force SSL (<code>pgbouncer_sslmode: require</code>)</li><li><input disabled type=checkbox> Enable certificate authentication (<code>auth: cert</code>)</li><li><input disabled type=checkbox> Enable <code>pgaudit</code> audit logs</li><li><input disabled type=checkbox> Enable backup encryption</li><li><input disabled type=checkbox> Enable Patroni SSL</li><li><input disabled type=checkbox> Enable watchdog</li><li><input disabled type=checkbox> Configure firewall rules</li><li><input disabled type=checkbox> Enable SELinux enforcing mode</li></ul><hr><h2 id=whats-next>What&rsquo;s Next</h2><p>Deep dive into security configuration details:</p><ul><li>👤 <a href=ac/><strong>Access Control</strong></a>: Role system and permission model</li><li>🔐 <a href=ca/><strong>Encrypted Communication</strong></a>: SSL/TLS and certificate management</li></ul><p>Related topics:</p><ul><li>♾️ <a href=../ha/><strong>High Availability</strong></a>: Business continuity assurance</li><li>⏰ <a href=../pitr/><strong>Backup & Recovery</strong></a>: Data recovery capabilities</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6a3742ed82b65fb5a722f76337bf835d>3 - Access Control</h1><div class=lead>Pigsty provides standard security practices with an out-of-the-box role and permission model.</div><blockquote><p>Pigsty provides an out-of-the-box access control model based on the <a href=#role-system>Role System</a> and <a href=#permission-system>Permission System</a>.</p></blockquote><p>Access control is important, but many users struggle to implement it properly. Pigsty provides a streamlined access control model that serves as a security baseline for your cluster.</p><hr><h2 id=role-system>Role System</h2><p>Pigsty&rsquo;s default role system includes four <a href=#default-roles>default roles</a> and four <a href=#default-users>default users</a>:</p><table><thead><tr><th>Role Name</th><th>Attributes</th><th>Member Of</th><th>Description</th></tr></thead><tbody><tr><td><code>dbrole_readonly</code></td><td><code>NOLOGIN</code></td><td></td><td>Role: Global read-only</td></tr><tr><td><code>dbrole_readwrite</code></td><td><code>NOLOGIN</code></td><td>dbrole_readonly</td><td>Role: Global read-write</td></tr><tr><td><code>dbrole_admin</code></td><td><code>NOLOGIN</code></td><td>pg_monitor,dbrole_readwrite</td><td>Role: Admin/Object creation</td></tr><tr><td><code>dbrole_offline</code></td><td><code>NOLOGIN</code></td><td></td><td>Role: Restricted read-only</td></tr><tr><td><code>postgres</code></td><td><code>SUPERUSER</code></td><td></td><td>System superuser</td></tr><tr><td><code>replicator</code></td><td><code>REPLICATION</code></td><td>pg_monitor,dbrole_readonly</td><td>System replication user</td></tr><tr><td><code>dbuser_dba</code></td><td><code>SUPERUSER</code></td><td>dbrole_admin</td><td>PostgreSQL admin user</td></tr><tr><td><code>dbuser_monitor</code></td><td></td><td>pg_monitor</td><td>PostgreSQL monitor user</td></tr></tbody></table><p>These <a href=/docs/pgsql/config/user#define-users>roles and users</a> are defined as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># Global default roles and system users</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readonly  ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-only access     }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_offline   ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for restricted read-only access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readwrite ,login: false ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-write access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin     ,login: false ,roles: [pg_monitor, dbrole_readwrite] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for object creation }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres     ,superuser: true  ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system superuser }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replicator ,replication: true  ,roles: [pg_monitor, dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system replicator }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_dba   ,superuser: true  ,roles: [dbrole_admin]  ,pgbouncer: true ,pool_mode: session, pool_connlimit: 16 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_monitor ,roles: [pg_monitor] ,pgbouncer: true ,parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>log_min_duration_statement: 1000 } ,pool_mode: session ,pool_connlimit: 8 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql monitor user }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=default-roles>Default Roles</h2><p>Pigsty has four default roles:</p><ul><li><strong>Business Read-Only</strong> (<code>dbrole_readonly</code>): Role for global read-only access. Use this if other services need read-only access to this database.</li><li><strong>Business Read-Write</strong> (<code>dbrole_readwrite</code>): Role for global read-write access. Production accounts for primary business should have database read-write permissions.</li><li><strong>Business Admin</strong> (<code>dbrole_admin</code>): Role with DDL permissions. Typically used for business administrators or scenarios requiring table creation in applications.</li><li><strong>Offline Read-Only</strong> (<code>dbrole_offline</code>): Restricted read-only access role (can only access <a href=/docs/pgsql/config#offline-replica>offline</a> instances). Usually for personal users or ETL tool accounts.</li></ul><p>Default roles are defined in <a href=/docs/pgsql/param#pg_default_roles><code>pg_default_roles</code></a>. Unless you know what you&rsquo;re doing, don&rsquo;t change the default role names.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readonly  , login: false , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-only access  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_offline ,   login: false , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for restricted read-only access (offline instance) }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readwrite , login: false , roles: [dbrole_readonly], comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-write access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin , login: false , roles: [pg_monitor, dbrole_readwrite] , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for object creation }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=default-users>Default Users</h2><p>Pigsty also has four default users (system users):</p><ul><li><strong>Superuser</strong> (<code>postgres</code>): Cluster owner and creator, same name as OS dbsu.</li><li><strong>Replication User</strong> (<code>replicator</code>): System user for primary-replica replication.</li><li><strong>Monitor User</strong> (<code>dbuser_monitor</code>): User for monitoring database and connection pool metrics.</li><li><strong>Admin User</strong> (<code>dbuser_dba</code>): Administrator for daily operations and database changes.</li></ul><p>These 4 default users&rsquo; username/password are defined by 4 pairs of dedicated parameters and referenced in many places:</p><ul><li><a href=/docs/pgsql/param#pg_dbsu><code>pg_dbsu</code></a>: OS dbsu name, defaults to postgres. Best not to change it.</li><li><a href=/docs/pgsql/param#pg_dbsu_password><code>pg_dbsu_password</code></a>: dbsu password, default empty means no password. Best not to set it.</li><li><a href=/docs/pgsql/param#pg_replication_username><code>pg_replication_username</code></a>: Replication username, defaults to <code>replicator</code></li><li><a href=/docs/pgsql/param#pg_replication_password><code>pg_replication_password</code></a>: Replication password, defaults to <code>DBUser.Replicator</code></li><li><a href=/docs/pgsql/param#pg_admin_username><code>pg_admin_username</code></a>: Admin username, defaults to <code>dbuser_dba</code></li><li><a href=/docs/pgsql/param#pg_admin_password><code>pg_admin_password</code></a>: Admin password plaintext, defaults to <code>DBUser.DBA</code></li><li><a href=/docs/pgsql/param#pg_monitor_username><code>pg_monitor_username</code></a>: Monitor username, defaults to <code>dbuser_monitor</code></li><li><a href=/docs/pgsql/param#pg_monitor_password><code>pg_monitor_password</code></a>: Monitor password, defaults to <code>DBUser.Monitor</code></li></ul><blockquote><p><strong>Remember to change these passwords in production deployments—don&rsquo;t use defaults!</strong></p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres                            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Database superuser name, recommended not to change</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># Database superuser password, recommended to leave empty!</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_replication_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replicator          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># System replication username</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Replicator   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># System replication password, must change!</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_monitor_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_monitor          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># System monitor username</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Monitor          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># System monitor password, must change!</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_admin_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_dba                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># System admin username</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.DBA                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># System admin password, must change!</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=permission-system>Permission System</h2><p>Pigsty has an out-of-the-box permission model that works with <a href=#default-roles>default roles</a>.</p><ul><li>All users can access all schemas.</li><li>Read-only users (<code>dbrole_readonly</code>) can read from all tables. (SELECT, EXECUTE)</li><li>Read-write users (<code>dbrole_readwrite</code>) can write to all tables and run DML. (INSERT, UPDATE, DELETE)</li><li>Admin users (<code>dbrole_admin</code>) can create objects and run DDL. (CREATE, USAGE, TRUNCATE, REFERENCES, TRIGGER)</li><li>Offline users (<code>dbrole_offline</code>) are similar to read-only but with restricted access—only <a href=/docs/pgsql/config#offline-replica>offline instances</a> (<code>pg_role = 'offline'</code> or <code>pg_offline_query = true</code>)</li><li>Objects created by admin users will have correct permissions.</li><li>Default privileges are configured on all databases, including template databases.</li><li>Database connection permissions are managed by database <a href=/docs/pgsql/config/db#define-database>definition</a>.</li><li><code>CREATE</code> privilege on databases and <code>public</code> schema is revoked from <code>PUBLIC</code> by default.</li></ul><hr><h2 id=object-privileges>Object Privileges</h2><p>Default privileges for newly created objects are controlled by <a href=/docs/pgsql/param#pg_default_privileges><code>pg_default_privileges</code></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT INSERT     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT UPDATE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT DELETE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT USAGE      ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT UPDATE     ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT TRUNCATE   ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT REFERENCES ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT TRIGGER    ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>GRANT CREATE     ON SCHEMAS   TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Objects <strong>newly created</strong> by admins will have the above privileges by default. Use <code>\ddp+</code> to view these default privileges:</p><table><thead><tr><th>Type</th><th>Access Privileges</th></tr></thead><tbody><tr><td>Function</td><td>=X</td></tr><tr><td></td><td>dbrole_readonly=X</td></tr><tr><td></td><td>dbrole_offline=X</td></tr><tr><td></td><td>dbrole_admin=X</td></tr><tr><td>Schema</td><td>dbrole_readonly=U</td></tr><tr><td></td><td>dbrole_offline=U</td></tr><tr><td></td><td>dbrole_admin=UC</td></tr><tr><td>Sequence</td><td>dbrole_readonly=r</td></tr><tr><td></td><td>dbrole_offline=r</td></tr><tr><td></td><td>dbrole_readwrite=wU</td></tr><tr><td></td><td>dbrole_admin=rwU</td></tr><tr><td>Table</td><td>dbrole_readonly=r</td></tr><tr><td></td><td>dbrole_offline=r</td></tr><tr><td></td><td>dbrole_readwrite=awd</td></tr><tr><td></td><td>dbrole_admin=arwdDxt</td></tr></tbody></table><hr><h2 id=default-privileges>Default Privileges</h2><p>The SQL statement <a href=https://www.postgresql.org/docs/current/sql-alterdefaultprivileges.html><code>ALTER DEFAULT PRIVILEGES</code></a> lets you set privileges for future objects. It doesn&rsquo;t affect existing objects or objects created by non-admin users.</p><p>In Pigsty, default privileges are defined for three roles:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a40000>{</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8> </span><span style=color:#000>priv</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>in</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_default_privileges</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#a40000>}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>PRIVILEGES</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOR</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ROLE</span><span style=color:#f8f8f8> </span><span style=color:#a40000>{{</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_dbsu</span><span style=color:#f8f8f8> </span><span style=color:#a40000>}}</span><span style=color:#f8f8f8> </span><span style=color:#a40000>{{</span><span style=color:#f8f8f8> </span><span style=color:#000>priv</span><span style=color:#f8f8f8> </span><span style=color:#a40000>}}</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#a40000>{</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#f8f8f8> </span><span style=color:#000>endfor</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#a40000>}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#a40000>{</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8> </span><span style=color:#000>priv</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>in</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_default_privileges</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#a40000>}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>PRIVILEGES</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOR</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ROLE</span><span style=color:#f8f8f8> </span><span style=color:#a40000>{{</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_admin_username</span><span style=color:#f8f8f8> </span><span style=color:#a40000>}}</span><span style=color:#f8f8f8> </span><span style=color:#a40000>{{</span><span style=color:#f8f8f8> </span><span style=color:#000>priv</span><span style=color:#f8f8f8> </span><span style=color:#a40000>}}</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#a40000>{</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#f8f8f8> </span><span style=color:#000>endfor</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#a40000>}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- For other business admins, they should SET ROLE dbrole_admin before executing DDL
</span></span></span><span style=display:flex><span><span style=color:#a40000>{</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8> </span><span style=color:#000>priv</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>in</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_default_privileges</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#a40000>}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>PRIVILEGES</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOR</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ROLE</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;dbrole_admin&#34;</span><span style=color:#f8f8f8> </span><span style=color:#a40000>{{</span><span style=color:#f8f8f8> </span><span style=color:#000>priv</span><span style=color:#f8f8f8> </span><span style=color:#a40000>}}</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#a40000>{</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#f8f8f8> </span><span style=color:#000>endfor</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#a40000>}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>To maintain correct object permissions, you must execute DDL with <strong>admin users</strong>:</p><ol><li><a href=/docs/pgsql/param#pg_dbsu><code>{{ pg_dbsu }}</code></a>, defaults to <code>postgres</code></li><li><a href=/docs/pgsql/param#pg_admin_username><code>{{ pg_admin_username }}</code></a>, defaults to <code>dbuser_dba</code></li><li>Business admin users granted <code>dbrole_admin</code> role (using <code>SET ROLE</code> to switch to <code>dbrole_admin</code>)</li></ol><p>Using <code>postgres</code> as global object owner is wise. If creating objects as business admin, use <code>SET ROLE dbrole_admin</code> before creation to maintain correct permissions.</p><hr><h2 id=database-privileges>Database Privileges</h2><p>In Pigsty, database-level privileges are covered in <a href=#define-database>database definition</a>.</p><p>Databases have three privilege levels: <code>CONNECT</code>, <code>CREATE</code>, <code>TEMP</code>, and a special &lsquo;privilege&rsquo;: <code>OWNERSHIP</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Required, `name` is the only required field</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional, database owner, defaults to postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>allowconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Optional, allow connections, default true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Optional, revoke public connect privilege, default false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li>If <code>owner</code> parameter exists, it becomes database owner instead of <a href=/docs/pgsql/param#pg_dbsu><code>{{ pg_dbsu }}</code></a></li><li>If <code>revokeconn</code> is <code>false</code>, all users have database <code>CONNECT</code> privilege (default behavior)</li><li>If <code>revokeconn</code> is explicitly <code>true</code>:<ul><li>Database <code>CONNECT</code> privilege is revoked from <code>PUBLIC</code></li><li><code>CONNECT</code> privilege is explicitly granted to <code>{{ pg_replication_username }}</code>, <code>{{ pg_monitor_username }}</code>, <code>{{ pg_admin_username }}</code></li><li><code>CONNECT</code> privilege with <code>GRANT OPTION</code> is granted to database owner</li></ul></li><li><code>revokeconn</code> can isolate cross-database access within the same cluster</li></ul><hr><h2 id=create-privilege>CREATE Privilege</h2><p>For security, Pigsty revokes <code>CREATE</code> privilege on databases from <code>PUBLIC</code> by default. This is also default behavior since PostgreSQL 15.</p><p>Database owners can always adjust CREATE privileges based on actual needs.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script type=module async>
  import mermaid from "https:\/\/cdn.jsdelivr.net\/npm\/mermaid@latest\/dist\/mermaid.esm.min.mjs";

  (function ($) {
    if ($('.mermaid').length == 0) {
      mermaid.initialize({ startOnLoad: false });
      return;
    }

    var params = {};

    
    
    var norm = function (defaultConfig, params) {
      var result = {};
      for (const key in defaultConfig) {
        const keyLower = key.toLowerCase();
        if (defaultConfig.hasOwnProperty(key) && params.hasOwnProperty(keyLower)) {
          if (typeof defaultConfig[key] === "object") {
            result[key] = norm(defaultConfig[key], params[keyLower]);
          } else {
            result[key] = params[keyLower];
          }
        }
      }
      return result;
    };

    var settings = norm(mermaid.mermaidAPI.defaultConfig, params);
    settings.startOnLoad = true;
    if ($('html[data-bs-theme="dark"]').length) {
      settings.theme = 'dark';
    }
    mermaid.initialize(settings);

    
    const lightDarkModeThemeChangeHandler = function (mutationsList, observer) {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
          
          
          
          location.reload();
        }
      }
    };

    const observer = new MutationObserver(lightDarkModeThemeChangeHandler);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-bs-theme']
    });
    

  })(jQuery);
</script><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>