<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/concept/model/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/concept/model/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>ER Model | PIGSTY</title><meta name=description content="How Pigsty abstracts different functionality into modules, and the E-R diagrams for these modules."><meta property="og:url" content="https://pigsty.io/docs/concept/model/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="ER Model"><meta property="og:description" content="How Pigsty abstracts different functionality into modules, and the E-R diagrams for these modules."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="ER Model"><meta itemprop=description content="How Pigsty abstracts different functionality into modules, and the E-R diagrams for these modules."><meta itemprop=dateModified content="2026-01-10T21:56:22+08:00"><meta itemprop=wordCount content="143"><meta itemprop=keywords content="Concept,PIGSTY"><meta name=twitter:card content="summary"><meta name=twitter:title content="ER Model"><meta name=twitter:description content="How Pigsty abstracts different functionality into modules, and the E-R diagrams for these modules."><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/concept/model/>Return to the regular view of this page</a>.</p></div><h1 class=title>ER Model</h1><div class=lead>How Pigsty abstracts different functionality into modules, and the E-R diagrams for these modules.</div><ul><li>1: <a href=#pg-2ad10e50acca12cdeaaf406b2cf23f3b>E-R Model of Infra Cluster</a></li><li>2: <a href=#pg-97ed05d79e93eabb25565a36bc328883>E-R Model of PostgreSQL Cluster</a></li><li>3: <a href=#pg-5a875c30b5ea163b13415e0cf143a46f>E-R Model of Etcd Cluster</a></li><li>4: <a href=#pg-c495cfba1010bd7cf73164bea4ebc4f3>E-R Model of MinIO Cluster</a></li><li>5: <a href=#pg-0de22cd0f8c383fe4e1ef5a4eb6b5440>E-R Model of Redis Cluster</a></li></ul><div class=content><p>The largest entity concept in Pigsty is a <strong>Deployment</strong>. The main entities and relationships (E-R diagram) in a deployment are shown below:</p><p><img src=/img/pigsty/er-full.svg alt></p><p>A deployment can also be understood as an <strong>Environment</strong>. For example, Production (Prod), User Acceptance Testing (UAT), Staging, Testing, Development (Devbox), etc.
Each environment corresponds to a Pigsty <a href=/docs/concept/iac/inventory><strong>inventory</strong></a> that describes all entities and attributes in that environment.</p><p>Typically, an environment includes shared infrastructure (<a href=/docs/infra><strong><code>INFRA</code></strong></a>), which broadly includes <a href=/docs/etcd><strong><code>ETCD</code></strong></a> (HA DCS) and <a href=/docs/minio><strong><code>MINIO</code></strong></a> (centralized backup repository),
serving multiple PostgreSQL database clusters (and other database module components). (Exception: there are also <a href=/docs/setup/slim><strong>deployments without infrastructure</strong></a>)</p><p>In Pigsty, almost all database modules are organized as &ldquo;<strong>Clusters</strong>&rdquo;. Each cluster is an Ansible group containing several node resources.
For example, PostgreSQL HA database clusters, Redis, Etcd/MinIO all exist as clusters. An environment can contain multiple clusters.</p><ul><li><a href=/docs/concept/model/pgsql><strong>PostgreSQL Cluster</strong></a></li><li><a href=/docs/concept/model/etcd><strong>ETCD Cluster</strong></a></li><li><a href=/docs/concept/model/minio><strong>MinIO Cluster</strong></a></li><li><a href=/docs/concept/model/redis><strong>Redis Cluster</strong></a></li><li><a href=/docs/concept/model/infra><strong>INFRA Nodes</strong></a></li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2ad10e50acca12cdeaaf406b2cf23f3b>1 - E-R Model of Infra Cluster</h1><div class=lead>Entity-Relationship model for INFRA infrastructure nodes in Pigsty, component composition, and naming conventions.</div><p>The INFRA module plays a special role in Pigsty: it&rsquo;s not a traditional &ldquo;cluster&rdquo; but rather a management hub composed of a group of <strong>infrastructure nodes</strong>, providing core services for the entire Pigsty deployment.
Each INFRA node is an <strong>autonomous</strong> infrastructure service unit running core components like Nginx, Grafana, and VictoriaMetrics, collectively providing observability and management capabilities for managed database clusters.</p><p>There are two core entities in Pigsty&rsquo;s INFRA module:</p><ul><li><strong>Node</strong>: A server running infrastructure components—can be bare metal, VM, container, or Pod.</li><li><strong>Component</strong>: Various infrastructure services running on nodes, such as Nginx, Grafana, VictoriaMetrics, etc.</li></ul><p>INFRA nodes typically serve as Admin Nodes, the control plane of Pigsty.</p><hr><h2 id=component-composition>Component Composition</h2><p>Each INFRA node runs the following core components:</p><table class=full-width><thead><tr><th style=text-align:left>Component</th><th style=text-align:left>Port</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/concept/arch/infra#nginx><strong>Nginx</strong></a></td><td style=text-align:left><code>80/443</code></td><td style=text-align:left>Web portal, local repo, unified reverse proxy</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#grafana><strong>Grafana</strong></a></td><td style=text-align:left><code>3000</code></td><td style=text-align:left>Visualization platform, dashboards, data apps</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#victoriametrics><strong>VictoriaMetrics</strong></a></td><td style=text-align:left><code>8428</code></td><td style=text-align:left>Time-series database, Prometheus API compatible</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#victorialogs><strong>VictoriaLogs</strong></a></td><td style=text-align:left><code>9428</code></td><td style=text-align:left>Log database, receives structured logs from Vector</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#victoriatraces><strong>VictoriaTraces</strong></a></td><td style=text-align:left><code>10428</code></td><td style=text-align:left>Trace storage for slow SQL / request tracing</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#vmalert><strong>VMAlert</strong></a></td><td style=text-align:left><code>8880</code></td><td style=text-align:left>Alert rule evaluator based on VictoriaMetrics</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#alertmanager><strong>Alertmanager</strong></a></td><td style=text-align:left><code>9059</code></td><td style=text-align:left>Alert aggregation and dispatch</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#blackboxexporter><strong>Blackbox Exporter</strong></a></td><td style=text-align:left><code>9115</code></td><td style=text-align:left>ICMP/TCP/HTTP black-box probing</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#dnsmasq><strong>DNSMASQ</strong></a></td><td style=text-align:left><code>53</code></td><td style=text-align:left>DNS server for internal domain resolution</td></tr><tr><td style=text-align:left><a href=/docs/concept/arch/infra#chronyd><strong>Chronyd</strong></a></td><td style=text-align:left><code>123</code></td><td style=text-align:left>NTP time server</td></tr></tbody></table><p>These components together form Pigsty&rsquo;s observability infrastructure.</p><hr><h2 id=examples>Examples</h2><p>Let&rsquo;s look at a concrete example with a two-node INFRA deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The above config fragment defines a two-node INFRA deployment:</p><table class=full-width><thead><tr><th style=text-align:center><span class=text-secondary><strong>Group</strong></span></th><th><span class=text-secondary><strong>Description</strong></span></th></tr></thead><tbody><tr><td style=text-align:center><strong><code>infra</code></strong></td><td>INFRA infrastructure node group</td></tr><tr><td style=text-align:center><span class=text-danger><strong>Node</strong></span></td><td><span class=text-danger><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>infra-1</code></strong></td><td><code>10.10.10.10</code> INFRA node #1</td></tr><tr><td style=text-align:center><strong><code>infra-2</code></strong></td><td><code>10.10.10.11</code> INFRA node #2</td></tr></tbody></table><p>For production environments, deploying at least two INFRA nodes is recommended for infrastructure component redundancy.</p><hr><h2 id=identity-parameters>Identity Parameters</h2><p>Pigsty uses the <a href=/docs/infra/param#infra_id><strong><code>INFRA_ID</code></strong></a> parameter group to assign deterministic identities to each INFRA module entity. One parameter is required:</p><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th><th style=text-align:left>Format</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/infra/param#infra_seq><strong><code>infra_seq</code></strong></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center>Node</td><td style=text-align:left>INFRA node sequence, required</td><td style=text-align:left>Natural number, starting from 1, unique within group</td></tr></tbody></table><p>With node sequence assigned at node level, Pigsty automatically generates unique identifiers for each entity based on rules:</p><table class=full-width><thead><tr><th>Entity</th><th style=text-align:left>Generation Rule</th><th style=text-align:left>Example</th></tr></thead><tbody><tr><td><strong>Node</strong></td><td style=text-align:left><code>infra-{{ infra_seq }}</code></td><td style=text-align:left><code>infra-1</code>, <code>infra-2</code></td></tr></tbody></table><p>The INFRA module assigns <code>infra-N</code> format identifiers to nodes for distinguishing multiple infrastructure nodes in the monitoring system.
However, this doesn&rsquo;t change the node&rsquo;s hostname or system identity; nodes still use their existing hostname or IP address for identification.</p><hr><h2 id=service-portal>Service Portal</h2><p>INFRA nodes provide unified web service entry through Nginx. The <a href=/docs/infra/param#infra_portal><strong><code>infra_portal</code></strong></a> parameter defines services exposed through Nginx.</p><p>The default configuration only defines the home server:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty automatically configures reverse proxy endpoints for enabled components (Grafana, VictoriaMetrics, AlertManager, etc.). If you need to access these services via separate domains, you can explicitly add configurations:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>prometheus   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># VMUI</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:left>Domain</th><th style=text-align:left>Service</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>i.pigsty</code></td><td style=text-align:left>Home</td><td style=text-align:left>Pigsty homepage</td></tr><tr><td style=text-align:left><code>g.pigsty</code></td><td style=text-align:left>Grafana</td><td style=text-align:left>Monitoring dashboard</td></tr><tr><td style=text-align:left><code>p.pigsty</code></td><td style=text-align:left>VictoriaMetrics</td><td style=text-align:left>TSDB Web UI</td></tr><tr><td style=text-align:left><code>a.pigsty</code></td><td style=text-align:left>Alertmanager</td><td style=text-align:left>Alert management UI</td></tr></tbody></table><p>Accessing Pigsty services via domain names is recommended over direct IP + port.</p><hr><h2 id=deployment-scale>Deployment Scale</h2><p>The number of INFRA nodes depends on deployment scale and HA requirements:</p><table class=full-width><thead><tr><th style=text-align:left>Scale</th><th style=text-align:left>INFRA Nodes</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>Dev/Test</td><td style=text-align:left>1</td><td style=text-align:left>Single-node deployment, all on one node</td></tr><tr><td style=text-align:left>Small Prod</td><td style=text-align:left>1-2</td><td style=text-align:left>Single or dual node, can share with other services</td></tr><tr><td style=text-align:left>Medium Prod</td><td style=text-align:left>2-3</td><td style=text-align:left>Dedicated INFRA nodes, redundant components</td></tr><tr><td style=text-align:left>Large Prod</td><td style=text-align:left>3+</td><td style=text-align:left>Multiple INFRA nodes, component separation</td></tr></tbody></table><p>In <a href=/docs/setup/install><strong>singleton deployment</strong></a>, INFRA components share the same node with PGSQL, ETCD, etc.
In small-scale deployments, INFRA nodes typically also serve as &ldquo;<a href=/docs/concept/arch/node#admin-node><strong>Admin Node</strong></a>&rdquo; / backup admin node and local software repository (<code>/www/pigsty</code>).
In larger deployments, these responsibilities can be separated to dedicated nodes.</p><hr><h2 id=monitoring-label-system>Monitoring Label System</h2><p>Pigsty&rsquo;s monitoring system collects metrics from INFRA components themselves. Unlike database modules, each <strong>component</strong> in the INFRA module is treated as an independent monitoring object, distinguished by the <code>cls</code> (class) label.</p><table class=full-width><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th><th style=text-align:left>Example</th></tr></thead><tbody><tr><td style=text-align:left><code>cls</code></td><td style=text-align:left>Component type, each forming a &ldquo;class&rdquo;</td><td style=text-align:left><code>nginx</code></td></tr><tr><td style=text-align:left><code>ins</code></td><td style=text-align:left>Instance name, format <code>{component}-{infra_seq}</code></td><td style=text-align:left><code>nginx-1</code></td></tr><tr><td style=text-align:left><code>ip</code></td><td style=text-align:left>INFRA node IP running the component</td><td style=text-align:left><code>10.10.10.10</code></td></tr><tr><td style=text-align:left><code>job</code></td><td style=text-align:left>VictoriaMetrics scrape job, fixed as <code>infra</code></td><td style=text-align:left><code>infra</code></td></tr></tbody></table><p>Using a two-node INFRA deployment (<code>infra_seq: 1</code> and <code>infra_seq: 2</code>) as example, component monitoring labels are:</p><table class=full-width><thead><tr><th style=text-align:left>Component</th><th style=text-align:left><code>cls</code></th><th style=text-align:left><code>ins</code> Example</th><th style=text-align:left>Port</th></tr></thead><tbody><tr><td style=text-align:left><strong>Nginx</strong></td><td style=text-align:left><code>nginx</code></td><td style=text-align:left><code>nginx-1</code>, <code>nginx-2</code></td><td style=text-align:left><code>9113</code></td></tr><tr><td style=text-align:left><strong>Grafana</strong></td><td style=text-align:left><code>grafana</code></td><td style=text-align:left><code>grafana-1</code>, <code>grafana-2</code></td><td style=text-align:left><code>3000</code></td></tr><tr><td style=text-align:left><strong>VictoriaMetrics</strong></td><td style=text-align:left><code>vmetrics</code></td><td style=text-align:left><code>vmetrics-1</code>, <code>vmetrics-2</code></td><td style=text-align:left><code>8428</code></td></tr><tr><td style=text-align:left><strong>VictoriaLogs</strong></td><td style=text-align:left><code>vlogs</code></td><td style=text-align:left><code>vlogs-1</code>, <code>vlogs-2</code></td><td style=text-align:left><code>9428</code></td></tr><tr><td style=text-align:left><strong>VictoriaTraces</strong></td><td style=text-align:left><code>vtraces</code></td><td style=text-align:left><code>vtraces-1</code>, <code>vtraces-2</code></td><td style=text-align:left><code>10428</code></td></tr><tr><td style=text-align:left><strong>VMAlert</strong></td><td style=text-align:left><code>vmalert</code></td><td style=text-align:left><code>vmalert-1</code>, <code>vmalert-2</code></td><td style=text-align:left><code>8880</code></td></tr><tr><td style=text-align:left><strong>Alertmanager</strong></td><td style=text-align:left><code>alertmanager</code></td><td style=text-align:left><code>alertmanager-1</code>, <code>alertmanager-2</code></td><td style=text-align:left><code>9059</code></td></tr><tr><td style=text-align:left><strong>Blackbox</strong></td><td style=text-align:left><code>blackbox</code></td><td style=text-align:left><code>blackbox-1</code>, <code>blackbox-2</code></td><td style=text-align:left><code>9115</code></td></tr></tbody></table><p>All INFRA component metrics use a unified <code>job="infra"</code> label, distinguished by the <code>cls</code> label:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>nginx_up{cls=&#34;nginx&#34;, ins=&#34;nginx-1&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;infra&#34;}
</span></span><span style=display:flex><span>grafana_info{cls=&#34;grafana&#34;, ins=&#34;grafana-1&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;infra&#34;}
</span></span><span style=display:flex><span>vm_app_version{cls=&#34;vmetrics&#34;, ins=&#34;vmetrics-1&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;infra&#34;}
</span></span><span style=display:flex><span>vlogs_rows_ingested_total{cls=&#34;vlogs&#34;, ins=&#34;vlogs-1&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;infra&#34;}
</span></span><span style=display:flex><span>alertmanager_alerts{cls=&#34;alertmanager&#34;, ins=&#34;alertmanager-1&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;infra&#34;}
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-97ed05d79e93eabb25565a36bc328883>2 - E-R Model of PostgreSQL Cluster</h1><div class=lead>Entity-Relationship model for PostgreSQL clusters in Pigsty, including E-R diagram, entity definitions, and naming conventions.</div><p>The PGSQL module organizes PostgreSQL in production as <strong>clusters</strong>—<strong>logical entities</strong> composed of a group of database <strong>instances</strong> associated by <strong>primary-replica</strong> relationships.</p><p>Each cluster is an <strong>autonomous</strong> business unit consisting of at least one <strong>primary instance</strong>, exposing capabilities through services.</p><p>There are four core entities in Pigsty&rsquo;s PGSQL module:</p><ul><li><strong>Cluster</strong>: An autonomous PostgreSQL business unit serving as the top-level namespace for other entities.</li><li><strong>Service</strong>: A named abstraction that exposes capabilities, routes traffic, and exposes services using node ports.</li><li><strong>Instance</strong>: A single PostgreSQL server consisting of running processes and database files on a single node.</li><li><strong>Node</strong>: A hardware resource abstraction running Linux + Systemd environment—can be bare metal, VM, container, or Pod.</li></ul><p>Along with two business entities—&ldquo;Database&rdquo; and &ldquo;Role&rdquo;—these form the complete logical view as shown below:</p><p><img src=/img/pigsty/er-pgsql.svg alt=er-pgsql></p><hr><h2 id=examples>Examples</h2><p>Let&rsquo;s look at two concrete examples. Using the four-node Pigsty <a href=/docs/deploy/sandbox><strong>sandbox</strong></a>, there&rsquo;s a three-node <code>pg-test</code> cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The above config fragment defines a <a href=/docs/concept/ha/><strong>high-availability</strong></a> PostgreSQL cluster with these related entities:</p><table class=full-width><thead><tr><th style=text-align:center><span class=text-secondary><strong>Cluster</strong></span></th><th><span class=text-secondary><strong>Description</strong></span></th></tr></thead><tbody><tr><td style=text-align:center><strong><code>pg-test</code></strong></td><td>PostgreSQL 3-node HA cluster</td></tr><tr><td style=text-align:center><span class=text-success><strong>Instance</strong></span></td><td><span class=text-success><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>pg-test-1</code></strong></td><td>PostgreSQL instance #1, default primary</td></tr><tr><td style=text-align:center><strong><code>pg-test-2</code></strong></td><td>PostgreSQL instance #2, initial replica</td></tr><tr><td style=text-align:center><strong><code>pg-test-3</code></strong></td><td>PostgreSQL instance #3, initial replica</td></tr><tr><td style=text-align:center><span class=text-info><strong>Service</strong></span></td><td><span class=text-info><strong>Description</strong></span></td></tr><tr><td style=text-align:center><a href=/docs/pgsql/service/#primary-service><strong><code>pg-test-primary</code></strong></a></td><td>Read-write service (routes to primary pgbouncer)</td></tr><tr><td style=text-align:center><a href=/docs/pgsql/service/#replica-service><strong><code>pg-test-replica</code></strong></a></td><td>Read-only service (routes to replica pgbouncer)</td></tr><tr><td style=text-align:center><a href=/docs/pgsql/service/#default-service><strong><code>pg-test-default</code></strong></a></td><td>Direct read-write service (routes to primary postgres)</td></tr><tr><td style=text-align:center><a href=/docs/pgsql/service/#offline-service><strong><code>pg-test-offline</code></strong></a></td><td>Offline read service (routes to dedicated postgres)</td></tr><tr><td style=text-align:center><span class=text-danger><strong>Node</strong></span></td><td><span class=text-danger><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>node-1</code></strong></td><td><code>10.10.10.11</code> Node #1, hosts <code>pg-test-1</code> PG instance</td></tr><tr><td style=text-align:center><strong><code>node-2</code></strong></td><td><code>10.10.10.12</code> Node #2, hosts <code>pg-test-2</code> PG instance</td></tr><tr><td style=text-align:center><strong><code>node-3</code></strong></td><td><code>10.10.10.13</code> Node #3, hosts <code>pg-test-3</code> PG instance</td></tr></tbody></table><p><img src=/img/pigsty/ha.png alt=ha></p><hr><h2 id=identity-parameters>Identity Parameters</h2><p>Pigsty uses the <a href=/docs/pgsql/param#pg_id><strong><code>PG_ID</code></strong></a> parameter group to assign deterministic identities to each PGSQL module entity. Three parameters are required:</p><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th><th>Format</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/pgsql/param#pg_cluster><strong><code>pg_cluster</code></strong></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center>Cluster</td><td style=text-align:left>PG cluster name, required</td><td>Valid DNS name, regex <code>[a-zA-Z0-9-]+</code></td></tr><tr><td style=text-align:left><a href=/docs/pgsql/param#pg_seq><strong><code>pg_seq</code></strong></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center>Instance</td><td style=text-align:left>PG instance number, required</td><td>Natural number, starting from 0 or 1, unique within cluster</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/param#pg_role><strong><code>pg_role</code></strong></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center>Instance</td><td style=text-align:left>PG instance role, required</td><td>Enum: <code>primary</code>, <code>replica</code>, <code>offline</code></td></tr></tbody></table><p>With cluster name defined at cluster level and instance number/role assigned at instance level, Pigsty automatically generates unique identifiers for each entity based on rules:</p><table class=full-width><thead><tr><th>Entity</th><th>Generation Rule</th><th>Example</th></tr></thead><tbody><tr><td><strong>Instance</strong></td><td><code>{{ pg_cluster }}-{{ pg_seq }}</code></td><td><code>pg-test-1</code>, <code>pg-test-2</code>, <code>pg-test-3</code></td></tr><tr><td><strong>Service</strong></td><td><code>{{ pg_cluster }}-{{ pg_role }}</code></td><td><code>pg-test-primary</code>, <code>pg-test-replica</code>, <code>pg-test-offline</code></td></tr><tr><td><strong>Node</strong></td><td>Explicitly specified or borrowed from PG</td><td><code>pg-test-1</code>, <code>pg-test-2</code>, <code>pg-test-3</code></td></tr></tbody></table><p>Because Pigsty adopts a 1:1 exclusive deployment model for nodes and PG instances, by default the host node identifier borrows from the PG instance identifier (<a href=/docs/node/param#node_id_from_pg><strong><code>node_id_from_pg</code></strong></a>).
You can also explicitly specify <a href=/docs/node/param#nodename><strong><code>nodename</code></strong></a> to override, or disable <a href=/docs/node/param#nodename_overview><strong><code>nodename_overwrite</code></strong></a> to use the current default.</p><hr><h2 id=sharding-identity-parameters>Sharding Identity Parameters</h2><p>When using multiple PostgreSQL clusters (<strong>sharding</strong>) to serve the same business, two additional identity parameters are used: <a href=/docs/pgsql/param#pg_shard><strong><code>pg_shard</code></strong></a> and <a href=/docs/pgsql/param#pg_group><strong><code>pg_group</code></strong></a>.</p><p>In this case, this group of PostgreSQL clusters shares the same <code>pg_shard</code> name with their own <code>pg_group</code> numbers, like this <a href=/docs/pgsql/config/#citus-cluster><strong>Citus cluster</strong></a>:</p><p>In this case, <code>pg_cluster</code> cluster names are typically composed of: <code>{{ pg_shard }}{{ pg_group }}</code>, e.g., <code>pg-citus0</code>, <code>pg-citus1</code>, etc.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus0 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus1 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus2 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus3</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus shard 3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus3 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty provides dedicated monitoring dashboards for horizontal sharding clusters, making it easy to compare performance and load across shards, but this requires using the above entity naming convention.</p><p>There are also other identity parameters for special scenarios, such as <a href=/docs/pgsql/param#pg_upstream><code>pg_upstream</code></a> for specifying backup clusters/cascading replication upstream, <a href=/docs/pgsql/param#gp_role><code>gp_role</code></a> for Greenplum cluster identity,
<a href=/docs/pgsql/param#pg_exporters><code>pg_exporters</code></a> for external monitoring instances, <a href=/docs/pgsql/param#pg_offline_query><code>pg_offline_query</code></a> for offline query instances, etc. See <a href=/docs/pgsql/param#pg_id><strong><code>PG_ID</code> parameter docs</strong></a>.</p><hr><h2 id=monitoring-label-system>Monitoring Label System</h2><p>Pigsty provides an out-of-box monitoring system that uses the above <a href=#identity-parameters><strong>identity parameters</strong></a> to identify various PostgreSQL entities.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>pg_up{cls=&#34;pg-test&#34;, ins=&#34;pg-test-1&#34;, ip=&#34;10.10.10.11&#34;, job=&#34;pgsql&#34;}
</span></span><span style=display:flex><span>pg_up{cls=&#34;pg-test&#34;, ins=&#34;pg-test-2&#34;, ip=&#34;10.10.10.12&#34;, job=&#34;pgsql&#34;}
</span></span><span style=display:flex><span>pg_up{cls=&#34;pg-test&#34;, ins=&#34;pg-test-3&#34;, ip=&#34;10.10.10.13&#34;, job=&#34;pgsql&#34;}
</span></span></code></pre></div><p>For example, the <code>cls</code>, <code>ins</code>, <code>ip</code> labels correspond to cluster name, instance name, and node IP—the identifiers for these three core entities.
They appear along with the <code>job</code> label in <strong>all</strong> native monitoring metrics collected by <a href=/docs/concept/arch/infra#victoriametrics><strong>VictoriaMetrics</strong></a> and <a href=/docs/concept/arch/infra#victorialogs><strong>VictoriaLogs</strong></a> log streams.</p><p>The <code>job</code> name for collecting PostgreSQL metrics is fixed as <code>pgsql</code>;
The <code>job</code> name for monitoring remote PG instances is fixed as <code>pgrds</code>.
The <code>job</code> name for collecting PostgreSQL CSV logs is fixed as <code>postgres</code>;
The <code>job</code> name for collecting pgbackrest logs is fixed as <code>pgbackrest</code>, other PG components collect logs via <code>job: syslog</code>.</p><p>Additionally, some entity identity labels appear in specific entity-related monitoring metrics, such as:</p><ul><li><code>datname</code>: Database name, if a metric belongs to a specific database.</li><li><code>relname</code>: Table name, if a metric belongs to a specific table.</li><li><code>idxname</code>: Index name, if a metric belongs to a specific index.</li><li><code>funcname</code>: Function name, if a metric belongs to a specific function.</li><li><code>seqname</code>: Sequence name, if a metric belongs to a specific sequence.</li><li><code>query</code>: Query fingerprint, if a metric belongs to a specific query.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-5a875c30b5ea163b13415e0cf143a46f>3 - E-R Model of Etcd Cluster</h1><div class=lead>Entity-Relationship model for ETCD clusters in Pigsty, including E-R diagram, entity definitions, and naming conventions.</div><p>The ETCD module organizes ETCD in production as <strong>clusters</strong>—<strong>logical entities</strong> composed of a group of ETCD <strong>instances</strong> associated through the <strong>Raft</strong> consensus protocol.</p><p>Each cluster is an <strong>autonomous</strong> distributed key-value storage unit consisting of at least one <strong>ETCD instance</strong>, exposing service capabilities through client ports.</p><p>There are three core entities in Pigsty&rsquo;s ETCD module:</p><ul><li><strong>Cluster</strong>: An autonomous ETCD service unit serving as the top-level namespace for other entities.</li><li><strong>Instance</strong>: A single ETCD server process running on a node, participating in Raft consensus.</li><li><strong>Node</strong>: A hardware resource abstraction running Linux + Systemd environment, implicitly declared.</li></ul><p>Compared to PostgreSQL clusters, the ETCD cluster model is simpler, without Services or complex Role distinctions.
All ETCD instances are functionally equivalent, electing a Leader through the Raft protocol while others become Followers.
During scale-out intermediate states, non-voting Learner instance members are also allowed.</p><hr><h2 id=examples>Examples</h2><p>Let&rsquo;s look at a concrete example with a three-node ETCD cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The above config fragment defines a three-node ETCD cluster with these related entities:</p><table class=full-width><thead><tr><th style=text-align:center><span class=text-secondary><strong>Cluster</strong></span></th><th><span class=text-secondary><strong>Description</strong></span></th></tr></thead><tbody><tr><td style=text-align:center><strong><code>etcd</code></strong></td><td>ETCD 3-node HA cluster</td></tr><tr><td style=text-align:center><span class=text-success><strong>Instance</strong></span></td><td><span class=text-success><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>etcd-1</code></strong></td><td>ETCD instance #1</td></tr><tr><td style=text-align:center><strong><code>etcd-2</code></strong></td><td>ETCD instance #2</td></tr><tr><td style=text-align:center><strong><code>etcd-3</code></strong></td><td>ETCD instance #3</td></tr><tr><td style=text-align:center><span class=text-danger><strong>Node</strong></span></td><td><span class=text-danger><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>10.10.10.10</code></strong></td><td>Node #1, hosts <code>etcd-1</code> instance</td></tr><tr><td style=text-align:center><strong><code>10.10.10.11</code></strong></td><td>Node #2, hosts <code>etcd-2</code> instance</td></tr><tr><td style=text-align:center><strong><code>10.10.10.12</code></strong></td><td>Node #3, hosts <code>etcd-3</code> instance</td></tr></tbody></table><hr><h2 id=identity-parameters>Identity Parameters</h2><p>Pigsty uses the <a href=/docs/etcd/param#etcd><strong><code>ETCD</code></strong></a> parameter group to assign deterministic identities to each ETCD module entity. Two parameters are required:</p><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th><th style=text-align:left>Format</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/etcd/param#etcd_cluster><strong><code>etcd_cluster</code></strong></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center>Cluster</td><td style=text-align:left>ETCD cluster name, required</td><td style=text-align:left>Valid DNS name, defaults to fixed <code>etcd</code></td></tr><tr><td style=text-align:left><a href=/docs/etcd/param#etcd_seq><strong><code>etcd_seq</code></strong></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center>Instance</td><td style=text-align:left>ETCD instance number, required</td><td style=text-align:left>Natural number, starting from 1, unique within cluster</td></tr></tbody></table><p>With cluster name defined at cluster level and instance number assigned at instance level, Pigsty automatically generates unique identifiers for each entity based on rules:</p><table class=full-width><thead><tr><th>Entity</th><th style=text-align:left>Generation Rule</th><th style=text-align:left>Example</th></tr></thead><tbody><tr><td><strong>Instance</strong></td><td style=text-align:left><code>{{ etcd_cluster }}-{{ etcd_seq }}</code></td><td style=text-align:left><code>etcd-1</code>, <code>etcd-2</code>, <code>etcd-3</code></td></tr></tbody></table><p>The ETCD module does not assign additional identity to host nodes; nodes are identified by their existing hostname or IP address.</p><hr><h2 id=ports--protocols>Ports & Protocols</h2><p>Each ETCD instance listens on the following two ports:</p><table class=full-width><thead><tr><th style=text-align:left>Port</th><th style=text-align:left>Parameter</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left><strong>2379</strong></td><td style=text-align:left><a href=/docs/etcd/param#etcd_port><strong><code>etcd_port</code></strong></a></td><td style=text-align:left>Client port, accessed by Patroni, vip-manager, etc.</td></tr><tr><td style=text-align:left><strong>2380</strong></td><td style=text-align:left><a href=/docs/etcd/param#etcd_peer_port><strong><code>etcd_peer_port</code></strong></a></td><td style=text-align:left>Peer communication port, used for Raft consensus</td></tr></tbody></table><p>ETCD clusters enable TLS encrypted communication by default and use RBAC authentication mechanism. Clients need correct certificates and passwords to access ETCD services.</p><hr><h2 id=cluster-size>Cluster Size</h2><p>As a distributed coordination service, ETCD cluster size directly affects availability, requiring more than half (quorum) of nodes to be alive to maintain service.</p><table class=full-width><thead><tr><th style=text-align:center>Cluster Size</th><th style=text-align:center>Quorum</th><th style=text-align:center>Fault Tolerance</th><th style=text-align:left>Use Case</th></tr></thead><tbody><tr><td style=text-align:center>1 node</td><td style=text-align:center>1</td><td style=text-align:center>0</td><td style=text-align:left>Dev, test, demo</td></tr><tr><td style=text-align:center>3 nodes</td><td style=text-align:center>2</td><td style=text-align:center>1</td><td style=text-align:left>Small-medium production</td></tr><tr><td style=text-align:center>5 nodes</td><td style=text-align:center>3</td><td style=text-align:center>2</td><td style=text-align:left>Large-scale production</td></tr></tbody></table><p>Therefore, even-numbered ETCD clusters are meaningless, and clusters over five nodes are uncommon. Typical sizes are single-node, three-node, and five-node.</p><hr><h2 id=monitoring-label-system>Monitoring Label System</h2><p>Pigsty provides an out-of-box monitoring system that uses the above <a href=#identity-parameters><strong>identity parameters</strong></a> to identify various ETCD entities.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>etcd_up{cls=&#34;etcd&#34;, ins=&#34;etcd-1&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;etcd&#34;}
</span></span><span style=display:flex><span>etcd_up{cls=&#34;etcd&#34;, ins=&#34;etcd-2&#34;, ip=&#34;10.10.10.11&#34;, job=&#34;etcd&#34;}
</span></span><span style=display:flex><span>etcd_up{cls=&#34;etcd&#34;, ins=&#34;etcd-3&#34;, ip=&#34;10.10.10.12&#34;, job=&#34;etcd&#34;}
</span></span></code></pre></div><p>For example, the <code>cls</code>, <code>ins</code>, <code>ip</code> labels correspond to cluster name, instance name, and node IP—the identifiers for these three core entities.
They appear along with the <code>job</code> label in <strong>all</strong> ETCD monitoring metrics collected by <a href=/docs/concept/arch/infra#victoriametrics><strong>VictoriaMetrics</strong></a>.
The <code>job</code> name for collecting ETCD metrics is fixed as <code>etcd</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c495cfba1010bd7cf73164bea4ebc4f3>4 - E-R Model of MinIO Cluster</h1><div class=lead>Entity-Relationship model for MinIO clusters in Pigsty, including E-R diagram, entity definitions, and naming conventions.</div><p>The MinIO module organizes MinIO in production as <strong>clusters</strong>—<strong>logical entities</strong> composed of a group of distributed MinIO <strong>instances</strong>, collectively providing highly available object storage services.</p><p>Each cluster is an <strong>autonomous</strong> S3-compatible object storage unit consisting of at least one <strong>MinIO instance</strong>, exposing service capabilities through the S3 API port.</p><p>There are three core entities in Pigsty&rsquo;s MinIO module:</p><ul><li><strong>Cluster</strong>: An autonomous MinIO service unit serving as the top-level namespace for other entities.</li><li><strong>Instance</strong>: A single MinIO server process running on a node, managing local disk storage.</li><li><strong>Node</strong>: A hardware resource abstraction running Linux + Systemd environment, implicitly declared.</li></ul><p>Additionally, MinIO has the concept of <a href=/docs/minio/config#multi-pool-deployment><strong>Storage Pool</strong></a>, used for smooth cluster scaling.
A cluster can contain multiple storage pools, each composed of a group of nodes and disks.</p><hr><h2 id=deployment-modes>Deployment Modes</h2><p>MinIO supports three main deployment modes for different scenarios:</p><table class=full-width><thead><tr><th style=text-align:center>Mode</th><th style=text-align:center>Code</th><th style=text-align:left>Description</th><th style=text-align:left>Use Case</th></tr></thead><tbody><tr><td style=text-align:center><a href=/docs/minio/config#single-node-single-drive><strong>Single-Node Single-Drive</strong></a></td><td style=text-align:center><strong>SNSD</strong></td><td style=text-align:left>Single node, single data directory or disk</td><td style=text-align:left>Dev, test, demo</td></tr><tr><td style=text-align:center><a href=/docs/minio/config#single-node-multi-drive><strong>Single-Node Multi-Drive</strong></a></td><td style=text-align:center><strong>SNMD</strong></td><td style=text-align:left>Single node, multiple disks, typically 4+</td><td style=text-align:left>Resource-constrained small deployments</td></tr><tr><td style=text-align:center><a href=/docs/minio/config#multi-node-multi-drive><strong>Multi-Node Multi-Drive</strong></a></td><td style=text-align:center><strong>MNMD</strong></td><td style=text-align:left>Multiple nodes, multiple disks per node</td><td style=text-align:left><strong>Production recommended</strong></td></tr></tbody></table><p>SNSD mode can use any directory as storage for quick experimentation; SNMD and MNMD modes require real disk mount points, otherwise startup is refused.</p><hr><h2 id=examples>Examples</h2><p>Let&rsquo;s look at a concrete multi-node multi-drive example with a four-node MinIO cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data{1...4}&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_node</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The above config fragment defines a four-node MinIO cluster with four disks per node:</p><table class=full-width><thead><tr><th style=text-align:center><span class=text-secondary><strong>Cluster</strong></span></th><th><span class=text-secondary><strong>Description</strong></span></th></tr></thead><tbody><tr><td style=text-align:center><strong><code>minio</code></strong></td><td>MinIO 4-node HA cluster</td></tr><tr><td style=text-align:center><span class=text-success><strong>Instance</strong></span></td><td><span class=text-success><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>minio-1</code></strong></td><td>MinIO instance #1, managing 4 disks</td></tr><tr><td style=text-align:center><strong><code>minio-2</code></strong></td><td>MinIO instance #2, managing 4 disks</td></tr><tr><td style=text-align:center><strong><code>minio-3</code></strong></td><td>MinIO instance #3, managing 4 disks</td></tr><tr><td style=text-align:center><strong><code>minio-4</code></strong></td><td>MinIO instance #4, managing 4 disks</td></tr><tr><td style=text-align:center><span class=text-danger><strong>Node</strong></span></td><td><span class=text-danger><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>10.10.10.10</code></strong></td><td>Node #1, hosts <code>minio-1</code> instance</td></tr><tr><td style=text-align:center><strong><code>10.10.10.11</code></strong></td><td>Node #2, hosts <code>minio-2</code> instance</td></tr><tr><td style=text-align:center><strong><code>10.10.10.12</code></strong></td><td>Node #3, hosts <code>minio-3</code> instance</td></tr><tr><td style=text-align:center><strong><code>10.10.10.13</code></strong></td><td>Node #4, hosts <code>minio-4</code> instance</td></tr></tbody></table><hr><h2 id=identity-parameters>Identity Parameters</h2><p>Pigsty uses the <a href=/docs/minio/param#minio><strong><code>MINIO</code></strong></a> parameter group to assign deterministic identities to each MinIO module entity. Two parameters are required:</p><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th><th style=text-align:left>Format</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/minio/param#minio_cluster><strong><code>minio_cluster</code></strong></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center>Cluster</td><td style=text-align:left>MinIO cluster name, required</td><td style=text-align:left>Valid DNS name, defaults to <code>minio</code></td></tr><tr><td style=text-align:left><a href=/docs/minio/param#minio_seq><strong><code>minio_seq</code></strong></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center>Instance</td><td style=text-align:left>MinIO instance number, required</td><td style=text-align:left>Natural number, starting from 1, unique within cluster</td></tr></tbody></table><p>With cluster name defined at cluster level and instance number assigned at instance level, Pigsty automatically generates unique identifiers for each entity based on rules:</p><table class=full-width><thead><tr><th>Entity</th><th style=text-align:left>Generation Rule</th><th style=text-align:left>Example</th></tr></thead><tbody><tr><td><strong>Instance</strong></td><td style=text-align:left><code>{{ minio_cluster }}-{{ minio_seq }}</code></td><td style=text-align:left><code>minio-1</code>, <code>minio-2</code>, <code>minio-3</code>, <code>minio-4</code></td></tr></tbody></table><p>The MinIO module does not assign additional identity to host nodes; nodes are identified by their existing hostname or IP address.
The <a href=/docs/minio/param#minio_node><strong><code>minio_node</code></strong></a> parameter generates node names for MinIO cluster internal use (written to <code>/etc/hosts</code> for cluster discovery), not host node identity.</p><hr><h2 id=core-configuration-parameters>Core Configuration Parameters</h2><p>Beyond identity parameters, the following parameters are critical for MinIO cluster configuration:</p><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/minio/param#minio_data><strong><code>minio_data</code></strong></a></td><td style=text-align:center><code>path</code></td><td style=text-align:left>Data directory, use <code>{x...y}</code> for multi-drive</td></tr><tr><td style=text-align:left><a href=/docs/minio/param#minio_node><strong><code>minio_node</code></strong></a></td><td style=text-align:center><code>string</code></td><td style=text-align:left>Node name pattern for multi-node deployment</td></tr><tr><td style=text-align:left><a href=/docs/minio/param#minio_domain><strong><code>minio_domain</code></strong></a></td><td style=text-align:center><code>string</code></td><td style=text-align:left>Service domain, defaults to <code>sss.pigsty</code></td></tr></tbody></table><p>These parameters together determine MinIO&rsquo;s core config <code>MINIO_VOLUMES</code>:</p><ul><li><strong>SNSD</strong>: Direct <code>minio_data</code> value, e.g., <code>/data/minio</code></li><li><strong>SNMD</strong>: Expanded <code>minio_data</code> directories, e.g., <code>/data{1...4}</code></li><li><strong>MNMD</strong>: Combined <code>minio_node</code> and <code>minio_data</code>, e.g., <code>https://minio-{1...4}.pigsty:9000/data{1...4}</code></li></ul><hr><h2 id=ports--services>Ports & Services</h2><p>Each MinIO instance listens on the following ports:</p><table class=full-width><thead><tr><th style=text-align:left>Port</th><th style=text-align:left>Parameter</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left>9000</td><td style=text-align:left><a href=/docs/minio/param#minio_port><strong><code>minio_port</code></strong></a></td><td style=text-align:left>S3 API service port</td></tr><tr><td style=text-align:left>9001</td><td style=text-align:left><a href=/docs/minio/param#minio_admin_port><strong><code>minio_admin_port</code></strong></a></td><td style=text-align:left>Web admin console port</td></tr></tbody></table><p>MinIO enables HTTPS encrypted communication by default (controlled by <a href=/docs/minio/param#minio_https><strong><code>minio_https</code></strong></a>). This is required for backup tools like pgBackREST to access MinIO.</p><p>Multi-node MinIO clusters can be accessed through <strong>any node</strong>. Best practice is to use a load balancer (e.g., HAProxy + VIP) for unified access point.</p><hr><h2 id=resource-provisioning>Resource Provisioning</h2><p>After MinIO cluster deployment, Pigsty automatically creates the following resources (controlled by <a href=/docs/minio/param#minio_provision><strong><code>minio_provision</code></strong></a>):</p><p><strong>Default Buckets</strong> (defined by <a href=/docs/minio/param#minio_buckets><strong><code>minio_buckets</code></strong></a>):</p><table class=full-width><thead><tr><th style=text-align:left>Bucket</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left><code>pgsql</code></td><td style=text-align:left>PostgreSQL pgBackREST backup storage</td></tr><tr><td style=text-align:left><code>meta</code></td><td style=text-align:left>Metadata storage, versioning enabled</td></tr><tr><td style=text-align:left><code>data</code></td><td style=text-align:left>General data storage</td></tr></tbody></table><p><strong>Default Users</strong> (defined by <a href=/docs/minio/param#minio_users><strong><code>minio_users</code></strong></a>):</p><table class=full-width><thead><tr><th style=text-align:left>User</th><th style=text-align:left>Default Password</th><th style=text-align:left>Policy</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left><code>pgbackrest</code></td><td style=text-align:left><code>S3User.Backup</code></td><td style=text-align:left><code>pgsql</code></td><td style=text-align:left>PostgreSQL backup dedicated user</td></tr><tr><td style=text-align:left><code>s3user_meta</code></td><td style=text-align:left><code>S3User.Meta</code></td><td style=text-align:left><code>meta</code></td><td style=text-align:left>Access <code>meta</code> bucket</td></tr><tr><td style=text-align:left><code>s3user_data</code></td><td style=text-align:left><code>S3User.Data</code></td><td style=text-align:left><code>data</code></td><td style=text-align:left>Access <code>data</code> bucket</td></tr></tbody></table><p><code>pgbackrest</code> is used for PostgreSQL cluster backups; <code>s3user_meta</code> and <code>s3user_data</code> are reserved users not actively used.</p><hr><h2 id=monitoring-label-system>Monitoring Label System</h2><p>Pigsty provides an out-of-box monitoring system that uses the above <a href=#identity-parameters><strong>identity parameters</strong></a> to identify various MinIO entities.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>minio_up{cls=&#34;minio&#34;, ins=&#34;minio-1&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;minio&#34;}
</span></span><span style=display:flex><span>minio_up{cls=&#34;minio&#34;, ins=&#34;minio-2&#34;, ip=&#34;10.10.10.11&#34;, job=&#34;minio&#34;}
</span></span><span style=display:flex><span>minio_up{cls=&#34;minio&#34;, ins=&#34;minio-3&#34;, ip=&#34;10.10.10.12&#34;, job=&#34;minio&#34;}
</span></span><span style=display:flex><span>minio_up{cls=&#34;minio&#34;, ins=&#34;minio-4&#34;, ip=&#34;10.10.10.13&#34;, job=&#34;minio&#34;}
</span></span></code></pre></div><p>For example, the <code>cls</code>, <code>ins</code>, <code>ip</code> labels correspond to cluster name, instance name, and node IP—the identifiers for these three core entities.
They appear along with the <code>job</code> label in <strong>all</strong> MinIO monitoring metrics collected by <a href=/docs/concept/arch/infra#victoriametrics><strong>VictoriaMetrics</strong></a>.
The <code>job</code> name for collecting MinIO metrics is fixed as <code>minio</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0de22cd0f8c383fe4e1ef5a4eb6b5440>5 - E-R Model of Redis Cluster</h1><div class=lead>Entity-Relationship model for Redis clusters in Pigsty, including E-R diagram, entity definitions, and naming conventions.</div><p>The Redis module organizes Redis in production as <strong>clusters</strong>—<strong>logical entities</strong> composed of a group of Redis <strong>instances</strong> deployed on one or more <strong>nodes</strong>.</p><p>Each cluster is an <strong>autonomous</strong> high-performance cache/storage unit consisting of at least one <strong>Redis instance</strong>, exposing service capabilities through ports.</p><p>There are three core entities in Pigsty&rsquo;s Redis module:</p><ul><li><strong>Cluster</strong>: An autonomous Redis service unit serving as the top-level namespace for other entities.</li><li><strong>Instance</strong>: A single Redis server process running on a specific port on a node.</li><li><strong>Node</strong>: A hardware resource abstraction running Linux + Systemd environment, can host multiple Redis instances, implicitly declared.</li></ul><p>Unlike PostgreSQL, Redis uses a <strong>single-node multi-instance</strong> deployment model: one physical/virtual machine node typically deploys <strong>multiple</strong> Redis instances
to fully utilize multi-core CPUs. Therefore, nodes and instances have a <strong>1:N</strong> relationship. Additionally, production typically advises against Redis instances with memory > 12GB.</p><hr><h2 id=operating-modes>Operating Modes</h2><p>Redis has three different operating modes, specified by the <a href=/docs/redis/param#redis_mode><strong><code>redis_mode</code></strong></a> parameter:</p><table class=full-width><thead><tr><th style=text-align:center>Mode</th><th style=text-align:center>Code</th><th style=text-align:left>Description</th><th style=text-align:left>HA Mechanism</th></tr></thead><tbody><tr><td style=text-align:center><a href=#standalone-cluster><strong>Standalone</strong></a></td><td style=text-align:center><code>standalone</code></td><td style=text-align:left>Classic master-replica, <strong>default mode</strong></td><td style=text-align:left>Requires Sentinel</td></tr><tr><td style=text-align:center><a href=#sentinel-cluster><strong>Sentinel</strong></a></td><td style=text-align:center><code>sentinel</code></td><td style=text-align:left>HA monitoring and auto-failover for standalone</td><td style=text-align:left>Multi-node quorum</td></tr><tr><td style=text-align:center><a href=#native-cluster><strong>Native Cluster</strong></a></td><td style=text-align:center><code>cluster</code></td><td style=text-align:left>Redis native distributed cluster, no sentinel needed</td><td style=text-align:left>Built-in auto-failover</td></tr></tbody></table><ul><li><strong>Standalone</strong>: Default mode, replication via <code>replica_of</code> parameter. Requires additional Sentinel cluster for HA.</li><li><strong>Sentinel</strong>: Stores no business data, dedicated to monitoring standalone Redis clusters for auto-failover; multi-node itself provides HA.</li><li><strong>Native Cluster</strong>: Data auto-sharded across multiple primaries, each can have multiple replicas, built-in HA, no sentinel needed.</li></ul><hr><h2 id=examples>Examples</h2><p>Let&rsquo;s look at concrete examples for each mode:</p><h3 id=standalone-cluster>Standalone Cluster</h3><p>Classic master-replica on a single node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-ms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>redis_node</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-ms</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;redis.ms&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>64MB</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:center><span class=text-secondary><strong>Cluster</strong></span></th><th><span class=text-secondary><strong>Description</strong></span></th></tr></thead><tbody><tr><td style=text-align:center><strong><code>redis-ms</code></strong></td><td>Redis standalone cluster</td></tr><tr><td style=text-align:center><span class=text-danger><strong>Node</strong></span></td><td><span class=text-danger><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>redis-ms-1</code></strong></td><td><code>10.10.10.10</code> Node #1, hosts 2 instances</td></tr><tr><td style=text-align:center><span class=text-success><strong>Instance</strong></span></td><td><span class=text-success><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>redis-ms-1-6379</code></strong></td><td>Primary instance, listening on port 6379</td></tr><tr><td style=text-align:center><strong><code>redis-ms-1-6380</code></strong></td><td>Replica instance, port 6380, replicates from 6379</td></tr></tbody></table><h3 id=sentinel-cluster>Sentinel Cluster</h3><p>Three sentinel instances on a single node for monitoring standalone clusters. Sentinel clusters specify monitored standalone clusters via <a href=/docs/redis/param#redis_sentinel_monitor><strong><code>redis_sentinel_monitor</code></strong></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-sentinel</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>redis_node</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>26379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>}, 26380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>}, 26381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-sentinel</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;redis.sentinel&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sentinel</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>16MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_sentinel_monitor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: redis-ms, host: 10.10.10.10, port: 6379, password: redis.ms, quorum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=native-cluster>Native Cluster</h3><p>A Redis native distributed cluster with two nodes and six instances (minimum spec: 3 primaries, 3 replicas):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1, redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>}, 6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2, redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>}, 6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;redis.test&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>32MB</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>This creates a <strong>3 primary 3 replica</strong> native Redis cluster.</p><table class=full-width><thead><tr><th style=text-align:center><span class=text-secondary><strong>Cluster</strong></span></th><th><span class=text-secondary><strong>Description</strong></span></th></tr></thead><tbody><tr><td style=text-align:center><strong><code>redis-test</code></strong></td><td>Redis native cluster (3P3R)</td></tr><tr><td style=text-align:center><span class=text-success><strong>Instance</strong></span></td><td><span class=text-success><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>redis-test-1-6379</code></strong></td><td>Instance on node 1, port 6379</td></tr><tr><td style=text-align:center><strong><code>redis-test-1-6380</code></strong></td><td>Instance on node 1, port 6380</td></tr><tr><td style=text-align:center><strong><code>redis-test-1-6381</code></strong></td><td>Instance on node 1, port 6381</td></tr><tr><td style=text-align:center><strong><code>redis-test-2-6379</code></strong></td><td>Instance on node 2, port 6379</td></tr><tr><td style=text-align:center><strong><code>redis-test-2-6380</code></strong></td><td>Instance on node 2, port 6380</td></tr><tr><td style=text-align:center><strong><code>redis-test-2-6381</code></strong></td><td>Instance on node 2, port 6381</td></tr><tr><td style=text-align:center><span class=text-danger><strong>Node</strong></span></td><td><span class=text-danger><strong>Description</strong></span></td></tr><tr><td style=text-align:center><strong><code>redis-test-1</code></strong></td><td><code>10.10.10.12</code> Node #1, hosts 3 instances</td></tr><tr><td style=text-align:center><strong><code>redis-test-2</code></strong></td><td><code>10.10.10.13</code> Node #2, hosts 3 instances</td></tr></tbody></table><hr><h2 id=identity-parameters>Identity Parameters</h2><p>Pigsty uses the <a href=/docs/redis/param#redis><strong><code>REDIS</code></strong></a> parameter group to assign deterministic identities to each Redis module entity. Three parameters are required:</p><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th><th style=text-align:left>Format</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/redis/param#redis_cluster><strong><code>redis_cluster</code></strong></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center>Cluster</td><td style=text-align:left>Redis cluster name, required</td><td style=text-align:left>Valid DNS name, regex <code>[a-z][a-z0-9-]*</code></td></tr><tr><td style=text-align:left><a href=/docs/redis/param#redis_node><strong><code>redis_node</code></strong></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center>Node</td><td style=text-align:left>Redis node number, required</td><td style=text-align:left>Natural number, starting from 1, unique within cluster</td></tr><tr><td style=text-align:left><a href=/docs/redis/param#redis_instances><strong><code>redis_instances</code></strong></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center>Node</td><td style=text-align:left>Redis instance definition, required</td><td style=text-align:left>JSON object, key is port, value is instance config</td></tr></tbody></table><p>With cluster name defined at cluster level and node number/instance definition assigned at node level, Pigsty automatically generates unique identifiers for each entity:</p><table class=full-width><thead><tr><th>Entity</th><th style=text-align:left>Generation Rule</th><th style=text-align:left>Example</th></tr></thead><tbody><tr><td><strong>Instance</strong></td><td style=text-align:left><code>{{ redis_cluster }}-{{ redis_node }}-{{ port }}</code></td><td style=text-align:left><code>redis-ms-1-6379</code>, <code>redis-ms-1-6380</code></td></tr></tbody></table><p>The Redis module does not assign additional identity to host nodes; nodes are identified by their existing hostname or IP address.
<a href=/docs/redis/param#redis_node><strong><code>redis_node</code></strong></a> is used for instance naming, not host node identity.</p><hr><h2 id=instance-definition>Instance Definition</h2><p><a href=/docs/redis/param#redis_instances><strong><code>redis_instances</code></strong></a> is a JSON object with <strong>port number</strong> as key and <strong>instance config</strong> as value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>                                      </span><span style=color:#8f5902;font-style:italic># Primary instance, no extra config</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># Replica, specify upstream primary</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># Replica, specify upstream primary</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Each Redis instance listens on a unique port within the node. You can choose any port number,
but avoid system reserved ports (&lt; 1024) or conflicts with <a href=/docs/ref/port/><strong>Pigsty used ports</strong></a>.
The <code>replica_of</code> parameter sets replication relationship in standalone mode, format <code>'&lt;ip> &lt;port>'</code>, specifying upstream primary address and port.</p><p>Additionally, each Redis node runs a Redis Exporter collecting metrics from <strong>all local instances</strong>:</p><table class=full-width><thead><tr><th style=text-align:left>Port</th><th style=text-align:left>Parameter</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left>9121</td><td style=text-align:left><a href=/docs/redis/param#redis_exporter_port><strong><code>redis_exporter_port</code></strong></a></td><td style=text-align:left>Redis Exporter port</td></tr></tbody></table><p>Redis&rsquo;s single-node multi-instance deployment model has some limitations:</p><ul><li><strong>Node Exclusive</strong>: A node can only belong to one Redis cluster, not assigned to different clusters simultaneously.</li><li><strong>Port Unique</strong>: Redis instances on the same node must use different ports to avoid conflicts.</li><li><strong>Password Shared</strong>: Multiple instances on the same node cannot have different passwords (redis_exporter limitation).</li><li><strong>Manual HA</strong>: Standalone Redis clusters require additional Sentinel configuration for auto-failover.</li></ul><hr><h2 id=monitoring-label-system>Monitoring Label System</h2><p>Pigsty provides an out-of-box monitoring system that uses the above <a href=#identity-parameters><strong>identity parameters</strong></a> to identify various Redis entities.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>redis_up{cls=&#34;redis-ms&#34;, ins=&#34;redis-ms-1-6379&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;redis&#34;}
</span></span><span style=display:flex><span>redis_up{cls=&#34;redis-ms&#34;, ins=&#34;redis-ms-1-6380&#34;, ip=&#34;10.10.10.10&#34;, job=&#34;redis&#34;}
</span></span></code></pre></div><p>For example, the <code>cls</code>, <code>ins</code>, <code>ip</code> labels correspond to cluster name, instance name, and node IP—the identifiers for these three core entities.
They appear along with the <code>job</code> label in <strong>all</strong> Redis monitoring metrics collected by <a href=/docs/concept/arch/infra#victoriametrics><strong>VictoriaMetrics</strong></a>.
The <code>job</code> name for collecting Redis metrics is fixed as <code>redis</code>.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>