<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/docker/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/docker/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Module: DOCKER | PIGSTY</title><meta name=description content="Docker daemon service that enables one-click deployment of containerized stateless software templates and additional functionality."><meta property="og:url" content="https://pigsty.io/docs/docker/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="Module: DOCKER"><meta property="og:description" content="Docker daemon service that enables one-click deployment of containerized stateless software templates and additional functionality."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Module: DOCKER"><meta itemprop=description content="Docker daemon service that enables one-click deployment of containerized stateless software templates and additional functionality."><meta itemprop=dateModified content="2026-01-08T18:48:49+08:00"><meta itemprop=wordCount content="119"><meta itemprop=keywords content="Reference,DOCKER"><meta name=twitter:card content="summary"><meta name=twitter:title content="Module: DOCKER"><meta name=twitter:description content="Docker daemon service that enables one-click deployment of containerized stateless software templates and additional functionality."><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/docker/>Return to the regular view of this page</a>.</p></div><h1 class=title>Module: DOCKER</h1><div class=lead>Docker daemon service that enables one-click deployment of containerized stateless software templates and additional functionality.</div><ul><li>1: <a href=#pg-ab29290668c14f70052872e28c66f5e4>Usage</a></li><li>2: <a href=#pg-c0b69dd4ee6960e205ee216b6b647bba>Parameters</a></li><li>3: <a href=#pg-0d8046db96a405e5b5a2289a58d6abd2>Playbooks</a></li><li>4: <a href=#pg-a3f1f926af2c0b8c8ba997c87b729b3e>Metrics</a></li><li>5: <a href=#pg-e91d8545ce4c41275eaf6b59c98047e2>FAQ</a></li></ul><div class=content><p><a href=https://www.docker.com/>Docker</a> is the most popular containerization platform, providing standardized software delivery capabilities.</p><p><strong>Pigsty does not rely on Docker to deploy any of its components; instead, it provides the ability to deploy and install Docker</strong> — this is an <strong>optional module</strong>.</p><p>Pigsty offers a series of <a href=/docs/app/>Docker software/tool/application templates</a> for you to choose from as needed.
This allows users to quickly spin up various containerized stateless software templates, adding extra functionality.
You can use external, Pigsty-managed highly available database clusters while placing stateless applications inside containers.</p><p>Pigsty&rsquo;s Docker module automatically configures accessible registry mirrors for users in mainland China to improve image pulling speed (and availability).
You can easily configure Registry and Proxy settings to flexibly access different image sources.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ab29290668c14f70052872e28c66f5e4>1 - Usage</h1><div class=lead>Docker module quick start guide - installation, removal, download, repository, mirrors, proxy, and image pulling.</div><p>Pigsty has built-in <a href=https://www.docker.com/><strong>Docker</strong></a> support, which you can use to quickly deploy containerized applications.</p><hr><h2 id=getting-started>Getting Started</h2><p>Docker is an <strong>optional module</strong>, and in most of Pigsty&rsquo;s configuration templates, Docker is <strong>not enabled by default</strong>. Therefore, users need to explicitly <strong>download</strong> and <strong>configure</strong> it to use Docker in Pigsty.</p><p>For example, in the default <a href=/docs/conf/meta><code>meta</code></a> template, Docker is not downloaded or installed by default. However, in the <a href=/docs/conf/rich><code>rich</code></a> single-node template, Docker is downloaded and installed.</p><p>The key difference between these two configurations lies in these two parameters: <a href=/docs/infra/param#repo_modules><code>repo_modules</code></a> and <a href=/docs/infra/param#repo_packages><code>repo_packages</code></a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra,node,pgsql,docker </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- Enable Docker repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-common, docker  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- Download Docker</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>After Docker is downloaded, you need to set the <a href=param#docker_enabled><strong><code>docker_enabled</code></strong></a>: <code>true</code> flag on the nodes where you want to install Docker, and configure <a href=param><strong>other parameters</strong></a> as needed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 1 ,nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra-1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 2 ,nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra-2 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Install Docker on this group!</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Finally, use the <a href=playbook#dockeryml><code>docker.yml</code></a> playbook to install it on the nodes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./docker.yml -l infra    <span style=color:#8f5902;font-style:italic># Install Docker on the infra group</span>
</span></span></code></pre></div><hr><h2 id=installation>Installation</h2><p>If you want to temporarily install Docker directly from the internet on certain nodes, you can use the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -e <span style=color:#4e9a06>&#39;{&#34;node_repo_modules&#34;:&#34;node,docker&#34;,&#34;node_packages&#34;:[&#34;docker-ce,docker-compose-plugin&#34;]}&#39;</span> -t node_repo,node_pkg -l &lt;select_group_ip&gt;
</span></span></code></pre></div><p>This command will first enable the upstream software sources for the <code>node,docker</code> modules on the target nodes, then install the <code>docker-ce</code> and <code>docker-compose-plugin</code> packages (same package names for EL/Debian).</p><p>If you want Docker-related packages to be automatically downloaded during Pigsty initialization, refer to the instructions below.</p><hr><h2 id=removal>Removal</h2><p>Because it&rsquo;s so simple, Pigsty doesn&rsquo;t provide an uninstall playbook for the Docker module. You can directly remove Docker using an Ansible command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible minio -m package -b -a <span style=color:#4e9a06>&#39;name=docker-ce state=absent&#39;</span>  <span style=color:#8f5902;font-style:italic># Remove docker</span>
</span></span></code></pre></div><p>This command will uninstall the <code>docker-ce</code> package using the OS package manager.</p><hr><h2 id=download>Download</h2><p>To download Docker during Pigsty installation, modify the <a href=/docs/infra/param#repo_modules><code>repo_modules</code></a> parameter in the <a href=/docs/setup/config#configuration-inventory><strong>configuration inventory</strong></a> to enable the Docker software repository,
then specify Docker packages to download in the <a href=/docs/infra/param#repo_packages><code>repo_packages</code></a> or <a href=/docs/infra/param#repo_extra_packages><code>repo_extra_packages</code></a> parameters.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra,node,pgsql,docker </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- Enable Docker repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-common, docker  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- Download Docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_extra_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgsql-main docker</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- Can also be specified here</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The <code>docker</code> specified here (which actually corresponds to the <code>docker-ce</code> and <code>docker-compose-plugin</code> packages) will be automatically downloaded to the local repository during the default <a href=/docs/setup/playbook#installyml><code>deploy.yml</code></a> process.
After downloading, the Docker packages will be available to all nodes via the local repository.</p><p>If you&rsquo;ve already completed Pigsty installation and the local repository is initialized, you can run <code>./infra.yml -t repo_build</code> after modifying the configuration to re-download and rebuild the offline repository.</p><p>Installing Docker requires the Docker YUM/APT <a href=#repository>repository</a>, which is included by default in Pigsty but not enabled. You need to add <code>docker</code> to <a href=/docs/infra/param#repo_modules><code>repo_modules</code></a> to enable it before installation.</p><hr><h2 id=repository>Repository</h2><p>Downloading Docker requires upstream internet software repositories, which are defined in the default <code>repo_upstream</code> with module name <code>docker</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: docker-ce ,description: &#39;Docker CE&#39; ,module: docker  ,releases: [7,8,9] ,arch: [x86_64, aarch64] ,baseurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>default: &#39;https://download.docker.com/linux/centos/$releasever/$basearch/stable&#39;    ,china: &#39;https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/stable&#39;  ,europe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://mirrors.xtom.de/docker-ce/linux/centos/$releasever/$basearch/stable&#39;</span><span style=color:#f8f8f8> </span>}}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: docker-ce ,description: &#39;Docker CE&#39; ,module: docker  ,releases: [11,12,20,22,24] ,arch: [x86_64, aarch64] ,baseurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://download.docker.com/linux/${distro_name} ${distro_codename} stable&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,china</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux//${distro_name} ${distro_codename} stable&#39;</span><span style=color:#f8f8f8> </span>}}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>You can reference this repository using the <code>docker</code> module name in the <a href=/docs/infra/param#repo_modules><code>repo_modules</code></a> and <a href=/docs/node/param#node_repo_modules><code>node_repo_modules</code></a> parameters.</p><blockquote><p>Note that Docker&rsquo;s official software repository is <strong>blocked</strong> by default in mainland China. You need to use mirror sites in China to complete the download.</p><p>If you&rsquo;re in mainland China and encounter Docker download failures, check whether <code>region</code> is set to <code>default</code> in your configuration inventory. The automatically configured <code>region: china</code> can resolve this issue.</p></blockquote><hr><h2 id=proxy>Proxy</h2><p>If your network environment requires a proxy server to access the internet, you can configure the <a href=/docs/infra/param#proxy_env><code>proxy_env</code></a> parameter in Pigsty&rsquo;s configuration inventory. This parameter will be written to the <code>proxy</code> related configuration in Docker&rsquo;s configuration file.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>proxy_env:
</span></span><span style=display:flex><span>  no_proxy: <span style=color:#4e9a06>&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.aliyuncs.com,mirrors.tuna.tsinghua.edu.cn,mirrors.zju.edu.cn&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>#http_proxy: &#39;http://username:password@proxy.address.com&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>#https_proxy: &#39;http://username:password@proxy.address.com&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>#all_proxy: &#39;http://username:password@proxy.address.com&#39;</span>
</span></span></code></pre></div><p>When running <a href=/docs/setup/install#configuration><code>configure</code></a> with the <code>-x</code> parameter, the proxy server configuration from your current environment will be automatically generated into Pigsty&rsquo;s configuration file under <code>proxy_env</code>.</p><p>In addition to using a proxy server, you can also configure <a href=#registry-mirrors><strong>Docker Registry Mirrors</strong></a> to bypass blocks.</p><hr><h2 id=registry-mirrors>Registry Mirrors</h2><p>You can use the <a href=param#docker_registry_mirrors><code>docker_registry_mirrors</code></a> parameter to specify Docker Registry Mirrors:</p><p>For users outside the firewall, in addition to the official DockerHub site, you can also consider using the <code>quay.io</code> mirror site. If your internal network environment already has mature image infrastructure, you can use your internal Docker registry mirrors to avoid being affected by external mirror sites and improve download speeds.</p><p>Users of public cloud providers can consider using free internal Docker mirrors. For example, if you&rsquo;re using Alibaba Cloud, you can use Alibaba Cloud&rsquo;s internal Docker mirror site (requires login):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://registry.cn-hangzhou.aliyuncs.com&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>   <span style=color:#8f5902;font-style:italic># Alibaba Cloud mirror, requires explicit login</span>
</span></span></code></pre></div><p>If you&rsquo;re using Tencent Cloud, you can use Tencent Cloud&rsquo;s internal Docker mirror site (requires internal network):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://ccr.ccs.tencentyun.com&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>   <span style=color:#8f5902;font-style:italic># Tencent Cloud mirror, internal network only</span>
</span></span></code></pre></div><p>Additionally, you can use <a href="https://github.com/cmliu/CF-Workers-docker.io?tab=readme-ov-file#%E7%AC%AC%E4%B8%89%E6%96%B9-dockerhub-%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1">CF-Workers-docker.io</a> to quickly set up your own Docker image proxy.
You can also consider using free <a href="https://github.com/cmliu/CF-Workers-docker.io?tab=readme-ov-file#%E7%AC%AC%E4%B8%89%E6%96%B9-dockerhub-%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1">Docker proxy mirrors</a> (use at your own risk!)</p><hr><h2 id=pulling-images>Pulling Images</h2><p>The <a href=param#docker_image><code>docker_image</code></a> and <a href=param#docker_image_cache><code>docker_image_cache</code></a> parameters can be used to directly specify a list of images to pull during Docker installation.</p><p>Using this feature, Docker will come with the specified images after installation (provided they can be successfully pulled; this task will be automatically ignored and skipped on failure).</p><p>For example, you can specify images to pull in the configuration inventory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Install Docker on this group!</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>docker_image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>redis:latest     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Pull the latest Redis image</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Another way to preload images is to use locally <code>save</code>d <code>tgz</code> archives: if you&rsquo;ve previously exported Docker images using <code>docker save xxx | gzip -c > /tmp/docker/xxx.tgz</code>.
These exported image files can be automatically loaded via the glob specified by the <a href=param#docker_image_cache><code>docker_image_cache</code></a> parameter. The default location is: <code>/tmp/docker/*.tgz</code>.</p><p>This means you can place images in the <code>/tmp/docker</code> directory beforehand, and after running <a href=playbook#dockeryml><code>docker.yml</code></a> to install Docker, these image packages will be automatically loaded.</p><p>For example, in the <a href=/blog/db/supabase>self-hosted Supabase tutorial</a>, this technique is used. Before spinning up Supabase and installing Docker, the <code>*.tgz</code> image archives from the local <code>/tmp/supabase</code> directory are copied to the target node&rsquo;s <code>/tmp/docker</code> directory.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>copy local docker images</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>copy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>src=&#34;{{ item }}&#34; dest=&#34;/tmp/docker/&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with_fileglob</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;{{ supa_images }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># you can override this with -e cli args</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supa_images</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/tmp/supabase/*.tgz</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=applications>Applications</h2><p>Pigsty provides a series of ready-to-use, Docker Compose-based <a href=/docs/app/><strong>software templates</strong></a>, which you can use to spin up business software that uses external Pigsty-managed database clusters.</p><br><hr><br></div><div class=td-content style=page-break-before:always><h1 id=pg-c0b69dd4ee6960e205ee216b6b647bba>2 - Parameters</h1><div class=lead>DOCKER module provides 8 configuration parameters</div><p>The DOCKER module provides 8 configuration parameters.</p><h2 id=parameter-overview>Parameter Overview</h2><p>The <a href=#docker><code>DOCKER</code></a> parameter group is used for Docker container engine deployment and configuration, including enable switch, data directory, storage driver, registry mirrors, and monitoring.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#docker_enabled><code>docker_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Enable Docker on current node? disabled by default</td></tr><tr><td style=text-align:left><a href=#docker_data><code>docker_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Docker data directory, <code>/data/docker</code> by default</td></tr><tr><td style=text-align:left><a href=#docker_storage_driver><code>docker_storage_driver</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Docker storage driver, <code>overlay2</code> by default</td></tr><tr><td style=text-align:left><a href=#docker_cgroups_driver><code>docker_cgroups_driver</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Docker cgroup driver: cgroupfs or systemd</td></tr><tr><td style=text-align:left><a href=#docker_registry_mirrors><code>docker_registry_mirrors</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Docker registry mirror list</td></tr><tr><td style=text-align:left><a href=#docker_exporter_port><code>docker_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Docker metrics exporter port, <code>9323</code> by default</td></tr><tr><td style=text-align:left><a href=#docker_image><code>docker_image</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Docker images to pull, empty list by default</td></tr><tr><td style=text-align:left><a href=#docker_image_cache><code>docker_image_cache</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Docker image cache tarball path, <code>/tmp/docker/*.tgz</code></td></tr></tbody></table><p>You can use the <a href=https://github.com/pgsty/pigsty/blob/main/docker.yml><code>docker.yml</code></a> playbook to install and enable Docker on nodes.</p><p>Default parameters are defined in <a href=https://github.com/pgsty/pigsty/blob/main/roles/docker/defaults/main.yml><code>roles/docker/defaults/main.yml</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># Enable Docker on current node?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/docker        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Docker data directory, /data/docker by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_storage_driver</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>overlay2  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Docker storage driver, overlay2/zfs/btrfs...</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_cgroups_driver: systemd    # Docker cgroup driver</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cgroupfs or systemd</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_registry_mirrors</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># Docker registry mirror list</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9323</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Docker metrics exporter port, 9323 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># Docker images to pull after startup</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>docker_image_cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/tmp/docker/*.tgz</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Docker image cache tarball glob pattern</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=docker_enabled><code>docker_enabled</code></h3><p>Parameter: <code>docker_enabled</code>, Type: <code>bool</code>, Level: <code>G/C/I</code></p><p>Enable Docker on current node? Default: <code>false</code>, meaning Docker is not enabled.</p><h3 id=docker_data><code>docker_data</code></h3><p>Parameter: <code>docker_data</code>, Type: <code>path</code>, Level: <code>G/C/I</code></p><p>Docker data directory, default is <code>/data/docker</code>.</p><p>This directory stores Docker images, containers, volumes, and other data. If you have a dedicated data disk, it&rsquo;s recommended to point this directory to that disk&rsquo;s mount point.</p><h3 id=docker_storage_driver><code>docker_storage_driver</code></h3><p>Parameter: <code>docker_storage_driver</code>, Type: <code>enum</code>, Level: <code>G/C/I</code></p><p>Docker storage driver, default is <code>overlay2</code>.</p><p>See official documentation: <a href=https://docs.docker.com/engine/storage/drivers/select-storage-driver/>https://docs.docker.com/engine/storage/drivers/select-storage-driver/</a></p><p>Available storage drivers include:</p><ul><li><code>overlay2</code>: Recommended default driver, suitable for most scenarios</li><li><code>fuse-overlayfs</code>: For rootless container scenarios</li><li><code>btrfs</code>: When using Btrfs filesystem</li><li><code>zfs</code>: When using ZFS filesystem</li><li><code>vfs</code>: For testing purposes, not recommended for production</li></ul><h3 id=docker_cgroups_driver><code>docker_cgroups_driver</code></h3><p>Parameter: <code>docker_cgroups_driver</code>, Type: <code>enum</code>, Level: <code>G/C/I</code></p><p>Docker cgroup filesystem driver, can be <code>cgroupfs</code> or <code>systemd</code>, default: <code>systemd</code></p><h3 id=docker_registry_mirrors><code>docker_registry_mirrors</code></h3><p>Parameter: <code>docker_registry_mirrors</code>, Type: <code>string[]</code>, Level: <code>G/C/I</code></p><p>Docker registry mirror list, default: <code>[]</code> empty array.</p><p>You can use Docker mirror sites to accelerate image pulls. Here are some examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://docker.m.daocloud.io&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># DaoCloud mirror</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://docker.1ms.run&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 1ms mirror</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://mirror.ccs.tencentyun.com&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># Tencent Cloud internal mirror</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://registry.cn-hangzhou.aliyuncs.com&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># Alibaba Cloud mirror (requires login)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>You can also consider using a Cloudflare Worker to set up a <a href=https://github.com/cmliu/CF-Workers-docker.io>Docker Proxy</a> for faster access.</p><p>If pull speeds are still too slow, consider using alternative registries: <code>docker login quay.io</code></p><h3 id=docker_exporter_port><code>docker_exporter_port</code></h3><p>Parameter: <code>docker_exporter_port</code>, Type: <code>port</code>, Level: <code>G</code></p><p>Docker metrics exporter port, default is <code>9323</code>.</p><p>The Docker daemon exposes Prometheus-format monitoring metrics on this port for collection by monitoring infrastructure.</p><h3 id=docker_image><code>docker_image</code></h3><p>Parameter: <code>docker_image</code>, Type: <code>string[]</code>, Level: <code>G/C/I</code></p><p>List of Docker images to pull, default is empty list <code>[]</code>.</p><p>Docker image names specified here will be automatically pulled during the installation phase.</p><h3 id=docker_image_cache><code>docker_image_cache</code></h3><p>Parameter: <code>docker_image_cache</code>, Type: <code>path</code>, Level: <code>G/C/I</code></p><p>Local Docker image cache tarball glob pattern, default is <code>/tmp/docker/*.tgz</code>.</p><p>You can use <code>docker save | gzip</code> to package images and automatically import them during Docker installation via this parameter.</p><p><code>.tgz</code> tarball files matching this pattern will be imported into Docker one by one using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat *.tgz <span style=color:#000;font-weight:700>|</span> gzip -d -c - <span style=color:#000;font-weight:700>|</span> docker load
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0d8046db96a405e5b5a2289a58d6abd2>3 - Playbooks</h1><div class=lead>How to use the built-in Ansible playbook to manage Docker and quick reference for common management commands.</div><p>The Docker module provides a default playbook <a href=#dockeryml><code>docker.yml</code></a> for installing Docker Daemon and Docker Compose.</p><hr><h2 id=dockeryml><code>docker.yml</code></h2><p>Playbook source file: <a href=https://github.com/pgsty/pigsty/blob/main/docker.yml><code>docker.yml</code></a></p><p>Running this playbook will install <code>docker-ce</code> and <code>docker-compose-plugin</code> on target nodes with the <code>docker_enabled: true</code> flag, and enable the <code>dockerd</code> service.</p><p>The following are the available task subsets in the <code>docker.yml</code> playbook:</p><ul><li><code>docker_install</code> : Install Docker and Docker Compose packages on the node</li><li><code>docker_admin</code> : Add specified users to the Docker admin user group</li><li><code>docker_alias</code> : Generate Docker command completion and alias scripts</li><li><code>docker_dir</code> : Create Docker related directories</li><li><code>docker_config</code> : Generate Docker daemon service configuration file</li><li><code>docker_launch</code> : Start the Docker daemon service</li><li><code>docker_register</code> : Register Docker daemon as a Prometheus monitoring target</li><li><code>docker_image</code> : Attempt to load pre-cached image tarballs from <code>/tmp/docker/*.tgz</code> (if they exist)</li></ul><p>The Docker module does not provide a dedicated uninstall playbook. If you need to uninstall Docker, you can manually stop Docker and then remove it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop docker                        <span style=color:#8f5902;font-style:italic># Stop Docker daemon service</span>
</span></span><span style=display:flex><span>yum remove docker-ce docker-compose-plugin   <span style=color:#8f5902;font-style:italic># Uninstall Docker on EL systems</span>
</span></span><span style=display:flex><span>apt remove docker-ce docker-compose-plugin   <span style=color:#8f5902;font-style:italic># Uninstall Docker on Debian systems</span>
</span></span></code></pre></div><br><hr><br></div><div class=td-content style=page-break-before:always><h1 id=pg-a3f1f926af2c0b8c8ba997c87b729b3e>4 - Metrics</h1><div class=lead>Complete list of monitoring metrics provided by the Pigsty Docker module</div><p>The <a href=/docs/docker><strong><code>DOCKER</code></strong></a> module contains 123 available monitoring metrics.</p><table><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>builder_builds_failed_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>reason</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of failed image builds</td></tr><tr><td>builder_builds_triggered_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of triggered image builds</td></tr><tr><td>docker_up</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>engine_daemon_container_actions_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_container_actions_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_container_actions_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_container_states_containers</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>state</code></td><td>The count of containers in various states</td></tr><tr><td>engine_daemon_engine_cpus_cpus</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of cpus that the host system of the engine has</td></tr><tr><td>engine_daemon_engine_info</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>architecture</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>os_version</code>, <code>kernel</code>, <code>version</code>, <code>graphdriver</code>, <code>os</code>, <code>daemon_id</code>, <code>commit</code>, <code>os_type</code></td><td>The information related to the engine and the OS it is running on</td></tr><tr><td>engine_daemon_engine_memory_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of bytes of memory that the host system of the engine has</td></tr><tr><td>engine_daemon_events_subscribers_total</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of current subscribers to events</td></tr><tr><td>engine_daemon_events_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of events logged</td></tr><tr><td>engine_daemon_health_checks_failed_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The total number of failed health checks</td></tr><tr><td>engine_daemon_health_check_start_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>engine_daemon_health_check_start_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>engine_daemon_health_check_start_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>engine_daemon_health_checks_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The total number of health checks</td></tr><tr><td>engine_daemon_host_info_functions_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code>, <code>function</code></td><td>N/A</td></tr><tr><td>engine_daemon_host_info_functions_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>function</code></td><td>N/A</td></tr><tr><td>engine_daemon_host_info_functions_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>function</code></td><td>N/A</td></tr><tr><td>engine_daemon_image_actions_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_image_actions_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_image_actions_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_network_actions_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_network_actions_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>action</code></td><td>N/A</td></tr><tr><td>engine_daemon_network_actions_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>action</code></td><td>N/A</td></tr><tr><td>etcd_debugging_snap_save_marshalling_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>etcd_debugging_snap_save_marshalling_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_debugging_snap_save_marshalling_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_debugging_snap_save_total_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>etcd_debugging_snap_save_total_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_debugging_snap_save_total_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_disk_wal_fsync_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>etcd_disk_wal_fsync_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_disk_wal_fsync_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_disk_wal_write_bytes_total</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Total number of bytes written in WAL.</td></tr><tr><td>etcd_snap_db_fsync_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>etcd_snap_db_fsync_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_snap_db_fsync_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_snap_db_save_total_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>etcd_snap_db_save_total_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_snap_db_save_total_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_snap_fsync_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>etcd_snap_fsync_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>etcd_snap_fsync_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds</td><td>summary</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>quantile</code></td><td>A summary of the pause duration of garbage collection cycles.</td></tr><tr><td>go_gc_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>go_goroutines</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of goroutines that currently exist.</td></tr><tr><td>go_info</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>version</code>, <code>instance</code></td><td>Information about the Go environment.</td></tr><tr><td>go_memstats_alloc_bytes</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_alloc_bytes_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_buck_hash_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes used by the profiling bucket hash table.</td></tr><tr><td>go_memstats_frees_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Total number of frees.</td></tr><tr><td>go_memstats_gc_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes used for garbage collection system metadata.</td></tr><tr><td>go_memstats_heap_alloc_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of heap bytes allocated and still in use.</td></tr><tr><td>go_memstats_heap_idle_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of heap bytes waiting to be used.</td></tr><tr><td>go_memstats_heap_inuse_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of heap bytes that are in use.</td></tr><tr><td>go_memstats_heap_objects</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of allocated objects.</td></tr><tr><td>go_memstats_heap_released_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of heap bytes released to OS.</td></tr><tr><td>go_memstats_heap_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of heap bytes obtained from system.</td></tr><tr><td>go_memstats_last_gc_time_seconds</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of seconds since 1970 of last garbage collection.</td></tr><tr><td>go_memstats_lookups_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Total number of pointer lookups.</td></tr><tr><td>go_memstats_mallocs_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Total number of mallocs.</td></tr><tr><td>go_memstats_mcache_inuse_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes in use by mcache structures.</td></tr><tr><td>go_memstats_mcache_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes used for mcache structures obtained from system.</td></tr><tr><td>go_memstats_mspan_inuse_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes in use by mspan structures.</td></tr><tr><td>go_memstats_mspan_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes used for mspan structures obtained from system.</td></tr><tr><td>go_memstats_next_gc_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of heap bytes when next garbage collection will take place.</td></tr><tr><td>go_memstats_other_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes used for other system allocations.</td></tr><tr><td>go_memstats_stack_inuse_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes in use by the stack allocator.</td></tr><tr><td>go_memstats_stack_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes obtained from system for stack allocator.</td></tr><tr><td>go_memstats_sys_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of bytes obtained from system.</td></tr><tr><td>go_threads</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of OS threads created.</td></tr><tr><td>logger_log_entries_size_greater_than_buffer_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of log entries which are larger than the log buffer</td></tr><tr><td>logger_log_read_operations_failed_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of log reads from container stdio that failed</td></tr><tr><td>logger_log_write_operations_failed_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of log write operations that failed</td></tr><tr><td>process_cpu_seconds_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Total user and system CPU time spent in seconds.</td></tr><tr><td>process_max_fds</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>process_open_fds</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Number of open file descriptors.</td></tr><tr><td>process_resident_memory_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Resident memory size in bytes.</td></tr><tr><td>process_start_time_seconds</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>process_virtual_memory_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>process_virtual_memory_max_bytes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>promhttp_metric_handler_requests_in_flight</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Current number of scrapes being served.</td></tr><tr><td>promhttp_metric_handler_requests_total</td><td>counter</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>code</code></td><td>Total number of scrapes by HTTP status code.</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_dispatcher_scheduling_delay_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_dispatcher_scheduling_delay_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_dispatcher_scheduling_delay_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_manager_configs_total</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of configs in the cluster object store</td></tr><tr><td>swarm_manager_leader</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Indicates if this manager node is a leader</td></tr><tr><td>swarm_manager_networks_total</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of networks in the cluster object store</td></tr><tr><td>swarm_manager_nodes</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>state</code></td><td>The number of nodes</td></tr><tr><td>swarm_manager_secrets_total</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of secrets in the cluster object store</td></tr><tr><td>swarm_manager_services_total</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>The number of services in the cluster object store</td></tr><tr><td>swarm_manager_tasks_total</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>state</code></td><td>The number of tasks in the cluster object store</td></tr><tr><td>swarm_node_manager</td><td>gauge</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>Whether this node is a manager or not</td></tr><tr><td>swarm_raft_snapshot_latency_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_raft_snapshot_latency_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_raft_snapshot_latency_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_raft_transaction_latency_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_raft_transaction_latency_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_raft_transaction_latency_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_batch_latency_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_store_batch_latency_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_batch_latency_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_lookup_latency_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_store_lookup_latency_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_lookup_latency_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_memory_store_lock_duration_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_store_memory_store_lock_duration_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_memory_store_lock_duration_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_read_tx_latency_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_store_read_tx_latency_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_read_tx_latency_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_write_tx_latency_seconds_bucket</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code>, <code>le</code></td><td>N/A</td></tr><tr><td>swarm_store_write_tx_latency_seconds_count</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>swarm_store_write_tx_latency_seconds_sum</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>ip</code>, <code>cls</code>, <code>ins</code>, <code>job</code>, <code>instance</code></td><td>N/A</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-e91d8545ce4c41275eaf6b59c98047e2>5 - FAQ</h1><div class=lead>Frequently asked questions about the Pigsty Docker module</div><hr><h2 id=who-can-run-docker-commands>Who Can Run Docker Commands?</h2><p>By default, Pigsty adds both the management user running the playbook on the remote node (i.e., the SSH login user on the target node) and the admin user specified in the <a href=/docs/node/param#node_admin_username><code>node_admin_username</code></a> parameter to the Docker operating system group.
All users in this group (<code>docker</code>) can manage Docker using the <code>docker</code> CLI command.</p><p>If you want other users to be able to run Docker commands, add that OS user to the docker group:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>usermod -aG docker &lt;username&gt;
</span></span></code></pre></div><hr><h2 id=working-through-a-proxy>Working Through a Proxy</h2><p>During Docker installation, if the <a href=/docs/infra/param#proxy_env><code>proxy_env</code></a> parameter exists,
the HTTP proxy server configuration will be written to the <code>/etc/docker/daemon.json</code> configuration file.</p><p>Docker will use this proxy server when pulling images from upstream registries.</p><p>Tip: Running <code>configure</code> with the <code>-x</code> flag will write the proxy server configuration from your current environment into <code>proxy_env</code>.</p><hr><h2 id=using-mirror-registries>Using Mirror Registries</h2><p>If you&rsquo;re in mainland China and affected by the Great Firewall, you can consider using Docker mirror sites available within China, such as quay.io:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker login quay.io    <span style=color:#8f5902;font-style:italic># Enter username and password to log in</span>
</span></span></code></pre></div><p>Update (June 2024): All previously accessible Docker mirror sites in China have been blocked. Please use a proxy server to access and pull images.</p><hr><h2 id=adding-docker-to-monitoring>Adding Docker to Monitoring</h2><p>During Docker module installation, you can register Docker as a monitoring target by running the <code>docker_register</code> or <code>register_prometheus</code> subtask for specific nodes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./docker.yml -l &lt;your-node-selector&gt; -t register_prometheus
</span></span></code></pre></div><hr><h2 id=using-software-templates>Using Software Templates</h2><p>Pigsty provides a collection of <a href=/docs/app/>software templates</a> that can be launched using Docker Compose, ready to use out of the box.</p><p>But you need to install the Docker module first.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>