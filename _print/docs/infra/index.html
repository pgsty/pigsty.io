<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/infra/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/infra/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Module: INFRA | PIGSTY</title><meta name=description content="Optional standalone infrastructure that provides NTP, DNS, observability and other foundational services for PostgreSQL."><meta property="og:url" content="https://pigsty.io/docs/infra/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="Module: INFRA"><meta property="og:description" content="Optional standalone infrastructure that provides NTP, DNS, observability and other foundational services for PostgreSQL."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Module: INFRA"><meta itemprop=description content="Optional standalone infrastructure that provides NTP, DNS, observability and other foundational services for PostgreSQL."><meta itemprop=dateModified content="2026-01-08T18:48:49+08:00"><meta itemprop=wordCount content="2071"><meta itemprop=keywords content="Reference"><meta name=twitter:card content="summary"><meta name=twitter:title content="Module: INFRA"><meta name=twitter:description content="Optional standalone infrastructure that provides NTP, DNS, observability and other foundational services for PostgreSQL."><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/infra/>Return to the regular view of this page</a>.</p></div><h1 class=title>Module: INFRA</h1><div class=lead>Optional standalone infrastructure that provides NTP, DNS, observability and other foundational services for PostgreSQL.</div><ul><li>1: <a href=#pg-b132f85e66823fcf873f2eae62277609>Configuration</a></li><li>2: <a href=#pg-878bc43f92081e59141a2773d0c07d86>Parameters</a></li><li>3: <a href=#pg-83a306c7aef5ddfdbad1dd3d6363e905>Playbook</a></li><li>4: <a href=#pg-338892e63af76b4e44d46c71803f5af5>Monitoring</a></li><li>5: <a href=#pg-f8c94ca1b2e6cfdd961016e7d77247d8>Metrics</a></li><li>6: <a href=#pg-00fcc0891b8e51b39a5b93b6e89a421f>FAQ</a></li><li>7: <a href=#pg-534bd7b2a1b7fa250e24342de3f0e5b1>Administration</a></li><ul><li>7.1: <a href=#pg-fba20550b8388331ec7938e5fd572d46>Ansible</a></li><li>7.2: <a href=#pg-f258509d1b17d59a0332114b15cb35b7>Playbooks</a></li><li>7.3: <a href=#pg-52d708085244eb9d51e81dd9e7c10996>Nginx Management</a></li><li>7.4: <a href=#pg-3e5c80de91c09afe274f784b52a45287>Software Repository</a></li><li>7.5: <a href=#pg-11e76a7fd5b13e8b9ed2ffe665bd1146>Domain Management</a></li><li>7.6: <a href=#pg-99138bcc6d2f367b6fb7df8b7a59e131>Module Management</a></li><li>7.7: <a href=#pg-3903df191db5a10a2713083bc196961f>CA and Certificates</a></li><li>7.8: <a href=#pg-c91827b2709e7c2e7f7afc8662f9e0bf>Grafana High Availability: Using PostgreSQL Backend</a></li></ul></ul><div class=content><p><a href=#configuration>Configuration</a> | <a href=#administration>Administration</a> | <a href=#playbooks>Playbooks</a> | <a href=#monitoring>Monitoring</a> | <a href=#parameters>Parameters</a></p><hr><h2 id=overview>Overview</h2><p>Every Pigsty deployment includes a set of infrastructure components that provide services for managed nodes and database clusters:</p><table><thead><tr><th style=text-align:center>Component</th><th style=text-align:center>Port</th><th style=text-align:center>Domain</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><a href=#nginx>Nginx</a></td><td style=text-align:center><code>80/443</code></td><td style=text-align:center><code>i.pigsty</code></td><td>Web service portal, local repo, and unified entry point</td></tr><tr><td style=text-align:center><a href=#grafana>Grafana</a></td><td style=text-align:center><code>3000</code></td><td style=text-align:center><code>g.pigsty</code></td><td>Visualization platform for monitoring dashboards and data apps</td></tr><tr><td style=text-align:center><a href=#victoria>VictoriaMetrics</a></td><td style=text-align:center><code>8428</code></td><td style=text-align:center><code>p.pigsty</code></td><td>Time-series database with VMUI, compatible with Prometheus API</td></tr><tr><td style=text-align:center><a href=#victoria>VictoriaLogs</a></td><td style=text-align:center><code>9428</code></td><td style=text-align:center>-</td><td>Centralized log database, receives structured logs from Vector</td></tr><tr><td style=text-align:center><a href=#victoria>VictoriaTraces</a></td><td style=text-align:center><code>10428</code></td><td style=text-align:center>-</td><td>Tracing and event storage for slow SQL / request tracing</td></tr><tr><td style=text-align:center><a href=#victoria>VMAlert</a></td><td style=text-align:center><code>8880</code></td><td style=text-align:center>-</td><td>Alert rule evaluator, triggers alerts based on VictoriaMetrics metrics</td></tr><tr><td style=text-align:center><a href=#victoria>AlertManager</a></td><td style=text-align:center><code>9059</code></td><td style=text-align:center><code>a.pigsty</code></td><td>Alert aggregation and dispatch, receives notifications from VMAlert</td></tr><tr><td style=text-align:center><a href=#victoria>BlackboxExporter</a></td><td style=text-align:center><code>9115</code></td><td style=text-align:center>-</td><td>ICMP/TCP/HTTP blackbox probing</td></tr><tr><td style=text-align:center><a href=#dnsmasq>DNSMASQ</a></td><td style=text-align:center><code>53</code></td><td style=text-align:center>-</td><td>DNS server for internal domain resolution</td></tr><tr><td style=text-align:center><a href=#chronyd>Chronyd</a></td><td style=text-align:center><code>123</code></td><td style=text-align:center>-</td><td>NTP time server</td></tr><tr><td style=text-align:center><a href=#postgresql>PostgreSQL</a></td><td style=text-align:center><code>5432</code></td><td style=text-align:center>-</td><td>CMDB and default database</td></tr><tr><td style=text-align:center><a href=#ansible>Ansible</a></td><td style=text-align:center>-</td><td style=text-align:center>-</td><td>Runs playbooks, orchestrates all infrastructure</td></tr></tbody></table><p>In Pigsty, the <a href=/docs/pgsql>PGSQL</a> module uses some services on <a href=/docs/concept/arch/node#infra-node><strong>INFRA nodes</strong></a>, specifically:</p><ul><li>Database cluster/host node domains depend on DNSMASQ on INFRA nodes for <strong>resolution</strong>.</li><li><strong>Installing</strong> software on database nodes uses the local yum/apt repo hosted by Nginx on INFRA nodes.</li><li>Database cluster/node monitoring <strong>metrics</strong> are scraped and stored by VictoriaMetrics on INFRA nodes, accessible via VMUI / PromQL.</li><li>Database and node runtime logs are collected by Vector and pushed to VictoriaLogs on INFRA, searchable in Grafana.</li><li>VMAlert <strong>evaluates</strong> alert rules based on metrics in VictoriaMetrics and forwards events to Alertmanager.</li><li>Users initiate <strong>management</strong> of database nodes from Infra/Admin nodes using Ansible or other tools:<ul><li>Execute cluster creation, scaling, instance/cluster recycling</li><li>Create business users, databases, modify services, HBA changes;</li><li>Execute log collection, garbage cleanup, backup, inspections, etc.</li></ul></li><li>Database nodes sync time from the NTP server on INFRA/ADMIN nodes by default</li><li>If no dedicated cluster exists, the HA component Patroni uses etcd on INFRA nodes as the HA DCS.</li><li>If no dedicated cluster exists, the backup component pgbackrest uses MinIO on INFRA nodes as an optional centralized backup repository.</li></ul><hr><h3 id=nginx>Nginx</h3><p>Nginx is the access entry point for all WebUI services in Pigsty, using port 80 on the admin node by default.</p><p>Many infrastructure components with WebUI are exposed through Nginx, such as Grafana, VictoriaMetrics (VMUI), AlertManager, and HAProxy traffic management pages. Additionally, static file resources like yum/apt repos are served through Nginx.</p><p>Nginx routes access requests to corresponding upstream components based on <strong>domain names</strong> according to <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> configuration. If you use other domains or public domains, you can modify them here:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># domain names and upstream servers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>prometheus   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># VMUI</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmalert      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8880&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#logs         : { domain: logs.pigsty ,endpoint: &#34;${admin_ip}:9428&#34; }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#minio        : { domain: sss.pigsty  ,endpoint: &#34;${admin_ip}:9001&#34; ,scheme: https ,websocket: true }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty strongly recommends using domain names to access Pigsty UI systems rather than direct IP+port access, for these reasons:</p><ul><li>Using domains makes it easy to enable HTTPS traffic encryption, consolidate access to Nginx, audit all requests, and conveniently integrate authentication mechanisms.</li><li>Some components only listen on 127.0.0.1 by default, so they can only be accessed through Nginx proxy.</li><li>Domain names are easier to remember and provide additional configuration flexibility.</li></ul><p>If you don&rsquo;t have available internet domains or local DNS resolution, you can add local static resolution records in <code>/etc/hosts</code> (MacOS/Linux) or <code>C:\Windows\System32\drivers\etc\hosts</code> (Windows).</p><p>Nginx configuration parameters are at: <a href=/docs/infra/param#nginx>Configuration: INFRA - NGINX</a></p><hr><h3 id=local-software-repository>Local Software Repository</h3><p>Pigsty creates a local software repository during installation to accelerate subsequent software installation.</p><p>This repository is served by Nginx, located by default at <code>/www/pigsty</code>, accessible via <code>http://i.pigsty/pigsty</code>.</p><p>Pigsty&rsquo;s offline package is the entire software repository directory (yum/apt) compressed. When Pigsty tries to build a local repo, if it finds the local repo directory <code>/www/pigsty</code> already exists with the <code>/www/pigsty/repo_complete</code> marker file, it considers the local repo already built and skips downloading software from upstream, eliminating internet dependency.</p><p>The repo definition file is at <code>/www/pigsty.repo</code>, accessible by default via <code>http://${admin_ip}/pigsty.repo</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -L http://i.pigsty/pigsty.repo -o /etc/yum.repos.d/pigsty.repo
</span></span></code></pre></div><p>You can also use the file local repo directly without Nginx:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[pigsty-local]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Pigsty local $releasever - $basearch</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>baseurl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>file:///www/pigsty/</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>gpgcheck</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>0</span>
</span></span></code></pre></div><p>Local repository configuration parameters are at: <a href=/docs/infra/param#repo>Configuration: INFRA - REPO</a></p><hr><h3 id=victoria-observability-suite>Victoria Observability Suite</h3><p>Pigsty v4.0 uses the VictoriaMetrics family to replace Prometheus/Loki, providing unified monitoring, logging, and tracing capabilities:</p><ul><li><strong>VictoriaMetrics</strong> listens on port <code>8428</code> by default, accessible via <code>http://p.pigsty</code> or <code>https://i.pigsty/vmetrics/</code> for VMUI, compatible with Prometheus API.</li><li><strong>VMAlert</strong> evaluates alert rules in <code>/infra/rules/*.yml</code>, listens on port <code>8880</code>, and sends alert events to Alertmanager.</li><li><strong>VictoriaLogs</strong> listens on port <code>9428</code>, supports the <code>https://i.pigsty/vlogs/</code> query interface. All nodes run Vector by default, pushing structured system logs, PostgreSQL logs, etc. to VictoriaLogs.</li><li><strong>VictoriaTraces</strong> listens on port <code>10428</code> for slow SQL / Trace collection, Grafana accesses it as a Jaeger datasource.</li><li><strong>Alertmanager</strong> listens on port <code>9059</code>, accessible via <code>http://a.pigsty</code> or <code>https://i.pigsty/alertmgr/</code> for managing alert notifications. After configuring SMTP, Webhook, etc., it can push messages.</li><li><strong>Blackbox Exporter</strong> listens on port <code>9115</code> by default for Ping/TCP/HTTP probing, accessible via <code>https://i.pigsty/blackbox/</code>.</li></ul><p>For more information, see: <a href=/docs/infra/param#victoria>Configuration: INFRA - VICTORIA</a> and <a href=/docs/infra/param#prometheus>Configuration: INFRA - PROMETHEUS</a>.</p><hr><h3 id=grafana>Grafana</h3><p>Grafana is the core of Pigsty&rsquo;s WebUI, listening on port <code>3000</code> by default, accessible directly via <code>IP:3000</code> or domain <code>http://g.pigsty</code>.</p><p>Pigsty comes with preconfigured datasources for VictoriaMetrics / Logs / Traces (<code>vmetrics-*</code>, <code>vlogs-*</code>, <code>vtraces-*</code>), and numerous dashboards with URL-based navigation for quick problem location.</p><p>Grafana can also be used as a general low-code visualization platform, so Pigsty installs plugins like ECharts and victoriametrics-datasource by default for building monitoring dashboards or inspection reports.</p><p>Grafana configuration parameters are at: <a href=/docs/infra/param#grafana>Configuration: INFRA - GRAFANA</a>.</p><hr><h3 id=ansible>Ansible</h3><p>Pigsty installs Ansible on the meta node by default. Ansible is a popular operations tool with declarative configuration style and idempotent playbook design that greatly reduces system maintenance complexity.</p><hr><h3 id=dnsmasq>DNSMASQ</h3><p>DNSMASQ provides DNS <strong>resolution</strong> services within the environment. Domain names from other modules are registered with the DNSMASQ service on INFRA nodes.</p><p>DNS records are placed by default in the <code>/etc/hosts.d/</code> directory on all INFRA nodes.</p><p>DNSMASQ configuration parameters are at: <a href=/docs/infra/param#dns>Configuration: INFRA - DNS</a></p><hr><h3 id=chronyd>Chronyd</h3><p>NTP service synchronizes time across all nodes in the environment (optional)</p><p>NTP configuration parameters are at: <a href=/docs/node/param#node_time>Configuration: NODES - NTP</a></p><hr><h2 id=configuration>Configuration</h2><p>To install the INFRA module on a node, first add it to the <code>infra</code> group in the config inventory and assign an instance number <a href=/docs/infra/param#infra_seq><code>infra_seq</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Configure single INFRA node</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Configure two INFRA nodes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Then use the <a href=#infrayml><code>infra.yml</code></a> playbook to initialize the INFRA module on the nodes.</p><hr><h2 id=administration>Administration</h2><p>Here are some administration tasks related to the INFRA module:</p><hr><h3 id=installuninstall-infra-module>Install/Uninstall Infra Module</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml     <span style=color:#8f5902;font-style:italic># Install INFRA module on infra group</span>
</span></span><span style=display:flex><span>./infra-rm.yml  <span style=color:#8f5902;font-style:italic># Uninstall INFRA module from infra group</span>
</span></span></code></pre></div><hr><h3 id=manage-local-software-repository>Manage Local Software Repository</h3><p>You can use the following playbook subtasks to manage the local yum repo on Infra nodes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo              <span style=color:#8f5902;font-style:italic># Create local repo from internet or offline package</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./infra.yml -t repo_dir          <span style=color:#8f5902;font-style:italic># Create local repo directory</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_check        <span style=color:#8f5902;font-style:italic># Check if local repo already exists</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_prepare      <span style=color:#8f5902;font-style:italic># If exists, use existing local repo</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_build        <span style=color:#8f5902;font-style:italic># If not exists, build local repo from upstream</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_upstream     <span style=color:#8f5902;font-style:italic># Handle upstream repo files in /etc/yum.repos.d</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_remove       <span style=color:#8f5902;font-style:italic># If repo_remove == true, delete existing repo files</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_add          <span style=color:#8f5902;font-style:italic># Add upstream repo files to /etc/yum.repos.d (or /etc/apt/sources.list.d)</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_url_pkg      <span style=color:#8f5902;font-style:italic># Download packages from internet defined by repo_url_packages</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_cache        <span style=color:#8f5902;font-style:italic># Create upstream repo metadata cache with yum makecache / apt update</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_boot_pkg     <span style=color:#8f5902;font-style:italic># Install bootstrap packages like createrepo_c, yum-utils... (or dpkg-)</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_pkg          <span style=color:#8f5902;font-style:italic># Download packages &amp; dependencies from upstream repos</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_create       <span style=color:#8f5902;font-style:italic># Create local repo with createrepo_c &amp; modifyrepo_c</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_use          <span style=color:#8f5902;font-style:italic># Add newly built repo to /etc/yum.repos.d | /etc/apt/sources.list.d</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_nginx        <span style=color:#8f5902;font-style:italic># If no nginx serving, start nginx as web server</span>
</span></span></code></pre></div><p>The most commonly used commands are:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml     -t repo_upstream     <span style=color:#8f5902;font-style:italic># Add upstream repos defined in repo_upstream to INFRA nodes</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_pkg          <span style=color:#8f5902;font-style:italic># Download packages and dependencies from upstream repos</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_create       <span style=color:#8f5902;font-style:italic># Create/update local yum repo with createrepo_c &amp; modifyrepo_c</span>
</span></span></code></pre></div><hr><h3 id=manage-infrastructure-components>Manage Infrastructure Components</h3><p>You can use the following playbook subtasks to manage various infrastructure components on Infra nodes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t infra           <span style=color:#8f5902;font-style:italic># Configure infrastructure</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_env       <span style=color:#8f5902;font-style:italic># Configure environment variables on admin node: env_dir, env_pg, env_var</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_pkg       <span style=color:#8f5902;font-style:italic># Install software packages required by INFRA: infra_pkg_yum, infra_pkg_pip</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_user      <span style=color:#8f5902;font-style:italic># Setup infra OS user group</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_cert      <span style=color:#8f5902;font-style:italic># Issue certificates for infra components</span>
</span></span><span style=display:flex><span>./infra.yml -t dns             <span style=color:#8f5902;font-style:italic># Configure DNSMasq: dns_config, dns_record, dns_launch</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx           <span style=color:#8f5902;font-style:italic># Configure Nginx: nginx_config, nginx_cert, nginx_static, nginx_launch, nginx_exporter</span>
</span></span><span style=display:flex><span>./infra.yml -t victoria        <span style=color:#8f5902;font-style:italic># Configure VictoriaMetrics/Logs/Traces: vmetrics|vlogs|vtraces|vmalert</span>
</span></span><span style=display:flex><span>./infra.yml -t alertmanager    <span style=color:#8f5902;font-style:italic># Configure AlertManager: alertmanager_config, alertmanager_launch</span>
</span></span><span style=display:flex><span>./infra.yml -t blackbox        <span style=color:#8f5902;font-style:italic># Configure Blackbox Exporter: blackbox_launch</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana         <span style=color:#8f5902;font-style:italic># Configure Grafana: grafana_clean, grafana_config, grafana_plugin, grafana_launch, grafana_provision</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_register  <span style=color:#8f5902;font-style:italic># Register infra components to VictoriaMetrics / Grafana</span>
</span></span></code></pre></div><p>Other commonly used tasks include:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_index                        <span style=color:#8f5902;font-style:italic># Re-render Nginx homepage content</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config,nginx_reload          <span style=color:#8f5902;font-style:italic># Re-render Nginx portal config, expose new upstream services</span>
</span></span><span style=display:flex><span>./infra.yml -t vmetrics_config,vmetrics_launch    <span style=color:#8f5902;font-style:italic># Regenerate VictoriaMetrics main config and restart service</span>
</span></span><span style=display:flex><span>./infra.yml -t vlogs_config,vlogs_launch          <span style=color:#8f5902;font-style:italic># Re-render VictoriaLogs config</span>
</span></span><span style=display:flex><span>./infra.yml -t vmetrics_clean                     <span style=color:#8f5902;font-style:italic># Clean VictoriaMetrics storage data directory</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana_plugin                     <span style=color:#8f5902;font-style:italic># Download Grafana plugins from internet</span>
</span></span></code></pre></div><hr><h2 id=playbooks>Playbooks</h2><p>Pigsty provides three playbooks related to the INFRA module:</p><ul><li><a href=#infrayml><code>infra.yml</code></a>: Initialize pigsty infrastructure on infra nodes</li><li><a href=#infra-rmyml><code>infra-rm.yml</code></a>: Remove infrastructure components from infra nodes</li><li><a href=#deployyml><code>deploy.yml</code></a>: Complete one-time Pigsty installation on all nodes</li></ul><hr><h3 id=infrayml><code>infra.yml</code></h3><p>The INFRA module playbook <a href=https://github.com/pgsty/pigsty/blob/main/infra.yml><code>infra.yml</code></a> initializes pigsty infrastructure on <a href=/docs/concept/arch/node#infra-node><strong>INFRA nodes</strong></a></p><p><strong>Executing this playbook completes the following tasks</strong></p><ul><li>Configure meta node directories and environment variables</li><li>Download and build a local software repository to accelerate subsequent installation. (If using offline package, skip download phase)</li><li>Add the current meta node as a regular node under Pigsty management</li><li>Deploy <strong>infrastructure</strong> components including VictoriaMetrics/Logs/Traces, VMAlert, Grafana, Alertmanager, Blackbox Exporter, etc.</li></ul><p><strong>This playbook executes on <a href=/docs/concept/arch/node#infra-node><strong>INFRA nodes</strong></a> by default</strong></p><ul><li>Pigsty uses the <strong>current node executing this playbook</strong> as Pigsty&rsquo;s <a href=/docs/concept/arch/node#infra-node><strong>INFRA node</strong></a> and <a href=/docs/concept/arch/node#admin-node><strong>ADMIN node</strong></a> by default.</li><li>During <a href=/docs/setup/install#configure>configuration</a>, Pigsty marks the current node as Infra/Admin node and replaces the placeholder IP <code>10.10.10.10</code> in config templates with the <strong>current node&rsquo;s primary IP address</strong>.</li><li>Besides initiating management and hosting infrastructure, this node is no different from a regular managed node.</li><li>In single-node installation, ETCD is also installed on this node to provide DCS service</li></ul><p><strong>Notes about this playbook</strong></p><ul><li>This is an idempotent playbook; repeated execution will wipe infrastructure components on meta nodes.</li><li>To preserve historical monitoring data, first set <code>vmetrics_clean</code>, <code>vlogs_clean</code>, <code>vtraces_clean</code> to <code>false</code>.</li><li>When offline repo <code>/www/pigsty/repo_complete</code> exists, this playbook skips downloading software from internet. Full execution takes about 5-8 minutes depending on machine configuration.</li><li>Downloading directly from upstream internet sources without offline package may take 10-20 minutes depending on your network conditions.</li></ul><p><a href=https://asciinema.org/a/566412><img src=https://asciinema.org/a/566412.svg alt=asciicast></a></p><hr><h3 id=infra-rmyml><code>infra-rm.yml</code></h3><p>The INFRA module playbook <a href=https://github.com/pgsty/pigsty/blob/main/infra-rm.yml><code>infra-rm.yml</code></a> removes pigsty infrastructure from <a href=/docs/concept/arch/node#infra-node><strong>INFRA nodes</strong></a></p><p>Common subtasks include:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra-rm.yml               <span style=color:#8f5902;font-style:italic># Remove INFRA module</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t service    <span style=color:#8f5902;font-style:italic># Stop infrastructure services on INFRA</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t data       <span style=color:#8f5902;font-style:italic># Remove remaining data on INFRA</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t package    <span style=color:#8f5902;font-style:italic># Uninstall software packages installed on INFRA</span>
</span></span></code></pre></div><hr><h3 id=deployyml><code>deploy.yml</code></h3><p>The INFRA module playbook <a href=https://github.com/pgsty/pigsty/blob/main/deploy.yml><code>deploy.yml</code></a> performs a complete one-time Pigsty installation on <strong>all nodes</strong></p><p>This playbook is described in more detail in <a href=/docs/setup/playbook#deployment-playbook>Playbook: One-Time Installation</a>.</p><hr><h2 id=monitoring>Monitoring</h2><p><a href=https://demo.pigsty.io/d/pigsty>Pigsty Home</a>: Pigsty monitoring system homepage</p><details><summary>Pigsty Home Dashboard</summary><p><a href=https://demo.pigsty.io/d/pigsty/><img src=/img/dashboard/pigsty.jpg alt=pigsty.jpg></a></p></details><p><a href=https://demo.pigsty.io/d/infra-overview>INFRA Overview</a>: Pigsty infrastructure self-monitoring overview</p><details><summary>INFRA Overview Dashboard</summary><p><a href=https://demo.pigsty.io/d/infra-overview/><img src=/img/dashboard/infra-overview.jpg alt=infra-overview.jpg></a></p></details><p><a href=https://demo.pigsty.io/d/nginx-instance>Nginx Instance</a>: Nginx metrics and logs</p><details><summary>Nginx Overview Dashboard</summary><p><a href=https://demo.pigsty.io/d/nginx-overview><img src=/img/dashboard/nginx-overview.jpg alt=nginx-overview.jpg></a></p></details><p><a href=https://demo.pigsty.io/d/grafana-instance>Grafana Instance</a>: Grafana metrics and logs</p><details><summary>Grafana Overview Dashboard</summary><p><a href=https://demo.pigsty.io/d/grafana-overview><img src=/img/dashboard/grafana-overview.jpg alt=grafana-overview.jpg></a></p></details><p><a href=https://demo.pigsty.io/d/vmetrics-instance>VictoriaMetrics Instance</a>: VictoriaMetrics scraping, querying, and storage metrics</p><p><a href=https://demo.pigsty.io/d/vmalert-instance>VMAlert Instance</a>: Alert rule evaluation and queue status</p><p><a href=https://demo.pigsty.io/d/alertmanager-instance>Alertmanager Instance</a>: Alert aggregation, notification pipelines, and Silences</p><p><a href=https://demo.pigsty.io/d/vlogs-instance>VictoriaLogs Instance</a>: Log ingestion rate, query load, and index hits</p><p><a href=https://demo.pigsty.io/d/vtraces-instance>VictoriaTraces Instance</a>: Trace/KV storage and Jaeger interface</p><p><a href=https://demo.pigsty.io/d/logs-instance>Logs Instance</a>: Node log search based on Vector + VictoriaLogs</p><details><summary>Logs Instance Dashboard</summary><p><a href=https://demo.pigsty.io/d/logs-instance><img src=/img/dashboard/logs-instance.jpg alt=logs-instance.jpg></a></p></details><p><a href=https://demo.pigsty.io/d/cmdb-overview>CMDB Overview</a>: CMDB visualization</p><details><summary>CMDB Overview Dashboard</summary><p><a href=https://demo.pigsty.io/d/cmdb-overview><img src=/img/dashboard/cmdb-overview.jpg alt=cmdb-overview.jpg></a></p></details><p><a href=https://demo.pigsty.io/d/etcd-overview>ETCD Overview</a>: etcd metrics and logs</p><details><summary>ETCD Overview Dashboard</summary><p><a href=https://demo.pigsty.io/d/etcd-overview><img src=/img/dashboard/etcd-overview.jpg alt=etcd-overview.jpg></a></p></details><hr><h2 id=parameters>Parameters</h2><p>The <a href=/docs/infra/param#infra><code>INFRA</code></a> module has the following 10 parameter groups.</p><ul><li><a href=/docs/infra/param#meta><code>META</code></a>: Pigsty metadata</li><li><a href=/docs/infra/param#ca><code>CA</code></a>: Self-signed PKI/CA infrastructure</li><li><a href=/docs/infra/param#infra_id><code>INFRA_ID</code></a>: Infrastructure portal, Nginx domains</li><li><a href=/docs/infra/param#repo><code>REPO</code></a>: Local software repository</li><li><a href=/docs/infra/param#infra_package><code>INFRA_PACKAGE</code></a>: Infrastructure software packages</li><li><a href=/docs/infra/param#nginx><code>NGINX</code></a>: Nginx web server</li><li><a href=/docs/infra/param#dns><code>DNS</code></a>: DNSMASQ domain server</li><li><a href=/docs/infra/param#victoria><code>VICTORIA</code></a>: VictoriaMetrics / Logs / Traces suite</li><li><a href=/docs/infra/param#prometheus><code>PROMETHEUS</code></a>: Alertmanager and Blackbox Exporter</li><li><a href=/docs/infra/param#grafana><code>GRAFANA</code></a>: Grafana observability suite</li></ul><details><summary>Parameter Overview</summary><p>For the latest default values, types, and hierarchy, please refer to the <a href=/docs/infra/param/#parameter-overview>Parameter Reference</a> to stay consistent with the Pigsty version.</p></details></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b132f85e66823fcf873f2eae62277609>1 - Configuration</h1><div class=lead>How to configure INFRA nodes? Customize Nginx, local repo, DNS, NTP, monitoring components.</div><h2 id=configuration-guide>Configuration Guide</h2><p>INFRA = primarily <strong>monitoring</strong> infrastructure, <strong>optional</strong> for PostgreSQL databases.</p><p>Unless manually configured to depend on DNS/NTP services on INFRA nodes, INFRA module failures typically don&rsquo;t affect PG cluster operations.</p><p>Single INFRA node suffices for most scenarios. Prod env recommends 2-3 INFRA nodes for HA.</p><p>For better resource utilization, ETCD module (required by PG HA) can share nodes with INFRA module.</p><p>Using more than 3 INFRA nodes provides little additional benefit, but more ETCD nodes (e.g., 5) can improve DCS availability.</p><hr><h2 id=configuration-examples>Configuration Examples</h2><p>Add node IPs to <code>infra</code> group in config inventory, assign INFRA instance number <code>infra_seq</code>.</p><p>Default single INFRA node config:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>By default, <code>10.10.10.10</code> placeholder replaced with current node&rsquo;s primary IP during config.</p><p>Use <code>infra.yml</code> playbook to init INFRA module on nodes.</p><h3 id=more-nodes>More Nodes</h3><p>Two INFRA nodes config:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Three INFRA nodes config (with params):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 2, repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 3, repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>grafana_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vmetrics_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vlogs_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vtraces_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=infra-high-availability>INFRA High Availability</h2><p>Most INFRA module components = &ldquo;stateless/identical state&rdquo;. For HA, focus on &ldquo;load balancing&rdquo;.</p><p>HA achievable via Keepalived L2 VIP or HAProxy L4 load balancing. L2 VIP recommended for L2-reachable networks.</p><p>Config example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_vrid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>prometheus   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vmalert      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:8880&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Set VIP-related params and modify service endpoints in <code>infra_portal</code>.</p><hr><h2 id=nginx-configuration>Nginx Configuration</h2><p>See <a href=/docs/infra/param/#nginx>Nginx Parameter Config</a> and <a href=/docs/infra/admin/portal>Tutorial: Nginx</a>.</p><hr><h2 id=local-repo-configuration>Local Repo Configuration</h2><p>See <a href=/docs/infra/param/#repo>Repo Parameter Config</a>.</p><hr><h2 id=dns-configuration>DNS Configuration</h2><p>See <a href=/docs/infra/param/#dns>DNS Parameter Config</a> and <a href=/docs/infra/admin/domain>Tutorial: DNS</a>.</p><hr><h2 id=ntp-configuration>NTP Configuration</h2><p>See <a href=/docs/node/param/#node_time>NTP Parameter Config</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-878bc43f92081e59141a2773d0c07d86>2 - Parameters</h1><div class=lead>INFRA module provides 10 sections with 70+ configurable parameters</div><p>The INFRA module is responsible for deploying Pigsty&rsquo;s infrastructure components: local software repository, Nginx, DNSMasq, VictoriaMetrics, VictoriaLogs, Grafana, Alertmanager, Blackbox Exporter, and other monitoring and alerting infrastructure.</p><blockquote><p>Pigsty v4.0 uses VictoriaMetrics to replace Prometheus and VictoriaLogs to replace Loki, providing a superior observability solution.</p></blockquote><table><thead><tr><th style=text-align:left>Section</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#meta><code>META</code></a></td><td style=text-align:left>Pigsty metadata: version, admin IP, region, language, proxy</td></tr><tr><td style=text-align:left><a href=#ca><code>CA</code></a></td><td style=text-align:left>Self-signed CA certificate management</td></tr><tr><td style=text-align:left><a href=#infra_id><code>INFRA_ID</code></a></td><td style=text-align:left>Infrastructure node identity and service portal</td></tr><tr><td style=text-align:left><a href=#repo><code>REPO</code></a></td><td style=text-align:left>Local software repository configuration</td></tr><tr><td style=text-align:left><a href=#infra_package><code>INFRA_PACKAGE</code></a></td><td style=text-align:left>Infrastructure node package installation</td></tr><tr><td style=text-align:left><a href=#nginx><code>NGINX</code></a></td><td style=text-align:left>Nginx web server and reverse proxy configuration</td></tr><tr><td style=text-align:left><a href=#dns><code>DNS</code></a></td><td style=text-align:left>DNSMasq DNS server configuration</td></tr><tr><td style=text-align:left><a href=#victoria><code>VICTORIA</code></a></td><td style=text-align:left>VictoriaMetrics/Logs/Traces observability stack</td></tr><tr><td style=text-align:left><a href=#prometheus><code>PROMETHEUS</code></a></td><td style=text-align:left>Alertmanager and Blackbox Exporter</td></tr><tr><td style=text-align:left><a href=#grafana><code>GRAFANA</code></a></td><td style=text-align:left>Grafana visualization platform configuration</td></tr></tbody></table><hr><h2 id=parameter-overview>Parameter Overview</h2><p><a href=#meta><code>META</code></a> parameters define Pigsty metadata, including version string, admin node IP, repository mirror region, default language, and proxy settings.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#version><code>version</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Pigsty version string</td></tr><tr><td style=text-align:left><a href=#admin_ip><code>admin_ip</code></a></td><td style=text-align:center><code>ip</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Admin node IP address</td></tr><tr><td style=text-align:left><a href=#region><code>region</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Upstream mirror region: default,china,europe</td></tr><tr><td style=text-align:left><a href=#language><code>language</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Default language: en or zh</td></tr><tr><td style=text-align:left><a href=#proxy_env><code>proxy_env</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Global proxy environment variables</td></tr></tbody></table><p><a href=#ca><code>CA</code></a> parameters configure Pigsty&rsquo;s self-signed CA certificate management, including CA creation, CA name, and certificate validity.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#ca_create><code>ca_create</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Create CA if not exists? Default true</td></tr><tr><td style=text-align:left><a href=#ca_cn><code>ca_cn</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>CA CN name, fixed as pigsty-ca</td></tr><tr><td style=text-align:left><a href=#cert_validity><code>cert_validity</code></a></td><td style=text-align:center><code>interval</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Certificate validity, default 20 years</td></tr></tbody></table><p><a href=#infra_id><code>INFRA_ID</code></a> parameters define infrastructure node identity, including node sequence number, service portal configuration, and data directory.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#infra_seq><code>infra_seq</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>Infrastructure node sequence, REQUIRED</td></tr><tr><td style=text-align:left><a href=#infra_portal><code>infra_portal</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Infrastructure services exposed via Nginx portal</td></tr><tr><td style=text-align:left><a href=#infra_data><code>infra_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Infrastructure data directory, default /data/infra</td></tr></tbody></table><p><a href=#repo><code>REPO</code></a> parameters configure the local software repository, including repository enable switch, directory paths, upstream source definitions, and packages to download.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#repo_enabled><code>repo_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Create local repo on this infra node?</td></tr><tr><td style=text-align:left><a href=#repo_home><code>repo_home</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Repo home directory, default <code>/www</code></td></tr><tr><td style=text-align:left><a href=#repo_name><code>repo_name</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Repo name, default <code>pigsty</code></td></tr><tr><td style=text-align:left><a href=#repo_endpoint><code>repo_endpoint</code></a></td><td style=text-align:center><code>url</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Repo access endpoint: domain or <code>ip:port</code></td></tr><tr><td style=text-align:left><a href=#repo_remove><code>repo_remove</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Remove existing upstream repo definitions?</td></tr><tr><td style=text-align:left><a href=#repo_modules><code>repo_modules</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Enabled upstream repo modules, comma separated</td></tr><tr><td style=text-align:left><a href=#repo_upstream><code>repo_upstream</code></a></td><td style=text-align:center><code>upstream[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Upstream repo definitions</td></tr><tr><td style=text-align:left><a href=#repo_packages><code>repo_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Packages to download from upstream</td></tr><tr><td style=text-align:left><a href=#repo_extra_packages><code>repo_extra_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>Extra packages to download</td></tr><tr><td style=text-align:left><a href=#repo_url_packages><code>repo_url_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Extra packages downloaded via URL</td></tr></tbody></table><p><a href=#infra_package><code>INFRA_PACKAGE</code></a> parameters define packages to install on infrastructure nodes, including RPM/DEB packages and PIP packages.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#infra_packages><code>infra_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Packages to install on infra nodes</td></tr><tr><td style=text-align:left><a href=#infra_packages_pip><code>infra_packages_pip</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Pip packages to install on infra nodes</td></tr></tbody></table><p><a href=#nginx><code>NGINX</code></a> parameters configure Nginx web server and reverse proxy, including enable switch, ports, SSL mode, certificates, and basic authentication.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#nginx_enabled><code>nginx_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Enable Nginx on this infra node?</td></tr><tr><td style=text-align:left><a href=#nginx_clean><code>nginx_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Clean existing Nginx config during init?</td></tr><tr><td style=text-align:left><a href=#nginx_exporter_enabled><code>nginx_exporter_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Enable nginx_exporter on this infra node?</td></tr><tr><td style=text-align:left><a href=#nginx_exporter_port><code>nginx_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx_exporter listen port, default 9113</td></tr><tr><td style=text-align:left><a href=#nginx_sslmode><code>nginx_sslmode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Nginx SSL mode: disable,enable,enforce</td></tr><tr><td style=text-align:left><a href=#nginx_cert_validity><code>nginx_cert_validity</code></a></td><td style=text-align:center><code>duration</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Nginx self-signed cert validity, default 397d</td></tr><tr><td style=text-align:left><a href=#nginx_home><code>nginx_home</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Nginx content dir, default <code>/www</code>, symlink to nginx_data</td></tr><tr><td style=text-align:left><a href=#nginx_data><code>nginx_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Nginx actual data dir, default /data/nginx</td></tr><tr><td style=text-align:left><a href=#nginx_users><code>nginx_users</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Nginx basic auth users: username-password dict</td></tr><tr><td style=text-align:left><a href=#nginx_port><code>nginx_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Nginx listen port, default 80</td></tr><tr><td style=text-align:left><a href=#nginx_ssl_port><code>nginx_ssl_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Nginx SSL listen port, default 443</td></tr><tr><td style=text-align:left><a href=#certbot_sign><code>certbot_sign</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Sign cert with certbot?</td></tr><tr><td style=text-align:left><a href=#certbot_email><code>certbot_email</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Certbot notification email address</td></tr><tr><td style=text-align:left><a href=#certbot_options><code>certbot_options</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Certbot extra command line options</td></tr></tbody></table><p><a href=#dns><code>DNS</code></a> parameters configure DNSMasq DNS server, including enable switch, listen port, and dynamic DNS records.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#dns_enabled><code>dns_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Setup dnsmasq on this infra node?</td></tr><tr><td style=text-align:left><a href=#dns_port><code>dns_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>DNS server listen port, default 53</td></tr><tr><td style=text-align:left><a href=#dns_records><code>dns_records</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Dynamic DNS records resolved by dnsmasq</td></tr></tbody></table><p><a href=#victoria><code>VICTORIA</code></a> parameters configure the VictoriaMetrics/Logs/Traces observability stack, including enable switches, ports, and data retention policies.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#vmetrics_enabled><code>vmetrics_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Enable VictoriaMetrics on this infra node?</td></tr><tr><td style=text-align:left><a href=#vmetrics_clean><code>vmetrics_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Clean VictoriaMetrics data during init?</td></tr><tr><td style=text-align:left><a href=#vmetrics_port><code>vmetrics_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaMetrics listen port, default 8428</td></tr><tr><td style=text-align:left><a href=#vmetrics_scrape_interval><code>vmetrics_scrape_interval</code></a></td><td style=text-align:center><code>interval</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Global scrape interval, default 10s</td></tr><tr><td style=text-align:left><a href=#vmetrics_scrape_timeout><code>vmetrics_scrape_timeout</code></a></td><td style=text-align:center><code>interval</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Global scrape timeout, default 8s</td></tr><tr><td style=text-align:left><a href=#vmetrics_options><code>vmetrics_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaMetrics extra CLI options</td></tr><tr><td style=text-align:left><a href=#vlogs_enabled><code>vlogs_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Enable VictoriaLogs on this infra node?</td></tr><tr><td style=text-align:left><a href=#vlogs_clean><code>vlogs_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Clean VictoriaLogs data during init?</td></tr><tr><td style=text-align:left><a href=#vlogs_port><code>vlogs_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaLogs listen port, default 9428</td></tr><tr><td style=text-align:left><a href=#vlogs_options><code>vlogs_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaLogs extra CLI options</td></tr><tr><td style=text-align:left><a href=#vtraces_enabled><code>vtraces_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Enable VictoriaTraces on this infra node?</td></tr><tr><td style=text-align:left><a href=#vtraces_clean><code>vtraces_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Clean VictoriaTraces data during init?</td></tr><tr><td style=text-align:left><a href=#vtraces_port><code>vtraces_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaTraces listen port, default 10428</td></tr><tr><td style=text-align:left><a href=#vtraces_options><code>vtraces_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaTraces extra CLI options</td></tr><tr><td style=text-align:left><a href=#vmalert_enabled><code>vmalert_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Enable VMAlert on this infra node?</td></tr><tr><td style=text-align:left><a href=#vmalert_port><code>vmalert_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VMAlert listen port, default 8880</td></tr><tr><td style=text-align:left><a href=#vmalert_options><code>vmalert_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VMAlert extra CLI options</td></tr></tbody></table><p><a href=#prometheus><code>PROMETHEUS</code></a> parameters configure Alertmanager and Blackbox Exporter, providing alert management and network probing capabilities.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#blackbox_enabled><code>blackbox_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Setup blackbox_exporter on this infra node?</td></tr><tr><td style=text-align:left><a href=#blackbox_port><code>blackbox_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>blackbox_exporter listen port, default 9115</td></tr><tr><td style=text-align:left><a href=#blackbox_options><code>blackbox_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>blackbox_exporter extra CLI options</td></tr><tr><td style=text-align:left><a href=#alertmanager_enabled><code>alertmanager_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Setup alertmanager on this infra node?</td></tr><tr><td style=text-align:left><a href=#alertmanager_port><code>alertmanager_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>AlertManager listen port, default 9059</td></tr><tr><td style=text-align:left><a href=#alertmanager_options><code>alertmanager_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>alertmanager extra CLI options</td></tr><tr><td style=text-align:left><a href=#exporter_metrics_path><code>exporter_metrics_path</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Exporter metrics path, default /metrics</td></tr></tbody></table><p><a href=#grafana><code>GRAFANA</code></a> parameters configure the Grafana visualization platform, including enable switch, port, admin credentials, and data source configuration.</p><table><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:center>Type</th><th style=text-align:center>Level</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=#grafana_enabled><code>grafana_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>Enable Grafana on this infra node?</td></tr><tr><td style=text-align:left><a href=#grafana_port><code>grafana_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana listen port, default 3000</td></tr><tr><td style=text-align:left><a href=#grafana_clean><code>grafana_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>Clean Grafana data during init?</td></tr><tr><td style=text-align:left><a href=#grafana_admin_username><code>grafana_admin_username</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana admin username, default <code>admin</code></td></tr><tr><td style=text-align:left><a href=#grafana_admin_password><code>grafana_admin_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana admin password, default <code>pigsty</code></td></tr><tr><td style=text-align:left><a href=#grafana_auth_proxy><code>grafana_auth_proxy</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Enable Grafana auth proxy?</td></tr><tr><td style=text-align:left><a href=#grafana_pgurl><code>grafana_pgurl</code></a></td><td style=text-align:center><code>url</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>External PostgreSQL URL for Grafana persistence</td></tr><tr><td style=text-align:left><a href=#grafana_view_password><code>grafana_view_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana metadb PG datasource password</td></tr></tbody></table><hr><h2 id=meta><code>META</code></h2><p>This section defines Pigsty deployment metadata: version string, admin node IP address, repository mirror <a href=#region><code>region</code></a>, default language, and HTTP(S) proxy for downloading packages.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v4.0.0                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pigsty version string</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># admin node ip address</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>region: default                   # upstream mirror region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default,china,europe</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>language: en                      # default language</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en or zh</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>proxy_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># global proxy env when downloading packages</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>no_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.myqcloud.com,*.tsinghua.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># http_proxy:  # set your proxy here: e.g http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># https_proxy: # set your proxy here: e.g http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># all_proxy:   # set your proxy here: e.g http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=version><code>version</code></h3><p>name: <code>version</code>, type: <code>string</code>, level: <code>G</code></p><p>Pigsty version string, default value is the current version: <code>v4.0.0</code>.</p><p>Pigsty uses this version string internally for feature control and content rendering. Do not modify this parameter arbitrarily.</p><p>Pigsty uses semantic versioning, and the version string typically starts with the character <code>v</code>, e.g., <code>v4.0.0</code>.</p><h3 id=admin_ip><code>admin_ip</code></h3><p>name: <code>admin_ip</code>, type: <code>ip</code>, level: <code>G</code></p><p>Admin node IP address, default is the placeholder IP address: <code>10.10.10.10</code></p><p>The node specified by this parameter will be treated as the admin node, typically pointing to the first node where Pigsty is installed, i.e., the control node.</p><p>The default value <code>10.10.10.10</code> is a placeholder that will be replaced with the actual admin node IP address during <a href=/docs/setup/install#configure>configure</a>.</p><p>Many parameters reference this parameter, such as:</p><ul><li><a href=#infra_portal><code>infra_portal</code></a></li><li><a href=#repo_endpoint><code>repo_endpoint</code></a></li><li><a href=#repo_upstream><code>repo_upstream</code></a></li><li><a href=#dns_records><code>dns_records</code></a></li><li><a href=/docs/node/param#node_default_etc_hosts><code>node_default_etc_hosts</code></a></li><li><a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a></li></ul><p>In these parameters, the string <code>${admin_ip}</code> will be replaced with the actual value of <code>admin_ip</code>. Using this mechanism, you can specify different admin nodes for different nodes.</p><h3 id=region><code>region</code></h3><p>name: <code>region</code>, type: <code>enum</code>, level: <code>G</code></p><p>Upstream mirror region, available options: <code>default</code>, <code>china</code>, <code>europe</code>, default is <code>default</code></p><p>If a region other than <code>default</code> is set, and there&rsquo;s a corresponding entry in <a href=#repo_upstream><code>repo_upstream</code></a> with a matching <code>baseurl</code>, it will be used instead of the <code>default</code> baseurl.</p><p>For example, if your region is set to <code>china</code>, Pigsty will attempt to use Chinese mirror sites to accelerate downloads. If an upstream repository doesn&rsquo;t have a corresponding China region mirror, the default upstream mirror site will be used instead.
Additionally, URLs defined in <a href=#repo_url_packages><code>repo_url_packages</code></a> will be replaced from <code>repo.pigsty.io</code> to <code>repo.pigsty.cc</code> to use domestic mirrors.</p><h3 id=language><code>language</code></h3><p>name: <code>language</code>, type: <code>enum</code>, level: <code>G</code></p><p>Default language setting, options are <code>en</code> (English) or <code>zh</code> (Chinese), default is <code>en</code>.</p><p>This parameter affects the language preference of some Pigsty-generated configurations and content, such as the initial language setting of Grafana dashboards.</p><p>If you are a Chinese user, it is recommended to set this parameter to <code>zh</code> for a better Chinese support experience.</p><h3 id=proxy_env><code>proxy_env</code></h3><p>name: <code>proxy_env</code>, type: <code>dict</code>, level: <code>G</code></p><p>Global proxy environment variables used when downloading packages, default value specifies <code>no_proxy</code>, which is the list of addresses that should not use a proxy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>proxy_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>no_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.aliyuncs.com,mirrors.tuna.tsinghua.edu.cn,mirrors.zju.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#http_proxy: &#39;http://username:password@proxy.address.com&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#https_proxy: &#39;http://username:password@proxy.address.com&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#all_proxy: &#39;http://username:password@proxy.address.com&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>When installing from the Internet in mainland China, certain packages may be blocked. You can use a proxy to solve this problem.</p><p>Note that if the Docker module is used, the proxy server configuration here will also be written to the Docker Daemon configuration file.</p><p>Note that if the <code>-x</code> parameter is specified during <code>./configure</code>, the proxy configuration information in the current environment will be automatically filled into the generated <code>pigsty.yaml</code> file.</p><hr><h2 id=ca><code>CA</code></h2><p>Pigsty uses self-signed CA certificates to support advanced security features such as HTTPS access, PostgreSQL SSL connections, etc.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>ca_create</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># create CA if not exists? default true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ca_cn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty-ca                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># CA CN name, fixed as pigsty-ca</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>cert_validity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>7300d             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># certificate validity, default 20 years</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=ca_create><code>ca_create</code></h3><p>name: <code>ca_create</code>, type: <code>bool</code>, level: <code>G</code></p><p>Create CA if not exists? Default value is <code>true</code>.</p><p>When set to <code>true</code>, if the CA public-private key pair does not exist in the <code>files/pki/ca</code> directory, Pigsty will automatically create a new CA.</p><p>If you already have a CA public-private key pair, you can copy them to the <code>files/pki/ca</code> directory:</p><ul><li><code>files/pki/ca/ca.crt</code>: CA public key certificate</li><li><code>files/pki/ca/ca.key</code>: CA private key file</li></ul><p>Pigsty will use the existing CA key pair instead of creating a new one. If the CA does not exist and this parameter is set to <code>false</code>, an error will occur.</p><p><strong>Be sure to retain and backup the newly generated CA private key file during deployment, as it is crucial for issuing new certificates later.</strong></p><blockquote><p>Note: Pigsty v3.x used the <code>ca_method</code> parameter (with values <code>create</code>/<code>recreate</code>/<code>copy</code>), v4.0 simplifies this to the boolean <code>ca_create</code>.</p></blockquote><h3 id=ca_cn><code>ca_cn</code></h3><p>name: <code>ca_cn</code>, type: <code>string</code>, level: <code>G</code></p><p>CA CN (Common Name), fixed as <code>pigsty-ca</code>, not recommended to modify.</p><p>You can use the following command to view the Pigsty CA certificate details on a node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl x509 -text -in /etc/pki/ca.crt
</span></span></code></pre></div><h3 id=cert_validity><code>cert_validity</code></h3><p>name: <code>cert_validity</code>, type: <code>interval</code>, level: <code>G</code></p><p>Certificate validity period for issued certificates, default is 20 years, sufficient for most scenarios. Default value: <code>7300d</code></p><p>This parameter affects the validity of all certificates issued by the Pigsty CA, including:</p><ul><li>PostgreSQL server certificates</li><li>Patroni API certificates</li><li>etcd server/client certificates</li><li>Other internal service certificates</li></ul><p>Note: The validity of HTTPS certificates used by Nginx is controlled separately by <a href=#nginx_cert_validity><code>nginx_cert_validity</code></a>, because modern browsers have stricter requirements for website certificate validity (maximum 397 days).</p><hr><h2 id=infra_id><code>INFRA_ID</code></h2><p>Infrastructure identity and portal definition.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#infra_seq: 1                     # infra node sequence, REQUIRED identity parameter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># infrastructure services exposed via Nginx portal</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default home server definition</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/infra          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># infrastructure default data directory</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=infra_seq><code>infra_seq</code></h3><p>name: <code>infra_seq</code>, type: <code>int</code>, level: <code>I</code></p><p>Infrastructure node sequence number, REQUIRED identity parameter that must be explicitly specified on infrastructure nodes, so no default value is provided.</p><p>This parameter is used to uniquely identify each node in multi-infrastructure node deployments, typically using positive integers starting from 1.</p><p>Example configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=infra_portal><code>infra_portal</code></h3><p>name: <code>infra_portal</code>, type: <code>dict</code>, level: <code>G</code></p><p>Infrastructure services exposed via Nginx portal. The v4.0 default value is very concise:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default home server definition</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty will automatically configure the corresponding reverse proxies based on the actually enabled components. Users typically only need to define the home domain name.</p><p>Each record consists of a Key and a Value dictionary, where <code>name</code> is the key representing the component name, and the value is an object that can configure the following parameters:</p><ul><li><code>name</code>: <strong>REQUIRED</strong>, specifies the name of the Nginx server<ul><li>Default record: <code>home</code> is a fixed name, please do not modify it.</li><li>Used as part of the Nginx configuration file name, corresponding to: <code>/etc/nginx/conf.d/&lt;name>.conf</code></li><li>Nginx servers without a <code>domain</code> field will not generate configuration files but will be used as references.</li></ul></li><li><code>domain</code>: <strong>OPTIONAL</strong>, when the service needs to be exposed via Nginx, this is a <strong>REQUIRED</strong> field specifying the domain name to use<ul><li>In Pigsty self-signed Nginx HTTPS certificates, the domain will be added to the SAN field of the Nginx SSL certificate</li><li>Pigsty web page cross-references will use the default domain name here</li></ul></li><li><code>endpoint</code>: Usually used as an alternative to <code>path</code>, specifies the upstream server address. Setting endpoint indicates this is a reverse proxy server<ul><li><code>${admin_ip}</code> can be used as a placeholder in the configuration and will be dynamically replaced with <a href=#admin_ip><code>admin_ip</code></a> during deployment</li><li>Default reverse proxy servers use <a href=https://github.com/pgsty/pigsty/blob/main/roles/infra/templates/nginx/endpoint.conf>endpoint.conf</a> as the configuration template</li><li>Reverse proxy servers can also configure <code>websocket</code> and <code>schema</code> parameters</li></ul></li><li><code>path</code>: Usually used as an alternative to <code>endpoint</code>, specifies the local file server path. Setting path indicates this is a local web server<ul><li>Local web servers use <a href=https://github.com/pgsty/pigsty/blob/main/roles/infra/templates/nginx/path.conf>path.conf</a> as the configuration template</li><li>Local web servers can also configure the <code>index</code> parameter to enable file index pages</li></ul></li><li><code>certbot</code>: Certbot certificate name; if configured, Certbot will be used to apply for certificates<ul><li>If multiple servers specify the same certbot, Pigsty will merge certificate applications; the final certificate name will be this certbot value</li></ul></li><li><code>cert</code>: Certificate file path; if configured, will override the default certificate path</li><li><code>key</code>: Certificate key file path; if configured, will override the default certificate key path</li><li><code>websocket</code>: Whether to enable WebSocket support<ul><li>Only reverse proxy servers can configure this parameter; if enabled, upstream WebSocket connections will be allowed</li></ul></li><li><code>schema</code>: Protocol used by the upstream server; if configured, will override the default protocol<ul><li>Default is http; if configured as https, it will force HTTPS connections to the upstream server</li></ul></li><li><code>index</code>: Whether to enable file index pages<ul><li>Only local web servers can configure this parameter; if enabled, autoindex configuration will be enabled to automatically generate directory index pages</li></ul></li><li><code>log</code>: Nginx log file path<ul><li>If specified, access logs will be written to this file; otherwise, the default log file will be used based on server type</li><li>Reverse proxy servers use <code>/var/log/nginx/&lt;name>.log</code> as the default log file path</li><li>Local web servers use the default Access log</li></ul></li><li><code>conf</code>: Nginx configuration file path<ul><li>Explicitly specifies the configuration template file to use, located in <a href=https://github.com/pgsty/pigsty/tree/main/roles/infra/templates/nginx>roles/infra/templates/nginx</a> or <a href=https://github.com/pgsty/pigsty/tree/main/templates/nginx>templates/nginx</a> directory</li><li>If this parameter is not specified, the default configuration template will be used</li></ul></li><li><code>config</code>: Nginx configuration code block<ul><li>Configuration text directly injected into the Nginx Server configuration block</li></ul></li><li><code>enforce_https</code>: Redirect HTTP to HTTPS<ul><li>Global configuration can be specified via nginx_sslmode: enforce</li><li>This configuration does not affect the default home server, which will always listen on both ports 80 and 443 to ensure compatibility</li></ul></li></ul><h3 id=infra_data><code>infra_data</code></h3><p>name: <code>infra_data</code>, type: <code>path</code>, level: <code>G</code></p><p>Infrastructure data directory, default value is <code>/data/infra</code>.</p><p>This directory is used to store data files for infrastructure components, including:</p><ul><li>VictoriaMetrics time series database data</li><li>VictoriaLogs log data</li><li>VictoriaTraces trace data</li><li>Other infrastructure component persistent data</li></ul><p>It is recommended to place this directory on a separate data disk for easier management and expansion.</p><hr><h2 id=repo><code>REPO</code></h2><p>This section is about local software repository configuration. Pigsty enables a local software repository (APT/YUM) on infrastructure nodes by default.</p><p>During initialization, Pigsty downloads all packages and their dependencies (specified by <a href=#repo_packages><code>repo_packages</code></a>) from the Internet upstream repository (specified by <a href=#repo_upstream><code>repo_upstream</code></a>) to <a href=#nginx_home><code>{{ nginx_home }}</code></a> / <a href=#repo_name><code>{{ repo_name }}</code></a> (default <code>/www/pigsty</code>). The total size of all software and dependencies is approximately 1GB.</p><p>When creating the local repository, if it already exists (determined by the presence of a marker file named <code>repo_complete</code> in the repository directory), Pigsty will consider the repository already built, skip the software download phase, and directly use the built repository.</p><p>If some packages download too slowly, you can set a download proxy using the <a href=#proxy_env><code>proxy_env</code></a> configuration to complete the initial download, or directly download the pre-packaged <a href=/docs/setup/offline>offline package</a>, which is essentially a local software repository built on the same operating system.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># create local repo on this infra node?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/www                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># repo home directory, default /www</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># repo name, default pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://${admin_ip}:80</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># repo access endpoint</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_remove</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># remove existing upstream repo definitions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra,node,pgsql   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># enabled upstream repo modules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#repo_upstream: []                # upstream repo definitions (inherited from OS variables)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#repo_packages: []                # packages to download (inherited from OS variables)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#repo_extra_packages: []          # extra packages to download</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_url_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># extra packages downloaded via URL</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=repo_enabled><code>repo_enabled</code></h3><p>name: <code>repo_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Create a local software repository on this infrastructure node? Default is <code>true</code>, meaning all Infra nodes will set up a local software repository.</p><p>If you have multiple infrastructure nodes, you can keep only 1-2 nodes as software repositories; other nodes can set this parameter to <code>false</code> to avoid duplicate software download builds.</p><h3 id=repo_home><code>repo_home</code></h3><p>name: <code>repo_home</code>, type: <code>path</code>, level: <code>G</code></p><p>Local software repository home directory, defaults to Nginx&rsquo;s root directory: <code>/www</code>.</p><p>This directory is actually a symlink pointing to <a href=#nginx_data><code>nginx_data</code></a>. It&rsquo;s not recommended to modify this directory. If modified, it should be consistent with <a href=#nginx_home><code>nginx_home</code></a>.</p><h3 id=repo_name><code>repo_name</code></h3><p>name: <code>repo_name</code>, type: <code>string</code>, level: <code>G</code></p><p>Local repository name, default is <code>pigsty</code>. Changing this repository name is not recommended.</p><p>The final repository path is <code>{{ repo_home }}/{{ repo_name }}</code>, defaulting to <code>/www/pigsty</code>.</p><h3 id=repo_endpoint><code>repo_endpoint</code></h3><p>name: <code>repo_endpoint</code>, type: <code>url</code>, level: <code>G</code></p><p>Endpoint used by other nodes to access this repository, default value: <code>http://${admin_ip}:80</code>.</p><p>Pigsty starts Nginx on infrastructure nodes at ports 80/443 by default, providing local software repository (static files) service.</p><p>If you modify <a href=#nginx_port><code>nginx_port</code></a> or <a href=#nginx_ssl_port><code>nginx_ssl_port</code></a>, or use a different infrastructure node from the control node, adjust this parameter accordingly.</p><p>If you use a domain name, you can add resolution in <a href=/docs/node/param#node_default_etc_hosts><code>node_default_etc_hosts</code></a>, <a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a>, or <a href=#dns_records><code>dns_records</code></a>.</p><h3 id=repo_remove><code>repo_remove</code></h3><p>name: <code>repo_remove</code>, type: <code>bool</code>, level: <code>G/A</code></p><p>Remove existing upstream repository definitions when building the local repository? Default value: <code>true</code>.</p><p>When this parameter is enabled, all existing repository files in <code>/etc/yum.repos.d</code> will be moved and backed up to <code>/etc/yum.repos.d/backup</code>. On Debian systems, <code>/etc/apt/sources.list</code> and <code>/etc/apt/sources.list.d</code> are removed and backed up to <code>/etc/apt/backup</code>.</p><p>Since existing OS sources have uncontrollable content, using Pigsty-validated upstream software sources can improve the success rate and speed of downloading packages from the Internet.</p><p>In certain situations (e.g., your OS is some EL/Deb compatible variant that uses private sources for many packages), you may need to keep existing upstream repository definitions. In such cases, set this parameter to <code>false</code>.</p><h3 id=repo_modules><code>repo_modules</code></h3><p>name: <code>repo_modules</code>, type: <code>string</code>, level: <code>G/A</code></p><p>Which upstream repository modules will be added to the local software source, default value: <code>infra,node,pgsql</code></p><p>When Pigsty attempts to add upstream repositories, it filters entries in <a href=#repo_upstream><code>repo_upstream</code></a> based on this parameter&rsquo;s value. Only entries whose <code>module</code> field matches this parameter&rsquo;s value will be added to the local software source.</p><p>Modules are comma-separated. Available module lists can be found in the <code>repo_upstream</code> definitions; common modules include:</p><ul><li><code>local</code>: Local Pigsty repository</li><li><code>infra</code>: Infrastructure packages (Nginx, Docker, etc.)</li><li><code>node</code>: OS base packages</li><li><code>pgsql</code>: PostgreSQL-related packages</li><li><code>extra</code>: Extra PostgreSQL extensions</li><li><code>docker</code>: Docker-related</li><li><code>redis</code>: Redis-related</li><li><code>mongo</code>: MongoDB-related</li><li><code>mysql</code>: MySQL-related</li><li>etc&mldr;</li></ul><h3 id=repo_upstream><code>repo_upstream</code></h3><p>name: <code>repo_upstream</code>, type: <code>upstream[]</code>, level: <code>G</code></p><p>Where to download upstream packages when building the local repository? This parameter has no default value. If not explicitly specified by the user in the configuration file, it will be loaded from the <code>repo_upstream_default</code> variable defined in <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a> based on the current node&rsquo;s OS family.</p><p>Pigsty provides complete upstream repository definitions for different OS versions (EL8/9/10, Debian 11/12/13, Ubuntu 22/24), including:</p><ul><li>OS base repositories (BaseOS, AppStream, EPEL, etc.)</li><li>PostgreSQL official PGDG repository</li><li>Pigsty extension repository</li><li>Various third-party software repositories (Docker, Nginx, Grafana, etc.)</li></ul><p>Each upstream repository definition contains the following fields:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty-pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># repository name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;Pigsty PGSQL&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># repository description</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>module</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># module it belongs to</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>releases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># supported OS versions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>arch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>x86_64, aarch64]        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># supported CPU architectures</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>baseurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># repository URL, configured by region</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://repo.pigsty.io/yum/pgsql/el$releasever.$basearch&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>china</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://repo.pigsty.cc/yum/pgsql/el$releasever.$basearch&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Users typically don&rsquo;t need to modify this parameter unless they have special repository requirements. For detailed repository definitions, refer to the configuration files for corresponding operating systems in the <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars/</code></a> directory.</p><h3 id=repo_packages><code>repo_packages</code></h3><p>name: <code>repo_packages</code>, type: <code>string[]</code>, level: <code>G</code></p><p>String array type, where each line is a <strong>space-separated</strong> list of software packages, specifying packages (and their dependencies) to download using <code>repotrack</code> or <code>apt download</code>.</p><p>This parameter has no default value, meaning its default state is undefined. If not explicitly defined, Pigsty will load the default from the <code>repo_packages_default</code> variable defined in <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-utility, extra-modules ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Each element in this parameter will be translated according to the <code>package_map</code> in the above files, based on the specific OS distro major version. For example, on EL systems it translates to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node-bootstrap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>          </span><span style=color:#4e9a06>&#34;ansible python3 python3-pip python3-virtualenv python3-requests python3-jmespath python3-cryptography dnf-utils modulemd-tools createrepo_c sshpass&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra-package</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>           </span><span style=color:#4e9a06>&#34;nginx dnsmasq etcd haproxy vip-manager node_exporter keepalived_exporter pg_exporter pgbackrest_exporter redis_exporter redis minio mcli pig&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra-addons</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>            </span><span style=color:#4e9a06>&#34;grafana grafana-plugins grafana-victoriametrics-ds grafana-victorialogs-ds victoria-metrics victoria-logs victoria-traces vlogscli vmutils vector alertmanager&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>As a convention, <code>repo_packages</code> typically includes packages unrelated to the PostgreSQL major version (such as Infra, Node, and PGDG Common parts), while PostgreSQL major version-related packages (kernel, extensions) are usually specified in <code>repo_extra_packages</code> to facilitate switching PG major versions.</p><h3 id=repo_extra_packages><code>repo_extra_packages</code></h3><p>name: <code>repo_extra_packages</code>, type: <code>string[]</code>, level: <code>G/C/I</code></p><p>Used to specify additional packages to download without modifying <a href=#repo_packages><code>repo_packages</code></a> (typically PG major version-related packages), default value is an empty list.</p><p>If not explicitly defined, Pigsty will load the default from the <code>repo_extra_packages_default</code> variable defined in <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql-main ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Elements in this parameter undergo package name translation, where <code>$v</code> will be replaced with <a href=/docs/pgsql/param#pg_version><code>pg_version</code></a>, i.e., the current PG major version (default <code>18</code>).</p><p>The <code>pgsql-main</code> here translates on EL systems to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>postgresql$v postgresql$v-server postgresql$v-libs postgresql$v-contrib postgresql$v-plperl postgresql$v-plpython3 postgresql$v-pltcl postgresql$v-llvmjit pg_repack_$v* wal2json_$v* pgvector_$v*</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Users can typically specify PostgreSQL major version-related packages here without affecting the other PG version-independent packages defined in <code>repo_packages</code>.</p><h3 id=repo_url_packages><code>repo_url_packages</code></h3><p>name: <code>repo_url_packages</code>, type: <code>object[] | string[]</code>, level: <code>G</code></p><p>Packages downloaded directly from the Internet using URLs, default is an empty array: <code>[]</code></p><p>You can use URL strings directly as array elements in this parameter, or use object structures to explicitly specify URLs and filenames.</p><p>Note that this parameter is affected by the <a href=#region><code>region</code></a> variable. If you&rsquo;re in mainland China, Pigsty will automatically replace URLs, changing <code>repo.pigsty.io</code> to <code>repo.pigsty.cc</code>.</p><hr><h2 id=infra_package><code>INFRA_PACKAGE</code></h2><p>These packages are installed only on INFRA nodes, including regular RPM/DEB packages and PIP packages.</p><h3 id=infra_packages><code>infra_packages</code></h3><p>name: <code>infra_packages</code>, type: <code>string[]</code>, level: <code>G</code></p><p>String array type, where each line is a <strong>space-separated</strong> list of software packages, specifying packages to install on Infra nodes.</p><p>This parameter has no default value, meaning its default state is undefined. If not explicitly specified by the user in the configuration file, Pigsty will load the default from the <code>infra_packages_default</code> variable defined in <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a> based on the current node&rsquo;s OS family.</p><p>v4.0 default value (EL operating systems):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_packages_default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>grafana,grafana-plugins,grafana-victorialogs-ds,grafana-victoriametrics-ds,victoria-metrics,victoria-logs,victoria-traces,vmutils,vlogscli,alertmanager</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>node_exporter,blackbox_exporter,nginx_exporter,pg_exporter,pev2,nginx,dnsmasq,ansible,etcd,python3-requests,redis,mcli,restic,certbot,python3-certbot-nginx</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Default value (Debian/Ubuntu):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_packages_default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>grafana,grafana-plugins,grafana-victorialogs-ds,grafana-victoriametrics-ds,victoria-metrics,victoria-logs,victoria-traces,vmutils,vlogscli,alertmanager</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>node-exporter,blackbox-exporter,nginx-exporter,pg-exporter,pev2,nginx,dnsmasq,ansible,etcd,python3-requests,redis,mcli,restic,certbot,python3-certbot-nginx</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>Note: v4.0 uses the VictoriaMetrics suite to replace Prometheus and Loki, so the package list differs significantly from v3.x.</p></blockquote><h3 id=infra_packages_pip><code>infra_packages_pip</code></h3><p>name: <code>infra_packages_pip</code>, type: <code>string</code>, level: <code>G</code></p><p>Additional packages to install using <code>pip</code> on Infra nodes, package names separated by commas. Default value is an empty string, meaning no additional python packages are installed.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_packages_pip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;requests,boto3,awscli&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=nginx><code>NGINX</code></h2><p>Pigsty proxies all web service access through Nginx: Home Page, Grafana, VictoriaMetrics, etc., as well as other optional tools like PGWeb, Jupyter Lab, Pgadmin, Bytebase, and static resources and reports like <code>pev</code>, <code>schemaspy</code>, and <code>pgbadger</code>.</p><p>Most importantly, Nginx also serves as the web server for the local software repository (Yum/Apt), used to store and distribute Pigsty packages.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># enable Nginx on this infra node?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># clean existing Nginx config during init?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># enable nginx_exporter?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9113</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># nginx_exporter listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_sslmode: enable             # SSL mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disable,enable,enforce</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_cert_validity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>397d        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># self-signed cert validity</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/www                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Nginx content directory (symlink)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/nginx          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Nginx actual data directory</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># basic auth users dictionary</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># HTTP port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_ssl_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>443</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># HTTPS port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_sign</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># sign cert with certbot?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your@email.com    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># certbot email</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># certbot extra options</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=nginx_enabled><code>nginx_enabled</code></h3><p>name: <code>nginx_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable Nginx on this Infra node? Default value: <code>true</code>.</p><p>Nginx is a core component of Pigsty infrastructure, responsible for:</p><ul><li>Providing local software repository service</li><li>Reverse proxying Grafana, VictoriaMetrics, and other web services</li><li>Hosting static files and reports</li></ul><h3 id=nginx_clean><code>nginx_clean</code></h3><p>name: <code>nginx_clean</code>, type: <code>bool</code>, level: <code>G/A</code></p><p>Clean existing Nginx configuration during initialization? Default value: <code>false</code>.</p><p>When set to <code>true</code>, all existing configuration files under <code>/etc/nginx/conf.d/</code> will be deleted during Nginx initialization, ensuring a clean start.</p><p>If you&rsquo;re deploying for the first time or want to completely rebuild Nginx configuration, you can set this parameter to <code>true</code>.</p><h3 id=nginx_exporter_enabled><code>nginx_exporter_enabled</code></h3><p>name: <code>nginx_exporter_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable nginx_exporter on this infrastructure node? Default value: <code>true</code>.</p><p>If this option is disabled, the <code>/nginx</code> health check stub will also be disabled. Consider disabling this when your Nginx version doesn&rsquo;t support this feature.</p><h3 id=nginx_exporter_port><code>nginx_exporter_port</code></h3><p>name: <code>nginx_exporter_port</code>, type: <code>port</code>, level: <code>G</code></p><p>nginx_exporter listen port, default value is <code>9113</code>.</p><p>nginx_exporter is used to collect Nginx operational metrics for VictoriaMetrics to scrape and monitor.</p><h3 id=nginx_sslmode><code>nginx_sslmode</code></h3><p>name: <code>nginx_sslmode</code>, type: <code>enum</code>, level: <code>G</code></p><p>Nginx SSL operating mode. Three options: <code>disable</code>, <code>enable</code>, <code>enforce</code>, default value is <code>enable</code>, meaning SSL is enabled but not enforced.</p><ul><li><code>disable</code>: Only listen on the port specified by <a href=#nginx_port><code>nginx_port</code></a> to serve HTTP requests.</li><li><code>enable</code>: Also listen on the port specified by <a href=#nginx_ssl_port><code>nginx_ssl_port</code></a> to serve HTTPS requests.</li><li><code>enforce</code>: All links will be rendered to use <code>https://</code> by default<ul><li>Also redirect port 80 to port 443 for non-default servers in <a href=#infra_portal><code>infra_portal</code></a></li></ul></li></ul><h3 id=nginx_cert_validity><code>nginx_cert_validity</code></h3><p>name: <code>nginx_cert_validity</code>, type: <code>duration</code>, level: <code>G</code></p><p>Nginx self-signed certificate validity, default value is <code>397d</code> (approximately 13 months).</p><p>Modern browsers require website certificate validity to be at most 397 days, hence this default value. Setting a longer validity is not recommended, as browsers may refuse to trust such certificates.</p><h3 id=nginx_home><code>nginx_home</code></h3><p>name: <code>nginx_home</code>, type: <code>path</code>, level: <code>G</code></p><p>Nginx server static content directory, default: <code>/www</code></p><p>This is a symlink that actually points to the <a href=#nginx_data><code>nginx_data</code></a> directory. This directory contains static resources and software repository files.</p><p>It&rsquo;s best not to modify this parameter arbitrarily. If modified, it should be consistent with the <a href=#repo_home><code>repo_home</code></a> parameter.</p><h3 id=nginx_data><code>nginx_data</code></h3><p>name: <code>nginx_data</code>, type: <code>path</code>, level: <code>G</code></p><p>Nginx actual data directory, default is <code>/data/nginx</code>.</p><p>This is the actual storage location for Nginx static files; <a href=#nginx_home><code>nginx_home</code></a> is a symlink pointing to this directory.</p><p>It&rsquo;s recommended to place this directory on a data disk for easier management of large package files.</p><h3 id=nginx_users><code>nginx_users</code></h3><p>name: <code>nginx_users</code>, type: <code>dict</code>, level: <code>G</code></p><p>Nginx Basic Authentication user dictionary, default is an empty dictionary <code>{}</code>.</p><p>Format is <code>{ username: password }</code> key-value pairs, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>admin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>viewer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readonly</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>These users can be used to protect certain Nginx endpoints that require authentication.</p><h3 id=nginx_port><code>nginx_port</code></h3><p>name: <code>nginx_port</code>, type: <code>port</code>, level: <code>G</code></p><p>Nginx default listening port (serving HTTP), default is port <code>80</code>. It&rsquo;s best not to modify this parameter.</p><p>When your server&rsquo;s port 80 is occupied, you can consider using another port, but you need to also modify <a href=#repo_endpoint><code>repo_endpoint</code></a> and keep <a href=/docs/node/param#node_repo_local_urls><code>node_repo_local_urls</code></a> consistent with the port used here.</p><h3 id=nginx_ssl_port><code>nginx_ssl_port</code></h3><p>name: <code>nginx_ssl_port</code>, type: <code>port</code>, level: <code>G</code></p><p>Nginx SSL default listening port, default is <code>443</code>. It&rsquo;s best not to modify this parameter.</p><h3 id=certbot_sign><code>certbot_sign</code></h3><p>name: <code>certbot_sign</code>, type: <code>bool</code>, level: <code>G/A</code></p><p>Use certbot to sign Nginx certificates during installation? Default value is <code>false</code>.</p><p>When set to <code>true</code>, Pigsty will use certbot to automatically apply for free SSL certificates from Let&rsquo;s Encrypt during the execution of <code>infra.yml</code> and <code>deploy.yml</code> playbooks (in the <code>nginx</code> role).</p><p>For domains defined in <a href=#infra_portal><code>infra_portal</code></a>, if a <code>certbot</code> parameter is defined, Pigsty will use certbot to apply for a certificate for that <code>domain</code>. The certificate name will be the value of the <code>certbot</code> parameter. If multiple servers/domains specify the same <code>certbot</code> parameter, Pigsty will merge and apply for certificates for these domains, using the <code>certbot</code> parameter value as the certificate name.</p><p>Enabling this option requires:</p><ul><li>The current node can be accessed through a public domain name, and DNS resolution is correctly pointed to the current node&rsquo;s public IP</li><li>The current node can access the Let&rsquo;s Encrypt API interface</li></ul><p>This option is disabled by default. You can manually execute the <code>make cert</code> command after installation, which actually calls the rendered <code>/etc/nginx/sign-cert</code> script to update or apply for certificates using certbot.</p><h3 id=certbot_email><code>certbot_email</code></h3><p>name: <code>certbot_email</code>, type: <code>string</code>, level: <code>G/A</code></p><p>Email address for receiving certificate expiration reminder emails, default value is <code>your@email.com</code>.</p><p>When <code>certbot_sign</code> is set to <code>true</code>, it&rsquo;s recommended to provide this parameter. Let&rsquo;s Encrypt will send reminder emails to this address when certificates are about to expire.</p><h3 id=certbot_options><code>certbot_options</code></h3><p>name: <code>certbot_options</code>, type: <code>string</code>, level: <code>G/A</code></p><p>Additional configuration parameters passed to certbot, default value is an empty string.</p><p>You can pass additional command-line options to certbot through this parameter, for example <code>--dry-run</code>, which makes certbot perform a preview and test without actually applying for certificates.</p><hr><h2 id=dns><code>DNS</code></h2><p>Pigsty enables DNSMASQ service on Infra nodes by default to resolve auxiliary domain names such as <code>i.pigsty</code>, <code>m.pigsty</code>, <code>api.pigsty</code>, etc., and optionally <code>sss.pigsty</code> for MinIO.</p><p>Resolution records are stored in the <code>/etc/hosts.d/default</code> file on Infra nodes. To use this DNS server, you must add <code>nameserver &lt;ip></code> to <code>/etc/resolv.conf</code>. The <a href=/docs/node/param#node_dns_servers><code>node_dns_servers</code></a> parameter handles this.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># setup dnsmasq on this infra node?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>53</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># DNS server listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># dynamic DNS records</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty supa.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=dns_enabled><code>dns_enabled</code></h3><p>name: <code>dns_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable DNSMASQ service on this Infra node? Default value: <code>true</code>.</p><p>If you don&rsquo;t want to use the default DNS server (e.g., you already have an external DNS server, or your provider doesn&rsquo;t allow you to use a DNS server), you can set this value to <code>false</code> to disable it, and use <a href=/docs/node/param#node_default_etc_hosts><code>node_default_etc_hosts</code></a> and <a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a> static resolution records instead.</p><h3 id=dns_port><code>dns_port</code></h3><p>name: <code>dns_port</code>, type: <code>port</code>, level: <code>G</code></p><p>DNSMASQ default listening port, default is <code>53</code>. It&rsquo;s not recommended to modify the default DNS service port.</p><h3 id=dns_records><code>dns_records</code></h3><p>name: <code>dns_records</code>, type: <code>string[]</code>, level: <code>G</code></p><p>Dynamic DNS records resolved by dnsmasq, generally used to resolve auxiliary domain names to the admin node. These records are written to the <code>/etc/hosts.d/default</code> file on infrastructure nodes.</p><p>v4.0 default value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty supa.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>The <code>${admin_ip}</code> placeholder is used here and will be replaced with the actual <a href=#admin_ip><code>admin_ip</code></a> value during deployment.</p><p>Common domain name purposes:</p><ul><li><code>i.pigsty</code>: Pigsty home page</li><li><code>m.pigsty</code>: VictoriaMetrics Web UI</li><li><code>api.pigsty</code>: API service</li><li><code>adm.pigsty</code>: Admin service</li><li>Others customized based on actual deployment needs</li></ul><hr><h2 id=victoria><code>VICTORIA</code></h2><p>Pigsty v4.0 uses the VictoriaMetrics suite to replace Prometheus and Loki, providing a superior observability solution:</p><ul><li><strong>VictoriaMetrics</strong>: Replaces Prometheus as the time series database for storing monitoring metrics</li><li><strong>VictoriaLogs</strong>: Replaces Loki as the log aggregation storage</li><li><strong>VictoriaTraces</strong>: Distributed trace storage</li><li><strong>VMAlert</strong>: Replaces Prometheus Alerting for alert rule evaluation</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># enable VictoriaMetrics?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># clean data during init?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8428</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_scrape_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>10s    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># global scrape interval</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_scrape_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>8s      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># global scrape timeout</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -promscrape.fileSDCheckInterval=5s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># enable VictoriaLogs?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># clean data during init?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9428</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -insert.maxLineSizeBytes=1MB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -search.maxQueryDuration=120s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># enable VictoriaTraces?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># clean data during init?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10428</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmalert_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># enable VMAlert?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmalert_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8880</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmalert_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># extra CLI options</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=vmetrics_enabled><code>vmetrics_enabled</code></h3><p>name: <code>vmetrics_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable VictoriaMetrics on this Infra node? Default value is <code>true</code>.</p><p>VictoriaMetrics is the core monitoring component in Pigsty v4.0, replacing Prometheus as the time series database, responsible for:</p><ul><li>Scraping monitoring metrics from various exporters</li><li>Storing time series data</li><li>Providing PromQL-compatible query interface</li><li>Supporting Grafana data sources</li></ul><h3 id=vmetrics_clean><code>vmetrics_clean</code></h3><p>name: <code>vmetrics_clean</code>, type: <code>bool</code>, level: <code>G/A</code></p><p>Clean existing VictoriaMetrics data during initialization? Default value is <code>false</code>.</p><p>When set to <code>true</code>, existing time series data will be deleted during initialization. Use this option carefully unless you&rsquo;re sure you want to rebuild monitoring data.</p><h3 id=vmetrics_port><code>vmetrics_port</code></h3><p>name: <code>vmetrics_port</code>, type: <code>port</code>, level: <code>G</code></p><p>VictoriaMetrics listen port, default value is <code>8428</code>.</p><p>This port is used for:</p><ul><li>HTTP API access</li><li>Web UI access</li><li>Prometheus-compatible remote write/read</li><li>Grafana data source connections</li></ul><h3 id=vmetrics_scrape_interval><code>vmetrics_scrape_interval</code></h3><p>name: <code>vmetrics_scrape_interval</code>, type: <code>interval</code>, level: <code>G</code></p><p>VictoriaMetrics global metrics scrape interval, default value is <code>10s</code>.</p><p>In production environments, 10-30 seconds is a suitable scrape interval. If you need finer monitoring data granularity, you can adjust this parameter, but it will increase storage and CPU overhead.</p><h3 id=vmetrics_scrape_timeout><code>vmetrics_scrape_timeout</code></h3><p>name: <code>vmetrics_scrape_timeout</code>, type: <code>interval</code>, level: <code>G</code></p><p>VictoriaMetrics global scrape timeout, default is <code>8s</code>.</p><p>Setting a scrape timeout can effectively prevent avalanches caused by monitoring system queries. The principle is that this parameter must be less than and close to <a href=#vmetrics_scrape_interval><code>vmetrics_scrape_interval</code></a> to ensure each scrape duration doesn&rsquo;t exceed the scrape interval.</p><h3 id=vmetrics_options><code>vmetrics_options</code></h3><p>name: <code>vmetrics_options</code>, type: <code>arg</code>, level: <code>G</code></p><p>VictoriaMetrics extra command line options, default value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -promscrape.fileSDCheckInterval=5s</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Common parameter descriptions:</p><ul><li><code>-retentionPeriod=15d</code>: Data retention period, default 15 days</li><li><code>-promscrape.fileSDCheckInterval=5s</code>: File service discovery refresh interval</li></ul><p>You can add other VictoriaMetrics-supported parameters as needed.</p><h3 id=vlogs_enabled><code>vlogs_enabled</code></h3><p>name: <code>vlogs_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable VictoriaLogs on this Infra node? Default value is <code>true</code>.</p><p>VictoriaLogs replaces Loki as the log aggregation storage, responsible for:</p><ul><li>Receiving log data from Vector</li><li>Storing and indexing logs</li><li>Providing log query interface</li><li>Supporting Grafana VictoriaLogs data source</li></ul><h3 id=vlogs_clean><code>vlogs_clean</code></h3><p>name: <code>vlogs_clean</code>, type: <code>bool</code>, level: <code>G/A</code></p><p>Clean existing VictoriaLogs data during initialization? Default value is <code>false</code>.</p><h3 id=vlogs_port><code>vlogs_port</code></h3><p>name: <code>vlogs_port</code>, type: <code>port</code>, level: <code>G</code></p><p>VictoriaLogs listen port, default value is <code>9428</code>.</p><h3 id=vlogs_options><code>vlogs_options</code></h3><p>name: <code>vlogs_options</code>, type: <code>arg</code>, level: <code>G</code></p><p>VictoriaLogs extra command line options, default value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -insert.maxLineSizeBytes=1MB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -search.maxQueryDuration=120s</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Common parameter descriptions:</p><ul><li><code>-retentionPeriod=15d</code>: Log retention period, default 15 days</li><li><code>-retention.maxDiskSpaceUsageBytes=50GiB</code>: Maximum disk usage</li><li><code>-insert.maxLineSizeBytes=1MB</code>: Maximum single log line size</li><li><code>-search.maxQueryDuration=120s</code>: Maximum query execution time</li></ul><h3 id=vtraces_enabled><code>vtraces_enabled</code></h3><p>name: <code>vtraces_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable VictoriaTraces on this Infra node? Default value is <code>true</code>.</p><p>VictoriaTraces is used for distributed trace data storage and query, supporting Jaeger, Zipkin, and other trace protocols.</p><h3 id=vtraces_clean><code>vtraces_clean</code></h3><p>name: <code>vtraces_clean</code>, type: <code>bool</code>, level: <code>G/A</code></p><p>Clean existing VictoriaTraces data during initialization? Default value is <code>false</code>.</p><h3 id=vtraces_port><code>vtraces_port</code></h3><p>name: <code>vtraces_port</code>, type: <code>port</code>, level: <code>G</code></p><p>VictoriaTraces listen port, default value is <code>10428</code>.</p><h3 id=vtraces_options><code>vtraces_options</code></h3><p>name: <code>vtraces_options</code>, type: <code>arg</code>, level: <code>G</code></p><p>VictoriaTraces extra command line options, default value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=vmalert_enabled><code>vmalert_enabled</code></h3><p>name: <code>vmalert_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable VMAlert on this Infra node? Default value is <code>true</code>.</p><p>VMAlert is responsible for alert rule evaluation, replacing Prometheus Alerting functionality, working with Alertmanager.</p><h3 id=vmalert_port><code>vmalert_port</code></h3><p>name: <code>vmalert_port</code>, type: <code>port</code>, level: <code>G</code></p><p>VMAlert listen port, default value is <code>8880</code>.</p><h3 id=vmalert_options><code>vmalert_options</code></h3><p>name: <code>vmalert_options</code>, type: <code>arg</code>, level: <code>G</code></p><p>VMAlert extra command line options, default value is an empty string.</p><hr><h2 id=prometheus><code>PROMETHEUS</code></h2><p>This section now primarily contains Blackbox Exporter and Alertmanager configuration.</p><blockquote><p>Note: Pigsty v4.0 uses VictoriaMetrics to replace Prometheus. The original <code>prometheus_*</code> and <code>pushgateway_*</code> parameters have been moved to the <a href=#victoria><code>VICTORIA</code></a> section.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>blackbox_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># enable blackbox_exporter?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>blackbox_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9115</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># blackbox_exporter listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>blackbox_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># extra CLI options</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>alertmanager_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># enable alertmanager?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>alertmanager_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9059</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># alertmanager listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>alertmanager_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># extra CLI options</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>exporter_metrics_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/metrics  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># exporter metrics path</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=blackbox_enabled><code>blackbox_enabled</code></h3><p>name: <code>blackbox_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable BlackboxExporter on this Infra node? Default value is <code>true</code>.</p><p>BlackboxExporter sends ICMP packets to node IP addresses, VIP addresses, and PostgreSQL VIP addresses to test network connectivity. It can also perform HTTP, TCP, DNS, and other probes.</p><h3 id=blackbox_port><code>blackbox_port</code></h3><p>name: <code>blackbox_port</code>, type: <code>port</code>, level: <code>G</code></p><p>Blackbox Exporter listen port, default value is <code>9115</code>.</p><h3 id=blackbox_options><code>blackbox_options</code></h3><p>name: <code>blackbox_options</code>, type: <code>arg</code>, level: <code>G</code></p><p>BlackboxExporter extra command line options, default value: empty string.</p><h3 id=alertmanager_enabled><code>alertmanager_enabled</code></h3><p>name: <code>alertmanager_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable AlertManager on this Infra node? Default value is <code>true</code>.</p><p>AlertManager is responsible for receiving alert notifications from VMAlert and performing alert grouping, inhibition, silencing, routing, and other processing.</p><h3 id=alertmanager_port><code>alertmanager_port</code></h3><p>name: <code>alertmanager_port</code>, type: <code>port</code>, level: <code>G</code></p><p>AlertManager listen port, default value is <code>9059</code>.</p><p>If you modify this port, ensure you update the alertmanager entry&rsquo;s <code>endpoint</code> configuration in <a href=#infra_portal><code>infra_portal</code></a> accordingly (if defined).</p><h3 id=alertmanager_options><code>alertmanager_options</code></h3><p>name: <code>alertmanager_options</code>, type: <code>arg</code>, level: <code>G</code></p><p>AlertManager extra command line options, default value: empty string.</p><h3 id=exporter_metrics_path><code>exporter_metrics_path</code></h3><p>name: <code>exporter_metrics_path</code>, type: <code>path</code>, level: <code>G</code></p><p>HTTP endpoint path where monitoring exporters expose metrics, default: <code>/metrics</code>. Not recommended to modify this parameter.</p><p>This parameter defines the standard path for all exporters to expose monitoring metrics.</p><hr><h2 id=grafana><code>GRAFANA</code></h2><p>Pigsty uses Grafana as the monitoring system frontend. It can also serve as a data analysis and visualization platform, or for low-code data application development and data application prototyping.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># enable Grafana?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3000</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Grafana listen port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># clean data during init?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_admin_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># admin username</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># admin password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_auth_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># enable auth proxy?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_pgurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># external PostgreSQL URL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_view_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Viewer </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PG datasource password</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=grafana_enabled><code>grafana_enabled</code></h3><p>name: <code>grafana_enabled</code>, type: <code>bool</code>, level: <code>G/I</code></p><p>Enable Grafana on Infra node? Default value: <code>true</code>, meaning all infrastructure nodes will install and enable Grafana by default.</p><h3 id=grafana_port><code>grafana_port</code></h3><p>name: <code>grafana_port</code>, type: <code>port</code>, level: <code>G</code></p><p>Grafana listen port, default value is <code>3000</code>.</p><p>If you need to access Grafana directly (not through Nginx reverse proxy), you can use this port.</p><h3 id=grafana_clean><code>grafana_clean</code></h3><p>name: <code>grafana_clean</code>, type: <code>bool</code>, level: <code>G/A</code></p><p>Clean Grafana data files during initialization? Default: <code>false</code>.</p><p>This operation removes <code>/var/lib/grafana/grafana.db</code>, ensuring a fresh Grafana installation.</p><p>If you want to preserve existing Grafana configuration (such as dashboards, users, data sources, etc.), set this parameter to <code>false</code>.</p><h3 id=grafana_admin_username><code>grafana_admin_username</code></h3><p>name: <code>grafana_admin_username</code>, type: <code>username</code>, level: <code>G</code></p><p>Grafana admin username, default is <code>admin</code>.</p><h3 id=grafana_admin_password><code>grafana_admin_password</code></h3><p>name: <code>grafana_admin_password</code>, type: <code>password</code>, level: <code>G</code></p><p>Grafana admin password, default is <code>pigsty</code>.</p><blockquote><p><strong>IMPORTANT: Be sure to change this password parameter before deploying to production!</strong></p></blockquote><h3 id=grafana_auth_proxy><code>grafana_auth_proxy</code></h3><p>name: <code>grafana_auth_proxy</code>, type: <code>bool</code>, level: <code>G</code></p><p>Enable Grafana auth proxy? Default is <code>false</code>.</p><p>When enabled, Grafana will trust user identity information passed by the reverse proxy (Nginx), enabling single sign-on (SSO) functionality.</p><p>This is typically used for integration with external identity authentication systems.</p><h3 id=grafana_pgurl><code>grafana_pgurl</code></h3><p>name: <code>grafana_pgurl</code>, type: <code>url</code>, level: <code>G</code></p><p>External PostgreSQL database URL for Grafana persistence storage. Default is an empty string.</p><p>If specified, Grafana will use this PostgreSQL database instead of the default SQLite database to store its configuration data.</p><p>Format example: <code>postgres://grafana:password@pg-meta:5432/grafana?sslmode=disable</code></p><p>This is useful for scenarios requiring Grafana high availability deployment or data persistence.</p><h3 id=grafana_view_password><code>grafana_view_password</code></h3><p>name: <code>grafana_view_password</code>, type: <code>password</code>, level: <code>G</code></p><p>Read-only user password used by Grafana metadb PG data source, default is <code>DBUser.Viewer</code>.</p><p>This password is used for Grafana to connect to the PostgreSQL CMDB data source to query metadata in read-only mode.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-83a306c7aef5ddfdbad1dd3d6363e905>3 - Playbook</h1><div class=lead>How to use built-in Ansible playbooks to manage the INFRA module, with a quick reference for common commands.</div><p>Pigsty provides four playbooks related to the INFRA module:</p><ul><li><a href=#deployyml><code>deploy.yml</code></a>: Deploy all components on all nodes in one pass</li><li><a href=#infrayml><code>infra.yml</code></a>: Initialize Pigsty infrastructure on infra nodes</li><li><a href=#infra-rmyml><code>infra-rm.yml</code></a>: Remove infrastructure components from infra nodes</li><li><a href=#deployyml><code>deploy.yml</code></a>: Perform a complete one-time installation of Pigsty on all nodes</li></ul><hr><h2 id=deployyml><code>deploy.yml</code></h2><p>Deploy all components on all nodes in one pass, resolving INFRA/NODE circular dependency issues.</p><p>This playbook interleaves subtasks from <code>infra.yml</code> and <code>node.yml</code>, completing deployment of all components in the following order:</p><ol><li><strong>id</strong>: Generate node and PostgreSQL identities</li><li><strong>ca</strong>: Create self-signed CA on localhost</li><li><strong>repo</strong>: Create local software repository on infra nodes</li><li><strong>node-init</strong>: Initialize nodes, HAProxy, and Docker</li><li><strong>infra</strong>: Initialize Nginx, DNS, VictoriaMetrics, Grafana, etc.</li><li><strong>node-monitor</strong>: Initialize node-exporter, vector</li><li><strong>etcd</strong>: Initialize etcd (required for PostgreSQL HA)</li><li><strong>minio</strong>: Initialize MinIO (optional)</li><li><strong>pgsql</strong>: Initialize PostgreSQL clusters</li><li><strong>pgsql-monitor</strong>: Initialize PostgreSQL monitoring</li></ol><p>This playbook is equivalent to executing the following four playbooks sequentially:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -l infra    <span style=color:#8f5902;font-style:italic># Deploy infrastructure on infra group</span>
</span></span><span style=display:flex><span>./node.yml              <span style=color:#8f5902;font-style:italic># Initialize all nodes</span>
</span></span><span style=display:flex><span>./etcd.yml              <span style=color:#8f5902;font-style:italic># Initialize etcd cluster</span>
</span></span><span style=display:flex><span>./pgsql.yml             <span style=color:#8f5902;font-style:italic># Initialize PostgreSQL clusters</span>
</span></span></code></pre></div><hr><h2 id=infrayml><code>infra.yml</code></h2><p>Initialize the infrastructure module on Infra nodes defined in the <code>infra</code> group of your configuration file.</p><p>This playbook performs the following tasks:</p><ul><li>Configures directories and environment variables on Infra nodes</li><li>Downloads and creates a local software repository to accelerate subsequent installations</li><li>Incorporates the current Infra node as a common node managed by Pigsty</li><li>Deploys infrastructure components (VictoriaMetrics/Logs/Traces, VMAlert, Grafana, Alertmanager, Blackbox Exporter, etc.)</li></ul><p><strong>Playbook notes:</strong></p><ul><li>This is an idempotent playbook - repeated execution will overwrite infrastructure components on Infra nodes</li><li>To preserve historical monitoring data, set <code>vmetrics_clean</code>, <code>vlogs_clean</code>, <code>vtraces_clean</code> to <code>false</code> beforehand</li><li>Unless <code>grafana_clean</code> is set to <code>false</code>, Grafana dashboards and configuration changes will be lost</li><li>When the local software repository <code>/www/pigsty/repo_complete</code> exists, this playbook skips downloading software from the internet</li><li>Complete execution takes approximately 1-3 minutes, depending on machine configuration and network conditions</li></ul><h3 id=available-tasks>Available Tasks</h3><pre tabindex=0><code># ca: create self-signed CA on localhost files/pki
#   - ca_dir        : create CA directory
#   - ca_private    : generate ca private key: files/pki/ca/ca.key
#   - ca_cert       : signing ca cert: files/pki/ca/ca.crt
#
# id: generate node identity
#
# repo: bootstrap a local yum repo from internet or offline packages
#   - repo_dir      : create repo directory
#   - repo_check    : check repo exists
#   - repo_prepare  : use existing repo if exists
#   - repo_build    : build repo from upstream if not exists
#     - repo_upstream    : handle upstream repo files in /etc/yum.repos.d
#       - repo_remove    : remove existing repo file if repo_remove == true
#       - repo_add       : add upstream repo files to /etc/yum.repos.d
#     - repo_url_pkg     : download packages from internet defined by repo_url_packages
#     - repo_cache       : make upstream yum cache with yum makecache
#     - repo_boot_pkg    : install bootstrap pkg such as createrepo_c,yum-utils,...
#     - repo_pkg         : download packages &amp; dependencies from upstream repo
#     - repo_create      : create a local yum repo with createrepo_c &amp; modifyrepo_c
#     - repo_use         : add newly built repo into /etc/yum.repos.d
#   - repo_nginx    : launch a nginx for repo if no nginx is serving
#
# node/haproxy/docker/monitor: setup infra node as a common node
#   - node_name, node_hosts, node_resolv, node_firewall, node_ca, node_repo, node_pkg
#   - node_feature, node_kernel, node_tune, node_sysctl, node_profile, node_ulimit
#   - node_data, node_admin, node_timezone, node_ntp, node_crontab, node_vip
#   - haproxy_install, haproxy_config, haproxy_launch, haproxy_reload
#   - docker_install, docker_admin, docker_config, docker_launch, docker_image
#   - haproxy_register, node_exporter, node_register, vector
#
# infra: setup infra components
#   - infra_env      : env_dir, env_pg, env_pgadmin, env_var
#   - infra_pkg      : infra_pkg_yum, infra_pkg_pip
#   - infra_user     : setup infra os user group
#   - infra_cert     : issue cert for infra components
#   - dns            : dns_config, dns_record, dns_launch
#   - nginx          : nginx_config, nginx_cert, nginx_static, nginx_launch, nginx_certbot, nginx_reload, nginx_exporter
#   - victoria       : vmetrics_config, vmetrics_launch, vlogs_config, vlogs_launch, vtraces_config, vtraces_launch, vmalert_config, vmalert_launch
#   - alertmanager   : alertmanager_config, alertmanager_launch
#   - blackbox       : blackbox_config, blackbox_launch
#   - grafana        : grafana_clean, grafana_config, grafana_launch, grafana_provision
#   - infra_register : register infra components to victoria
</code></pre><hr><h2 id=infra-rmyml><code>infra-rm.yml</code></h2><p>Remove Pigsty infrastructure from Infra nodes defined in the <code>infra</code> group of your configuration file.</p><p>Common subtasks include:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra-rm.yml               <span style=color:#8f5902;font-style:italic># Remove the INFRA module</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t service    <span style=color:#8f5902;font-style:italic># Stop infrastructure services on INFRA</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t data       <span style=color:#8f5902;font-style:italic># Remove retained data on INFRA</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t package    <span style=color:#8f5902;font-style:italic># Uninstall packages installed on INFRA</span>
</span></span></code></pre></div><hr><h2 id=deployyml-1><code>deploy.yml</code></h2><p>Perform a complete one-time installation of Pigsty on all nodes.</p><p>This playbook is described in more detail in <a href=/docs/setup/playbook/#installyml>Playbook: One-Pass Installation</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-338892e63af76b4e44d46c71803f5af5>4 - Monitoring</h1><div class=lead>How to perform self-monitoring of infrastructure in Pigsty?</div><p>This document describes monitoring dashboards and alert rules for the INFRA module in Pigsty.</p><hr><h2 id=dashboards>Dashboards</h2><p>Pigsty provides the following monitoring dashboards for the Infra module:</p><table><thead><tr><th style=text-align:left>Dashboard</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/pigsty>Pigsty Home</a></td><td style=text-align:left>Pigsty monitoring system homepage</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/infra-overview>INFRA Overview</a></td><td style=text-align:left>Pigsty infrastructure self-monitoring overview</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/nginx-instance>Nginx Instance</a></td><td style=text-align:left>Nginx metrics and logs</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/grafana-instance>Grafana Instance</a></td><td style=text-align:left>Grafana metrics and logs</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/vmetrics-instance>VictoriaMetrics Instance</a></td><td style=text-align:left>VictoriaMetrics scraping/query status</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/vmalert-instance>VMAlert Instance</a></td><td style=text-align:left>Alert rule execution status</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/alertmanager-instance>Alertmanager Instance</a></td><td style=text-align:left>Alert aggregation and notifications</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/vlogs-instance>VictoriaLogs Instance</a></td><td style=text-align:left>Log ingestion, querying, and indexing</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/logs-instance>Logs Instance</a></td><td style=text-align:left>View log information on a single node</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/vtraces-instance>VictoriaTraces Instance</a></td><td style=text-align:left>Trace storage and querying</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/inventory-cmdb>Inventory CMDB</a></td><td style=text-align:left>CMDB visualization</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.io/d/etcd-overview>ETCD Overview</a></td><td style=text-align:left>etcd cluster monitoring</td></tr></tbody></table><hr><h2 id=alert-rules>Alert Rules</h2><p>Pigsty provides the following two alert rules for the INFRA module:</p><table><thead><tr><th style=text-align:left>Alert Rule</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>InfraDown</code></td><td style=text-align:left>Infrastructure component is down</td></tr><tr><td style=text-align:left><code>AgentDown</code></td><td style=text-align:left>Monitoring agent is down</td></tr></tbody></table><p>You can modify or add new infrastructure alert rules in <a href=https://github.com/pgsty/pigsty/blob/main/files/victoria/rules/infra.yml><code>files/victoria/rules/infra.yml</code></a>.</p><h3 id=alert-rule-configuration>Alert Rule Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>################################################################</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                Infrastructure Alert Rules                    #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>################################################################</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra-alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#                       Infra Aliveness                        #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># infra components (victoria,grafana) down for 1m triggers a P1 alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>InfraDown</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra_up &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 0, severity: CRIT, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CRIT InfraDown {{ $labels.type }}@{{ $labels.instance }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          infra_up[type={{ $labels.type }}, instance={{ $labels.instance }}] = {{ $value  | printf &#34;%.2f&#34; }} &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#                       Agent Aliveness                        #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># agent aliveness are determined directly by exporter aliveness</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># including: node_exporter, pg_exporter, pgbouncer_exporter, haproxy_exporter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>AgentDown</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>agent_up &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 0, severity: CRIT, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;CRIT AgentDown {{ $labels.ins }}@{{ $labels.instance }}&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          agent_up[ins={{ $labels.ins }}, instance={{ $labels.instance }}] = {{ $value  | printf &#34;%.2f&#34; }} &lt; 1</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-f8c94ca1b2e6cfdd961016e7d77247d8>5 - Metrics</h1><div class=lead>Complete list of monitoring metrics provided by the Pigsty INFRA module</div><hr><blockquote><p><strong>Note</strong>: Pigsty v4.0 has replaced Prometheus/Loki with VictoriaMetrics/Logs/Traces. The following metric list is still based on v3.x generation, for reference when troubleshooting older versions only. To get the latest metrics, query directly in <code>https://p.pigsty</code> (VMUI) or Grafana. Future versions will regenerate metric reference sheets consistent with the Victoria suite.</p></blockquote><h2 id=infra-metrics>INFRA Metrics</h2><p>The <a href=/docs/infra><strong><code>INFRA</code></strong></a> module has 964 available metrics.</p><table><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>alertmanager_alerts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>How many alerts by state.</td></tr><tr><td>alertmanager_alerts_invalid_total</td><td>counter</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of received alerts that were invalid.</td></tr><tr><td>alertmanager_alerts_received_total</td><td>counter</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>The total number of received alerts.</td></tr><tr><td>alertmanager_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which alertmanager was built, and the goos and goarch for the build.</td></tr><tr><td>alertmanager_cluster_alive_messages_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>peer</code>, <code>job</code>, <code>cls</code></td><td>Total number of received alive messages.</td></tr><tr><td>alertmanager_cluster_enabled</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Indicates whether the clustering is enabled or not.</td></tr><tr><td>alertmanager_cluster_failed_peers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number indicating the current number of failed peers in the cluster.</td></tr><tr><td>alertmanager_cluster_health_score</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Health score of the cluster. Lower values are better and zero means &rsquo;totally healthy&rsquo;.</td></tr><tr><td>alertmanager_cluster_members</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number indicating current number of members in cluster.</td></tr><tr><td>alertmanager_cluster_messages_pruned_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of cluster messages pruned.</td></tr><tr><td>alertmanager_cluster_messages_queued</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of cluster messages which are queued.</td></tr><tr><td>alertmanager_cluster_messages_received_size_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total size of cluster messages received.</td></tr><tr><td>alertmanager_cluster_messages_received_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total number of cluster messages received.</td></tr><tr><td>alertmanager_cluster_messages_sent_size_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total size of cluster messages sent.</td></tr><tr><td>alertmanager_cluster_messages_sent_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total number of cluster messages sent.</td></tr><tr><td>alertmanager_cluster_peer_info</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>peer</code>, <code>job</code>, <code>cls</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by peer name.</td></tr><tr><td>alertmanager_cluster_peers_joined_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of peers that have joined.</td></tr><tr><td>alertmanager_cluster_peers_left_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of peers that have left.</td></tr><tr><td>alertmanager_cluster_peers_update_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of peers that have updated metadata.</td></tr><tr><td>alertmanager_cluster_reconnections_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of failed cluster peer reconnection attempts.</td></tr><tr><td>alertmanager_cluster_reconnections_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of cluster peer reconnections.</td></tr><tr><td>alertmanager_cluster_refresh_join_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of failed cluster peer joined attempts via refresh.</td></tr><tr><td>alertmanager_cluster_refresh_join_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of cluster peer joined via refresh.</td></tr><tr><td>alertmanager_config_hash</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Hash of the currently loaded alertmanager configuration.</td></tr><tr><td>alertmanager_config_last_reload_success_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>alertmanager_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the last configuration reload attempt was successful.</td></tr><tr><td>alertmanager_dispatcher_aggregation_groups</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active aggregation groups</td></tr><tr><td>alertmanager_dispatcher_alert_processing_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_dispatcher_alert_processing_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_http_concurrency_limit_exceeded_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times an HTTP request failed because the concurrency limit was reached.</td></tr><tr><td>alertmanager_http_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_requests_in_flight</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of HTTP requests being processed.</td></tr><tr><td>alertmanager_http_response_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_response_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_response_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_integrations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of configured integrations.</td></tr><tr><td>alertmanager_marked_alerts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>How many alerts by state are currently marked in the Alertmanager regardless of their expiry.</td></tr><tr><td>alertmanager_nflog_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_gossip_messages_propagated_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of received gossip messages that have been further gossiped.</td></tr><tr><td>alertmanager_nflog_maintenance_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for the notification log that failed.</td></tr><tr><td>alertmanager_nflog_maintenance_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for the notification log.</td></tr><tr><td>alertmanager_nflog_queries_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of notification log queries were received.</td></tr><tr><td>alertmanager_nflog_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_query_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number notification log received queries that failed.</td></tr><tr><td>alertmanager_nflog_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last notification log snapshot in bytes.</td></tr><tr><td>alertmanager_notification_latency_seconds_bucket</td><td>Unknown</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_notification_latency_seconds_count</td><td>Unknown</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_notification_latency_seconds_sum</td><td>Unknown</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_notification_requests_failed_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of failed notification requests.</td></tr><tr><td>alertmanager_notification_requests_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of attempted notification requests.</td></tr><tr><td>alertmanager_notifications_failed_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>The total number of failed notifications.</td></tr><tr><td>alertmanager_notifications_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of attempted notifications.</td></tr><tr><td>alertmanager_oversize_gossip_message_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_oversize_gossip_message_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_oversize_gossip_message_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_oversized_gossip_message_dropped_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>Number of oversized gossip messages that were dropped due to a full message queue.</td></tr><tr><td>alertmanager_oversized_gossip_message_failure_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>Number of oversized gossip message sends that failed.</td></tr><tr><td>alertmanager_oversized_gossip_message_sent_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>Number of oversized gossip message sent.</td></tr><tr><td>alertmanager_peer_position</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Position the Alertmanager instance believes it&rsquo;s in. The position determines a peer&rsquo;s behavior in the cluster.</td></tr><tr><td>alertmanager_receivers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of configured receivers.</td></tr><tr><td>alertmanager_silences</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>How many silences by state.</td></tr><tr><td>alertmanager_silences_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_gossip_messages_propagated_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of received gossip messages that have been further gossiped.</td></tr><tr><td>alertmanager_silences_maintenance_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for silences that failed.</td></tr><tr><td>alertmanager_silences_maintenance_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for silences.</td></tr><tr><td>alertmanager_silences_queries_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many silence queries were received.</td></tr><tr><td>alertmanager_silences_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_query_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many silence received queries did not succeed.</td></tr><tr><td>alertmanager_silences_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last silence snapshot in bytes.</td></tr><tr><td>blackbox_exporter_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which blackbox_exporter was built, and the goos and goarch for the build.</td></tr><tr><td>blackbox_exporter_config_last_reload_success_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>blackbox_exporter_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Blackbox exporter config loaded successfully.</td></tr><tr><td>blackbox_module_unknown_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Count of unknown modules requested by probes</td></tr><tr><td>cortex_distributor_ingester_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of ingester clients.</td></tr><tr><td>cortex_dns_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_dns_lookups_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_frontend_query_range_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_frontend_query_range_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_frontend_query_range_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_ingester_flush_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of series pending in the flush queue.</td></tr><tr><td>cortex_kv_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_kv_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_kv_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_member_consul_heartbeats_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_notifications_alertmanagers_discovered</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>The number of alertmanagers discovered and active.</td></tr><tr><td>cortex_prometheus_notifications_dropped_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_notifications_queue_capacity</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>The capacity of the alert notifications queue.</td></tr><tr><td>cortex_prometheus_notifications_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>The number of alert notifications in the queue.</td></tr><tr><td>cortex_prometheus_rule_evaluation_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration for a rule to execute.</td></tr><tr><td>cortex_prometheus_rule_evaluation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_rule_evaluation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_rule_group_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of rule group evaluations.</td></tr><tr><td>cortex_prometheus_rule_group_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_rule_group_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_frontend_connected_schedulers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of schedulers this frontend is connected to.</td></tr><tr><td>cortex_query_frontend_queries_in_progress</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of queries in progress handled by this frontend.</td></tr><tr><td>cortex_query_frontend_retries_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_frontend_retries_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_frontend_retries_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_connected_frontend_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of query-frontend worker clients currently connected to the query-scheduler.</td></tr><tr><td>cortex_query_scheduler_connected_querier_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of querier worker clients currently connected to the query-scheduler.</td></tr><tr><td>cortex_query_scheduler_inflight_requests</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Number of inflight requests (either queued or processing) sampled at a regular interval. Quantile buckets keep track of inflight requests over the last 60s.</td></tr><tr><td>cortex_query_scheduler_inflight_requests_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_inflight_requests_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_length</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_running</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Value will be 1 if the scheduler is in the ReplicationSet and actively receiving/processing requests</td></tr><tr><td>cortex_ring_member_heartbeats_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_ring_member_tokens_owned</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens owned in the ring.</td></tr><tr><td>cortex_ring_member_tokens_to_own</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens to own in the ring.</td></tr><tr><td>cortex_ring_members</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>Number of members in the ring</td></tr><tr><td>cortex_ring_oldest_member_timestamp</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>Timestamp of the oldest member in the ring.</td></tr><tr><td>cortex_ring_tokens_total</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of tokens in the ring</td></tr><tr><td>cortex_ruler_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of ruler clients in the pool.</td></tr><tr><td>cortex_ruler_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>Boolean set to 1 whenever the last configuration reload attempt was successful.</td></tr><tr><td>cortex_ruler_config_last_reload_successful_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>cortex_ruler_config_updates_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_ruler_managers_total</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of managers registered and running in the ruler</td></tr><tr><td>cortex_ruler_ring_check_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_ruler_sync_rules_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>deprecated_flags_inuse_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cgo_go_to_c_calls_calls_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_mark_assist_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_mark_dedicated_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_mark_idle_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_pause_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_total_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_idle_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_scavenge_assist_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_scavenge_background_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_scavenge_total_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_total_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_user_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_cycles_automatic_gc_cycles_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_cycles_forced_gc_cycles_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_cycles_total_gc_cycles_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>A summary of the pause duration of garbage collection cycles.</td></tr><tr><td>go_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_gogc_percent</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Heap size target percentage configured by the user, otherwise 100. This value is set by the GOGC environment variable, and the runtime/debug.SetGCPercent function.</td></tr><tr><td>go_gc_gomemlimit_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Go runtime memory limit configured by the user, otherwise math.MaxInt64. This value is set by the GOMEMLIMIT environment variable, and the runtime/debug.SetMemoryLimit function.</td></tr><tr><td>go_gc_heap_allocs_by_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_by_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_by_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_objects_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_by_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_by_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_by_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_objects_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_goal_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Heap size target for the end of the GC cycle.</td></tr><tr><td>go_gc_heap_live_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Heap memory occupied by live objects that were marked by the previous GC.</td></tr><tr><td>go_gc_heap_objects_objects</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of objects, live or unswept, occupying heap memory.</td></tr><tr><td>go_gc_heap_tiny_allocs_objects_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_limiter_last_enabled_gc_cycle</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>GC cycle the last time the GC CPU limiter was enabled. This metric is useful for diagnosing the root cause of an out-of-memory error, because the limiter trades memory for CPU time when the GC&rsquo;s CPU time gets too high. This is most likely to occur with use of SetMemoryLimit. The first GC cycle is cycle 1, so a value of 0 indicates that it was never enabled.</td></tr><tr><td>go_gc_pauses_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_pauses_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_pauses_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_scan_globals_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total amount of global variable space that is scannable.</td></tr><tr><td>go_gc_scan_heap_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total amount of heap space that is scannable.</td></tr><tr><td>go_gc_scan_stack_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of bytes of stack that were scanned last GC cycle.</td></tr><tr><td>go_gc_scan_total_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total amount space that is scannable. Sum of all metrics in /gc/scan.</td></tr><tr><td>go_gc_stack_starting_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The stack size of new goroutines.</td></tr><tr><td>go_godebug_non_default_behavior_execerrdot_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_gocachehash_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_gocachetest_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_gocacheverify_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_http2client_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_http2server_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_installgoroot_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_jstmpllitinterp_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_multipartmaxheaders_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_multipartmaxparts_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_multipathtcp_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_panicnil_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_randautoseed_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_tarinsecurepath_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_tlsmaxrsasize_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_x509sha1_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_x509usefallbackroots_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_zipinsecurepath_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_goroutines</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of goroutines that currently exist.</td></tr><tr><td>go_info</td><td>gauge</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Information about the Go environment.</td></tr><tr><td>go_memory_classes_heap_free_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is completely free and eligible to be returned to the underlying system, but has not been. This metric is the runtime&rsquo;s estimate of free address space that is backed by physical memory.</td></tr><tr><td>go_memory_classes_heap_objects_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory occupied by live objects and dead objects that have not yet been marked free by the garbage collector.</td></tr><tr><td>go_memory_classes_heap_released_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is completely free and has been returned to the underlying system. This metric is the runtime&rsquo;s estimate of free address space that is still mapped into the process, but is not backed by physical memory.</td></tr><tr><td>go_memory_classes_heap_stacks_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory allocated from the heap that is reserved for stack space, whether or not it is currently in-use. Currently, this represents all stack memory for goroutines. It also includes all OS thread stacks in non-cgo programs. Note that stacks may be allocated differently in the future, and this may change.</td></tr><tr><td>go_memory_classes_heap_unused_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for heap objects but is not currently used to hold heap objects.</td></tr><tr><td>go_memory_classes_metadata_mcache_free_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for runtime mcache structures, but not in-use.</td></tr><tr><td>go_memory_classes_metadata_mcache_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is occupied by runtime mcache structures that are currently being used.</td></tr><tr><td>go_memory_classes_metadata_mspan_free_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for runtime mspan structures, but not in-use.</td></tr><tr><td>go_memory_classes_metadata_mspan_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is occupied by runtime mspan structures that are currently being used.</td></tr><tr><td>go_memory_classes_metadata_other_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for or used to hold runtime metadata.</td></tr><tr><td>go_memory_classes_os_stacks_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Stack memory allocated by the underlying operating system. In non-cgo programs this metric is currently zero. This may change in the future.In cgo programs this metric includes OS thread stacks allocated directly from the OS. Currently, this only accounts for one stack in c-shared and c-archive build modes, and other sources of stacks from the OS are not measured. This too may change in the future.</td></tr><tr><td>go_memory_classes_other_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory used by execution trace buffers, structures for debugging the runtime, finalizer and profiler specials, and more.</td></tr><tr><td>go_memory_classes_profiling_buckets_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is used by the stack trace hash map used for profiling.</td></tr><tr><td>go_memory_classes_total_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>All memory mapped by the Go runtime into the current process as read-write. Note that this does not include memory mapped by code called via cgo or via the syscall package. Sum of all metrics in /memory/classes.</td></tr><tr><td>go_memstats_alloc_bytes</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_alloc_bytes_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_buck_hash_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used by the profiling bucket hash table.</td></tr><tr><td>go_memstats_frees_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of frees.</td></tr><tr><td>go_memstats_gc_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for garbage collection system metadata.</td></tr><tr><td>go_memstats_heap_alloc_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes allocated and still in use.</td></tr><tr><td>go_memstats_heap_idle_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes waiting to be used.</td></tr><tr><td>go_memstats_heap_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes that are in use.</td></tr><tr><td>go_memstats_heap_objects</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of allocated objects.</td></tr><tr><td>go_memstats_heap_released_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes released to OS.</td></tr><tr><td>go_memstats_heap_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes obtained from system.</td></tr><tr><td>go_memstats_last_gc_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of seconds since 1970 of last garbage collection.</td></tr><tr><td>go_memstats_lookups_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of pointer lookups.</td></tr><tr><td>go_memstats_mallocs_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of mallocs.</td></tr><tr><td>go_memstats_mcache_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes in use by mcache structures.</td></tr><tr><td>go_memstats_mcache_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for mcache structures obtained from system.</td></tr><tr><td>go_memstats_mspan_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes in use by mspan structures.</td></tr><tr><td>go_memstats_mspan_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for mspan structures obtained from system.</td></tr><tr><td>go_memstats_next_gc_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes when next garbage collection will take place.</td></tr><tr><td>go_memstats_other_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for other system allocations.</td></tr><tr><td>go_memstats_stack_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes in use by the stack allocator.</td></tr><tr><td>go_memstats_stack_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes obtained from system for stack allocator.</td></tr><tr><td>go_memstats_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes obtained from system.</td></tr><tr><td>go_sched_gomaxprocs_threads</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current runtime.GOMAXPROCS setting, or the number of operating system threads that can execute user-level Go code simultaneously.</td></tr><tr><td>go_sched_goroutines_goroutines</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Count of live goroutines.</td></tr><tr><td>go_sched_latencies_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_sched_latencies_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_sched_latencies_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_sql_stats_connections_blocked_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total time blocked waiting for a new connection.</td></tr><tr><td>go_sql_stats_connections_closed_max_idle</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetMaxIdleConns.</td></tr><tr><td>go_sql_stats_connections_closed_max_idle_time</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetConnMaxIdleTime.</td></tr><tr><td>go_sql_stats_connections_closed_max_lifetime</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetConnMaxLifetime.</td></tr><tr><td>go_sql_stats_connections_idle</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of idle connections.</td></tr><tr><td>go_sql_stats_connections_in_use</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of connections currently in use.</td></tr><tr><td>go_sql_stats_connections_max_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open connections to the database.</td></tr><tr><td>go_sql_stats_connections_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of established connections both in use and idle.</td></tr><tr><td>go_sql_stats_connections_waited_for</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections waited for.</td></tr><tr><td>go_sync_mutex_wait_total_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_threads</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of OS threads created.</td></tr><tr><td>grafana_access_evaluation_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>number of evaluation calls</td></tr><tr><td>grafana_access_evaluation_duration_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_evaluation_duration_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_evaluation_duration_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_permissions_duration_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_permissions_duration_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_permissions_duration_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aggregator_discovery_aggregation_count_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_active_alerts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>amount of active alerts</td></tr><tr><td>grafana_alerting_active_configurations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of active Alertmanager configurations.</td></tr><tr><td>grafana_alerting_alertmanager_config_match</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of match</td></tr><tr><td>grafana_alerting_alertmanager_config_match_re</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of matchRE</td></tr><tr><td>grafana_alerting_alertmanager_config_matchers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of matchers</td></tr><tr><td>grafana_alerting_alertmanager_config_object_matchers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of object_matchers</td></tr><tr><td>grafana_alerting_discovered_configurations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of organizations we&rsquo;ve discovered that require an Alertmanager configuration.</td></tr><tr><td>grafana_alerting_dispatcher_aggregation_groups</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active aggregation groups</td></tr><tr><td>grafana_alerting_dispatcher_alert_processing_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_dispatcher_alert_processing_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_execution_time_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary of alert execution duration</td></tr><tr><td>grafana_alerting_execution_time_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_execution_time_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_gossip_messages_propagated_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_queries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last notification log snapshot in bytes.</td></tr><tr><td>grafana_alerting_notification_latency_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_notification_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_notification_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_alert_rules</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of alert rules that could be considered for evaluation at the next tick.</td></tr><tr><td>grafana_alerting_schedule_alert_rules_hash</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A hash of the alert rules that could be considered for evaluation at the next tick.</td></tr><tr><td>grafana_alerting_schedule_periodic_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_periodic_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_periodic_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_query_alert_rules_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_query_alert_rules_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_query_alert_rules_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_scheduler_behind_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of seconds the scheduler is behind.</td></tr><tr><td>grafana_alerting_silences_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_gossip_messages_propagated_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_queries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last silence snapshot in bytes.</td></tr><tr><td>grafana_alerting_state_calculation_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_state_calculation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_state_calculation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_state_history_writes_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_ticker_interval_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Interval at which the ticker is meant to tick.</td></tr><tr><td>grafana_alerting_ticker_last_consumed_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last consumed tick in seconds.</td></tr><tr><td>grafana_alerting_ticker_next_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the next tick in seconds before it is consumed.</td></tr><tr><td>grafana_api_admin_user_created_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_get_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dashboard get duration</td></tr><tr><td>grafana_api_dashboard_get_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_get_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_save_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dashboard save duration</td></tr><tr><td>grafana_api_dashboard_save_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_save_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_search_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dashboard search duration</td></tr><tr><td>grafana_api_dashboard_search_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_search_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_snapshot_create_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_snapshot_external_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_snapshot_get_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dataproxy_request_all_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dataproxy request duration</td></tr><tr><td>grafana_api_dataproxy_request_all_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dataproxy_request_all_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_login_oauth_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_login_post_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_login_saml_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_models_dashboard_insert_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_org_create_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_response_status_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_api_user_signup_completed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_user_signup_invite_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_user_signup_started_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_audit_event_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_audit_requests_rejected_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_client_certificate_expiration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_client_certificate_expiration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_client_certificate_expiration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_envelope_encryption_dek_cache_fill_percent</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>[ALPHA] Percent of the cache slots currently occupied by cached DEKs.</td></tr><tr><td>grafana_apiserver_flowcontrol_seat_fair_frac</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>[ALPHA] Fair fraction of server&rsquo;s concurrency to allocate to each priority level that can use it</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_envelope_transformation_cache_misses_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_tls_handshake_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_webhooks_x509_insecure_sha1_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_webhooks_x509_missing_san_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_authn_authn_failed_authentication_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_authn_authn_successful_authentication_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>client</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_authn_authn_successful_login_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>client</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aws_cloudwatch_get_metric_data_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aws_cloudwatch_get_metric_statistics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aws_cloudwatch_list_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>edition</code>, <code>ip</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, and goversion from which Grafana was built</td></tr><tr><td>grafana_build_timestamp</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>edition</code>, <code>ip</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code></td><td>A metric exposing when the binary was built in epoch</td></tr><tr><td>grafana_cardinality_enforcement_unexpected_categorizations_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_idle</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of idle connections</td></tr><tr><td>grafana_database_conn_in_use</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of connections currently in use</td></tr><tr><td>grafana_database_conn_max_idle_closed_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetConnMaxIdleTime</td></tr><tr><td>grafana_database_conn_max_idle_closed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_max_lifetime_closed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_max_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open connections to the database</td></tr><tr><td>grafana_database_conn_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of established connections both in use and idle</td></tr><tr><td>grafana_database_conn_wait_count_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_wait_duration_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total time blocked waiting for a new connection</td></tr><tr><td>grafana_datasource_request_duration_seconds_bucket</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_request_duration_seconds_count</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_request_duration_seconds_sum</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_request_in_flight</td><td>gauge</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>A gauge of outgoing data source requests currently being sent by Grafana</td></tr><tr><td>grafana_datasource_request_total</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_response_size_bytes_bucket</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_datasource_response_size_bytes_count</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_datasource_response_size_bytes_sum</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_db_datasource_query_by_id_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_disabled_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_emails_sent_failed</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of emails Grafana failed to send</td></tr><tr><td>grafana_emails_sent_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_encryption_cache_reads_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>hit</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_encryption_ops_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>success</code>, <code>operation</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_environment_info</td><td>gauge</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>commit</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by environment information about the running instance.</td></tr><tr><td>grafana_feature_toggles_info</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>info metric that exposes what feature toggles are enabled or not</td></tr><tr><td>grafana_frontend_boot_css_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_css_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_css_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_contentful_paint_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_contentful_paint_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_contentful_paint_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_paint_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_paint_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_paint_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_js_done_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_js_done_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_js_done_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_load_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_load_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_load_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_plugins_preload_ms_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_plugins_preload_ms_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_plugins_preload_ms_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_hidden_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_http_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>grafana_http_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>grafana_http_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>grafana_http_request_in_flight</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A gauge of requests currently being served by Grafana.</td></tr><tr><td>grafana_idforwarding_idforwarding_failed_token_signing_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_from_cache_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_instance_start_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_ldap_users_sync_execution_time</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for LDAP users sync execution duration</td></tr><tr><td>grafana_ldap_users_sync_execution_time_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_ldap_users_sync_execution_time_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_live_client_command_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Client command duration summary.</td></tr><tr><td>grafana_live_client_command_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_live_client_command_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_live_client_num_reply_errors</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>Number of errors in replies sent to clients.</td></tr><tr><td>grafana_live_client_num_server_disconnects</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>Number of server initiated disconnects.</td></tr><tr><td>grafana_live_client_recover</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>recovered</code>, <code>job</code>, <code>cls</code></td><td>Count of recover operations.</td></tr><tr><td>grafana_live_node_action_count</td><td>unknown</td><td><code>action</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of node actions called.</td></tr><tr><td>grafana_live_node_build</td><td>gauge</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Node build info.</td></tr><tr><td>grafana_live_node_messages_received_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Number of messages received.</td></tr><tr><td>grafana_live_node_messages_sent_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Number of messages sent.</td></tr><tr><td>grafana_live_node_num_channels</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of channels with one or more subscribers.</td></tr><tr><td>grafana_live_node_num_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of clients connected.</td></tr><tr><td>grafana_live_node_num_nodes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of nodes in cluster.</td></tr><tr><td>grafana_live_node_num_subscriptions</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of subscriptions.</td></tr><tr><td>grafana_live_node_num_users</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of unique users connected.</td></tr><tr><td>grafana_live_transport_connect_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>transport</code>, <code>job</code>, <code>cls</code></td><td>Number of connections to specific transport.</td></tr><tr><td>grafana_live_transport_messages_sent</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>transport</code>, <code>job</code>, <code>cls</code></td><td>Number of messages sent over specific transport.</td></tr><tr><td>grafana_loki_plugin_parse_response_duration_seconds_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_loki_plugin_parse_response_duration_seconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_loki_plugin_parse_response_duration_seconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_page_response_status_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_plugin_build_info</td><td>gauge</td><td><code>version</code>, <code>signature_status</code>, <code>ins</code>, <code>instance</code>, <code>plugin_type</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by pluginId, pluginType and version from which Grafana plugin was built</td></tr><tr><td>grafana_plugin_request_duration_milliseconds_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>le</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_milliseconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_milliseconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_seconds_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>le</code>, <code>status</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_seconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>status</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_seconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>status</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_size_bytes_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>le</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_size_bytes_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_size_bytes_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_total</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>status</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_process_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_process_max_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>grafana_process_open_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of open file descriptors.</td></tr><tr><td>grafana_process_resident_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Resident memory size in bytes.</td></tr><tr><td>grafana_process_start_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>grafana_process_virtual_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>grafana_process_virtual_memory_max_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>grafana_prometheus_plugin_backend_request_count</td><td>unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>errorSource</code>, <code>job</code>, <code>cls</code></td><td>The total amount of prometheus backend plugin requests</td></tr><tr><td>grafana_proxy_response_status_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_public_dashboard_request_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>counter for public dashboards requests</td></tr><tr><td>grafana_registered_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>stability_level</code>, <code>deprecated_version</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_rendering_queue_size</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>size of rendering queue</td></tr><tr><td>grafana_search_dashboard_search_failures_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_failures_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_failures_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_successes_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_successes_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_successes_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_stat_active_users</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>number of active users</td></tr><tr><td>grafana_stat_total_orgs</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of orgs</td></tr><tr><td>grafana_stat_total_playlists</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of playlists</td></tr><tr><td>grafana_stat_total_service_account_tokens</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of service account tokens</td></tr><tr><td>grafana_stat_total_service_accounts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of service accounts</td></tr><tr><td>grafana_stat_total_service_accounts_role_none</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of service accounts with no role</td></tr><tr><td>grafana_stat_total_teams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of teams</td></tr><tr><td>grafana_stat_total_users</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of users</td></tr><tr><td>grafana_stat_totals_active_admins</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of active admins</td></tr><tr><td>grafana_stat_totals_active_editors</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of active editors</td></tr><tr><td>grafana_stat_totals_active_viewers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of active viewers</td></tr><tr><td>grafana_stat_totals_admins</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of admins</td></tr><tr><td>grafana_stat_totals_alert_rules</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of alert rules in the database</td></tr><tr><td>grafana_stat_totals_annotations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of annotations in the database</td></tr><tr><td>grafana_stat_totals_correlations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of correlations</td></tr><tr><td>grafana_stat_totals_dashboard</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of dashboards</td></tr><tr><td>grafana_stat_totals_dashboard_versions</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of dashboard versions in the database</td></tr><tr><td>grafana_stat_totals_data_keys</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>active</code></td><td>total amount of data keys in the database</td></tr><tr><td>grafana_stat_totals_datasource</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>total number of defined datasources, labeled by pluginId</td></tr><tr><td>grafana_stat_totals_editors</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of editors</td></tr><tr><td>grafana_stat_totals_folder</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of folders</td></tr><tr><td>grafana_stat_totals_library_panels</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of library panels in the database</td></tr><tr><td>grafana_stat_totals_library_variables</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of library variables in the database</td></tr><tr><td>grafana_stat_totals_public_dashboard</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of public dashboards</td></tr><tr><td>grafana_stat_totals_rule_groups</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of alert rule groups in the database</td></tr><tr><td>grafana_stat_totals_viewers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of viewers</td></tr><tr><td>infra_up</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_baggage_restrictions_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_baggage_truncations_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_baggage_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_finished_spans_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>sampled</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_reporter_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of spans in the reporter queue</td></tr><tr><td>jaeger_tracer_reporter_spans_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_sampler_queries_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_sampler_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_span_context_decoding_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_started_spans_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>sampled</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_throttled_debug_spans_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_throttler_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_traces_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>sampled</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>N/A</td></tr><tr><td>kv_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>kv_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>kv_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>legacy_grafana_alerting_ticker_interval_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Interval at which the ticker is meant to tick.</td></tr><tr><td>legacy_grafana_alerting_ticker_last_consumed_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last consumed tick in seconds.</td></tr><tr><td>legacy_grafana_alerting_ticker_next_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the next tick in seconds before it is consumed.</td></tr><tr><td>logql_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>query_type</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>logql_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>query_type</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>logql_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>query_type</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_azure_blob_egress_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_apply_retention_last_successful_run_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Unix timestamp of the last successful retention run</td></tr><tr><td>loki_boltdb_shipper_compact_tables_operation_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Time (in seconds) spent in compacting all the tables</td></tr><tr><td>loki_boltdb_shipper_compact_tables_operation_last_successful_run_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Unix timestamp of the last successful compaction run</td></tr><tr><td>loki_boltdb_shipper_compact_tables_operation_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_compactor_running</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Value will be 1 if compactor is currently running on this instance</td></tr><tr><td>loki_boltdb_shipper_open_existing_file_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_query_time_table_download_duration_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>job</code>, <code>cls</code>, <code>table</code></td><td>Time (in seconds) spent in downloading of files per table at query time</td></tr><tr><td>loki_boltdb_shipper_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_tables_download_operation_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>Time (in seconds) spent in downloading updated files for all the tables</td></tr><tr><td>loki_boltdb_shipper_tables_sync_operation_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_tables_upload_operation_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which loki was built, and the goos and goarch for the build.</td></tr><tr><td>loki_bytes_per_line_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_bytes_per_line_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_bytes_per_line_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_corrupt_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_fetched_keys</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total count of keys requested from cache.</td></tr><tr><td>loki_cache_hits</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total count of keys found in cache.</td></tr><tr><td>loki_cache_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_cache_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_cache_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_cache_value_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_value_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_value_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_cache_dequeued_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_cache_enqueued_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_cache_skipped_buffer_full_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_fetched_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_fetched_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_fetched_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_chunks_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_chunks_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_chunks_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_deduped_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_deduped_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_fetched_chunk_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_fetched_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_entries_per_chunk_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_entries_per_chunk_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_entries_per_chunk_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_lookups_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_lookups_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_lookups_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_post_intersection_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_post_intersection_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_post_intersection_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_pre_intersection_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_pre_intersection_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_pre_intersection_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_stored_chunk_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_stored_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_consul_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_consul_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>kv_name</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_consul_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>kv_name</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_delete_request_lookups_failed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_delete_request_lookups_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_discarded_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_discarded_samples_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_distributor_bytes_received_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>retention_hours</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_distributor_ingester_appends_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>ingester</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_distributor_lines_received_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_distributor_replication_factor</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The configured replication factor.</td></tr><tr><td>loki_distributor_structured_metadata_bytes_received_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>retention_hours</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_experimental_features_in_use_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_index_chunk_refs_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_index_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_index_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_index_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_inflight_requests</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>Current number of inflight requests.</td></tr><tr><td>loki_ingester_autoforget_unhealthy_ingesters_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_blocks_per_chunk_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_blocks_per_chunk_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_blocks_per_chunk_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_creations_failed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_creations_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_deletions_failed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_deletions_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Time taken to create a checkpoint.</td></tr><tr><td>loki_ingester_checkpoint_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_logged_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_age_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_age_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_age_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_bounds_hours_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_bounds_hours_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_bounds_hours_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_compression_ratio_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_compression_ratio_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_compression_ratio_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_encode_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_encode_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_encode_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_entries_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_entries_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_entries_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_stored_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_utilization_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_utilization_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_utilization_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunks_created_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunks_flushed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunks_stored_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_client_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_ingester_client_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_ingester_client_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_ingester_limiter_enabled</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the ingester&rsquo;s limiter is enabled</td></tr><tr><td>loki_ingester_memory_chunks</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of chunks in memory.</td></tr><tr><td>loki_ingester_memory_streams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>The total number of streams in memory per tenant.</td></tr><tr><td>loki_ingester_memory_streams_labels_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total bytes of labels of the streams in memory.</td></tr><tr><td>loki_ingester_received_chunks</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of chunks received by this ingester whilst joining.</td></tr><tr><td>loki_ingester_samples_per_chunk_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_samples_per_chunk_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_samples_per_chunk_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_sent_chunks</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of chunks sent by this ingester whilst leaving.</td></tr><tr><td>loki_ingester_shutdown_marker</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>1 if prepare shutdown has been called, 0 otherwise</td></tr><tr><td>loki_ingester_streams_created_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_streams_removed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_bytes_in_use</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of bytes in use by the WAL recovery process.</td></tr><tr><td>loki_ingester_wal_disk_full_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_duplicate_entries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_logged_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_records_logged_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_entries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_streams_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_replay_active</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the WAL is replaying</td></tr><tr><td>loki_ingester_wal_replay_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Time taken to replay the checkpoint and the WAL.</td></tr><tr><td>loki_ingester_wal_replay_flushing</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the wal replay is in a flushing phase due to backpressure</td></tr><tr><td>loki_internal_log_messages_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>level</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_kv_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_kv_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_kv_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_log_flushes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_log_flushes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_log_flushes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_log_messages_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>level</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_bytes_processed_per_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>le</code>, <code>sharded</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>latency_type</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_bytes_processed_per_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>sharded</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>latency_type</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_bytes_processed_per_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>sharded</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>latency_type</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_chunk_download_latency_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>le</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_chunk_download_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_chunk_download_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_downloaded_chunk_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_duplicates_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_ingester_sent_lines_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_latency_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>le</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_panic_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_corruptions_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_encode_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_gets_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_hits_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_puts_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_query_frontend_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of clients connected to query-frontend.</td></tr><tr><td>loki_querier_query_frontend_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_querier_query_frontend_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_querier_query_frontend_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_querier_tail_active</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active tailers</td></tr><tr><td>loki_querier_tail_active_streams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active streams being tailed</td></tr><tr><td>loki_querier_tail_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_worker_concurrency</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of concurrent querier workers</td></tr><tr><td>loki_querier_worker_inflight_queries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of queries being processed by the querier workers</td></tr><tr><td>loki_query_frontend_log_result_cache_hit_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_log_result_cache_miss_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_partitions_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_partitions_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_partitions_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_shard_factor_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>mapper</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_shard_factor_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>mapper</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_shard_factor_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>mapper</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_scheduler_enqueue_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>level</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_expired_streams_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_max_stream_rate_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The maximum stream rate for any stream reported by ingesters during a sync operation. Sharded Streams are combined.</td></tr><tr><td>loki_rate_store_max_stream_shards</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of shards for a single stream reported by ingesters during a sync operation.</td></tr><tr><td>loki_rate_store_max_unique_stream_rate_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The maximum stream rate for any stream reported by ingesters during a sync operation. Sharded Streams are considered separate.</td></tr><tr><td>loki_rate_store_stream_rate_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_rate_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_rate_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_shards_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_shards_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_shards_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_streams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of unique streams reported by all ingesters. Sharded streams are combined</td></tr><tr><td>loki_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>ws</code>, <code>route</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>ws</code>, <code>route</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>ws</code>, <code>route</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_request_message_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_request_message_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_request_message_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_response_message_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_response_message_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_response_message_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_results_cache_version_comparisons_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_downloaded_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_per_batch_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_per_batch_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_per_batch_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_series_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_stream_sharding_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times the distributor has sharded streams</td></tr><tr><td>loki_tcp_connections</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>protocol</code>, <code>job</code>, <code>cls</code></td><td>Current number of accepted TCP connections.</td></tr><tr><td>loki_tcp_connections_limit</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>protocol</code>, <code>job</code>, <code>cls</code></td><td>The max number of TCP connections that can be accepted (0 means no limit).</td></tr><tr><td>net_conntrack_dialer_conn_attempted_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections attempted by the given dialer a given name.</td></tr><tr><td>net_conntrack_dialer_conn_closed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections closed which originated from the dialer of a given name.</td></tr><tr><td>net_conntrack_dialer_conn_established_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections successfully established by the given dialer a given name.</td></tr><tr><td>net_conntrack_dialer_conn_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections failed to dial by the dialer a given name.</td></tr><tr><td>net_conntrack_listener_conn_accepted_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>listener_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections opened to the listener of a given name.</td></tr><tr><td>net_conntrack_listener_conn_closed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>listener_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections closed that were made to the listener of a given name.</td></tr><tr><td>nginx_connections_accepted</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Accepted client connections</td></tr><tr><td>nginx_connections_active</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Active client connections</td></tr><tr><td>nginx_connections_handled</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Handled client connections</td></tr><tr><td>nginx_connections_reading</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Connections where NGINX is reading the request header</td></tr><tr><td>nginx_connections_waiting</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Idle client connections</td></tr><tr><td>nginx_connections_writing</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Connections where NGINX is writing the response back to the client</td></tr><tr><td>nginx_exporter_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which nginx_exporter was built, and the goos and goarch for the build.</td></tr><tr><td>nginx_http_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total http requests</td></tr><tr><td>nginx_up</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Status of the last metric scrape</td></tr><tr><td>plugins_active_instances</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of active plugin instances</td></tr><tr><td>plugins_datasource_instances_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>process_cpu_seconds_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total user and system CPU time spent in seconds.</td></tr><tr><td>process_max_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>process_open_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of open file descriptors.</td></tr><tr><td>process_resident_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Resident memory size in bytes.</td></tr><tr><td>process_start_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>process_virtual_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>process_virtual_memory_max_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>prometheus_api_remote_read_queries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of remote read queries being executed or waiting.</td></tr><tr><td>prometheus_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which prometheus was built, and the goos and goarch for the build.</td></tr><tr><td>prometheus_config_last_reload_success_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>prometheus_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the last configuration reload attempt was successful.</td></tr><tr><td>prometheus_engine_queries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of queries being executed or waiting.</td></tr><tr><td>prometheus_engine_queries_concurrent_max</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The max number of concurrent queries.</td></tr><tr><td>prometheus_engine_query_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code>, <code>slice</code></td><td>Query timings</td></tr><tr><td>prometheus_engine_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>slice</code></td><td>N/A</td></tr><tr><td>prometheus_engine_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>slice</code></td><td>N/A</td></tr><tr><td>prometheus_engine_query_log_enabled</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>State of the query log.</td></tr><tr><td>prometheus_engine_query_log_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of query log failures.</td></tr><tr><td>prometheus_engine_query_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of samples loaded by all queries.</td></tr><tr><td>prometheus_http_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code>, <code>handler</code></td><td>Counter of HTTP requests.</td></tr><tr><td>prometheus_http_response_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_response_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_response_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_notifications_alertmanagers_discovered</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of alertmanagers discovered and active.</td></tr><tr><td>prometheus_notifications_dropped_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of alerts dropped due to errors when sending to Alertmanager.</td></tr><tr><td>prometheus_notifications_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>Total number of errors sending alert notifications.</td></tr><tr><td>prometheus_notifications_latency_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Latency quantiles for sending alert notifications.</td></tr><tr><td>prometheus_notifications_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_notifications_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_notifications_queue_capacity</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The capacity of the alert notifications queue.</td></tr><tr><td>prometheus_notifications_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of alert notifications in the queue.</td></tr><tr><td>prometheus_notifications_sent_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>Total number of alerts sent.</td></tr><tr><td>prometheus_ready</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether Prometheus startup was fully completed and the server is ready for normal operation.</td></tr><tr><td>prometheus_remote_storage_exemplars_in_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Exemplars in to remote storage, compare to exemplars out for queue managers.</td></tr><tr><td>prometheus_remote_storage_highest_timestamp_in_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Highest timestamp that has come into the remote storage via the Appender interface, in seconds since epoch.</td></tr><tr><td>prometheus_remote_storage_histograms_in_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>HistogramSamples in to remote storage, compare to histograms out for queue managers.</td></tr><tr><td>prometheus_remote_storage_samples_in_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Samples in to remote storage, compare to samples out for queue managers.</td></tr><tr><td>prometheus_remote_storage_string_interner_zero_reference_releases_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of times release has been called for strings that are not interned.</td></tr><tr><td>prometheus_rule_evaluation_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration for a rule to execute.</td></tr><tr><td>prometheus_rule_evaluation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_evaluation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_evaluation_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of rule evaluation failures.</td></tr><tr><td>prometheus_rule_evaluations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of rule evaluations.</td></tr><tr><td>prometheus_rule_group_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of rule group evaluations.</td></tr><tr><td>prometheus_rule_group_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_group_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_group_interval_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The interval of a rule group.</td></tr><tr><td>prometheus_rule_group_iterations_missed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of rule group evaluations missed due to slow rule group evaluation.</td></tr><tr><td>prometheus_rule_group_iterations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of scheduled rule group evaluations, whether executed or missed.</td></tr><tr><td>prometheus_rule_group_last_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The duration of the last rule group evaluation.</td></tr><tr><td>prometheus_rule_group_last_evaluation_samples</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The number of samples returned during the last rule group evaluation.</td></tr><tr><td>prometheus_rule_group_last_evaluation_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The timestamp of the last rule group evaluation in seconds.</td></tr><tr><td>prometheus_rule_group_rules</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The number of rules.</td></tr><tr><td>prometheus_sd_azure_cache_hit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of cache hit during refresh.</td></tr><tr><td>prometheus_sd_azure_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of Azure service discovery refresh failures.</td></tr><tr><td>prometheus_sd_consul_rpc_duration_seconds</td><td>summary</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>call</code>, <code>quantile</code></td><td>The duration of a Consul RPC call in seconds.</td></tr><tr><td>prometheus_sd_consul_rpc_duration_seconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>call</code></td><td>N/A</td></tr><tr><td>prometheus_sd_consul_rpc_duration_seconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>call</code></td><td>N/A</td></tr><tr><td>prometheus_sd_consul_rpc_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Consul RPC call failures.</td></tr><tr><td>prometheus_sd_discovered_targets</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>config</code>, <code>job</code>, <code>cls</code></td><td>Current number of discovered targets.</td></tr><tr><td>prometheus_sd_dns_lookup_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of DNS-SD lookup failures.</td></tr><tr><td>prometheus_sd_dns_lookups_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of DNS-SD lookups.</td></tr><tr><td>prometheus_sd_failed_configs</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of service discovery configurations that failed to load.</td></tr><tr><td>prometheus_sd_file_mtime_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>filename</code>, <code>job</code>, <code>cls</code></td><td>Timestamp (mtime) of files read by FileSD. Timestamp is set at read time.</td></tr><tr><td>prometheus_sd_file_read_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of File-SD read errors.</td></tr><tr><td>prometheus_sd_file_scan_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of the File-SD scan in seconds.</td></tr><tr><td>prometheus_sd_file_scan_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_file_scan_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_file_watcher_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of File-SD errors caused by filesystem watch failures.</td></tr><tr><td>prometheus_sd_http_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of HTTP service discovery refresh failures.</td></tr><tr><td>prometheus_sd_kubernetes_events_total</td><td>counter</td><td><code>event</code>, <code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Kubernetes events handled.</td></tr><tr><td>prometheus_sd_kuma_fetch_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of a Kuma MADS fetch call.</td></tr><tr><td>prometheus_sd_kuma_fetch_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_kuma_fetch_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_kuma_fetch_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Kuma MADS fetch call failures.</td></tr><tr><td>prometheus_sd_kuma_fetch_skipped_updates_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Kuma MADS fetch calls that result in no updates to the targets.</td></tr><tr><td>prometheus_sd_linode_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of Linode service discovery refresh failures.</td></tr><tr><td>prometheus_sd_nomad_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of nomad service discovery refresh failures.</td></tr><tr><td>prometheus_sd_received_updates_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of update events received from the SD providers.</td></tr><tr><td>prometheus_sd_updates_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of update events sent to the SD consumers.</td></tr><tr><td>prometheus_target_interval_length_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>interval</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Actual intervals between scrapes.</td></tr><tr><td>prometheus_target_interval_length_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>interval</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_target_interval_length_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>interval</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_target_metadata_cache_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>The number of bytes that are currently used for storing metric metadata in the cache</td></tr><tr><td>prometheus_target_metadata_cache_entries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Total number of metric metadata entries in the cache</td></tr><tr><td>prometheus_target_scrape_pool_exceeded_label_limits_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times scrape pools hit the label limits, during sync or config reload.</td></tr><tr><td>prometheus_target_scrape_pool_exceeded_target_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times scrape pools hit the target limit, during sync or config reload.</td></tr><tr><td>prometheus_target_scrape_pool_reloads_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of failed scrape pool reloads.</td></tr><tr><td>prometheus_target_scrape_pool_reloads_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrape pool reloads.</td></tr><tr><td>prometheus_target_scrape_pool_sync_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Total number of syncs that were executed on a scrape pool.</td></tr><tr><td>prometheus_target_scrape_pool_target_limit</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of targets allowed in this scrape pool.</td></tr><tr><td>prometheus_target_scrape_pool_targets</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Current number of targets in this scrape pool.</td></tr><tr><td>prometheus_target_scrape_pools_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrape pool creations that failed.</td></tr><tr><td>prometheus_target_scrape_pools_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrape pool creation attempts.</td></tr><tr><td>prometheus_target_scrapes_cache_flush_forced_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many times a scrape cache was flushed due to getting big while scrapes are failing.</td></tr><tr><td>prometheus_target_scrapes_exceeded_body_size_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrapes that hit the body size limit</td></tr><tr><td>prometheus_target_scrapes_exceeded_native_histogram_bucket_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrapes that hit the native histogram bucket limit and were rejected.</td></tr><tr><td>prometheus_target_scrapes_exceeded_sample_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrapes that hit the sample limit and were rejected.</td></tr><tr><td>prometheus_target_scrapes_exemplar_out_of_order_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of exemplar rejected due to not being out of the expected order.</td></tr><tr><td>prometheus_target_scrapes_sample_duplicate_timestamp_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of samples rejected due to duplicate timestamps but different values.</td></tr><tr><td>prometheus_target_scrapes_sample_out_of_bounds_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of samples rejected due to timestamp falling outside of the time bounds.</td></tr><tr><td>prometheus_target_scrapes_sample_out_of_order_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of samples rejected due to not being out of the expected order.</td></tr><tr><td>prometheus_target_sync_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Total number of target sync failures.</td></tr><tr><td>prometheus_target_sync_length_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Actual interval to sync the scrape pool.</td></tr><tr><td>prometheus_target_sync_length_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_target_sync_length_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_template_text_expansion_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of template text expansion failures.</td></tr><tr><td>prometheus_template_text_expansions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of template text expansions.</td></tr><tr><td>prometheus_treecache_watcher_goroutines</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of watcher goroutines.</td></tr><tr><td>prometheus_treecache_zookeeper_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of ZooKeeper failures.</td></tr><tr><td>prometheus_tsdb_blocks_loaded</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of currently loaded data blocks</td></tr><tr><td>prometheus_tsdb_checkpoint_creations_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint creations that failed.</td></tr><tr><td>prometheus_tsdb_checkpoint_creations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint creations attempted.</td></tr><tr><td>prometheus_tsdb_checkpoint_deletions_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint deletions that failed.</td></tr><tr><td>prometheus_tsdb_checkpoint_deletions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint deletions attempted.</td></tr><tr><td>prometheus_tsdb_clean_start</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>-1: lockfile is disabled. 0: a lockfile from a previous execution was replaced. 1: lockfile creation was clean</td></tr><tr><td>prometheus_tsdb_compaction_chunk_range_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_range_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_range_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_samples_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_samples_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_samples_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_populating_block</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Set to 1 when a block is currently being written to the disk.</td></tr><tr><td>prometheus_tsdb_compactions_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of compactions that failed for the partition.</td></tr><tr><td>prometheus_tsdb_compactions_skipped_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of skipped compactions due to disabled auto compaction.</td></tr><tr><td>prometheus_tsdb_compactions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of compactions that were executed for the partition.</td></tr><tr><td>prometheus_tsdb_compactions_triggered_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of triggered compactions for the partition.</td></tr><tr><td>prometheus_tsdb_data_replay_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Time taken to replay the data on disk.</td></tr><tr><td>prometheus_tsdb_exemplar_exemplars_appended_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of appended exemplars.</td></tr><tr><td>prometheus_tsdb_exemplar_exemplars_in_storage</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of exemplars currently in circular storage.</td></tr><tr><td>prometheus_tsdb_exemplar_last_exemplars_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The timestamp of the oldest exemplar stored in circular storage. Useful to check for what timerange the current exemplar buffer limit allows. This usually means the last timestampfor all exemplars for a typical setup. This is not true though if one of the series timestamp is in future compared to rest series.</td></tr><tr><td>prometheus_tsdb_exemplar_max_exemplars</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of exemplars the exemplar storage can store, resizeable.</td></tr><tr><td>prometheus_tsdb_exemplar_out_of_order_exemplars_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of order exemplar ingestion failed attempts.</td></tr><tr><td>prometheus_tsdb_exemplar_series_with_exemplars_in_storage</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of series with exemplars currently in circular storage.</td></tr><tr><td>prometheus_tsdb_head_active_appenders</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of currently active appender transactions</td></tr><tr><td>prometheus_tsdb_head_chunks</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks in the head block.</td></tr><tr><td>prometheus_tsdb_head_chunks_created_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks created in the head</td></tr><tr><td>prometheus_tsdb_head_chunks_removed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks removed in the head</td></tr><tr><td>prometheus_tsdb_head_chunks_storage_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the chunks_head directory.</td></tr><tr><td>prometheus_tsdb_head_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_head_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_head_max_time</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum timestamp of the head block. The unit is decided by the library consumer.</td></tr><tr><td>prometheus_tsdb_head_max_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum timestamp of the head block.</td></tr><tr><td>prometheus_tsdb_head_min_time</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Minimum time bound of the head block. The unit is decided by the library consumer.</td></tr><tr><td>prometheus_tsdb_head_min_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Minimum time bound of the head block.</td></tr><tr><td>prometheus_tsdb_head_out_of_order_samples_appended_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of appended out of order samples.</td></tr><tr><td>prometheus_tsdb_head_samples_appended_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of appended samples.</td></tr><tr><td>prometheus_tsdb_head_series</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of series in the head block.</td></tr><tr><td>prometheus_tsdb_head_series_created_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of series created in the head</td></tr><tr><td>prometheus_tsdb_head_series_not_found_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of requests for series that were not found.</td></tr><tr><td>prometheus_tsdb_head_series_removed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of series removed in the head</td></tr><tr><td>prometheus_tsdb_head_truncations_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of head truncations that failed.</td></tr><tr><td>prometheus_tsdb_head_truncations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of head truncations attempted.</td></tr><tr><td>prometheus_tsdb_isolation_high_watermark</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The highest TSDB append ID that has been given out.</td></tr><tr><td>prometheus_tsdb_isolation_low_watermark</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The lowest TSDB append ID that is still referenced.</td></tr><tr><td>prometheus_tsdb_lowest_timestamp</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Lowest timestamp value stored in the database. The unit is decided by the library consumer.</td></tr><tr><td>prometheus_tsdb_lowest_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Lowest timestamp value stored in the database.</td></tr><tr><td>prometheus_tsdb_mmap_chunk_corruptions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of memory-mapped chunk corruptions.</td></tr><tr><td>prometheus_tsdb_mmap_chunks_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks that were memory-mapped.</td></tr><tr><td>prometheus_tsdb_out_of_bound_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of bound samples ingestion failed attempts with out of order support disabled.</td></tr><tr><td>prometheus_tsdb_out_of_order_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of order samples ingestion failed attempts due to out of order being disabled.</td></tr><tr><td>prometheus_tsdb_reloads_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of times the database failed to reloadBlocks block data from disk.</td></tr><tr><td>prometheus_tsdb_reloads_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of times the database reloaded block data from disk.</td></tr><tr><td>prometheus_tsdb_retention_limit_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Max number of bytes to be retained in the tsdb blocks, configured 0 means disabled</td></tr><tr><td>prometheus_tsdb_retention_limit_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How long to retain samples in storage.</td></tr><tr><td>prometheus_tsdb_size_retentions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of times that blocks were deleted because the maximum number of bytes was exceeded.</td></tr><tr><td>prometheus_tsdb_snapshot_replay_error_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number snapshot replays that failed.</td></tr><tr><td>prometheus_tsdb_storage_blocks_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of bytes that are currently used for local storage by all blocks.</td></tr><tr><td>prometheus_tsdb_symbol_table_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of symbol table in memory for loaded blocks</td></tr><tr><td>prometheus_tsdb_time_retentions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of times that blocks were deleted because the maximum time limit was exceeded.</td></tr><tr><td>prometheus_tsdb_tombstone_cleanup_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_tombstone_cleanup_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_tombstone_cleanup_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_too_old_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of order samples ingestion failed attempts with out of support enabled, but sample outside of time window.</td></tr><tr><td>prometheus_tsdb_vertical_compactions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of compactions done on overlapping blocks.</td></tr><tr><td>prometheus_tsdb_wal_completed_pages_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of completed pages.</td></tr><tr><td>prometheus_tsdb_wal_corruptions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of WAL corruptions.</td></tr><tr><td>prometheus_tsdb_wal_fsync_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Duration of write log fsync.</td></tr><tr><td>prometheus_tsdb_wal_fsync_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_fsync_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_page_flushes_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of page flushes.</td></tr><tr><td>prometheus_tsdb_wal_segment_current</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Write log segment index that TSDB is currently writing to.</td></tr><tr><td>prometheus_tsdb_wal_storage_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the write log directory.</td></tr><tr><td>prometheus_tsdb_wal_truncate_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_truncate_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_truncations_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of write log truncations that failed.</td></tr><tr><td>prometheus_tsdb_wal_truncations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of write log truncations attempted.</td></tr><tr><td>prometheus_tsdb_wal_writes_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of write log writes that failed.</td></tr><tr><td>prometheus_web_federation_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of errors that occurred while sending federation responses.</td></tr><tr><td>prometheus_web_federation_warnings_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of warnings that occurred while sending federation responses.</td></tr><tr><td>promhttp_metric_handler_requests_in_flight</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of scrapes being served.</td></tr><tr><td>promhttp_metric_handler_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>Total number of scrapes by HTTP status code.</td></tr><tr><td>pushgateway_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which pushgateway was built, and the goos and goarch for the build.</td></tr><tr><td>pushgateway_http_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code>, <code>handler</code></td><td>Total HTTP requests processed by the Pushgateway, excluding scrapes.</td></tr><tr><td>querier_cache_added_new_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_added_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_entries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>The total number of entries</td></tr><tr><td>querier_cache_evicted_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>reason</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_gets_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>The current cache size in bytes</td></tr><tr><td>querier_cache_misses_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_stale_gets_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>ring_member_heartbeats_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>ring_member_tokens_owned</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens owned in the ring.</td></tr><tr><td>ring_member_tokens_to_own</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens to own in the ring.</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr></tbody></table><hr><h2 id=ping-metrics>PING Metrics</h2><p><strong><code>PING</code></strong> job has 54 metrics, provided by <code>blackbox_exporter</code>.</p><table><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>agent_up</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>probe_dns_lookup_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Returns the time taken for probe dns lookup in seconds</td></tr><tr><td>probe_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Returns how long the probe took to complete in seconds</td></tr><tr><td>probe_icmp_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>phase</code>, <code>instance</code>, <code>cls</code></td><td>Duration of icmp request by phase</td></tr><tr><td>probe_icmp_reply_hop_limit</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Replied packet hop limit (TTL for ipv4)</td></tr><tr><td>probe_ip_addr_hash</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Specifies the hash of IP address. It&rsquo;s useful to detect if the IP address changes.</td></tr><tr><td>probe_ip_protocol</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Specifies whether probe ip protocol is IP4 or IP6</td></tr><tr><td>probe_success</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Displays whether or not the probe was a success</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr></tbody></table><hr><h2 id=push-metrics>PUSH Metrics</h2><p>PushGateway provides 44 metrics.</p><table><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>agent_up</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds</td><td>summary</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>quantile</code>, <code>ip</code></td><td>A summary of the pause duration of garbage collection cycles.</td></tr><tr><td>go_gc_duration_seconds_count</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds_sum</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>go_goroutines</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of goroutines that currently exist.</td></tr><tr><td>go_info</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code>, <code>version</code></td><td>Information about the Go environment.</td></tr><tr><td>go_memstats_alloc_bytes</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_alloc_bytes_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_buck_hash_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used by the profiling bucket hash table.</td></tr><tr><td>go_memstats_frees_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of frees.</td></tr><tr><td>go_memstats_gc_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for garbage collection system metadata.</td></tr><tr><td>go_memstats_heap_alloc_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes allocated and still in use.</td></tr><tr><td>go_memstats_heap_idle_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes waiting to be used.</td></tr><tr><td>go_memstats_heap_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes that are in use.</td></tr><tr><td>go_memstats_heap_objects</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of allocated objects.</td></tr><tr><td>go_memstats_heap_released_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes released to OS.</td></tr><tr><td>go_memstats_heap_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes obtained from system.</td></tr><tr><td>go_memstats_last_gc_time_seconds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of seconds since 1970 of last garbage collection.</td></tr><tr><td>go_memstats_lookups_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of pointer lookups.</td></tr><tr><td>go_memstats_mallocs_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of mallocs.</td></tr><tr><td>go_memstats_mcache_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes in use by mcache structures.</td></tr><tr><td>go_memstats_mcache_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for mcache structures obtained from system.</td></tr><tr><td>go_memstats_mspan_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes in use by mspan structures.</td></tr><tr><td>go_memstats_mspan_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for mspan structures obtained from system.</td></tr><tr><td>go_memstats_next_gc_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes when next garbage collection will take place.</td></tr><tr><td>go_memstats_other_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for other system allocations.</td></tr><tr><td>go_memstats_stack_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes in use by the stack allocator.</td></tr><tr><td>go_memstats_stack_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes obtained from system for stack allocator.</td></tr><tr><td>go_memstats_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes obtained from system.</td></tr><tr><td>go_threads</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of OS threads created.</td></tr><tr><td>process_cpu_seconds_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total user and system CPU time spent in seconds.</td></tr><tr><td>process_max_fds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>process_open_fds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of open file descriptors.</td></tr><tr><td>process_resident_memory_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Resident memory size in bytes.</td></tr><tr><td>process_start_time_seconds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>process_virtual_memory_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>process_virtual_memory_max_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>pushgateway_build_info</td><td>gauge</td><td><code>job</code>, <code>goversion</code>, <code>cls</code>, <code>branch</code>, <code>instance</code>, <code>tags</code>, <code>revision</code>, <code>goarch</code>, <code>ins</code>, <code>ip</code>, <code>version</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which pushgateway was built, and the goos and goarch for the build.</td></tr><tr><td>pushgateway_http_requests_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>method</code>, <code>code</code>, <code>handler</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total HTTP requests processed by the Pushgateway, excluding scrapes.</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-00fcc0891b8e51b39a5b93b6e89a421f>6 - FAQ</h1><div class=lead>Frequently asked questions about the Pigsty INFRA infrastructure module</div><hr><h2 id=what-components-are-included-in-the-infra-module>What components are included in the INFRA module?</h2><ul><li><strong>Ansible</strong>: Used for automation configuration, deployment, and daily operations.</li><li><strong>Nginx</strong>: Exposes WebUIs like Grafana, VictoriaMetrics (VMUI), Alertmanager, and hosts local YUM/APT repositories.</li><li><strong>Self-signed CA</strong>: Issues SSL/TLS certificates for components like Nginx, Patroni, pgBackRest.</li><li><strong>VictoriaMetrics Suite</strong>: Replaces Prometheus/Loki, including VictoriaMetrics (TSDB), VMAlert (alert evaluation), VictoriaLogs (centralized logs), VictoriaTraces (tracing).</li><li><strong>Vector</strong>: Node-side log collector, pushes system/database logs to VictoriaLogs.</li><li><strong>AlertManager</strong>: Aggregates and dispatches alert notifications.</li><li><strong>Grafana</strong>: Monitoring/visualization platform with numerous preconfigured dashboards and datasources.</li><li><strong>Chronyd</strong>: Provides NTP time synchronization.</li><li><strong>DNSMasq</strong>: Provides DNS registration and resolution.</li><li><strong>ETCD</strong>: Acts as PostgreSQL HA DCS (can also be deployed on dedicated cluster).</li><li><strong>PostgreSQL</strong>: Acts as CMDB on the admin node (optional).</li><li><strong>Docker</strong>: Runs stateless tools or applications on nodes (optional).</li></ul><hr><h2 id=how-to-re-register-monitoring-targets-to-victoriametrics>How to re-register monitoring targets to VictoriaMetrics?</h2><p>VictoriaMetrics uses static service discovery through the <code>/infra/targets/&lt;job>/*.yml</code> directory. If target files are accidentally deleted, use the following commands to re-register:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml  -t infra_register   <span style=color:#8f5902;font-style:italic># Re-render infra self-monitoring targets</span>
</span></span><span style=display:flex><span>./node.yml   -t node_register    <span style=color:#8f5902;font-style:italic># Re-render node / HAProxy / Vector targets</span>
</span></span><span style=display:flex><span>./etcd.yml   -t etcd_register    <span style=color:#8f5902;font-style:italic># Re-render etcd targets</span>
</span></span><span style=display:flex><span>./minio.yml  -t minio_register   <span style=color:#8f5902;font-style:italic># Re-render MinIO targets</span>
</span></span><span style=display:flex><span>./pgsql.yml  -t pg_register      <span style=color:#8f5902;font-style:italic># Re-render PGSQL/Patroni targets</span>
</span></span><span style=display:flex><span>./redis.yml  -t redis_register   <span style=color:#8f5902;font-style:italic># Re-render Redis targets</span>
</span></span></code></pre></div><p>Other modules (like <code>pg_monitor.yml</code>, <code>mongo.yml</code>, <code>mysql.yml</code>) also provide corresponding <code>*_register</code> tags that can be executed as needed.</p><hr><h2 id=how-to-re-register-postgresql-datasources-to-grafana>How to re-register PostgreSQL datasources to Grafana?</h2><p>PGSQL databases defined in <a href=/docs/pgsql/param#pg_databases><code>pg_databases</code></a> are registered as Grafana datasources by default (for use by PGCAT applications).</p><p>If you accidentally delete postgres datasources registered in Grafana, you can register them again using the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Register all pgsql databases (defined in pg_databases) as grafana datasources</span>
</span></span><span style=display:flex><span>./pgsql.yml -t register_grafana
</span></span></code></pre></div><hr><h2 id=how-to-re-register-node-haproxy-admin-pages-to-nginx>How to re-register node HAProxy admin pages to Nginx?</h2><p>If you accidentally delete the registered haproxy proxy settings in <code>/etc/nginx/conf.d/haproxy</code>, you can restore them using the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -t register_nginx     <span style=color:#8f5902;font-style:italic># Register all haproxy admin page proxy settings to nginx on infra nodes</span>
</span></span></code></pre></div><hr><h2 id=how-to-restore-dns-registration-records-in-dnsmasq>How to restore DNS registration records in DNSMASQ?</h2><p>PGSQL cluster/instance domains are registered by default to <code>/etc/hosts.d/&lt;name></code> on infra nodes. You can restore them using the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -t pg_dns    <span style=color:#8f5902;font-style:italic># Register pg DNS names to dnsmasq on infra nodes</span>
</span></span></code></pre></div><hr><h2 id=how-to-expose-new-upstream-services-via-nginx>How to expose new upstream services via Nginx?</h2><p>Although you can access services directly via IP:Port, we still recommend consolidating access entry points by using domain names and accessing various WebUI services through Nginx proxy.
This helps consolidate access, reduce exposed ports, and facilitate access control and auditing.</p><p>If you want to expose new WebUI services through the Nginx portal, you can add service definitions to the <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> parameter.
For example, here&rsquo;s the Infra portal configuration used by Pigsty&rsquo;s official demo, exposing several additional services:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>home.pigsty.cc }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: demo.pigsty.io ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>prometheus   </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmalert      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8880&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Additional web portals</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: sss.pigsty  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>postgrest    </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: api.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8884&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgadmin      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgweb        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: cli.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8886&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bytebase     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: ddl.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8887&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>gitea        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: git.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8889&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>wiki         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: wiki.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9002&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>noco         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: noco.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9003&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>supa         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>After completing the Nginx upstream service definition, use the following configuration and commands to register new services to Nginx.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_config           <span style=color:#8f5902;font-style:italic># Regenerate Nginx configuration files</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_launch           <span style=color:#8f5902;font-style:italic># Update and apply Nginx configuration</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># You can also manually reload Nginx config with Ansible</span>
</span></span><span style=display:flex><span>ansible infra -b -a <span style=color:#4e9a06>&#39;nginx -s reload&#39;</span>  <span style=color:#8f5902;font-style:italic># Reload Nginx config</span>
</span></span></code></pre></div><p>If you want HTTPS access, you must delete <code>files/pki/csr/pigsty.csr</code> and <code>files/pki/nginx/pigsty.{key,crt}</code> to force regeneration of Nginx SSL/TLS certificates to include new upstream domains.
If you want to use certificates issued by an authoritative CA instead of Pigsty self-signed CA certificates, you can place them in the <code>/etc/nginx/conf.d/cert/</code> directory and modify the corresponding configuration: <code>/etc/nginx/conf.d/&lt;name>.conf</code>.</p><hr><h2 id=how-to-manually-add-upstream-repo-files-to-nodes>How to manually add upstream repo files to nodes?</h2><p>Pigsty has a built-in wrapper script <code>bin/repo-add</code> that calls the ansible playbook <code>node.yml</code> to add repo files to corresponding nodes.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/repo-add &lt;selector&gt; <span style=color:#ce5c00;font-weight:700>[</span>modules<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>bin/repo-add 10.10.10.10           <span style=color:#8f5902;font-style:italic># Add node repo for node 10.10.10.10</span>
</span></span><span style=display:flex><span>bin/repo-add infra   node,infra    <span style=color:#8f5902;font-style:italic># Add node and infra repos for infra group</span>
</span></span><span style=display:flex><span>bin/repo-add infra   node,local    <span style=color:#8f5902;font-style:italic># Add node repo and local pigsty repo for infra group</span>
</span></span><span style=display:flex><span>bin/repo-add pg-test node,pgsql    <span style=color:#8f5902;font-style:italic># Add node and pgsql repos for pg-test group</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-534bd7b2a1b7fa250e24342de3f0e5b1>7 - Administration</h1><div class=lead>Infrastructure components and INFRA cluster administration SOP: create, destroy, scale out, scale in, certificates, repositories&mldr;</div><p>This section covers daily administration and operations for Pigsty deployments.</p><hr><h2 id=create-infra-module>Create INFRA Module</h2><p>Use <a href=/docs/infra/playbook#infrayml><code>infra.yml</code></a> playbook to install INFRA module on <code>infra</code> group:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml     <span style=color:#8f5902;font-style:italic># Install INFRA module on infra group</span>
</span></span></code></pre></div><hr><h2 id=uninstall-infra-module>Uninstall INFRA Module</h2><p>Use dedicated <a href=/docs/infra/playbook#infra-rmyml><code>infra-rm.yml</code></a> playbook to remove INFRA module from <code>infra</code> group:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra-rm.yml  <span style=color:#8f5902;font-style:italic># Remove INFRA module from infra group</span>
</span></span></code></pre></div><hr><h2 id=manage-local-repository>Manage Local Repository</h2><p>Pigsty includes local yum/apt repo for software packages. Manage repo configuration:</p><h3 id=repo-variables>Repo Variables</h3><table><thead><tr><th style=text-align:left>Variable</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>repo_enabled</code></td><td>Enable local repo on node</td></tr><tr><td style=text-align:left><code>repo_upstream</code></td><td>Upstream repos to include</td></tr><tr><td style=text-align:left><code>repo_remove</code></td><td>Remove upstream repos if true</td></tr><tr><td style=text-align:left><code>repo_url_pkg</code></td><td>Extra packages to download</td></tr><tr><td style=text-align:left><code>repo_clean</code></td><td>Clean repo cache (makecache)</td></tr><tr><td style=text-align:left><code>repo_pkg</code></td><td>Packages to include</td></tr></tbody></table><h3 id=repo-tasks>Repo Tasks</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo              <span style=color:#8f5902;font-style:italic># Create or update repo</span>
</span></span></code></pre></div><p>Repo location: <code>/www/pigsty</code> served by Nginx.</p><p>More: <a href=/docs/infra/param#repo>Configuration: INFRA - REPO</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-fba20550b8388331ec7938e5fd572d46>7.1 - Ansible</h1><div class=lead>Using Ansible to run administration commands</div><p>Ansible is installed by default on all INFRA nodes and can be used to manage the entire deployment.</p><p>Pigsty implements automation based on <strong>Ansible</strong>, following the <strong>Infrastructure-as-Code</strong> philosophy.</p><p>Ansible knowledge is useful for managing databases and infrastructure, but <strong>not required</strong>. You only need to know how to execute <strong>Playbooks</strong> - YAML files that define a series of automated tasks.</p><hr><h2 id=installation>Installation</h2><p>Pigsty automatically installs <code>ansible</code> and its dependencies during the <a href=/docs/setup/install#bootstrap>bootstrap process</a>.
For manual installation, use the following commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Debian / Ubuntu</span>
</span></span><span style=display:flex><span>sudo apt install -y ansible python3-jmespath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 10</span>
</span></span><span style=display:flex><span>sudo dnf install -y ansible python-jmespath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 8/9</span>
</span></span><span style=display:flex><span>sudo dnf install -y ansible python3.12-jmespath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 7</span>
</span></span><span style=display:flex><span>sudo yum install -y ansible python-jmespath
</span></span></code></pre></div><h3 id=macos>macOS</h3><p>macOS users can install using <a href=https://brew.sh/>Homebrew</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install ansible
</span></span><span style=display:flex><span>pip3 install jmespath
</span></span></code></pre></div><hr><h2 id=basic-usage>Basic Usage</h2><p>To run a playbook, simply execute <code>./path/to/playbook.yml</code>. Here are the most commonly used Ansible command-line parameters:</p><table><thead><tr><th>Purpose</th><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><strong>Where</strong></td><td><code>-l</code> / <code>--limit &lt;pattern></code></td><td>Limit target hosts/groups/patterns</td></tr><tr><td><strong>What</strong></td><td><code>-t</code> / <code>--tags &lt;tags></code></td><td>Only run tasks with specified tags</td></tr><tr><td><strong>How</strong></td><td><code>-e</code> / <code>--extra-vars &lt;vars></code></td><td>Pass extra command-line variables</td></tr><tr><td><strong>Config</strong></td><td><code>-i</code> / <code>--inventory &lt;path></code></td><td>Specify inventory file path</td></tr></tbody></table><hr><h2 id=limiting-hosts>Limiting Hosts</h2><p>Use <code>-l|--limit &lt;pattern></code> to limit execution to specific groups, hosts, or patterns:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml                      <span style=color:#8f5902;font-style:italic># Execute on all nodes</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-test          <span style=color:#8f5902;font-style:italic># Only execute on pg-test cluster</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-*             <span style=color:#8f5902;font-style:italic># Execute on all clusters starting with pg-</span>
</span></span><span style=display:flex><span>./pgsql.yml -l 10.10.10.10      <span style=color:#8f5902;font-style:italic># Only execute on specific IP host</span>
</span></span></code></pre></div><blockquote><p>Running playbooks without host limits <strong>can be very dangerous</strong>! By default, most playbooks execute on <strong>all</strong> hosts. <strong>Use with caution!</strong></p></blockquote><hr><h2 id=limiting-tasks>Limiting Tasks</h2><p>Use <code>-t|--tags &lt;tags></code> to only execute task subsets with specified tags:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo           <span style=color:#8f5902;font-style:italic># Only execute tasks to create local repo</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream  <span style=color:#8f5902;font-style:italic># Only execute tasks to add upstream repos</span>
</span></span><span style=display:flex><span>./node.yml -t node_pkg        <span style=color:#8f5902;font-style:italic># Only execute tasks to install node packages</span>
</span></span><span style=display:flex><span>./pgsql.yml -t pg_hba         <span style=color:#8f5902;font-style:italic># Only execute tasks to render pg_hba.conf</span>
</span></span></code></pre></div><hr><h2 id=passing-variables>Passing Variables</h2><p>Use <code>-e|--extra-vars &lt;key=value></code> to override variables at runtime:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -e <span style=color:#000>pg_clean</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>         <span style=color:#8f5902;font-style:italic># Force clean existing PG instances</span>
</span></span><span style=display:flex><span>./pgsql-rm.yml -e <span style=color:#000>pg_rm_pkg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>    <span style=color:#8f5902;font-style:italic># Keep packages when uninstalling</span>
</span></span><span style=display:flex><span>./node.yml -e <span style=color:#4e9a06>&#39;{&#34;node_tune&#34;:&#34;tiny&#34;}&#39;</span> <span style=color:#8f5902;font-style:italic># Pass variables in JSON format</span>
</span></span><span style=display:flex><span>./pgsql.yml -e @/path/to/config.yml  <span style=color:#8f5902;font-style:italic># Load variables from YAML file</span>
</span></span></code></pre></div><hr><h2 id=specifying-inventory>Specifying Inventory</h2><p>By default, Ansible uses <code>pigsty.yml</code> in the current directory as the inventory.
Use <code>-i|--inventory &lt;path></code> to specify a different config file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -i files/pigsty/full.yml -l pg-test
</span></span></code></pre></div><blockquote><p>[!NOTE]</p><p>To permanently change the default config file path, modify the <code>inventory</code> parameter in <code>ansible.cfg</code>.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-f258509d1b17d59a0332114b15cb35b7>7.2 - Playbooks</h1><div class=lead>Built-in Ansible playbooks in Pigsty</div><p>Pigsty uses <strong>idempotent</strong> Ansible playbooks for management and control. Running playbooks requires <code>ansible-playbook</code> to be in the system PATH; users must first <a href=./ansible/#installation>install Ansible</a> before executing playbooks.</p><h2 id=available-playbooks>Available Playbooks</h2><table><thead><tr><th>Module</th><th>Playbook</th><th>Purpose</th></tr></thead><tbody><tr><td>INFRA</td><td><code>deploy.yml</code></td><td>One-click Pigsty installation</td></tr><tr><td>INFRA</td><td><code>infra.yml</code></td><td>Initialize Pigsty infrastructure on infra nodes</td></tr><tr><td>INFRA</td><td><code>infra-rm.yml</code></td><td>Remove infrastructure components from infra nodes</td></tr><tr><td>INFRA</td><td><code>cache.yml</code></td><td>Create offline installation packages from target nodes</td></tr><tr><td>INFRA</td><td><code>cert.yml</code></td><td>Issue certificates using Pigsty self-signed CA</td></tr><tr><td>NODE</td><td><code>node.yml</code></td><td>Initialize nodes, configure to desired state</td></tr><tr><td>NODE</td><td><code>node-rm.yml</code></td><td>Remove nodes from Pigsty</td></tr><tr><td>PGSQL</td><td><code>pgsql.yml</code></td><td>Initialize HA PostgreSQL cluster, or add new replica</td></tr><tr><td>PGSQL</td><td><code>pgsql-rm.yml</code></td><td>Remove PostgreSQL cluster, or remove replica</td></tr><tr><td>PGSQL</td><td><code>pgsql-db.yml</code></td><td>Add new business database to existing cluster</td></tr><tr><td>PGSQL</td><td><code>pgsql-user.yml</code></td><td>Add new business user to existing cluster</td></tr><tr><td>PGSQL</td><td><code>pgsql-pitr.yml</code></td><td>Perform point-in-time recovery (PITR) on cluster</td></tr><tr><td>PGSQL</td><td><code>pgsql-monitor.yml</code></td><td>Monitor remote PostgreSQL using local exporters</td></tr><tr><td>PGSQL</td><td><code>pgsql-migration.yml</code></td><td>Generate migration manual and scripts for PostgreSQL</td></tr><tr><td>PGSQL</td><td><code>slim.yml</code></td><td>Install Pigsty with minimal components</td></tr><tr><td>REDIS</td><td><code>redis.yml</code></td><td>Initialize Redis cluster/node/instance</td></tr><tr><td>REDIS</td><td><code>redis-rm.yml</code></td><td>Remove Redis cluster/node/instance</td></tr><tr><td>ETCD</td><td><code>etcd.yml</code></td><td>Initialize ETCD cluster, or add new member</td></tr><tr><td>ETCD</td><td><code>etcd-rm.yml</code></td><td>Remove ETCD cluster, or remove existing member</td></tr><tr><td>MINIO</td><td><code>minio.yml</code></td><td>Initialize MinIO cluster</td></tr><tr><td>MINIO</td><td><code>minio-rm.yml</code></td><td>Remove MinIO cluster</td></tr><tr><td>DOCKER</td><td><code>docker.yml</code></td><td>Install Docker on nodes</td></tr><tr><td>DOCKER</td><td><code>app.yml</code></td><td>Install applications using Docker Compose</td></tr><tr><td>FERRET</td><td><code>mongo.yml</code></td><td>Install Mongo/FerretDB on nodes</td></tr></tbody></table><hr><h2 id=deployment-strategy>Deployment Strategy</h2><p>The <code>deploy.yml</code> playbook orchestrates specialized playbooks in the following group order for complete deployment:</p><ul><li><strong>infra</strong>: <code>infra.yml</code> (-l infra)</li><li><strong>nodes</strong>: <code>node.yml</code></li><li><strong>etcd</strong>: <code>etcd.yml</code> (-l etcd)</li><li><strong>minio</strong>: <code>minio.yml</code> (-l minio)</li><li><strong>pgsql</strong>: <code>pgsql.yml</code></li></ul><blockquote><p><strong>Circular Dependency Note</strong>: There is a weak circular dependency between NODE and INFRA: to register NODE to INFRA, INFRA must already exist; while INFRA module depends on NODE to work.
The solution is to initialize <code>infra</code> nodes first, then add other nodes. To complete all deployment at once, use <code>deploy.yml</code>.</p></blockquote><hr><h2 id=safety-notes>Safety Notes</h2><blockquote><p>Most playbooks are <strong>idempotent</strong>, which means some deployment playbooks <strong>may wipe existing databases and create new ones</strong> when protection options are not enabled.
Use extra caution with <code>pgsql</code>, <code>minio</code>, and <code>infra</code> playbooks. Read the documentation carefully and proceed with caution.</p></blockquote><h3 id=best-practices>Best Practices</h3><ol><li><strong>Read playbook documentation carefully</strong> before execution</li><li><strong>Press Ctrl-C immediately to stop</strong> when anomalies occur</li><li><strong>Test in non-production environments</strong> first</li><li>Use <code>-l</code> parameter to <strong>limit target hosts</strong>, avoiding unintended hosts</li><li>Use <code>-t</code> parameter to <strong>specify tags</strong>, executing only specific tasks</li></ol><hr><h2 id=dry-run-mode>Dry-Run Mode</h2><p>Use <code>--check --diff</code> options to preview changes without actually executing:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Preview changes without execution</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-test --check --diff
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check specific tasks with tags</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-test -t pg_config --check --diff
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-52d708085244eb9d51e81dd9e7c10996>7.3 - Nginx Management</h1><div class=lead>Nginx management, web portal configuration, web server, upstream services</div><p>Pigsty installs Nginx on INFRA nodes as the entry point for all web services, listening on standard ports 80/443.</p><p>In Pigsty, you can configure Nginx to provide various services through inventory:</p><ul><li>Expose web interfaces for monitoring components like Grafana, VictoriaMetrics (VMUI), Alertmanager, and VictoriaLogs</li><li>Serve static files (software repos, documentation sites, websites, etc.)</li><li>Proxy custom application services (internal apps, database management UIs, Docker application interfaces, etc.)</li><li>Automatically issue self-signed HTTPS certificates, or use Certbot to obtain free Let&rsquo;s Encrypt certificates</li><li>Expose services through a single port using different subdomains for unified access</li></ul><hr><h2 id=basic-configuration>Basic Configuration</h2><p>Customize Nginx behavior via <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> parameter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>infra_portal</code> is a dictionary where each key defines a service and the value is the service configuration.
Only services with a <code>domain</code> defined will generate corresponding Nginx config files.</p><ul><li><strong><code>home</code></strong>: Special default server for homepage and built-in monitoring component reverse proxies</li><li><strong>Proxy services</strong>: Specify upstream service address via <code>endpoint</code> for reverse proxy</li><li><strong>Static services</strong>: Specify local directory via <code>path</code> for static file serving</li></ul><hr><h2 id=server-parameters>Server Parameters</h2><h3 id=basic-parameters>Basic Parameters</h3><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><code>domain</code></td><td>Optional proxy domain</td></tr><tr><td><code>endpoint</code></td><td>Upstream service address (IP:PORT or socket)</td></tr><tr><td><code>path</code></td><td>Local directory for static content</td></tr><tr><td><code>scheme</code></td><td>Protocol type (http/https), default http</td></tr><tr><td><code>domains</code></td><td>Additional domain list (aliases)</td></tr></tbody></table><h3 id=ssltls-options>SSL/TLS Options</h3><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><code>certbot</code></td><td>Enable Let&rsquo;s Encrypt cert management, value is cert name</td></tr><tr><td><code>cert</code></td><td>Custom certificate file path</td></tr><tr><td><code>key</code></td><td>Custom private key file path</td></tr><tr><td><code>enforce_https</code></td><td>Force HTTPS redirect (301)</td></tr></tbody></table><h3 id=advanced-settings>Advanced Settings</h3><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><code>config</code></td><td>Custom Nginx config snippet</td></tr><tr><td><code>index</code></td><td>Enable directory listing (for static)</td></tr><tr><td><code>log</code></td><td>Custom log file name</td></tr><tr><td><code>websocket</code></td><td>Enable WebSocket support</td></tr><tr><td><code>auth</code></td><td>Enable Basic Auth</td></tr><tr><td><code>realm</code></td><td>Basic Auth prompt message</td></tr></tbody></table><hr><h2 id=configuration-examples>Configuration Examples</h2><h3 id=reverse-proxy-services>Reverse Proxy Services</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgadmin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=static-files-and-directory-listing>Static Files and Directory Listing</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: repo.pigsty.io, path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/repo&#34;</span><span style=color:#204a87;font-weight:700>, index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=custom-ssl-certificate>Custom SSL Certificate</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>secure_app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>secure.pigsty.io</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8443&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>cert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/etc/ssl/certs/custom.crt&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/etc/ssl/private/custom.key&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=using-lets-encrypt-certificates>Using Let&rsquo;s Encrypt Certificates</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>demo.pigsty.io</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.demo   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Cert name, multiple domains can share one cert</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=force-https-redirect>Force HTTPS Redirect</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>web.io</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en.pigsty.io</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/web.io&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.doc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>enforce_https</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=custom-config-snippet>Custom Config Snippet</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>web.cc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.io</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/web.io&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domains</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>en.pigsty.io ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.doc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # rewrite /en/ to /
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        location /en/ {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            rewrite ^/en/(.*)$ /$1 permanent;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=management-commands>Management Commands</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx           <span style=color:#8f5902;font-style:italic># Full Nginx reconfiguration</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config    <span style=color:#8f5902;font-style:italic># Regenerate config files</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_launch    <span style=color:#8f5902;font-style:italic># Restart Nginx service</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_cert      <span style=color:#8f5902;font-style:italic># Regenerate SSL certificates</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_certbot   <span style=color:#8f5902;font-style:italic># Sign certificates with certbot</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_reload    <span style=color:#8f5902;font-style:italic># Reload Nginx configuration</span>
</span></span></code></pre></div><hr><h2 id=domain-resolution>Domain Resolution</h2><p>Three ways to resolve domains to Pigsty servers:</p><ol><li><strong>Public domains</strong>: Configure via DNS provider</li><li><strong>Internal DNS server</strong>: Configure internal DNS resolution</li><li><strong>Local hosts file</strong>: Modify <code>/etc/hosts</code></li></ol><p>For local development, add to <code>/etc/hosts</code>:</p><pre tabindex=0><code>&lt;your_public_ip_address&gt; i.pigsty g.pigsty p.pigsty a.pigsty
</code></pre><p>Pigsty includes dnsmasq service, configurable via <a href=/docs/infra/param#dns_records><code>dns_records</code></a> parameter for internal DNS resolution.</p><hr><h2 id=https-configuration>HTTPS Configuration</h2><p>Configure HTTPS via <a href=/docs/infra/param#nginx_sslmode><code>nginx_sslmode</code></a> parameter:</p><table><thead><tr><th>Mode</th><th>Description</th></tr></thead><tbody><tr><td><code>disable</code></td><td>Listen HTTP only (<code>nginx_port</code>)</td></tr><tr><td><code>enable</code></td><td>Also listen HTTPS (<code>nginx_ssl_port</code>), default self-signed cert</td></tr><tr><td><code>enforce</code></td><td>Force redirect to HTTPS, all port 80 requests get 301 redirect</td></tr></tbody></table><p>For self-signed certificates, several access options:</p><ul><li>Trust the self-signed CA in browser (download at <code>http://&lt;ip>/ca.crt</code>)</li><li>Use browser security bypass (type &ldquo;thisisunsafe&rdquo; in Chrome)</li><li>Configure proper CA-signed certs or Let&rsquo;s Encrypt for production</li></ul><hr><h2 id=certbot-certificates>Certbot Certificates</h2><p>Pigsty supports using Certbot to request free Let&rsquo;s Encrypt certificates.</p><h3 id=enable-certbot>Enable Certbot</h3><ol><li>Add <code>certbot</code> parameter to services in <code>infra_portal</code>, specifying cert name</li><li>Configure <a href=/docs/infra/param#certbot_email><code>certbot_email</code></a> with a valid email</li><li>Set <a href=/docs/infra/param#certbot_sign><code>certbot_sign</code></a> to <code>true</code> for auto-signing during deployment</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_sign</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your@email.com</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=manual-certificate-signing>Manual Certificate Signing</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_certbot   <span style=color:#8f5902;font-style:italic># Sign Let&#39;s Encrypt certificates</span>
</span></span></code></pre></div><p>Or run the scripts directly on the server:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/etc/nginx/sign-cert           <span style=color:#8f5902;font-style:italic># Sign certificates</span>
</span></span><span style=display:flex><span>/etc/nginx/link-cert           <span style=color:#8f5902;font-style:italic># Link certificates to Nginx config directory</span>
</span></span></code></pre></div><p>For more info, see <a href=/docs/infra/admin/cert>Certbot: Request and Renew HTTPS Certificates</a></p><hr><h2 id=default-homepage>Default Homepage</h2><p>Pigsty&rsquo;s default <code>home</code> server provides these built-in routes:</p><table><thead><tr><th>Path</th><th>Description</th></tr></thead><tbody><tr><td><code>/</code></td><td>Homepage navigation</td></tr><tr><td><code>/ui/</code></td><td>Grafana monitoring dashboards</td></tr><tr><td><code>/vmetrics/</code></td><td>VictoriaMetrics VMUI</td></tr><tr><td><code>/vlogs/</code></td><td>VictoriaLogs log query</td></tr><tr><td><code>/vtraces/</code></td><td>VictoriaTraces tracing</td></tr><tr><td><code>/vmalert/</code></td><td>VMAlert alerting rules</td></tr><tr><td><code>/alertmgr/</code></td><td>AlertManager alert management</td></tr><tr><td><code>/blackbox/</code></td><td>Blackbox Exporter</td></tr><tr><td><code>/pev</code></td><td>PostgreSQL Explain visualization</td></tr><tr><td><code>/haproxy/&lt;cluster>/</code></td><td>HAProxy admin interface (if any)</td></tr></tbody></table><p>These routes allow accessing all monitoring components through a single entry point, no need for multiple domain configurations.</p><hr><h2 id=best-practices>Best Practices</h2><ul><li>Use domain names instead of IP:PORT for service access</li><li>Properly configure DNS resolution or hosts file</li><li>Enable WebSocket for real-time apps (e.g., Grafana, Jupyter)</li><li>Enable HTTPS for production</li><li>Use meaningful subdomains to organize services</li><li>Monitor Let&rsquo;s Encrypt certificate expiration</li><li>Use <code>config</code> parameter for custom Nginx configurations</li></ul><hr><h2 id=full-example>Full Example</h2><p>Here&rsquo;s the Nginx configuration used by Pigsty&rsquo;s public demo site <a href=https://demo.pigsty.io>demo.pigsty.io</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>io           </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: pigsty.io      ,path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/pigsty.io&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,cert: /etc/cert/pigsty.io.crt ,key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/cert/pigsty.io.key }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty.io    ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>postgrest    </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: api.pigsty.io  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8884&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgadmin      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty.io  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgweb        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: cli.pigsty.io  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8886&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bytebase     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: ddl.pigsty.io  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8887&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>jupyter      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: lab.pigsty.io  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8888&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>gitea        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: git.pigsty.io  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8889&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>wiki         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: wiki.pigsty.io ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9002&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>noco         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: noco.pigsty.io ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9003&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>supa         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty.io ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>dify         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: dify.pigsty.io ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>odoo         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: odoo.pigsty.io ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8069&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>mm           </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: mm.pigsty.io   ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8065&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3e5c80de91c09afe274f784b52a45287>7.4 - Software Repository</h1><div class=lead>Managing local APT/YUM software repositories</div><p>Pigsty supports creating and managing local APT/YUM software repositories for offline deployment or accelerated package installation.</p><hr><h2 id=quick-start>Quick Start</h2><p>To add packages to the local repository:</p><ol><li>Add packages to <a href=../param/#repo_packages><code>repo_packages</code></a> (default packages)</li><li>Add packages to <a href=../param/#repo_extra_packages><code>repo_extra_packages</code></a> (extra packages)</li><li>Run the build command:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo_build   <span style=color:#8f5902;font-style:italic># Build local repo from upstream</span>
</span></span><span style=display:flex><span>./node.yml -t node_repo     <span style=color:#8f5902;font-style:italic># Refresh node repository cache</span>
</span></span></code></pre></div><hr><h2 id=package-aliases>Package Aliases</h2><p>Pigsty predefines common package combinations for batch installation:</p><h3 id=el-systems-rhelcentosrocky>EL Systems (RHEL/CentOS/Rocky)</h3><table><thead><tr><th>Alias</th><th>Description</th></tr></thead><tbody><tr><td><code>node-bootstrap</code></td><td>Ansible, Python3 tools, SSH related</td></tr><tr><td><code>infra-package</code></td><td>Nginx, etcd, HAProxy, monitoring exporters, MinIO</td></tr><tr><td><code>pgsql-utility</code></td><td>Patroni, pgBouncer, pgBackRest, PG tools</td></tr><tr><td><code>pgsql</code></td><td>Full PostgreSQL (server, client, extensions)</td></tr><tr><td><code>pgsql-mini</code></td><td>Minimal PostgreSQL installation</td></tr></tbody></table><h3 id=debianubuntu-systems>Debian/Ubuntu Systems</h3><table><thead><tr><th>Alias</th><th>Description</th></tr></thead><tbody><tr><td><code>node-bootstrap</code></td><td>Ansible, development tools</td></tr><tr><td><code>infra-package</code></td><td>Infrastructure components (Debian naming)</td></tr><tr><td><code>pgsql-client</code></td><td>PostgreSQL client</td></tr><tr><td><code>pgsql-server</code></td><td>PostgreSQL server and related packages</td></tr></tbody></table><hr><h2 id=playbook-tasks>Playbook Tasks</h2><h3 id=main-tasks>Main Tasks</h3><table><thead><tr><th>Task</th><th>Description</th></tr></thead><tbody><tr><td><code>repo</code></td><td>Create local repo from internet or offline packages</td></tr><tr><td><code>repo_build</code></td><td>Build from upstream if not exists</td></tr><tr><td><code>repo_upstream</code></td><td>Add upstream repository files</td></tr><tr><td><code>repo_pkg</code></td><td>Download packages and dependencies</td></tr><tr><td><code>repo_create</code></td><td>Create/update YUM or APT repository</td></tr><tr><td><code>repo_nginx</code></td><td>Start Nginx file server</td></tr></tbody></table><h3 id=complete-task-list>Complete Task List</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo_dir          <span style=color:#8f5902;font-style:italic># Create local repository directory</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_check        <span style=color:#8f5902;font-style:italic># Check if local repo exists</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_prepare      <span style=color:#8f5902;font-style:italic># Use existing repo directly</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_build        <span style=color:#8f5902;font-style:italic># Build repo from upstream</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream     <span style=color:#8f5902;font-style:italic># Add upstream repositories</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_remove       <span style=color:#8f5902;font-style:italic># Delete existing repo files</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_add          <span style=color:#8f5902;font-style:italic># Add repo to system directory</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_url_pkg      <span style=color:#8f5902;font-style:italic># Download packages from internet</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_cache        <span style=color:#8f5902;font-style:italic># Create metadata cache</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_boot_pkg     <span style=color:#8f5902;font-style:italic># Install bootstrap packages</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg          <span style=color:#8f5902;font-style:italic># Download packages and dependencies</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create       <span style=color:#8f5902;font-style:italic># Create local repository</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_use          <span style=color:#8f5902;font-style:italic># Add new repo to system</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_nginx        <span style=color:#8f5902;font-style:italic># Start Nginx file server</span>
</span></span></code></pre></div><hr><h2 id=common-operations>Common Operations</h2><h3 id=add-new-packages>Add New Packages</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Configure upstream repositories</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Download packages and dependencies</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. Build local repository metadata</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create
</span></span></code></pre></div><h3 id=refresh-node-repositories>Refresh Node Repositories</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -t node_repo    <span style=color:#8f5902;font-style:italic># Refresh repository cache on all nodes</span>
</span></span></code></pre></div><h3 id=complete-repository-rebuild>Complete Repository Rebuild</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo        <span style=color:#8f5902;font-style:italic># Create repo from internet or offline packages</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-11e76a7fd5b13e8b9ed2ffe665bd1146>7.5 - Domain Management</h1><div class=lead>Configure local or public domain names to access Pigsty services.</div><p>Use domain names instead of IP addresses to access Pigsty&rsquo;s various web services.</p><hr><h2 id=quick-start>Quick Start</h2><p>Add the following static resolution records to <code>/etc/hosts</code>:</p><pre tabindex=0><code>10.10.10.10 i.pigsty g.pigsty p.pigsty a.pigsty
</code></pre><p>Replace IP address with your actual Pigsty node&rsquo;s IP.</p><hr><h2 id=why-use-domain-names>Why Use Domain Names</h2><ul><li>Easier to remember than IP addresses</li><li>Flexible pointing to different IPs</li><li>Unified service management through Nginx</li><li>Support for HTTPS encryption</li><li>Prevent ISP hijacking in some regions</li><li>Allow access to internally bound services via proxy</li></ul><hr><h2 id=dns-mechanism>DNS Mechanism</h2><p><strong>DNS Protocol</strong>: Resolves domain names to IP addresses. Multiple domains can point to same IP.</p><p><strong>HTTP Protocol</strong>: Uses Host header to route requests to different sites on same port (80/443).</p><hr><h2 id=default-domains>Default Domains</h2><p>Pigsty predefines the following default domains:</p><table><thead><tr><th>Domain</th><th>Service</th><th>Port</th><th>Purpose</th></tr></thead><tbody><tr><td><code>i.pigsty</code></td><td>Nginx</td><td>80/443</td><td>Default homepage, local repo, unified entry</td></tr><tr><td><code>g.pigsty</code></td><td>Grafana</td><td>3000</td><td>Monitoring and visualization</td></tr><tr><td><code>p.pigsty</code></td><td>VictoriaMetrics</td><td>8428</td><td>VMUI/PromQL entry</td></tr><tr><td><code>a.pigsty</code></td><td>AlertManager</td><td>9059</td><td>Alert routing</td></tr><tr><td><code>m.pigsty</code></td><td>MinIO</td><td>9001</td><td>Object storage console</td></tr></tbody></table><hr><h2 id=resolution-methods>Resolution Methods</h2><h3 id=local-static-resolution>Local Static Resolution</h3><p>Add entries to <code>/etc/hosts</code> on the client machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Linux/macOS</span>
</span></span><span style=display:flex><span>sudo vim /etc/hosts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Windows</span>
</span></span><span style=display:flex><span>notepad C:<span style=color:#4e9a06>\W</span>indows<span style=color:#4e9a06>\S</span>ystem32<span style=color:#4e9a06>\d</span>rivers<span style=color:#4e9a06>\e</span>tc<span style=color:#4e9a06>\h</span>osts
</span></span></code></pre></div><p>Add content:</p><pre tabindex=0><code>10.10.10.10 i.pigsty g.pigsty p.pigsty a.pigsty m.pigsty
</code></pre><h3 id=internal-dynamic-resolution>Internal Dynamic Resolution</h3><p>Pigsty includes dnsmasq as an internal DNS server. Configure managed nodes to use INFRA node as DNS server:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_dns_servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;${admin_ip}&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># Use INFRA node as DNS server</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_dns_method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>add               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Add to existing DNS server list</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Configure domain records resolved by dnsmasq via <a href=/docs/infra/param#dns_records><code>dns_records</code></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty sss.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=public-domain-names>Public Domain Names</h3><p>Purchase a domain and add DNS A record pointing to public IP:</p><ol><li>Purchase domain from registrar (e.g., <code>example.com</code>)</li><li>Configure A record pointing to server public IP</li><li>Use real domain in <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a></li></ol><hr><h2 id=built-in-dns-service>Built-in DNS Service</h2><p>Pigsty runs dnsmasq on INFRA nodes as a DNS server.</p><h3 id=related-parameters>Related Parameters</h3><table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><a href=/docs/infra/param#dns_enabled><code>dns_enabled</code></a></td><td><code>true</code></td><td>Enable DNS service</td></tr><tr><td><a href=/docs/infra/param#dns_port><code>dns_port</code></a></td><td><code>53</code></td><td>DNS listen port</td></tr><tr><td><a href=/docs/infra/param#dns_records><code>dns_records</code></a></td><td>See below</td><td>Default DNS records</td></tr></tbody></table><p>Default DNS records:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty sss.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=dynamic-dns-registration>Dynamic DNS Registration</h3><p>Pigsty automatically registers DNS records for PostgreSQL clusters and instances:</p><ul><li><strong>Instance-level DNS</strong>: <code>&lt;pg_instance></code> points to instance IP (e.g., <code>pg-meta-1</code>)</li><li><strong>Cluster-level DNS</strong>: <code>&lt;pg_cluster></code> points to primary IP or VIP (e.g., <code>pg-meta</code>)</li></ul><p>Cluster-level DNS target controlled by <a href=/docs/pgsql/param#pg_dns_target><code>pg_dns_target</code></a>:</p><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>auto</code></td><td>Auto-select: use VIP if available, else primary IP</td></tr><tr><td><code>primary</code></td><td>Always point to primary IP</td></tr><tr><td><code>vip</code></td><td>Always point to VIP (requires VIP enabled)</td></tr><tr><td><code>none</code></td><td>Don&rsquo;t register cluster DNS</td></tr><tr><td><code>&lt;ip></code></td><td>Specify fixed IP address</td></tr></tbody></table><p>Add suffix to cluster DNS via <a href=/docs/pgsql/param#pg_dns_suffix><code>pg_dns_suffix</code></a>.</p><hr><h2 id=node-dns-configuration>Node DNS Configuration</h2><p>Pigsty manages DNS configuration on managed nodes.</p><h3 id=static-hosts-records>Static hosts Records</h3><p>Configure static <code>/etc/hosts</code> records via <a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_etc_hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty sss.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;10.10.10.20 db.example.com&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=dns-server-configuration>DNS Server Configuration</h3><table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><a href=/docs/node/param#node_dns_method><code>node_dns_method</code></a></td><td><code>add</code></td><td>DNS config method</td></tr><tr><td><a href=/docs/node/param#node_dns_servers><code>node_dns_servers</code></a></td><td><code>['${admin_ip}']</code></td><td>DNS server list</td></tr><tr><td><a href=/docs/node/param#node_dns_options><code>node_dns_options</code></a></td><td>See below</td><td>resolv.conf options</td></tr></tbody></table><p><code>node_dns_method</code> options:</p><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>add</code></td><td>Prepend to existing DNS server list</td></tr><tr><td><code>overwrite</code></td><td>Completely overwrite DNS config</td></tr><tr><td><code>none</code></td><td>Don&rsquo;t modify DNS config</td></tr></tbody></table><p>Default DNS options:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_dns_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>options single-request-reopen timeout:1</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=https-certificates>HTTPS Certificates</h2><p>Pigsty uses self-signed certificates by default. Options include:</p><ul><li>Ignore warnings, use HTTP</li><li>Trust self-signed CA certificate (download at <code>http://&lt;ip>/ca.crt</code>)</li><li>Use real CA or get free public domain certs via Certbot</li></ul><p>See <a href=./cert/>CA and Certificates</a> documentation for details.</p><hr><h2 id=extended-domains>Extended Domains</h2><p>Pigsty reserves the following domains for various application services:</p><table><thead><tr><th>Domain</th><th>Purpose</th></tr></thead><tbody><tr><td><code>adm.pigsty</code></td><td>PgAdmin interface</td></tr><tr><td><code>ddl.pigsty</code></td><td>Bytebase DDL management</td></tr><tr><td><code>cli.pigsty</code></td><td>PgWeb CLI interface</td></tr><tr><td><code>api.pigsty</code></td><td>PostgREST API service</td></tr><tr><td><code>lab.pigsty</code></td><td>Jupyter environment</td></tr><tr><td><code>git.pigsty</code></td><td>Gitea Git service</td></tr><tr><td><code>wiki.pigsty</code></td><td>Wiki.js docs</td></tr><tr><td><code>noco.pigsty</code></td><td>NocoDB</td></tr><tr><td><code>supa.pigsty</code></td><td>Supabase</td></tr><tr><td><code>dify.pigsty</code></td><td>Dify AI</td></tr><tr><td><code>odoo.pigsty</code></td><td>Odoo ERP</td></tr><tr><td><code>mm.pigsty</code></td><td>Mattermost</td></tr></tbody></table><p>Using these domains requires configuring corresponding services in <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a>.</p><hr><h2 id=management-commands>Management Commands</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t dns            <span style=color:#8f5902;font-style:italic># Full DNS service configuration</span>
</span></span><span style=display:flex><span>./infra.yml -t dns_config     <span style=color:#8f5902;font-style:italic># Regenerate dnsmasq config</span>
</span></span><span style=display:flex><span>./infra.yml -t dns_record     <span style=color:#8f5902;font-style:italic># Update default DNS records</span>
</span></span><span style=display:flex><span>./infra.yml -t dns_launch     <span style=color:#8f5902;font-style:italic># Restart dnsmasq service</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./node.yml -t node_hosts      <span style=color:#8f5902;font-style:italic># Configure node /etc/hosts</span>
</span></span><span style=display:flex><span>./node.yml -t node_resolv     <span style=color:#8f5902;font-style:italic># Configure node DNS resolver</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./pgsql.yml -t pg_dns         <span style=color:#8f5902;font-style:italic># Register PostgreSQL DNS records</span>
</span></span><span style=display:flex><span>./pgsql.yml -t pg_dns_ins     <span style=color:#8f5902;font-style:italic># Register instance-level DNS only</span>
</span></span><span style=display:flex><span>./pgsql.yml -t pg_dns_cls     <span style=color:#8f5902;font-style:italic># Register cluster-level DNS only</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-99138bcc6d2f367b6fb7df8b7a59e131>7.6 - Module Management</h1><div class=lead>INFRA module management SOP: define, create, destroy, scale out, scale in</div><p>This document covers daily management operations for the INFRA module, including installation, uninstallation, scaling, and component maintenance.</p><hr><h2 id=install-infra-module>Install INFRA Module</h2><p>Use the <a href=/docs/infra/playbook/#infrayml><code>infra.yml</code></a> playbook to install the INFRA module on the <code>infra</code> group:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml     <span style=color:#8f5902;font-style:italic># Install INFRA module on infra group</span>
</span></span></code></pre></div><hr><h2 id=uninstall-infra-module>Uninstall INFRA Module</h2><p>Use the <a href=/docs/infra/playbook/#infra-rmyml><code>infra-rm.yml</code></a> playbook to uninstall the INFRA module from the <code>infra</code> group:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra-rm.yml  <span style=color:#8f5902;font-style:italic># Uninstall INFRA module from infra group</span>
</span></span></code></pre></div><hr><h2 id=scale-out-infra-module>Scale Out INFRA Module</h2><p>Assign <a href=/docs/infra/param/#infra_seq><code>infra_seq</code></a> to new nodes and add them to the <code>infra</code> group in the inventory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Existing node</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># New node</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Use the <code>-l</code> limit option to execute the playbook on the new node only:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -l 10.10.10.11    <span style=color:#8f5902;font-style:italic># Install INFRA module on new node</span>
</span></span></code></pre></div><hr><h2 id=manage-local-repository>Manage Local Repository</h2><p>Local repository management tasks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo              <span style=color:#8f5902;font-style:italic># Create repo from internet or offline packages</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream     <span style=color:#8f5902;font-style:italic># Add upstream repositories</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg          <span style=color:#8f5902;font-style:italic># Download packages and dependencies</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create       <span style=color:#8f5902;font-style:italic># Create local yum/apt repository</span>
</span></span></code></pre></div><p>Complete subtask list:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo_dir          <span style=color:#8f5902;font-style:italic># Create local repository directory</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_check        <span style=color:#8f5902;font-style:italic># Check if local repo exists</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_prepare      <span style=color:#8f5902;font-style:italic># Use existing repo directly</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_build        <span style=color:#8f5902;font-style:italic># Build repo from upstream</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream     <span style=color:#8f5902;font-style:italic># Add upstream repositories</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_remove       <span style=color:#8f5902;font-style:italic># Delete existing repo files</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_add          <span style=color:#8f5902;font-style:italic># Add repo to system directory</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_url_pkg      <span style=color:#8f5902;font-style:italic># Download packages from internet</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_cache        <span style=color:#8f5902;font-style:italic># Create metadata cache</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_boot_pkg     <span style=color:#8f5902;font-style:italic># Install bootstrap packages</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg          <span style=color:#8f5902;font-style:italic># Download packages and dependencies</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create       <span style=color:#8f5902;font-style:italic># Create local repository</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_use          <span style=color:#8f5902;font-style:italic># Add new repo to system</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_nginx        <span style=color:#8f5902;font-style:italic># Start Nginx file server</span>
</span></span></code></pre></div><hr><h2 id=manage-nginx>Manage Nginx</h2><p>Nginx management tasks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx                       <span style=color:#8f5902;font-style:italic># Reset Nginx component</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_index                 <span style=color:#8f5902;font-style:italic># Re-render homepage</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config,nginx_reload   <span style=color:#8f5902;font-style:italic># Re-render config and reload</span>
</span></span></code></pre></div><p>Request HTTPS certificate:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_certbot,nginx_reload -e <span style=color:#000>certbot_sign</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><hr><h2 id=manage-infrastructure-components>Manage Infrastructure Components</h2><p>Management commands for various infrastructure components:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t infra           <span style=color:#8f5902;font-style:italic># Configure infrastructure</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_env       <span style=color:#8f5902;font-style:italic># Configure environment variables</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_pkg       <span style=color:#8f5902;font-style:italic># Install packages</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_user      <span style=color:#8f5902;font-style:italic># Set up OS user</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_cert      <span style=color:#8f5902;font-style:italic># Issue certificates</span>
</span></span><span style=display:flex><span>./infra.yml -t dns             <span style=color:#8f5902;font-style:italic># Configure DNSMasq</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx           <span style=color:#8f5902;font-style:italic># Configure Nginx</span>
</span></span><span style=display:flex><span>./infra.yml -t victoria        <span style=color:#8f5902;font-style:italic># Configure VictoriaMetrics/Logs/Traces</span>
</span></span><span style=display:flex><span>./infra.yml -t alertmanager    <span style=color:#8f5902;font-style:italic># Configure AlertManager</span>
</span></span><span style=display:flex><span>./infra.yml -t blackbox        <span style=color:#8f5902;font-style:italic># Configure Blackbox Exporter</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana         <span style=color:#8f5902;font-style:italic># Configure Grafana</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_register  <span style=color:#8f5902;font-style:italic># Register to VictoriaMetrics/Grafana</span>
</span></span></code></pre></div><p>Common maintenance commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_index                        <span style=color:#8f5902;font-style:italic># Re-render homepage</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config,nginx_reload          <span style=color:#8f5902;font-style:italic># Reconfigure and reload</span>
</span></span><span style=display:flex><span>./infra.yml -t vmetrics_config,vmetrics_launch    <span style=color:#8f5902;font-style:italic># Regenerate VictoriaMetrics config and restart</span>
</span></span><span style=display:flex><span>./infra.yml -t vlogs_config,vlogs_launch          <span style=color:#8f5902;font-style:italic># Update VictoriaLogs config</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana_plugin                     <span style=color:#8f5902;font-style:italic># Download Grafana plugins</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3903df191db5a10a2713083bc196961f>7.7 - CA and Certificates</h1><div class=lead>Using self-signed CA or real HTTPS certificates</div><p>Pigsty uses a <strong>self-signed Certificate Authority (CA)</strong> by default for internal SSL/TLS encryption. This document covers:</p><ul><li><a href=#self-signed-ca>Self-Signed CA</a>: Default PKI infrastructure</li><li><a href=#issue-certificates>Issue Certificates</a>: Using <code>cert.yml</code> to issue additional certificates</li><li><a href=#trust-ca-certificate>Trust CA Certificate</a>: Installing CA on client machines</li><li><a href=#lets-encrypt>Let&rsquo;s Encrypt</a>: Using real certificates for public-facing services</li></ul><hr><h2 id=self-signed-ca>Self-Signed CA</h2><p>Pigsty automatically creates a self-signed CA during infrastructure initialization (<code>infra.yml</code>). The CA signs certificates for:</p><ul><li>PostgreSQL server/client SSL</li><li>Patroni REST API</li><li>etcd cluster communication</li><li>MinIO cluster communication</li><li>Nginx HTTPS (fallback)</li><li>Infrastructure services</li></ul><h3 id=pki-directory-structure>PKI Directory Structure</h3><pre tabindex=0><code>files/pki/
├── ca/
│   ├── ca.key                # CA private key (keep secure!)
│   └── ca.crt                # CA certificate
├── csr/                      # Certificate signing requests
│   ├── misc/                     # Miscellaneous certificates (cert.yml output)
│   ├── etcd/                     # ETCD certificates
│   ├── pgsql/                    # PostgreSQL certificates
│   ├── minio/                    # MinIO certificates
│   ├── nginx/                    # Nginx certificates
│   └── mongo/                    # FerretDB certificates
└── infra/                    # Infrastructure certificates
</code></pre><h3 id=ca-variables>CA Variables</h3><table><thead><tr><th style=text-align:left>Variable</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>ca_create</code></td><td><code>true</code></td><td>Create CA if not exists, or abort</td></tr><tr><td style=text-align:left><code>ca_cn</code></td><td><code>pigsty-ca</code></td><td>CA certificate common name</td></tr><tr><td style=text-align:left><code>cert_validity</code></td><td><code>7300d</code></td><td>Default validity for issued certificates</td></tr><tr><td style=text-align:left></td><td>Variable</td><td>Default</td></tr><tr><td style=text-align:left>:&mdash;&mdash;&mdash;&mdash;&mdash;-</td><td>&mdash;&mdash;&mdash;&mdash;&ndash;</td><td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</td></tr><tr><td style=text-align:left>CA Certificate</td><td>100 years</td><td>Hardcoded (36500 days)</td></tr><tr><td style=text-align:left>Server/Client</td><td>20 years</td><td><code>cert_validity</code> (7300d)</td></tr><tr><td style=text-align:left>Nginx HTTPS</td><td>~1 year</td><td><code>nginx_cert_validity</code> (397d)</td></tr><tr><td style=text-align:left>> <strong>Note</strong>: Browser vendors limit trust to 398-day certificates. Nginx uses shorter validity for browser compatibility.</td><td></td><td></td></tr></tbody></table><hr><h2 id=using-external-ca>Using External CA</h2><p>To use your own enterprise CA instead of auto-generated one:</p><p><strong>1. Set <code>ca_create: false</code></strong> in your configuration.</p><p><strong>2. Place your CA files before running playbook:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p files/pki/ca
</span></span><span style=display:flex><span>cp /path/to/your/ca.key files/pki/ca/ca.key
</span></span><span style=display:flex><span>cp /path/to/your/ca.crt files/pki/ca/ca.crt
</span></span><span style=display:flex><span>chmod <span style=color:#0000cf;font-weight:700>600</span> files/pki/ca/ca.key
</span></span><span style=display:flex><span>chmod <span style=color:#0000cf;font-weight:700>644</span> files/pki/ca/ca.crt
</span></span></code></pre></div><p><strong>3. Run <code>./infra.yml</code></strong></p><hr><h3 id=backup-ca-files>Backup CA Files</h3><p>The CA private key is critical. Back it up securely:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Backup with timestamp</span>
</span></span><span style=display:flex><span>tar -czvf pigsty-ca-<span style=color:#204a87;font-weight:700>$(</span>date +%Y%m%d<span style=color:#204a87;font-weight:700>)</span>.tar.gz files/pki/ca/
</span></span></code></pre></div><blockquote><p><strong>Warning</strong>: If you lose CA private key, all certificates signed by it become unverifiable. You&rsquo;ll need to regenerate everything.</p></blockquote><hr><h2 id=issue-certificates>Issue Certificates</h2><p>Use <code>cert.yml</code> to issue additional certificates signed by Pigsty CA.</p><h3 id=basic-usage>Basic Usage</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Issue certificate for database user (client cert)</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_dba
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Issue certificate for monitor user</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_monitor
</span></span></code></pre></div><p>Certificates generated in <code>files/pki/misc/&lt;cn>.{key,crt}</code> by default.</p><h3 id=parameters>Parameters</h3><table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>cn</code></td><td><code>pigsty</code></td><td>Common Name (required)</td></tr><tr><td><code>san</code></td><td><code>[DNS:localhost, IP:127.0.0.1]</code></td><td>Subject Alternative Names</td></tr><tr><td><code>org</code></td><td><code>pigsty</code></td><td>Organization name</td></tr><tr><td><code>unit</code></td><td><code>pigsty</code></td><td>Organizational unit name</td></tr><tr><td><code>expire</code></td><td><code>7300d</code></td><td>Certificate validity (20 years)</td></tr><tr><td><code>key</code></td><td><code>files/pki/misc/&lt;cn>.key</code></td><td>Private key output path</td></tr><tr><td><code>crt</code></td><td><code>files/pki/misc/&lt;cn>.crt</code></td><td>Certificate output path</td></tr></tbody></table><h3 id=advanced-examples>Advanced Examples</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Issue certificate with custom SAN (DNS and IP)</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>myservice -e <span style=color:#000>san</span><span style=color:#ce5c00;font-weight:700>=</span>DNS:myservice,IP:10.2.82.163
</span></span></code></pre></div><p>(File has more lines. Use &lsquo;offset&rsquo; parameter to read beyond line 130)</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c91827b2709e7c2e7f7afc8662f9e0bf>7.8 - Grafana High Availability: Using PostgreSQL Backend</h1><div class=lead>Use PostgreSQL instead of SQLite as Grafana&rsquo;s remote storage backend for better performance and availability.</div><p>You can use PostgreSQL as Grafana&rsquo;s backend database.</p><p>This is a great opportunity to understand Pigsty&rsquo;s deployment system. By completing this tutorial, you&rsquo;ll learn:</p><ul><li>How to <a href=#create-database-cluster>create a new database cluster</a></li><li>How to <a href=#create-grafana-business-user>create new business users</a> in an existing cluster</li><li>How to <a href=#create-grafana-business-database>create new business databases</a> in an existing cluster</li><li>How to <a href=#use-grafana-business-database>access databases</a> created by Pigsty</li><li>How to <a href=#manage-grafana-dashboards>manage Grafana dashboards</a></li><li>How to manage <a href=#manage-postgres-datasources>PostgreSQL datasources</a> in Grafana</li><li>How to <a href=#one-step-grafana-upgrade>upgrade Grafana database</a> in one step</li></ul><hr><h2 id=tldr>TL;DR</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi pigsty.yml <span style=color:#8f5902;font-style:italic># Uncomment DB/User definitions: dbuser_grafana  grafana</span>
</span></span><span style=display:flex><span>bin/pgsql-user  pg-meta  dbuser_grafana
</span></span><span style=display:flex><span>bin/pgsql-db    pg-meta  grafana
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>psql postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana -c <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;CREATE TABLE t(); DROP TABLE t;&#39;</span> <span style=color:#8f5902;font-style:italic># Verify connection string works</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vi /etc/grafana/grafana.ini <span style=color:#8f5902;font-style:italic># Modify [database] type url</span>
</span></span><span style=display:flex><span>systemctl restart grafana-server
</span></span></code></pre></div><hr><h2 id=create-database-cluster>Create Database Cluster</h2><p>We can define a new database <code>grafana</code> on <code>pg-meta</code>, or create a dedicated Grafana database cluster <code>pg-grafana</code> on new nodes.</p><h3 id=define-cluster>Define Cluster</h3><p>To create a new dedicated cluster <code>pg-grafana</code> on machines <code>10.10.10.11</code> and <code>10.10.10.12</code>, use this config:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>grafana primary database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for grafana database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=create-cluster>Create Cluster</h3><p>Use this command to create the <code>pg-grafana</code> cluster: <a href=p-pgsql.yml><code>pgsql.yml</code></a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -l pg-grafana    <span style=color:#8f5902;font-style:italic># Initialize pg-grafana cluster</span>
</span></span></code></pre></div><p>This command is the Ansible Playbook <a href=/docs/pgsql/playbook#pgsqlyml><code>pgsql.yml</code></a> for creating database clusters.</p><p>Users and databases defined in <a href=/docs/pgsql/config#pg_users><code>pg_users</code></a> and <a href=/docs/pgsql/config#pg_databases><code>pg_databases</code></a> are automatically created during cluster initialization. With this config, after cluster creation (without DNS), you can <a href=/docs/concept/sec/ac>access</a> the database using these connection strings (any one works):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.11:5432/grafana <span style=color:#8f5902;font-style:italic># Direct primary connection</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.11:5436/grafana <span style=color:#8f5902;font-style:italic># Direct default service</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.11:5433/grafana <span style=color:#8f5902;font-style:italic># Primary read-write service</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.12:5432/grafana <span style=color:#8f5902;font-style:italic># Direct primary connection</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.12:5436/grafana <span style=color:#8f5902;font-style:italic># Direct default service</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.12:5433/grafana <span style=color:#8f5902;font-style:italic># Primary read-write service</span>
</span></span></code></pre></div><p>Since Pigsty is installed on a <strong>single meta node</strong> by default, the following steps will create Grafana&rsquo;s user and database on the existing <code>pg-meta</code> cluster, not the <code>pg-grafana</code> cluster created here.</p><hr><h2 id=create-grafana-business-user>Create Grafana Business User</h2><p>The usual convention for business object management: create user first, then database.
Because if the database has an <code>owner</code> configured, it depends on the corresponding user.</p><h3 id=define-user>Define User</h3><p>To create user <code>dbuser_grafana</code> on the <code>pg-meta</code> cluster, first add this user definition to <code>pg-meta</code>&rsquo;s <a href=#define-cluster>cluster definition</a>:</p><p>Location: <code>all.children.pg-meta.vars.pg_users</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for grafana database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>If you define a different password here, replace the corresponding parameter in subsequent steps</p></blockquote><h3 id=create-user>Create User</h3><p>Use this command to create the <code>dbuser_grafana</code> user (either works):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-user pg-meta dbuser_grafana <span style=color:#8f5902;font-style:italic># Create `dbuser_grafana` user on pg-meta cluster</span>
</span></span></code></pre></div><p>This actually calls the Ansible Playbook <a href=/docs/pgsql/playbook#pgsql-useryml><code>pgsql-user.yml</code></a> to create the user:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql-user.yml -l pg-meta -e <span style=color:#000>pg_user</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_grafana  <span style=color:#8f5902;font-style:italic># Ansible</span>
</span></span></code></pre></div><p>The <code>dbrole_admin</code> role has permission to execute DDL changes in the database, which is exactly what Grafana needs.</p><hr><h2 id=create-grafana-business-database>Create Grafana Business Database</h2><h3 id=define-database>Define Database</h3><p>Creating a business database follows the same pattern as users. First add the new database <code>grafana</code> <a href=#define-cluster>definition</a> to <code>pg-meta</code>&rsquo;s cluster definition.</p><p>Location: <code>all.children.pg-meta.vars.pg_databases</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: grafana, owner: dbuser_grafana, revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=create-database>Create Database</h3><p>Use this command to create the <code>grafana</code> database (either works):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-db pg-meta grafana <span style=color:#8f5902;font-style:italic># Create `grafana` database on `pg-meta` cluster</span>
</span></span></code></pre></div><p>This actually calls the Ansible Playbook <a href=/docs/pgsql/playbook#pgsql-dbyml><code>pgsql-db.yml</code></a> to create the database:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql-db.yml -l pg-meta -e <span style=color:#000>pg_database</span><span style=color:#ce5c00;font-weight:700>=</span>grafana <span style=color:#8f5902;font-style:italic># Actual Ansible playbook executed</span>
</span></span></code></pre></div><hr><h2 id=use-grafana-business-database>Use Grafana Business Database</h2><h3 id=verify-connection-string-reachability>Verify Connection String Reachability</h3><p>You can access the database using different <a href=/docs/concept/ha/svc>services</a> or <a href=/docs/concept/sec/ac>access</a> methods, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@meta:5432/grafana <span style=color:#8f5902;font-style:italic># Direct connection</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana <span style=color:#8f5902;font-style:italic># Default service</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@meta:5433/grafana <span style=color:#8f5902;font-style:italic># Primary service</span>
</span></span></code></pre></div><p>Here, we&rsquo;ll use the <a href=/docs/concept/ha/svc#default-service>Default service</a> that directly accesses the primary through load balancer.</p><p>First verify the connection string is reachable and has DDL execution permissions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana -c <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;CREATE TABLE t(); DROP TABLE t;&#39;</span>
</span></span></code></pre></div><h3 id=directly-modify-grafana-config>Directly Modify Grafana Config</h3><p>To make Grafana use a Postgres datasource, edit <code>/etc/grafana/grafana.ini</code> and modify the config:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[database]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;type = sqlite3</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;host = 127.0.0.1:3306</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;name = grafana</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;user = root</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If the password contains # or ; you have to wrap it with triple quotes. Ex &#34;&#34;&#34;#password;&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;password =</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;url =</span>
</span></span></code></pre></div><p>Change the default config to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[database]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>postgres</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>url</span> <span style=color:#ce5c00;font-weight:700>=</span>  <span style=color:#4e9a06>postgres://dbuser_grafana:DBUser.Grafana@meta/grafana</span>
</span></span></code></pre></div><p>Then restart Grafana:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart grafana-server
</span></span></code></pre></div><p>When you see activity in the newly added <a href="http://g.pigsty/d/pgsql-database/pgsql-database?var-cls=pg-meta&amp;var-ins=pg-meta-1&amp;var-datname=grafana"><code>grafana</code></a> database from the monitoring system, Grafana is now using Postgres as its primary backend database.
But there&rsquo;s a new issue—the original Dashboards and Datasources in Grafana have disappeared! You need to re-import <a href=#manage-grafana-dashboards>dashboards</a> and <a href=#manage-postgres-datasources>Postgres datasources</a>.</p><hr><h2 id=manage-grafana-dashboards>Manage Grafana Dashboards</h2><p>As admin user, navigate to the <code>files/grafana</code> directory under the Pigsty directory and run <code>grafana.py init</code> to reload Pigsty dashboards.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/files/grafana
</span></span><span style=display:flex><span>./grafana.py init    <span style=color:#8f5902;font-style:italic># Initialize Grafana dashboards using Dashboards in current directory</span>
</span></span></code></pre></div><p>Execution result:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vagrant@meta:~/pigsty/files/grafana
</span></span><span style=display:flex><span>$ ./grafana.py init
</span></span><span style=display:flex><span>Grafana API: admin:pigsty @ http://10.10.10.10:3000
</span></span><span style=display:flex><span>init dashboard : home.json
</span></span><span style=display:flex><span>init folder pgcat
</span></span><span style=display:flex><span>init dashboard: pgcat / pgcat-table.json
</span></span><span style=display:flex><span>init dashboard: pgcat / pgcat-bloat.json
</span></span><span style=display:flex><span>init dashboard: pgcat / pgcat-query.json
</span></span><span style=display:flex><span>init folder pgsql
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-replication.json
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>This script detects the current environment (defined in <code>~/pigsty</code> during installation), gets Grafana access info, and replaces dashboard URL placeholder domains (<code>*.pigsty</code>) with actual domains used.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GRAFANA_ENDPOINT</span><span style=color:#ce5c00;font-weight:700>=</span>http://10.10.10.10:3000
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GRAFANA_USERNAME</span><span style=color:#ce5c00;font-weight:700>=</span>admin
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GRAFANA_PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span>pigsty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>NGINX_UPSTREAM_YUMREPO</span><span style=color:#ce5c00;font-weight:700>=</span>yum.pigsty
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>NGINX_UPSTREAM_CONSUL</span><span style=color:#ce5c00;font-weight:700>=</span>c.pigsty
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>NGINX_UPSTREAM_PROMETHEUS</span><span style=color:#ce5c00;font-weight:700>=</span>p.pigsty
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>NGINX_UPSTREAM_ALERTMANAGER</span><span style=color:#ce5c00;font-weight:700>=</span>a.pigsty
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>NGINX_UPSTREAM_GRAFANA</span><span style=color:#ce5c00;font-weight:700>=</span>g.pigsty
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>NGINX_UPSTREAM_HAPROXY</span><span style=color:#ce5c00;font-weight:700>=</span>h.pigsty
</span></span></code></pre></div><p>As a side note, use <code>grafana.py clean</code> to clear target dashboards, and <code>grafana.py load</code> to load all dashboards from the current directory. When Pigsty dashboards change, use these two commands to upgrade all dashboards.</p><h2 id=manage-postgres-datasources>Manage Postgres Datasources</h2><p>When creating a new PostgreSQL cluster with <a href=/docs/pgsql/playbook#pgsqlyml><code>pgsql.yml</code></a> or a new business database with <a href=/docs/pgsql/playbook#pgsql-dbyml><code>pgsql-db.yml</code></a>, Pigsty registers new PostgreSQL datasources in Grafana. You can directly access target database instances through Grafana using the default monitoring user. Most <code>pgcat</code> application features depend on this.</p><p>To register Postgres databases, use the <code>register_grafana</code> task in <a href=/docs/pgsql/playbook#pgsqlyml><code>pgsql.yml</code></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -t register_grafana             <span style=color:#8f5902;font-style:italic># Re-register all Postgres datasources in current environment</span>
</span></span><span style=display:flex><span>./pgsql.yml -t register_grafana -l pg-test  <span style=color:#8f5902;font-style:italic># Re-register all databases in pg-test cluster</span>
</span></span></code></pre></div><hr><h2 id=one-step-grafana-upgrade>One-Step Grafana Upgrade</h2><p>You can directly modify the Pigsty config file to change Grafana&rsquo;s backend datasource, completing the database switch in one step. Edit the <a href=/docs/infra/param#grafana_pgurl><code>grafana_pgurl</code></a> parameter in <code>pigsty.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_pgurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Then re-run the <code>grafana</code> task from <a href=/docs/infra/playbook#infrayml><code>infra.yml</code></a> to complete the Grafana upgrade:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t grafana
</span></span></code></pre></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>