<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.io/docs/deploy/><link rel=alternate type=application/rss+xml href=https://pigsty.io/docs/deploy/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Deployment | PIGSTY</title><meta name=description content="Multi-node, high-availability Pigsty deployment for serious production environments."><meta property="og:url" content="https://pigsty.io/docs/deploy/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="Deployment"><meta property="og:description" content="Multi-node, high-availability Pigsty deployment for serious production environments."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Deployment"><meta itemprop=description content="Multi-node, high-availability Pigsty deployment for serious production environments."><meta itemprop=dateModified content="2026-01-08T18:48:49+08:00"><meta itemprop=wordCount content="94"><meta itemprop=keywords content="Tutorial,PIGSTY"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deployment"><meta name=twitter:description content="Multi-node, high-availability Pigsty deployment for serious production environments."><link rel=preload href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css as=style integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><link href=/scss/main.min.f6da858eb22dc48110abb983f095554930a5a614c30190b4e32ee7b08a496331.css rel=stylesheet integrity="sha256-9tqFjrItxIEQq7mD8JVVSTClphTDAZC04y7nsIpJYzE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Ver</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.cc>Pigsty 中文网站</a></li><li><a class=dropdown-item href=https://doc.pgsty.com>Pigsty v3.7 Doc</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc>Pigsty v3.4 Doc</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 Doc</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 Doc</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch Language / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d757e151050fd40088751a74721d74f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:window.location.href="https://pigsty.cc"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/deploy/>Return to the regular view of this page</a>.</p></div><h1 class=title>Deployment</h1><div class=lead>Multi-node, high-availability Pigsty deployment for serious production environments.</div><ul><li>1: <a href=#pg-26f5f78dacbf3daf14a3ddd2c1d928dd>Install Pigsty for Production</a></li><li>2: <a href=#pg-374829cbbe6f2f715a9e6d868d9f9693>Prepare Resources for Serious Deployment</a></li><li>3: <a href=#pg-9acb71881039d3570f14c9a9caf9563c>Planning Architecture and Nodes</a></li><li>4: <a href=#pg-7679452458507892fa3756a891f5287a>Setup Admin User and Privileges</a></li><li>5: <a href=#pg-aa44e6b5b4b5d27a4235af210a56fc6e>Sandbox</a></li><li>6: <a href=#pg-6c08c58dc7691eda288baa9ba0766305>Vagrant</a></li><li>7: <a href=#pg-87e7f74da392ae65771e6fb357b13c6f>Terraform</a></li><li>8: <a href=#pg-8783a52d352cd41160ffaa5b596ca07f>Security</a></li></ul><div class=content><p>Unlike <a href=/docs/setup/><strong>Getting Started</strong></a>, production Pigsty deployments require more <a href=/docs/deploy/planning><strong>Architecture Planning</strong></a> and <a href=/docs/deploy/prepare><strong>Preparation</strong></a>.</p><p>This chapter helps you understand the complete deployment process and provides best practices for production environments.</p><hr><p>Before deploying to production, we recommend testing in Pigsty&rsquo;s <a href=/docs/deploy/sandbox><strong>Sandbox</strong></a> to fully understand the workflow.
Use <a href=/docs/deploy/vagrant/><strong>Vagrant</strong></a> to create a local 4-node sandbox, or leverage <a href=/docs/deploy/terraform/><strong>Terraform</strong></a> to provision larger simulation environments in the cloud.</p><p><a href=/docs/concept/arch><img src=/img/pigsty/sandbox.png alt=pigsty-sandbox></a></p><p>For production, you typically need at least three <a href=/docs/deploy/prepare><strong>nodes</strong></a> for high availability. You should understand Pigsty&rsquo;s core <a href=/docs/concept><strong>Concepts</strong></a> and common administration procedures,
including <a href=/docs/setup/config><strong>Configuration</strong></a>, <a href=/docs/setup/playbook><strong>Ansible Playbooks</strong></a>, and <a href=/docs/deploy/security><strong>Security Hardening</strong></a> for enterprise compliance.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-26f5f78dacbf3daf14a3ddd2c1d928dd>1 - Install Pigsty for Production</h1><div class=lead>How to install Pigsty on Linux hosts for production?</div><p>This is the Pigsty production multi-node deployment guide. For single-node Demo/Dev setups, see <a href=/docs/setup/><strong>Getting Started</strong></a>.</p><hr><h2 id=summary>Summary</h2><p><a href=/docs/deploy/prepare><strong>Prepare</strong></a> <a href=/docs/deploy/prepare#node><strong>nodes</strong></a> with <a href=/docs/deploy/admin#ssh><strong>SSH access</strong></a> following your <a href=/docs/deploy/planning><strong>architecture plan</strong></a>,
install a <a href=/docs/ref/linux/><strong>compatible Linux OS</strong></a>, then execute with an <a href=/docs/deploy/admin><strong>admin user</strong></a> having passwordless <a href=/docs/deploy/admin#ssh><strong><code>ssh</code></strong></a> and <a href=/docs/deploy/admin#sudo><strong><code>sudo</code></strong></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>         <span style=color:#8f5902;font-style:italic># International</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>         <span style=color:#8f5902;font-style:italic># Backup Mirror</span>
</span></span></code></pre></div><p>This runs the <a href=#install><strong>install</strong></a> script, downloading and extracting Pigsty source to your home directory with dependencies installed. Complete <a href=#configure><strong>configuration</strong></a> and <a href=#deploy><strong>deployment</strong></a> to finish.</p><p>Before running <a href=/docs/setup/playbook><strong><code>deploy.yml</code></strong></a> for deployment, review and edit the <a href=/docs/concept/iac/inventory><strong>configuration inventory</strong></a>: <code>pigsty.yml</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty      <span style=color:#8f5902;font-style:italic># Enter Pigsty directory</span>
</span></span><span style=display:flex><span>./configure -g   <span style=color:#8f5902;font-style:italic># Generate config file (optional, skip if you know how to configure)</span>
</span></span><span style=display:flex><span>./deploy.yml     <span style=color:#8f5902;font-style:italic># Execute deployment playbook based on generated config</span>
</span></span></code></pre></div><p>After installation, access the <a href=/docs/setup/webui/><strong>WebUI</strong></a> via IP/domain + ports <code>80/443</code>,
and <a href=/docs/setup/pgsql/><strong>PostgreSQL service</strong></a> via port <code>5432</code>.</p><p>Full installation takes 3-10 minutes depending on specs/network. <a href=/docs/setup/offline/><strong>Offline installation</strong></a> significantly speeds this up; <a href=/docs/setup/slim/><strong>slim installation</strong></a> further accelerates when monitoring isn&rsquo;t needed.</p><p><strong>Video Example: 20-node Production Simulation (Ubuntu 24.04 x86_64)</strong></p><div id=asciinema-2d8762e5e8d05b72e98e654cb5544ae2 class="asciinema-container td-max-width-on-larger-screens" style="margin:1em 0"></div><script>(function(){var n,s="asciinema-2d8762e5e8d05b72e98e654cb5544ae2",o="/demo/install-simu.cast",e="solarized-light",i=null;function a(){var e=document.documentElement.getAttribute("data-bs-theme");return e==="dark"?"solarized-dark":e==="light"?"solarized-light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"solarized-dark":"solarized-light"}function r(){return e==="auto"?a():e}function t(){var e,t=document.getElementById(s);t.innerHTML="",e={theme:r(),speed:"1.3",startAt:0,fit:"width"},e.autoPlay=!0,e.loop=!0,e.markers=[[0,"Provision Servers"],[36,"Deploy"],[360,"Complete"]],i=AsciinemaPlayer.create(o,t,e)}t(),e==="auto"&&(n=new MutationObserver(function(e){e.forEach(function(e){e.attributeName==="data-bs-theme"&&t()})}),n.observe(document.documentElement,{attributes:!0}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){var e=document.documentElement.getAttribute("data-bs-theme");(!e||e==="auto")&&t()}))})()</script><hr><h2 id=prepare>Prepare</h2><p>Production Pigsty deployment involves <a href=/docs/deploy/prepare><strong>preparation work</strong></a>. Here&rsquo;s the complete checklist:</p><table class=full-width><thead><tr><th style=text-align:center>Item</th><th style=text-align:left>Requirement</th><th style=text-align:center>Item</th><th style=text-align:left>Requirement</th></tr></thead><tbody><tr><td style=text-align:center><a href=/docs/deploy/prepare#node><strong>Node</strong></a></td><td style=text-align:left>At least <code>1C2G</code>, no upper limit</td><td style=text-align:center><a href=/docs/deploy/planning><strong>Plan</strong></a></td><td style=text-align:left>Multiple homogeneous nodes: 2/3/4 or more</td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#disk><strong>Disk</strong></a></td><td style=text-align:left><code>/data</code> as default mount point</td><td style=text-align:center><a href=/docs/deploy/prepare#filesystem><strong>FS</strong></a></td><td style=text-align:left><code>xfs</code> recommended; <code>ext4</code>/<code>zfs</code> as needed</td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#vip><strong>VIP</strong></a></td><td style=text-align:left>L2 VIP, optional (unavailable in cloud)</td><td style=text-align:center><a href=/docs/deploy/prepare#network><strong>Network</strong></a></td><td style=text-align:left>Static IPv4, single-node can use <code>127.0.0.1</code></td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#ca><strong>CA</strong></a></td><td style=text-align:left>Self-signed CA or specify existing certs</td><td style=text-align:center><a href=/docs/deploy/prepare#domain><strong>Domain</strong></a></td><td style=text-align:left>Local/public domain, optional, default <code>h.pigsty</code></td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#linux><strong>Kernel</strong></a></td><td style=text-align:left><code>Linux</code> <code>x86_64</code> / <code>aarch64</code></td><td style=text-align:center><a href=/docs/deploy/prepare#linux><strong>Linux</strong></a></td><td style=text-align:left><code>el8</code>, <code>el9</code>, <code>el10</code>, <code>d12</code>, <code>d13</code>, <code>u22</code>, <code>u24</code></td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#locale><strong>Locale</strong></a></td><td style=text-align:left><code>C.UTF-8</code> or <code>C</code></td><td style=text-align:center><a href=/docs/deploy/admin#firewall><strong>Firewall</strong></a></td><td style=text-align:left>Ports: <code>80</code>/<code>443</code>/<code>22</code>/<code>5432</code> (optional)</td></tr><tr><td style=text-align:center><a href=/docs/deploy/admin#user><strong>User</strong></a></td><td style=text-align:left>Avoid <code>root</code> and <code>postgres</code></td><td style=text-align:center><a href=/docs/deploy/admin#sudo><strong>Sudo</strong></a></td><td style=text-align:left>sudo privilege, preferably with <code>nopass</code></td></tr><tr><td style=text-align:center><a href=/docs/deploy/admin#ssh><strong>SSH</strong></a></td><td style=text-align:left>Passwordless SSH via public key</td><td style=text-align:center><a href=/docs/deploy/admin#check-accessibility><strong>Accessible</strong></a></td><td style=text-align:left><code>ssh &lt;ip|alias> sudo ls</code> no error</td></tr></tbody></table><hr><h2 id=install>Install</h2><p>Use the following to automatically install the <a href=/docs/deploy/prepare#pigsty><strong>Pigsty source package</strong></a> to <code>~/pigsty</code> (recommended). Deployment dependencies (Ansible) are auto-installed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash            <span style=color:#8f5902;font-style:italic># Install latest stable version</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash            <span style=color:#8f5902;font-style:italic># Backup mirror</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash -s v4.0.0  <span style=color:#8f5902;font-style:italic># Install specific version</span>
</span></span></code></pre></div><p>If you prefer not to run remote scripts, manually <a href=https://github.com/pgsty/pigsty/releases><strong>download</strong></a> or clone the source. When using <code>git</code>, always checkout a specific version before use:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/pgsty/pigsty<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> pigsty<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>git checkout v4.0.0-b4<span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic># Always checkout a specific version when using git</span>
</span></span></code></pre></div><p>For manual download/clone, additionally run <a href=/docs/setup/offline#bootstrap><strong><code>bootstrap</code></strong></a> to manually install Ansible and other dependencies, or <a href=/docs/setup/playbook#install-ansible><strong>install them yourself</strong></a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./bootstrap           <span style=color:#8f5902;font-style:italic># Install ansible for subsequent deployment</span>
</span></span></code></pre></div><hr><h2 id=configure>Configure</h2><p>In Pigsty, deployment details are defined by the <a href=/docs/setup/config/><strong>configuration inventory</strong></a>—the <a href=https://github.com/pgsty/pigsty/blob/main/pigsty.yml><strong><code>pigsty.yml</code></strong></a> config file. Customize through declarative configuration.</p><p>Pigsty provides <a href=https://github.com/pgsty/pigsty/blob/main/configure><strong><code>configure</code></strong></a> as an optional <a href=/docs/concept/iac/configure><strong>configuration wizard</strong></a>,
generating a <a href=/docs/concept/iac/inventory/><strong>configuration inventory</strong></a> with good defaults based on your environment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -g                <span style=color:#8f5902;font-style:italic># Use wizard to generate config with random passwords</span>
</span></span></code></pre></div><p>The generated config defaults to <code>~/pigsty/pigsty.yml</code>. Review and customize before installation.</p><p>Many <a href=/docs/concept/iac/template/><strong>configuration templates</strong></a> are available for reference. You can skip the wizard and directly edit <code>pigsty.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -c ha/full -g       <span style=color:#8f5902;font-style:italic># Use 4-node sandbox template</span>
</span></span><span style=display:flex><span>./configure -c ha/trio -g       <span style=color:#8f5902;font-style:italic># Use 3-node minimal HA template</span>
</span></span><span style=display:flex><span>./configure -c ha/dual -g -v <span style=color:#0000cf;font-weight:700>17</span> <span style=color:#8f5902;font-style:italic># Use 2-node semi-HA template with PG 17</span>
</span></span><span style=display:flex><span>./configure -c ha/simu -s       <span style=color:#8f5902;font-style:italic># Use 20-node production simulation, skip IP check, no random passwords</span>
</span></span></code></pre></div><details><summary>Example configure output</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vagrant@meta:~/pigsty$ ./configure
</span></span><span style=display:flex><span>configure pigsty v4.0.0 begin
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>region</span> <span style=color:#ce5c00;font-weight:700>=</span> china
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>kernel</span>  <span style=color:#ce5c00;font-weight:700>=</span> Linux
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>=</span> x86_64
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>package</span> <span style=color:#ce5c00;font-weight:700>=</span> deb,apt
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>vendor</span>  <span style=color:#ce5c00;font-weight:700>=</span> ubuntu <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>version</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>22</span> <span style=color:#ce5c00;font-weight:700>(</span>22.04<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>sudo</span> <span style=color:#ce5c00;font-weight:700>=</span> vagrant ok
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>ssh</span> <span style=color:#ce5c00;font-weight:700>=</span> vagrant@127.0.0.1 ok
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>WARN<span style=color:#ce5c00;font-weight:700>]</span> Multiple IP address candidates found:
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>(</span>1<span style=color:#ce5c00;font-weight:700>)</span> 192.168.121.38	    inet 192.168.121.38/24 metric <span style=color:#0000cf;font-weight:700>100</span> brd 192.168.121.255 scope global dynamic eth0
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>(</span>2<span style=color:#ce5c00;font-weight:700>)</span> 10.10.10.10	    inet 10.10.10.10/24 brd 10.10.10.255 scope global eth1
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>primary_ip</span> <span style=color:#ce5c00;font-weight:700>=</span> 10.10.10.10 <span style=color:#ce5c00;font-weight:700>(</span>from demo<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>admin</span> <span style=color:#ce5c00;font-weight:700>=</span> vagrant@10.10.10.10 ok
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>mode</span> <span style=color:#ce5c00;font-weight:700>=</span> meta <span style=color:#ce5c00;font-weight:700>(</span>ubuntu22.04<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>locale</span>  <span style=color:#ce5c00;font-weight:700>=</span> C.UTF-8
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>ansible</span> <span style=color:#ce5c00;font-weight:700>=</span> ready
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> pigsty configured
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>WARN<span style=color:#ce5c00;font-weight:700>]</span> don<span style=color:#a40000>&#39;</span>t forget to check it and change passwords!
</span></span><span style=display:flex><span>proceed with ./deploy.yml
</span></span></code></pre></div></details><br><p>The wizard only replaces the <strong>current node&rsquo;s</strong> IP (use <code>-s</code> to skip replacement). For multi-node deployments, replace other node IPs manually.
Also customize the config as needed—modify default passwords, add nodes, etc.</p><p><strong>Common configure parameters</strong>:</p><table class=full-width><thead><tr><th style=text-align:left>Parameter</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>-c|--conf</code></td><td style=text-align:left>Specify <a href=/docs/conf/><strong>config template</strong></a> relative to <code>conf/</code>, without <code>.yml</code> suffix</td></tr><tr><td style=text-align:left><code>-v|--version</code></td><td style=text-align:left>PostgreSQL major version: <code>13</code>, <code>14</code>, <code>15</code>, <code>16</code>, <code>17</code>, <code>18</code></td></tr><tr><td style=text-align:left><code>-r|--region</code></td><td style=text-align:left>Upstream repo region for faster downloads: <code>default|china|europe</code></td></tr><tr><td style=text-align:left><code>-n|--non-interactive</code></td><td style=text-align:left>Use CLI params for primary IP, skip interactive wizard</td></tr><tr><td style=text-align:left><code>-x|--proxy</code></td><td style=text-align:left>Configure <a href=/docs/infra/param#proxy_env><code>proxy_env</code></a> from current environment variables</td></tr></tbody></table><p>If your machine has multiple IPs, explicitly specify one with <code>-i|--ip &lt;ipaddr></code> or provide it interactively.
The script replaces IP placeholder <code>10.10.10.10</code> with the current node&rsquo;s primary IPv4. Use a static IP; never use public IPs.</p><p>Generated config is at <code>~/pigsty/pigsty.yml</code>. Review and modify before installation.</p><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>Change default passwords!</div><p>We strongly recommend modifying default passwords and credentials before installation. See <a href=/docs/setup/security/#passwords><strong>Security Hardening</strong></a>.</p></div><hr><h2 id=deploy>Deploy</h2><p>Pigsty&rsquo;s <a href=/docs/setup/playbook/><strong><code>deploy.yml</code></strong></a> <a href=/docs/setup/playbook/><strong>playbook</strong></a> applies the <a href=#configure><strong>configuration</strong></a> blueprint to <strong>all target nodes</strong>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./deploy.yml     <span style=color:#8f5902;font-style:italic># Deploy everything on all nodes at once</span>
</span></span></code></pre></div><details><summary>Example deployment output</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>......
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#ce5c00;font-weight:700>[</span>pgsql : pgsql init <span style=color:#204a87;font-weight:700>done</span><span style=color:#ce5c00;font-weight:700>]</span> *************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#ce5c00;font-weight:700>[</span>10.10.10.11<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;msg&#34;</span>: <span style=color:#4e9a06>&#34;postgres://10.10.10.11/postgres | meta  | dbuser_meta dbuser_view &#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#ce5c00;font-weight:700>[</span>pg_monitor : load grafana datasource meta<span style=color:#ce5c00;font-weight:700>]</span> *******************************
</span></span><span style=display:flex><span>changed: <span style=color:#ce5c00;font-weight:700>[</span>10.10.10.11<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY RECAP *********************************************************************
</span></span><span style=display:flex><span>10.10.10.11                : <span style=color:#000>ok</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>302</span>  <span style=color:#000>changed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>232</span>  <span style=color:#000>unreachable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>failed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>skipped</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>65</span>   <span style=color:#000>rescued</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>ignored</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>localhost                  : <span style=color:#000>ok</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6</span>    <span style=color:#000>changed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span>    <span style=color:#000>unreachable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>failed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>skipped</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>    <span style=color:#000>rescued</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>ignored</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><p>When output ends with <code>pgsql init done</code>, <code>PLAY RECAP</code>, etc., installation is complete!</p></details><br><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>Upstream repo changes may cause online installation failures!</div><p>Upstream repos (Linux/PGDG) may break due to improper updates, causing deployment failures (quite common)!
For serious production deployments, we strongly recommend using verified <a href=/docs/setup/offline#offline-package><strong>offline packages</strong></a> for <a href=/docs/setup/offline><strong>offline installation</strong></a>.</p></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>Avoid running deploy playbook repeatedly!</div><p>Warning: Running <a href=https://github.com/pgsty/pigsty/blob/main/deploy.yml><strong><code>deploy.yml</code></strong></a> again on an initialized environment may restart services and overwrite configs. Be careful!</p></div><hr><h2 id=interface>Interface</h2><p>Assuming the <a href=/docs/conf/full><strong>4-node</strong></a> deployment template, your Pigsty environment should have a structure like:</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>10.10.10.10</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>10.10.10.11</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>10.10.10.12</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>10.10.10.13</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr></tbody></table><p>The <a href=/docs/infra><strong><code>INFRA</code></strong></a> module provides a <a href=/docs/setup/webui><strong>graphical management interface</strong></a> via browser, accessible through Nginx&rsquo;s <strong>80/443</strong> ports.</p><p>The <a href=/docs/pgsql/><strong><code>PGSQL</code></strong></a> module provides a <a href=/docs/setup/pgsql><strong>PostgreSQL database server</strong></a> on port <strong>5432</strong>, also accessible via Pgbouncer/HAProxy <a href=/docs/pgsql/service><strong>proxies</strong></a>.</p><p>For production multi-node HA PostgreSQL clusters, use <a href=/docs/pgsql/misc/svc><strong>service access</strong></a> for automatic traffic routing.</p><p><a href=https://demo.pigsty.io><img src=/img/pigsty/home.png alt></a></p><hr><h2 id=more>More</h2><p>After installation, explore the <a href=/docs/setup/webui/><strong>WebUI</strong></a> and access <a href=/docs/setup/pgsql/><strong>PostgreSQL service</strong></a> via port 5432.</p><p>Deploy and monitor <a href=/docs/conf/full><strong>more clusters</strong></a>—add definitions to the <a href=/docs/setup/config/><strong>configuration inventory</strong></a> and run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/node-add   pg-test      <span style=color:#8f5902;font-style:italic># Add pg-test cluster&#39;s 3 nodes to Pigsty management</span>
</span></span><span style=display:flex><span>bin/pgsql-add  pg-test      <span style=color:#8f5902;font-style:italic># Initialize a 3-node pg-test HA PG cluster</span>
</span></span><span style=display:flex><span>bin/redis-add  redis-ms     <span style=color:#8f5902;font-style:italic># Initialize Redis cluster: redis-ms</span>
</span></span></code></pre></div><p>Most modules require the <a href=/docs/node/><strong><code>NODE</code></strong></a> module first. See available <a href=/docs/ref/module/><strong>modules</strong></a>:</p><p><a href=/docs/pgsql/><strong><code>PGSQL</code></strong></a>, <a href=/docs/infra/><strong><code>INFRA</code></strong></a>, <a href=/docs/node/><strong><code>NODE</code></strong></a>, <a href=/docs/etcd/><strong><code>ETCD</code></strong></a>,
<a href=/docs/minio/><strong><code>MINIO</code></strong></a>, <a href=/docs/redis/><strong><code>REDIS</code></strong></a>, <a href=/docs/ferret/><strong><code>FERRET</code></strong></a>, <a href=/docs/docker/><strong><code>DOCKER</code></strong></a>&mldr;</p></div><div class=td-content style=page-break-before:always><h1 id=pg-374829cbbe6f2f715a9e6d868d9f9693>2 - Prepare Resources for Serious Deployment</h1><div class=lead>Production deployment preparation including hardware, nodes, disks, network, VIP, domain, software, and filesystem requirements.</div><p>Pigsty runs on nodes (physical machines or VMs). This document covers the planning and preparation required for deployment.</p><hr><h2 id=node>Node</h2><p>Pigsty currently runs on <code>Linux</code> kernel with <code>x86_64</code> / <code>aarch64</code> architecture.
A &ldquo;<strong>node</strong>&rdquo; refers to an SSH <a href=/docs/deploy/admin#check-accessibility><strong>accessible</strong></a> resource that provides a bare Linux OS environment.
It can be a physical machine, virtual machine, or a systemd-enabled container equipped with <code>systemd</code>, <code>sudo</code>, and <code>sshd</code>.</p><p>Deploying Pigsty requires at least <strong>1</strong> node. You can prepare more and deploy everything in one pass via <a href=/docs/setup/playbook#playbooks><strong>playbooks</strong></a>, or add nodes later.
The minimum spec requirement is <code>1C1G</code>, but at least <code>1C2G</code> is recommended. Higher is better—no upper limit. <strong>Parameters are auto-tuned based on available resources</strong>.</p><p>The number of nodes you need depends on your requirements. See <a href=/docs/deploy/planning><strong>Architecture Planning</strong></a> for details.
Although a <a href=/docs/setup/install><strong>single-node deployment</strong></a> with <a href=/docs/pgsql/backup/repository><strong>external backup</strong></a> provides reasonable recovery guarantees,
we recommend multiple nodes for production. A functioning <a href=/docs/deploy/planning#three-node-setup><strong>HA setup</strong></a> requires at least <strong>3</strong> nodes; <strong>2</strong> nodes provide <a href=/docs/deploy/planning#two-node-setup><strong>Semi-HA</strong></a>.</p><hr><h2 id=disk>Disk</h2><p>Pigsty uses <strong><code>/data</code></strong> as the default data directory. If you have a dedicated data disk, mount it there.
Use <code>/data1</code>, <code>/data2</code>, <code>/dataN</code> for additional disk drives.</p><p>To use a different data directory, configure these parameters:</p><table class=full-width><thead><tr><th>Name</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><a href=/docs/node/param#node_data><strong><code>node_data</code></strong></a></td><td>Node main data directory</td><td><code>/data</code></td></tr><tr><td><a href=/docs/pgsql/param#pg_fs_main><strong><code>pg_fs_main</code></strong></a></td><td>PG main data directory</td><td><code>/data/postgres</code></td></tr><tr><td><a href=/docs/pgsql/param#pg_fs_backup><strong><code>pg_fs_backup</code></strong></a></td><td>PG backup directory</td><td><code>/data/backups</code></td></tr><tr><td><a href=/docs/etcd/param#etcd_data><strong><code>etcd_data</code></strong></a></td><td>ETCD data directory</td><td><code>/data/etcd</code></td></tr><tr><td><a href=/docs/infra/param#infra_data><strong><code>infra_data</code></strong></a></td><td>Infra data directory</td><td><code>/data/infra</code></td></tr><tr><td><a href=/docs/infra/param#nginx_data><strong><code>nginx_data</code></strong></a></td><td>Nginx data directory</td><td><code>/data/nginx</code></td></tr><tr><td><a href=/docs/minio/param#minio_data><strong><code>minio_data</code></strong></a></td><td>MinIO data directory</td><td><code>/data/minio</code></td></tr><tr><td><a href=/docs/redis/param#redis_fs_main><strong><code>redis_fs_main</code></strong></a></td><td>Redis data directory</td><td><code>/data/redis</code></td></tr></tbody></table><hr><h2 id=filesystem>Filesystem</h2><p>You can use any supported Linux filesystem for data disks. For production, we recommend <strong><code>xfs</code></strong>.</p><p><code>xfs</code> is a Linux standard with excellent performance and CoW capabilities for instant large database cluster cloning. MinIO requires <code>xfs</code>.
<code>ext4</code> is another viable option with a richer data recovery tool ecosystem, but lacks CoW.
<code>zfs</code> provides RAID and snapshot features but with significant performance overhead and requires separate installation.</p><p>Choose among these three based on your needs. Avoid NFS for database services.</p><p>Pigsty assumes <code>/data</code> is owned by <code>root:root</code> with <code>755</code> permissions.
Admins can assign ownership for first-level directories; each application runs with a dedicated user in its subdirectory.
See <a href=/docs/ref/fhs><strong>FHS</strong></a> for the directory structure reference.</p><hr><h2 id=network>Network</h2><p>Pigsty defaults to online installation mode, requiring outbound Internet access.
<a href=/docs/setup/offline/><strong>Offline installation</strong></a> eliminates the Internet requirement.</p><p>Internally, Pigsty requires a <strong>static network</strong>. Assign a <strong>fixed</strong> IPv4 address to each node.</p><p>The IP address serves as the node&rsquo;s <strong>unique identifier</strong>—the primary IP bound to the main network interface for <strong>internal</strong> communications.</p><p>For <a href=/docs/setup/install><strong>single-node deployment</strong></a> without a fixed IP, use the loopback address <code>127.0.0.1</code> as a workaround.</p><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>Never use Public IP as identifier</div><p>Using public IP addresses as node identifiers can cause security and connectivity issues. Always use internal IP addresses.</p></div><hr><h2 id=vip>VIP</h2><p>Pigsty supports optional L2 VIP for NODE clusters (<code>keepalived</code>) and PGSQL clusters (<code>vip-manager</code>).</p><p>To use L2 VIP, you must explicitly assign an L2 VIP address for each node/database cluster.
This is straightforward on your own hardware but may be challenging in public cloud environments.</p><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>L2 VIP requires L2 Networking</div><p>To use optional Node VIP and PG VIP features, ensure all nodes are on the same L2 network.</p></div><hr><h2 id=ca>CA</h2><p>Pigsty generates a self-signed <a href=/docs/concept/sec/ca/><strong>CA infrastructure</strong></a> for each deployment, issuing all encryption certificates.</p><p>If you have an existing enterprise CA or self-signed CA, you can use it to issue the certificates Pigsty requires.</p><hr><h2 id=domain>Domain</h2><p>Pigsty uses a local static domain <code>i.pigsty</code> by default for WebUI access. This is optional—IP addresses work too.</p><p>For production, domain names are recommended to enable HTTPS and encrypted data transmission.
Domains also allow multiple services on the same port, differentiated by domain name.</p><p>For <strong>Internet-facing</strong> deployments, use public DNS providers (Cloudflare, AWS Route53, etc.) to manage resolution.
Point your domain to the Pigsty node&rsquo;s <strong>public IP address</strong>.
For <strong>LAN/office network</strong> deployments, use internal DNS servers with the node&rsquo;s <strong>internal IP address</strong>.</p><p>For local-only access, add the following to <code>/etc/hosts</code> on machines accessing the Pigsty WebUI:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.10 i.pigsty    <span style=color:#8f5902;font-style:italic># Replace with your domain and Pigsty node IP</span>
</span></span></code></pre></div><hr><h2 id=linux>Linux</h2><p>Pigsty runs on <strong>Linux</strong>. It supports <strong>14</strong> mainstream distributions: <a href=/docs/ref/linux/><strong>Compatible OS List</strong></a></p><p>We recommend <strong>RockyLinux 10.0</strong>, <strong>Debian 13.2</strong>, or <strong>Ubuntu 24.04.2</strong> as default options.</p><p>On macOS and Windows, use VM software or Docker systemd images to run Pigsty.</p><p>We <strong>strongly recommend</strong> a fresh OS installation. If your server already runs Nginx, PostgreSQL, or similar services, consider deploying on new nodes.</p><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>Use the same OS version on all nodes</div><p>For multi-node deployments, ensure all nodes use the same Linux distribution, architecture, and version. Heterogeneous deployments may work but are unsupported and may cause unpredictable issues.</p></div><hr><h2 id=locale>Locale</h2><p>We recommend setting <code>en_US</code> as the primary OS language, or <strong>at minimum ensuring this locale is available</strong>, so PostgreSQL logs are in English.</p><p>Some distributions (e.g., Debian) may not provide the <code>en_US</code> locale by default. Enable it with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>localedef -i en_US -f UTF-8 en_US.UTF-8
</span></span><span style=display:flex><span>localectl set-locale <span style=color:#000>LANG</span><span style=color:#ce5c00;font-weight:700>=</span>en_US.UTF-8
</span></span></code></pre></div><p>For PostgreSQL, we strongly recommend using the built-in <code>C.UTF-8</code> collation (PG 17+) as the default.</p><p>The <a href=/docs/setup/playbook#configure><strong>configuration wizard</strong></a> automatically sets <code>C.UTF-8</code> as the collation when PG version and OS support are detected.</p><hr><h2 id=ansible>Ansible</h2><p>Pigsty uses <a href=/docs/setup/playbook/><strong>Ansible</strong></a> to control all managed nodes from the admin node.
See <a href=/docs/setup/playbook#install-ansible><strong>Installing Ansible</strong></a> for details.</p><p>Pigsty installs Ansible on Infra nodes by default, making them usable as admin nodes (or backup admin nodes).
For <a href=/docs/setup/install><strong>single-node deployment</strong></a>, the installation node serves as both the <a href=/docs/concept/arch/node#admin-node><strong>admin node</strong></a> running Ansible and the <a href=/docs/concept/arch/node#infra-node><strong>INFRA node</strong></a> hosting infrastructure.</p><hr><h2 id=pigsty>Pigsty</h2><p>You can <a href=/docs/deploy/install#install><strong>install</strong></a> the latest stable Pigsty source with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>         <span style=color:#8f5902;font-style:italic># International</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>         <span style=color:#8f5902;font-style:italic># Backup Mirror</span>
</span></span></code></pre></div><p>To <a href=/docs/deploy/install#install><strong>install</strong></a> a specific version, use the <strong><code>-s &lt;version></code></strong> parameter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash -s v4.0.0
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v4.0.0
</span></span></code></pre></div><p>To <a href=/docs/deploy/install#install><strong>install</strong></a> the latest beta version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/beta <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/beta <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>For developers or the latest development version, clone the repository directly:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/pgsty/pigsty.git<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> pigsty<span style=color:#000;font-weight:700>;</span> git checkout v4.0.0
</span></span></code></pre></div><p>If your environment lacks Internet access, download the source tarball from <a href=https://github.com/pgsty/pigsty/releases/><strong>GitHub Releases</strong></a> or the Pigsty repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://repo.pigsty.io/src/pigsty-v4.0.0.tgz
</span></span><span style=display:flex><span>wget https://repo.pigsty.cc/src/pigsty-v4.0.0.tgz
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9acb71881039d3570f14c9a9caf9563c>3 - Planning Architecture and Nodes</h1><div class=lead>How many nodes? Which modules need HA? How to plan based on available resources and requirements?</div><p>Pigsty uses a <a href=/docs/concept/arch><strong>modular architecture</strong></a>. You can combine modules like building blocks and express your intent through <a href=/docs/concept/iac><strong>declarative configuration</strong></a>.</p><h2 id=common-patterns>Common Patterns</h2><p>Here are common deployment patterns for reference. Customize based on your requirements:</p><table class=full-width><thead><tr><th style=text-align:center>Pattern</th><th style=text-align:center><a href=/docs/infra/><strong>INFRA</strong></a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/pgsql/><strong>PGSQL</strong></a></th><th style=text-align:center><a href=/docs/minio><strong>MINIO</strong></a></th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>Single-node (<a href=/docs/conf/meta><strong><code>meta</code></strong></a>)</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center></td><td><a href=/docs/setup/install><strong>Single-node deployment</strong></a> default</td></tr><tr><td style=text-align:center>Slim deploy (<a href=/docs/conf/slim><strong><code>slim</code></strong></a>)</td><td style=text-align:center></td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center></td><td>Database only, no monitoring infra</td></tr><tr><td style=text-align:center>Infra-only (<a href=/docs/conf/infra><strong><code>infra</code></strong></a>)</td><td style=text-align:center>1</td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td>Monitoring infrastructure only</td></tr><tr><td style=text-align:center>Rich deploy (<a href=/docs/conf/rich><strong><code>rich</code></strong></a>)</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td>Single-node + object storage + local repo with all extensions</td></tr></tbody></table><table class=full-width><thead><tr><th style=text-align:center>Multi-node Pattern</th><th style=text-align:center><a href=/docs/infra/><strong>INFRA</strong></a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/pgsql/><strong>PGSQL</strong></a></th><th style=text-align:center><a href=/docs/minio><strong>MINIO</strong></a></th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>Two-node (<a href=/docs/conf/dual><strong><code>dual</code></strong></a>)</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>2</td><td style=text-align:center></td><td>Semi-HA, tolerates specific node failure</td></tr><tr><td style=text-align:center>Three-node (<a href=/docs/conf/trio><strong><code>trio</code></strong></a>)</td><td style=text-align:center>3</td><td style=text-align:center>3</td><td style=text-align:center>3</td><td style=text-align:center></td><td>Standard HA, tolerates any one failure</td></tr><tr><td style=text-align:center>Four-node (<a href=/docs/conf/full><strong><code>full</code></strong></a>)</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1+3</td><td style=text-align:center></td><td>Demo setup, single INFRA/ETCD</td></tr><tr><td style=text-align:center>Production (<a href=/docs/conf/simu><strong><code>simu</code></strong></a>)</td><td style=text-align:center>2</td><td style=text-align:center>3</td><td style=text-align:center>n</td><td style=text-align:center>n</td><td>2 INFRA, 3 ETCD</td></tr><tr><td style=text-align:center>Large-scale (custom)</td><td style=text-align:center>3</td><td style=text-align:center>5</td><td style=text-align:center>n</td><td style=text-align:center>n</td><td>3 INFRA, 5 ETCD</td></tr></tbody></table><p>Your architecture choice depends on reliability requirements and available resources.
Serious production deployments require at least <strong>3</strong> nodes for <a href=#three-node-setup><strong>HA configuration</strong></a>.
With only <strong>2</strong> nodes, use <a href=#two-node-setup><strong>Semi-HA configuration</strong></a>.</p><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>Expert Consulting: Architecture Planning</div><p>We offer <a href=/price><strong>Architecture Consulting Services</strong></a> to help plan your Pigsty configuration.</p></div><hr><h2 id=trade-offs>Trade-offs</h2><ul><li>Pigsty monitoring requires at least <strong>1</strong> INFRA node. Production typically uses <strong>2</strong>; large-scale deployments use <strong>3</strong>.</li><li>PostgreSQL HA requires at least <strong>1</strong> ETCD node. Production typically uses <strong>3</strong>; large-scale uses <strong>5</strong>. Must be odd numbers.</li><li>Object storage (MinIO) requires at least <strong>1</strong> <a href=/docs/minio/config#single-node-single-drive><strong>MINIO node</strong></a>. Production typically uses 4+ nodes in <a href=/docs/minio/config#multi-node-multi-drive><strong>MNMD</strong></a> clusters.</li><li>Production PG clusters typically use at least two-node primary-replica configuration; serious deployments use 3 nodes; high read loads can have dozens of replicas.</li><li>For PostgreSQL, you can also use advanced configurations: offline instances, sync instances, standby clusters, delayed clusters, etc.</li></ul><hr><h2 id=single-node-setup>Single-Node Setup</h2><p>The simplest configuration with everything on a single node. Installs four essential modules by default. Typically used for demos, devbox, or testing.</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr></tbody></table><p>With an external S3/MinIO <a href=/docs/pgsql/backup/><strong>backup repository</strong></a> providing RTO/RPO guarantees, this configuration works for standard production environments.</p><p>Single-node variants:</p><ul><li><strong>Rich</strong> (<a href=/docs/conf/rich><strong><code>rich</code></strong></a>): Production single-node template with local MinIO object storage, local software repo, and all PG extensions.</li><li><strong>Slim</strong> (<a href=/docs/conf/slim><strong><code>slim</code></strong></a>): Installs only <a href=/docs/pgsql/><strong>PGSQL</strong></a> and <a href=/docs/etcd/><strong>ETCD</strong></a>, no monitoring infra. <a href=/docs/setup/slim><strong>Slim installation</strong></a> can expand to <a href=/docs/setup/slim#ha-cluster><strong>multi-node HA deployment</strong></a>.</li><li><strong>Infra-only</strong> (<a href=/docs/conf/infra><strong><code>infra</code></strong></a>): Opposite of slim—installs only <a href=/docs/infra/><strong>INFRA</strong></a> monitoring infrastructure, no database services, for monitoring other instances.</li><li><strong>Alternative kernels</strong>: Replace vanilla PG with derivatives: <a href=/docs/conf/pgsql/><strong><code>pgsql</code></strong></a>, <a href=/docs/conf/citus/><strong><code>citus</code></strong></a>, <a href=/docs/conf/mssql/><strong><code>mssql</code></strong></a>, <a href=/docs/conf/polar/><strong><code>polar</code></strong></a>, <a href=/docs/conf/ivory/><strong><code>ivory</code></strong></a>, <a href=/docs/conf/mysql/><strong><code>mysql</code></strong></a>, <a href=/docs/conf/pgtde/><strong><code>pgtde</code></strong></a>, <a href=/docs/conf/oriole/><strong><code>oriole</code></strong></a>, <a href=/docs/conf/supabase/><strong><code>supabase</code></strong></a>.</li></ul><hr><h2 id=two-node-setup>Two-Node Setup</h2><p><a href=/docs/conf/dual><strong>Two-node configuration</strong></a> enables database replication and <strong>Semi-HA</strong> capability with better data redundancy and limited failover support:</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code> (<code>replica</code>)</td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-meta-2</code> (<code>primary</code>)</td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><p>Two-node HA auto-failover has limitations. This &ldquo;Semi-HA&rdquo; setup only auto-recovers from specific node failures:</p><ul><li>If <code>node-1</code> fails: No automatic failover—requires manual promotion of <code>node-2</code></li><li>If <code>node-2</code> fails: Automatic failover works—<code>node-1</code> auto-promoted</li></ul><hr><h2 id=three-node-setup>Three-Node Setup</h2><p><a href=/docs/conf/trio><strong>Three-node template</strong></a> provides true baseline HA configuration, tolerating any single node failure with automatic recovery.</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-meta-2</code></td><td style=text-align:center><code>infra-2</code></td><td style=text-align:center><code>etcd-2</code></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-meta-3</code></td><td style=text-align:center><code>infra-3</code></td><td style=text-align:center><code>etcd-3</code></td></tr></tbody></table><hr><h2 id=four-node-setup>Four-Node Setup</h2><p>Pigsty <a href=/docs/deploy/sandbox/><strong>Sandbox</strong></a> uses the <a href=/docs/conf/full><strong>standard four-node configuration</strong></a>.</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>node-4</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><p>For demo purposes, <a href=/docs/infra><strong>INFRA</strong></a> / <a href=/docs/etcd><strong>ETCD</strong></a> modules aren&rsquo;t configured for HA. You can adjust further:</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/minio/><strong>MINIO</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td><td style=text-align:center><code>minio-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center><code>infra-2</code></td><td style=text-align:center><code>etcd-2</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-3</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>node-4</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><hr><h2 id=more-nodes>More Nodes</h2><p>With proper virtualization infrastructure or abundant resources, you can <a href=/docs/conf/simu><strong>use more nodes</strong></a> for <strong>dedicated deployment</strong> of each module, achieving optimal reliability, observability, and performance.</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/minio/><strong>MINIO</strong></a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>10.10.10.10</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-meta-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>10.10.10.11</code></td><td style=text-align:center><code>infra-2</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-meta-2</code></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>10.10.10.21</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-1</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>10.10.10.22</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-2</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>5</td><td style=text-align:center><code>10.10.10.23</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-3</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>6</td><td style=text-align:center><code>10.10.10.31</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-1</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>7</td><td style=text-align:center><code>10.10.10.32</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-2</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>8</td><td style=text-align:center><code>10.10.10.33</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-3</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>9</td><td style=text-align:center><code>10.10.10.34</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-4</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>10</td><td style=text-align:center><code>10.10.10.40</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-src-1</code></td></tr><tr><td style=text-align:center>11</td><td style=text-align:center><code>10.10.10.41</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-src-2</code></td></tr><tr><td style=text-align:center>12</td><td style=text-align:center><code>10.10.10.42</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-src-3</code></td></tr><tr><td style=text-align:center>13</td><td style=text-align:center><code>10.10.10.50</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-test-1</code></td></tr><tr><td style=text-align:center>14</td><td style=text-align:center><code>10.10.10.51</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-test-2</code></td></tr><tr><td style=text-align:center>15</td><td style=text-align:center><code>10.10.10.52</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-test-3</code></td></tr><tr><td style=text-align:center>16</td><td style=text-align:center>&mldr;&mldr;</td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-7679452458507892fa3756a891f5287a>4 - Setup Admin User and Privileges</h1><div class=lead>Admin user, sudo, SSH, accessibility verification, and firewall configuration</div><p>Pigsty requires an OS <strong>admin user</strong> with passwordless <a href=#ssh><strong>SSH</strong></a> and <a href=#sudo><strong>Sudo</strong></a> privileges on all managed nodes.</p><p>This user must be able to SSH to all managed nodes and execute sudo commands on them.</p><hr><h2 id=user>User</h2><p>Typically use names like <code>dba</code> or <code>admin</code>, avoiding <code>root</code> and <code>postgres</code>:</p><ul><li>Using <code>root</code> for deployment is possible but not a production best practice.</li><li>Using <code>postgres</code> (<a href=/docs/pgsql/param#pg_dbsu><strong><code>pg_dbsu</code></strong></a>) as admin user is strictly prohibited.</li></ul><hr><h2 id=passwordless>Passwordless</h2><p>The passwordless requirement is optional if you can accept entering a password for every <code>ssh</code> and <code>sudo</code> command.</p><p>Use <code>-k|--ask-pass</code> when <a href=/docs/setup/playbook/><strong>running playbooks</strong></a> to prompt for <strong>SSH</strong> password,
and <code>-K|--ask-become-pass</code> to prompt for <strong>sudo</strong> password.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./deploy.yml -k -K
</span></span></code></pre></div><p>Some enterprise security policies may prohibit passwordless <code>ssh</code> or <code>sudo</code>. In such cases, use the options above,
or consider configuring a sudoers rule with a longer password cache time to reduce password prompts.</p><hr><h2 id=create-admin-user>Create Admin User</h2><p>Typically, your server/VM provider creates an initial admin user.</p><p>If unsatisfied with that user, Pigsty&rsquo;s deployment playbook can <a href=#create-admin-user><strong>create a new admin user</strong></a> for you.</p><p>Assuming you have root access or an existing admin user on the node, create an admin user with Pigsty itself:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -k -K -t node_admin -e <span style=color:#000>ansible_user</span><span style=color:#ce5c00;font-weight:700>=[</span>your_existing_admin<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>This leverages the existing admin to create a new one—a dedicated <code>dba</code> (uid=88) user described by these parameters, with sudo/ssh properly configured:</p><table class=full-width><thead><tr><th>Name</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><a href=/docs/node/param#node_admin_enabled><code>node_admin_enabled</code></a></td><td>Enable node admin user</td><td><code>true</code></td></tr><tr><td><a href=/docs/node/param#node_admin_uid><code>node_admin_uid</code></a></td><td>Node admin user UID</td><td><code>88</code></td></tr><tr><td><a href=/docs/node/param#node_admin_username><code>node_admin_username</code></a></td><td>Node admin username</td><td><code>dba</code></td></tr></tbody></table><hr><h2 id=sudo>Sudo</h2><p>All <a href=#user><strong>admin users</strong></a> should have <code>sudo</code> privileges on all managed nodes, preferably with passwordless execution.</p><p>To configure an admin user with passwordless <code>sudo</code> from scratch, edit/create a sudoers file (assuming username <code>vagrant</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;%vagrant ALL=(ALL) NOPASSWD: ALL&#39;</span> <span style=color:#000;font-weight:700>|</span> sudo tee /etc/sudoers.d/vagrant
</span></span></code></pre></div><p>For admin user <code>dba</code>, the <code>/etc/sudoers.d/dba</code> content should be:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>%dba <span style=color:#000>ALL</span><span style=color:#ce5c00;font-weight:700>=(</span>ALL<span style=color:#ce5c00;font-weight:700>)</span> NOPASSWD: ALL
</span></span></code></pre></div><p>If your security policy prohibits passwordless <code>sudo</code>, remove the <code>NOPASSWD:</code> part:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>%dba <span style=color:#000>ALL</span><span style=color:#ce5c00;font-weight:700>=(</span>ALL<span style=color:#ce5c00;font-weight:700>)</span> ALL
</span></span></code></pre></div><p>Ansible relies on <code>sudo</code> to execute commands with root privileges on managed nodes.
In environments where <code>sudo</code> is unavailable (e.g., inside Docker containers), install <code>sudo</code> first.</p><hr><h2 id=ssh>SSH</h2><p>Your current user should have passwordless SSH access to all managed nodes as the corresponding admin user.</p><p>Your current user can be the admin user itself, but this isn&rsquo;t required—as long as you can SSH as the admin user.</p><p>SSH configuration is Linux 101, but here are the basics:</p><h3 id=generate-ssh-key>Generate SSH Key</h3><p>If you don&rsquo;t have an SSH key pair, generate one:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#0000cf;font-weight:700>2048</span> -N <span style=color:#4e9a06>&#39;&#39;</span> -f ~/.ssh/id_rsa -q
</span></span></code></pre></div><p>Pigsty will do this for you during the <a href=/docs/setup/offline#bootstrap><code>bootstrap</code></a> stage if you lack a key pair.</p><h3 id=copy-ssh-key>Copy SSH Key</h3><p>Distribute your generated public key to remote (and local) servers, placing it in the admin user&rsquo;s <code>~/.ssh/authorized_keys</code> file on all nodes.
Use the <code>ssh-copy-id</code> utility:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-copy-id &lt;ip&gt;                        <span style=color:#8f5902;font-style:italic># Interactive password entry</span>
</span></span><span style=display:flex><span>sshpass -p &lt;password&gt; ssh-copy-id &lt;ip&gt;  <span style=color:#8f5902;font-style:italic># Non-interactive (use with caution)</span>
</span></span></code></pre></div><h3 id=using-alias>Using Alias</h3><p>When direct SSH access is unavailable (jumpserver, non-standard port, different credentials), configure SSH aliases in <code>~/.ssh/config</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Host meta
</span></span><span style=display:flex><span>    HostName 10.10.10.10
</span></span><span style=display:flex><span>    User dba                      <span style=color:#8f5902;font-style:italic># Different user on remote</span>
</span></span><span style=display:flex><span>    IdentityFile /etc/dba/id_rsa  <span style=color:#8f5902;font-style:italic># Non-standard key</span>
</span></span><span style=display:flex><span>    Port <span style=color:#0000cf;font-weight:700>24</span>                       <span style=color:#8f5902;font-style:italic># Non-standard port</span>
</span></span></code></pre></div><p>Reference the alias in the inventory using <code>ansible_host</code> for the real SSH alias:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nodes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># If node `10.10.10.10` requires SSH alias `meta`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ansible_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Access via `ssh meta`</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>SSH parameters work directly in Ansible. See <a href=https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#connecting-to-hosts-behavioral-inventory-parameters>Ansible Inventory Guide</a> for details.
This technique enables accessing nodes in private networks via jumpservers, or using different ports and credentials,
or using your local laptop as an admin node.</p><hr><h2 id=check-accessibility>Check Accessibility</h2><p>You should be able to passwordlessly <code>ssh</code> from the admin node to all managed nodes as your current user.
The remote user (admin user) should have privileges to run passwordless <code>sudo</code> commands.</p><p>To verify passwordless ssh/sudo works, run this command on the admin node for all managed nodes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh &lt;ip<span style=color:#000;font-weight:700>|</span>alias&gt; <span style=color:#4e9a06>&#39;sudo ls&#39;</span>
</span></span></code></pre></div><p>If there&rsquo;s no password prompt or error, passwordless ssh/sudo is working as expected.</p><hr><h2 id=firewall>Firewall</h2><p>Production deployments typically require firewall configuration to block unauthorized port access.</p><p>By default, block inbound access from office/Internet networks except:</p><ul><li>SSH port <code>22</code> for node access</li><li>HTTP (<code>80</code>) / HTTPS (<code>443</code>) for WebUI services</li><li>PostgreSQL port <code>5432</code> for database access</li></ul><p>If accessing PostgreSQL via other ports, allow them accordingly.
See <a href=/docs/node/><strong>used ports</strong></a> for the complete port list.</p><ul><li><code>5432</code>: PostgreSQL database</li><li><code>6432</code>: Pgbouncer connection pooler</li><li><code>5433</code>: PG primary service</li><li><code>5434</code>: PG replica service</li><li><code>5436</code>: PG default service</li><li><code>5438</code>: PG offline service</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-aa44e6b5b4b5d27a4235af210a56fc6e>5 - Sandbox</h1><div class=lead>4-node sandbox environment for learning, testing, and demonstration</div><p>Pigsty provides a standard 4-node <strong>sandbox</strong> environment for learning, testing, and feature demonstration.</p><p>The sandbox uses fixed IP addresses and predefined identity identifiers, making it easy to reproduce various demo use cases.</p><hr><h2 id=description>Description</h2><p>The default sandbox environment consists of 4 nodes, using the <a href=https://github.com/pgsty/pigsty/blob/main/conf/ha/full.yml><code>ha/full.yml</code></a> configuration template.</p><table><thead><tr><th style=text-align:center>ID</th><th style=text-align:center>IP Address</th><th style=text-align:center>Node</th><th style=text-align:center>PostgreSQL</th><th style=text-align:center>INFRA</th><th style=text-align:center>ETCD</th><th style=text-align:center>MINIO</th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>10.10.10.10</code></td><td style=text-align:center><code>meta</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td><td style=text-align:center><code>minio-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>10.10.10.11</code></td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>10.10.10.12</code></td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>10.10.10.13</code></td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><p>The sandbox configuration can be summarized as the following config:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq:  1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v4.0.0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><img src=/img/pigsty/sandbox.png alt=pigsty-sandbox></p><h3 id=postgresql-clusters>PostgreSQL Clusters</h3><p>The sandbox comes with a single-instance PostgreSQL cluster <code>pg-meta</code> on the <code>meta</code> node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.10 meta pg-meta-1
</span></span><span style=display:flex><span>10.10.10.2  pg-meta          <span style=color:#8f5902;font-style:italic># Optional L2 VIP</span>
</span></span></code></pre></div><p>There&rsquo;s also a 3-instance PostgreSQL HA cluster <code>pg-test</code> deployed on the other three nodes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.11 node-1 pg-test-1
</span></span><span style=display:flex><span>10.10.10.12 node-2 pg-test-2
</span></span><span style=display:flex><span>10.10.10.13 node-3 pg-test-3
</span></span><span style=display:flex><span>10.10.10.3  pg-test          <span style=color:#8f5902;font-style:italic># Optional L2 VIP</span>
</span></span></code></pre></div><p>Two optional L2 VIPs are bound to the primary instances of <code>pg-meta</code> and <code>pg-test</code> clusters respectively.</p><h3 id=infrastructure>Infrastructure</h3><p>The <code>meta</code> node also hosts:</p><ul><li><strong>ETCD cluster</strong>: Single-node <code>etcd</code> cluster providing DCS service for PostgreSQL HA</li><li><strong>MinIO cluster</strong>: Single-node <code>minio</code> cluster providing S3-compatible object storage</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.10 etcd-1
</span></span><span style=display:flex><span>10.10.10.10 minio-1
</span></span></code></pre></div><hr><h2 id=creating-sandbox>Creating Sandbox</h2><p>Pigsty provides out-of-the-box templates. You can use <a href=/docs/deploy/vagrant/><strong>Vagrant</strong></a> to create a local sandbox, or use <a href=/docs/deploy/terraform/><strong>Terraform</strong></a> to create a cloud sandbox.</p><h3 id=local-sandbox-vagrant>Local Sandbox (Vagrant)</h3><p>Local sandbox uses VirtualBox/libvirt to create local virtual machines, running free on your Mac / PC.</p><p>To run the full 4-node sandbox, your machine should have at least <strong>4 CPU cores</strong> and <strong>8GB memory</strong>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>make full       <span style=color:#8f5902;font-style:italic># Create 4-node sandbox with default RockyLinux 9 image</span>
</span></span><span style=display:flex><span>make full9      <span style=color:#8f5902;font-style:italic># Create 4-node sandbox with RockyLinux 9</span>
</span></span><span style=display:flex><span>make full12     <span style=color:#8f5902;font-style:italic># Create 4-node sandbox with Debian 12</span>
</span></span><span style=display:flex><span>make full24     <span style=color:#8f5902;font-style:italic># Create 4-node sandbox with Ubuntu 24.04</span>
</span></span></code></pre></div><p>For more details, please refer to <a href=/docs/deploy/vagrant/><strong>Vagrant</strong></a> documentation.</p><h3 id=cloud-sandbox-terraform>Cloud Sandbox (Terraform)</h3><p>Cloud sandbox uses public cloud API to create virtual machines. Easy to create and destroy, pay-as-you-go, ideal for quick testing.</p><p>Use <a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-full.tf><code>spec/aliyun-full.tf</code></a> template to create a 4-node sandbox on Alibaba Cloud:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>cp spec/aliyun-full.tf terraform.tf
</span></span><span style=display:flex><span>terraform init
</span></span><span style=display:flex><span>terraform apply
</span></span></code></pre></div><p>For more details, please refer to <a href=/docs/deploy/terraform/><strong>Terraform</strong></a> documentation.</p><hr><h2 id=other-specs>Other Specs</h2><p>Besides the standard 4-node sandbox, Pigsty also provides other environment specs:</p><h3 id=single-node-devbox-meta>Single Node Devbox (meta)</h3><p>The simplest 1-node environment for quick start, development, and testing:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make meta       <span style=color:#8f5902;font-style:italic># Create single-node devbox</span>
</span></span></code></pre></div><h3 id=two-node-environment-dual>Two Node Environment (dual)</h3><p>2-node environment for testing primary-replica replication:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make dual       <span style=color:#8f5902;font-style:italic># Create 2-node environment</span>
</span></span></code></pre></div><h3 id=three-node-environment-trio>Three Node Environment (trio)</h3><p>3-node environment for testing basic high availability:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make trio       <span style=color:#8f5902;font-style:italic># Create 3-node environment</span>
</span></span></code></pre></div><h3 id=production-simulation-simu>Production Simulation (simu)</h3><p>20-node large simulation environment for full production environment testing:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make simu       <span style=color:#8f5902;font-style:italic># Create 20-node production simulation environment</span>
</span></span></code></pre></div><p>This environment includes:</p><ul><li>3 infrastructure nodes (<code>meta1</code>, <code>meta2</code>, <code>meta3</code>)</li><li>2 HAProxy proxy nodes</li><li>4 MinIO nodes</li><li>5 ETCD nodes</li><li>6 PostgreSQL nodes (2 clusters, 3 nodes each)</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6c08c58dc7691eda288baa9ba0766305>6 - Vagrant</h1><div class=lead>Create local virtual machine environment with Vagrant</div><p><a href=https://www.vagrantup.com/><strong>Vagrant</strong></a> is a popular local virtualization tool that creates local virtual machines in a declarative manner.</p><p>Pigsty requires a Linux environment to run. You can use Vagrant to easily create Linux virtual machines locally for testing.</p><hr><h2 id=quick-start>Quick Start</h2><h3 id=install-dependencies>Install Dependencies</h3><p>First, ensure you have <a href=https://www.vagrantup.com/><strong>Vagrant</strong></a> and a virtual machine provider (such as <a href=https://www.virtualbox.org/><strong>VirtualBox</strong></a> or <a href=https://libvirt.org/><strong>libvirt</strong></a>) installed on your system.</p><p>On macOS, you can use <a href=https://brew.sh/><strong>Homebrew</strong></a> for one-click installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/bin/bash -c <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>brew install vagrant virtualbox ansible
</span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>VirtualBox requires reboot after installation</div><p>After installing VirtualBox, you need to restart your system and allow its kernel extensions in System Preferences.</p></div><p>On Linux, you can use VirtualBox or <a href=https://vagrant-libvirt.github.io/vagrant-libvirt/><strong>vagrant-libvirt</strong></a> as the VM provider.</p><h3 id=create-virtual-machines>Create Virtual Machines</h3><p>Use the Pigsty-provided <code>make</code> shortcuts to create virtual machines:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make meta       <span style=color:#8f5902;font-style:italic># 1 node devbox for quick start, development, and testing</span>
</span></span><span style=display:flex><span>make full       <span style=color:#8f5902;font-style:italic># 4 node sandbox for HA testing and feature demonstration</span>
</span></span><span style=display:flex><span>make simu       <span style=color:#8f5902;font-style:italic># 20 node simubox for production environment simulation</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Other less common specs</span>
</span></span><span style=display:flex><span>make dual       <span style=color:#8f5902;font-style:italic># 2 node environment</span>
</span></span><span style=display:flex><span>make trio       <span style=color:#8f5902;font-style:italic># 3 node environment</span>
</span></span><span style=display:flex><span>make deci       <span style=color:#8f5902;font-style:italic># 10 node environment</span>
</span></span></code></pre></div><p>You can use variant aliases to specify different operating system images:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make meta9      <span style=color:#8f5902;font-style:italic># Create single node with RockyLinux 9</span>
</span></span><span style=display:flex><span>make full12     <span style=color:#8f5902;font-style:italic># Create 4-node sandbox with Debian 12</span>
</span></span><span style=display:flex><span>make simu24     <span style=color:#8f5902;font-style:italic># Create 20-node simubox with Ubuntu 24.04</span>
</span></span></code></pre></div><p>Available OS suffixes: <code>7</code> (EL7), <code>8</code> (EL8), <code>9</code> (EL9), <code>10</code> (EL10), <code>11</code> (Debian 11), <code>12</code> (Debian 12), <code>13</code> (Debian 13), <code>20</code> (Ubuntu 20.04), <code>22</code> (Ubuntu 22.04), <code>24</code> (Ubuntu 24.04)</p><h3 id=build-environment>Build Environment</h3><p>You can also use the following aliases to create Pigsty build environments. These templates won&rsquo;t replace the base image:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make oss        <span style=color:#8f5902;font-style:italic># 3 node OSS build environment</span>
</span></span><span style=display:flex><span>make pro        <span style=color:#8f5902;font-style:italic># 5 node PRO build environment</span>
</span></span><span style=display:flex><span>make rpm        <span style=color:#8f5902;font-style:italic># 3 node EL7/8/9 build environment</span>
</span></span><span style=display:flex><span>make deb        <span style=color:#8f5902;font-style:italic># 5 node Debian11/12 Ubuntu20/22/24 build environment</span>
</span></span><span style=display:flex><span>make all        <span style=color:#8f5902;font-style:italic># 7 node full build environment</span>
</span></span></code></pre></div><hr><h2 id=spec-templates>Spec Templates</h2><p>Pigsty provides multiple predefined VM specs in the <a href=https://github.com/pgsty/pigsty/tree/main/vagrant/spec><code>vagrant/spec/</code></a> directory:</p><table><thead><tr><th style=text-align:center>Template</th><th style=text-align:center>Nodes</th><th style=text-align:center>Spec</th><th style=text-align:center>Description</th><th style=text-align:center>Alias</th></tr></thead><tbody><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/meta.rb>meta.rb</a></td><td style=text-align:center>1 node</td><td style=text-align:center>2c4g x 1</td><td style=text-align:center>Single-node devbox</td><td style=text-align:center>Devbox</td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/dual.rb>dual.rb</a></td><td style=text-align:center>2 nodes</td><td style=text-align:center>1c2g x 2</td><td style=text-align:center>Two-node environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/trio.rb>trio.rb</a></td><td style=text-align:center>3 nodes</td><td style=text-align:center>1c2g x 3</td><td style=text-align:center>Three-node environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/full.rb>full.rb</a></td><td style=text-align:center>4 nodes</td><td style=text-align:center>2c4g + 1c2g x 3</td><td style=text-align:center>4-node full sandbox</td><td style=text-align:center>Sandbox</td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/deci.rb>deci.rb</a></td><td style=text-align:center>10 nodes</td><td style=text-align:center>Mixed</td><td style=text-align:center>10-node environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/simu.rb>simu.rb</a></td><td style=text-align:center>20 nodes</td><td style=text-align:center>Mixed</td><td style=text-align:center>20-node production simubox</td><td style=text-align:center>Simubox</td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/minio.rb>minio.rb</a></td><td style=text-align:center>4 nodes</td><td style=text-align:center>1c2g x 4 + disk</td><td style=text-align:center>MinIO test environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/oss.rb>oss.rb</a></td><td style=text-align:center>3 nodes</td><td style=text-align:center>1c2g x 3</td><td style=text-align:center>3-node OSS build environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/pro.rb>pro.rb</a></td><td style=text-align:center>5 nodes</td><td style=text-align:center>1c2g x 5</td><td style=text-align:center>5-node PRO build environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/rpm.rb>rpm.rb</a></td><td style=text-align:center>3 nodes</td><td style=text-align:center>1c2g x 3</td><td style=text-align:center>3-node EL build environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/deb.rb>deb.rb</a></td><td style=text-align:center>5 nodes</td><td style=text-align:center>1c2g x 5</td><td style=text-align:center>5-node Deb build environment</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/all.rb>all.rb</a></td><td style=text-align:center>7 nodes</td><td style=text-align:center>1c2g x 7</td><td style=text-align:center>7-node full build environment</td><td style=text-align:center></td></tr></tbody></table><p>Each spec file contains a <code>Specs</code> variable describing the VM nodes. For example, <code>full.rb</code> contains the 4-node sandbox definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#8f5902;font-style:italic># full: pigsty full-featured 4-node sandbox for HA-testing &amp; tutorial &amp; practices</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>Specs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;meta&#34;</span>   <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.10&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;4096&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;node-1&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.11&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2048&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;node-2&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.12&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2048&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;node-3&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.13&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2048&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h3 id=simu-spec-details>simu Spec Details</h3><p><code>simu.rb</code> provides a 20-node production environment simulation configuration:</p><ul><li>3 x infra nodes (<code>meta1-3</code>): 4c16g</li><li>2 x haproxy nodes (<code>proxy1-2</code>): 1c2g</li><li>4 x minio nodes (<code>minio1-4</code>): 1c2g</li><li>5 x etcd nodes (<code>etcd1-5</code>): 1c2g</li><li>6 x pgsql nodes (<code>pg-src-1-3</code>, <code>pg-dst-1-3</code>): 2c4g</li></ul><hr><h2 id=config-script>Config Script</h2><p>Use the <a href=https://github.com/pgsty/pigsty/blob/main/vagrant/config><code>vagrant/config</code></a> script to generate the final <code>Vagrantfile</code> based on spec and options:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>vagrant/config <span style=color:#ce5c00;font-weight:700>[</span>spec<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>image<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>scale<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>provider<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Examples</span>
</span></span><span style=display:flex><span>vagrant/config meta                <span style=color:#8f5902;font-style:italic># Use 1-node spec with default EL9 image</span>
</span></span><span style=display:flex><span>vagrant/config dual el9            <span style=color:#8f5902;font-style:italic># Use 2-node spec with EL9 image</span>
</span></span><span style=display:flex><span>vagrant/config trio d12 <span style=color:#0000cf;font-weight:700>2</span>          <span style=color:#8f5902;font-style:italic># Use 3-node spec with Debian 12, double resources</span>
</span></span><span style=display:flex><span>vagrant/config full u22 <span style=color:#0000cf;font-weight:700>4</span>          <span style=color:#8f5902;font-style:italic># Use 4-node spec with Ubuntu 22, 4x resources</span>
</span></span><span style=display:flex><span>vagrant/config simu u24 <span style=color:#0000cf;font-weight:700>1</span> libvirt  <span style=color:#8f5902;font-style:italic># Use 20-node spec with Ubuntu 24, libvirt provider</span>
</span></span></code></pre></div><h3 id=image-aliases>Image Aliases</h3><p>The config script supports various image aliases:</p><table><thead><tr><th>Distro</th><th>Alias</th><th>Vagrant Box</th></tr></thead><tbody><tr><td>CentOS 7</td><td><code>el7</code>, <code>7</code>, <code>centos</code></td><td><code>generic/centos7</code></td></tr><tr><td>Rocky 8</td><td><code>el8</code>, <code>8</code>, <code>rocky8</code></td><td><code>bento/rockylinux-9</code></td></tr><tr><td>Rocky 9</td><td><code>el9</code>, <code>9</code>, <code>rocky9</code>, <code>el</code></td><td><code>bento/rockylinux-9</code></td></tr><tr><td>Rocky 10</td><td><code>el10</code>, <code>rocky10</code></td><td><code>rockylinux/10</code></td></tr><tr><td>Debian 11</td><td><code>d11</code>, <code>11</code>, <code>debian11</code></td><td><code>generic/debian11</code></td></tr><tr><td>Debian 12</td><td><code>d12</code>, <code>12</code>, <code>debian12</code></td><td><code>generic/debian12</code></td></tr><tr><td>Debian 13</td><td><code>d13</code>, <code>13</code>, <code>debian13</code></td><td><code>cloud-image/debian-13</code></td></tr><tr><td>Ubuntu 20.04</td><td><code>u20</code>, <code>20</code>, <code>ubuntu20</code></td><td><code>generic/ubuntu2004</code></td></tr><tr><td>Ubuntu 22.04</td><td><code>u22</code>, <code>22</code>, <code>ubuntu22</code>, <code>ubuntu</code></td><td><code>generic/ubuntu2204</code></td></tr><tr><td>Ubuntu 24.04</td><td><code>u24</code>, <code>24</code>, <code>ubuntu24</code></td><td><code>bento/ubuntu-24.04</code></td></tr></tbody></table><h3 id=resource-scaling>Resource Scaling</h3><p>You can use the <code>VM_SCALE</code> environment variable to adjust the resource multiplier (default is <code>1</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>VM_SCALE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span> vagrant/config meta     <span style=color:#8f5902;font-style:italic># Double the CPU/memory resources for meta spec</span>
</span></span></code></pre></div><p>For example, using <code>VM_SCALE=4</code> with the meta spec will adjust the default 2c4g to 8c16g:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#000>Specs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;meta&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.10&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;8&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;16384&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>simu spec doesn't support scaling</div><p>The <code>simu</code> spec doesn&rsquo;t support resource scaling. The scale parameter will be automatically ignored because its resource configuration is already optimized for simulation scenarios.</p></div><hr><h2 id=vm-management>VM Management</h2><p>Pigsty provides a set of Makefile shortcuts for managing virtual machines:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make           <span style=color:#8f5902;font-style:italic># Equivalent to make start</span>
</span></span><span style=display:flex><span>make new       <span style=color:#8f5902;font-style:italic># Destroy existing VMs and create new ones</span>
</span></span><span style=display:flex><span>make ssh       <span style=color:#8f5902;font-style:italic># Write VM SSH config to ~/.ssh/ (must run after creation)</span>
</span></span><span style=display:flex><span>make dns       <span style=color:#8f5902;font-style:italic># Write VM DNS records to /etc/hosts (optional)</span>
</span></span><span style=display:flex><span>make start     <span style=color:#8f5902;font-style:italic># Start VMs and configure SSH (up + ssh)</span>
</span></span><span style=display:flex><span>make up        <span style=color:#8f5902;font-style:italic># Start VMs with vagrant up</span>
</span></span><span style=display:flex><span>make halt      <span style=color:#8f5902;font-style:italic># Shutdown VMs (alias: down, dw)</span>
</span></span><span style=display:flex><span>make clean     <span style=color:#8f5902;font-style:italic># Destroy VMs (alias: del, destroy)</span>
</span></span><span style=display:flex><span>make status    <span style=color:#8f5902;font-style:italic># Show VM status (alias: st)</span>
</span></span><span style=display:flex><span>make pause     <span style=color:#8f5902;font-style:italic># Pause VMs (alias: suspend)</span>
</span></span><span style=display:flex><span>make resume    <span style=color:#8f5902;font-style:italic># Resume VMs</span>
</span></span><span style=display:flex><span>make nuke      <span style=color:#8f5902;font-style:italic># Destroy all VMs and volumes with virsh (libvirt only)</span>
</span></span><span style=display:flex><span>make info      <span style=color:#8f5902;font-style:italic># Show libvirt info (VMs, networks, storage volumes)</span>
</span></span></code></pre></div><hr><h2 id=ssh-keys>SSH Keys</h2><p>Pigsty Vagrant templates use your <code>~/.ssh/id_rsa[.pub]</code> as the SSH key for VMs by default.</p><p>Before starting, ensure you have a valid SSH key pair. If not, generate one with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#0000cf;font-weight:700>2048</span> -N <span style=color:#4e9a06>&#39;&#39;</span> -f ~/.ssh/id_rsa -q
</span></span></code></pre></div><hr><h2 id=supported-images>Supported Images</h2><p>Pigsty currently uses the following Vagrant Boxes for testing:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># x86_64 / amd64</span>
</span></span><span style=display:flex><span>el8 :  bento/rockylinux-8     <span style=color:#ce5c00;font-weight:700>(</span>libvirt, 202502.21.0, <span style=color:#ce5c00;font-weight:700>(</span>amd64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>el9 :  bento/rockylinux-9     <span style=color:#ce5c00;font-weight:700>(</span>libvirt, 202502.21.0, <span style=color:#ce5c00;font-weight:700>(</span>amd64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>el10:  rockylinux/10          <span style=color:#ce5c00;font-weight:700>(</span>libvirt<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d11 :  generic/debian11       <span style=color:#ce5c00;font-weight:700>(</span>libvirt, 4.3.12, <span style=color:#ce5c00;font-weight:700>(</span>amd64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>d12 :  generic/debian12       <span style=color:#ce5c00;font-weight:700>(</span>libvirt, 4.3.12, <span style=color:#ce5c00;font-weight:700>(</span>amd64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>d13 :  cloud-image/debian-13  <span style=color:#ce5c00;font-weight:700>(</span>libvirt<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>u20 :  generic/ubuntu2004     <span style=color:#ce5c00;font-weight:700>(</span>libvirt, 4.3.12, <span style=color:#ce5c00;font-weight:700>(</span>amd64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>u22 :  generic/ubuntu2204     <span style=color:#ce5c00;font-weight:700>(</span>libvirt, 4.3.12, <span style=color:#ce5c00;font-weight:700>(</span>amd64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>u24 :  bento/ubuntu-24.04     <span style=color:#ce5c00;font-weight:700>(</span>libvirt, 20250316.0.0, <span style=color:#ce5c00;font-weight:700>(</span>amd64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span></code></pre></div><p>For Apple Silicon (aarch64) architecture, fewer images are available:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># aarch64 / arm64</span>
</span></span><span style=display:flex><span>bento/rockylinux-9 <span style=color:#ce5c00;font-weight:700>(</span>virtualbox, 202502.21.0, <span style=color:#ce5c00;font-weight:700>(</span>arm64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>bento/ubuntu-24.04 <span style=color:#ce5c00;font-weight:700>(</span>virtualbox, 202502.21.0, <span style=color:#ce5c00;font-weight:700>(</span>arm64<span style=color:#ce5c00;font-weight:700>))</span>
</span></span></code></pre></div><p>You can find more available Box images on <a href=https://app.vagrantup.com/bento/boxes><strong>Vagrant Cloud</strong></a>.</p><hr><h2 id=environment-variables>Environment Variables</h2><p>You can use the following environment variables to control Vagrant behavior:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_SPEC</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;meta&#39;</span>              <span style=color:#8f5902;font-style:italic># Spec name</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;bento/rockylinux-9&#39;</span>  <span style=color:#8f5902;font-style:italic># Image name</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_SCALE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;1&#39;</span>                <span style=color:#8f5902;font-style:italic># Resource scaling multiplier</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_PROVIDER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;virtualbox&#39;</span>    <span style=color:#8f5902;font-style:italic># Virtualization provider</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VAGRANT_EXPERIMENTAL</span><span style=color:#ce5c00;font-weight:700>=</span>disks  <span style=color:#8f5902;font-style:italic># Enable experimental disk features</span>
</span></span></code></pre></div><hr><h2 id=notes>Notes</h2><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>VirtualBox Network Configuration</div><p>When using older versions of VirtualBox as Vagrant provider, additional configuration is required to use <code>10.x.x.x</code> CIDR as Host-Only network:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;* 10.0.0.0/8&#34;</span> <span style=color:#000;font-weight:700>|</span> sudo tee -a /etc/vbox/networks.conf
</span></span></code></pre></div></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>First-time image download is slow</div><p>The first time you use Vagrant to start a specific operating system, it will download the corresponding Box image file (typically 1-2 GB). After download, the image is cached and reused for subsequent VM creation.</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>libvirt Provider</div><p>If you&rsquo;re using libvirt as the provider, you can use <code>make info</code> to view VMs, networks, and storage volume information, and <code>make nuke</code> to forcefully destroy all related resources.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-87e7f74da392ae65771e6fb357b13c6f>7 - Terraform</h1><div class=lead>Create virtual machine environment on public cloud with Terraform</div><p><a href=https://www.terraform.io/><strong>Terraform</strong></a> is a popular &ldquo;Infrastructure as Code&rdquo; tool that you can use to create virtual machines on public clouds with one click.</p><p>Pigsty provides Terraform templates for Alibaba Cloud, AWS, and Tencent Cloud as examples.</p><hr><h2 id=quick-start>Quick Start</h2><h3 id=install-terraform>Install Terraform</h3><p>On macOS, you can use <a href=https://brew.sh/><strong>Homebrew</strong></a> to install Terraform:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install terraform
</span></span></code></pre></div><p>For other platforms, refer to the <a href=https://developer.hashicorp.com/terraform/install><strong>Terraform Official Installation Guide</strong></a>.</p><h3 id=initialize-and-apply>Initialize and Apply</h3><p>Enter the Terraform directory, select a template, initialize provider plugins, and apply the configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>cp spec/aliyun-meta.tf terraform.tf   <span style=color:#8f5902;font-style:italic># Select template</span>
</span></span><span style=display:flex><span>terraform init                         <span style=color:#8f5902;font-style:italic># Install cloud provider plugins (first use)</span>
</span></span><span style=display:flex><span>terraform apply                        <span style=color:#8f5902;font-style:italic># Generate execution plan and create resources</span>
</span></span></code></pre></div><p>After running the <code>apply</code> command, type <code>yes</code> to confirm when prompted. Terraform will create VMs and related cloud resources for you.</p><h3 id=get-ip-address>Get IP Address</h3><p>After creation, print the public IP address of the admin node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform output <span style=color:#000;font-weight:700>|</span> grep -Eo <span style=color:#4e9a06>&#39;[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}&#39;</span>
</span></span></code></pre></div><h3 id=configure-ssh-access>Configure SSH Access</h3><p>Use the <code>ssh</code> script to automatically configure SSH aliases and distribute keys:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./ssh    <span style=color:#8f5902;font-style:italic># Write SSH config to ~/.ssh/pigsty_config and copy keys</span>
</span></span></code></pre></div><p>This script writes the IP addresses from Terraform output to <code>~/.ssh/pigsty_config</code> and automatically distributes SSH keys using the default password <code>PigstyDemo4</code>.</p><p>After configuration, you can login directly using hostnames:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh meta    <span style=color:#8f5902;font-style:italic># Login using hostname instead of IP</span>
</span></span></code></pre></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>Using SSH Config File</div><p>If you want to use the configuration in <code>~/.ssh/pigsty_config</code>, ensure your <code>~/.ssh/config</code> includes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Include ~/.ssh/pigsty_config
</span></span></code></pre></div></div><h3 id=destroy-resources>Destroy Resources</h3><p>After testing, you can destroy all created cloud resources with one click:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform destroy
</span></span></code></pre></div><hr><h2 id=template-specs>Template Specs</h2><p>Pigsty provides multiple predefined cloud resource templates in the <a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec><code>terraform/spec/</code></a> directory:</p><table><thead><tr><th>Template File</th><th>Cloud Provider</th><th>Description</th></tr></thead><tbody><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-meta.tf><code>aliyun-meta.tf</code></a></td><td>Alibaba Cloud</td><td>Single-node meta template, supports all distros and AMD/ARM (default)</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-meta-s3.tf><code>aliyun-meta-s3.tf</code></a></td><td>Alibaba Cloud</td><td>Single-node template + OSS bucket for PITR backup</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-full.tf><code>aliyun-full.tf</code></a></td><td>Alibaba Cloud</td><td>4-node sandbox template, supports all distros and AMD/ARM</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-oss.tf><code>aliyun-oss.tf</code></a></td><td>Alibaba Cloud</td><td>5-node build template, supports all distros and AMD/ARM</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-pro.tf><code>aliyun-pro.tf</code></a></td><td>Alibaba Cloud</td><td>Multi-distro test template for cross-OS testing</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aws-cn.tf><code>aws-cn.tf</code></a></td><td>AWS</td><td>AWS China region 4-node environment</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/tencentcloud.tf><code>tencentcloud.tf</code></a></td><td>Tencent Cloud</td><td>Tencent Cloud 4-node environment</td></tr></tbody></table><p>When using a template, copy the template file to <code>terraform.tf</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>cp spec/aliyun-full.tf terraform.tf   <span style=color:#8f5902;font-style:italic># Use Alibaba Cloud 4-node sandbox template</span>
</span></span><span style=display:flex><span>terraform init <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> terraform apply
</span></span></code></pre></div><hr><h2 id=variable-configuration>Variable Configuration</h2><p>Pigsty&rsquo;s Terraform templates use variables to control architecture, OS distribution, and resource configuration:</p><h3 id=architecture-and-distribution>Architecture and Distribution</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#204a87;font-weight:700>variable</span> <span style=color:#4e9a06>&#34;architecture&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  description</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Architecture type (amd64 or arm64)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  type</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#000>  default</span>     <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;amd64&#34;</span><span style=color:#8f5902;font-style:italic>    # Comment this line to use arm64
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  #default     = &#34;arm64&#34;   # Uncomment to use arm64
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>variable</span> <span style=color:#4e9a06>&#34;distro&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  description</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Distribution code (el8,el9,el10,u22,u24,d12,d13)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  type</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#000>  default</span>     <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;el9&#34;</span><span style=color:#8f5902;font-style:italic>       # Default uses Rocky Linux 9
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=resource-configuration>Resource Configuration</h3><p>The following resource parameters can be configured in the <code>locals</code> block:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#204a87;font-weight:700>locals</span> {
</span></span><span style=display:flex><span><span style=color:#000>  bandwidth</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>100</span><span style=color:#8f5902;font-style:italic>                    # Public bandwidth (Mbps)
</span></span></span><span style=display:flex><span><span style=color:#000>  disk_size</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>40</span><span style=color:#8f5902;font-style:italic>                     # System disk size (GB)
</span></span></span><span style=display:flex><span><span style=color:#000>  spot_policy</span>      <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;SpotWithPriceLimit&#34;</span><span style=color:#8f5902;font-style:italic>   # Spot policy: NoSpot, SpotWithPriceLimit, SpotAsPriceGo
</span></span></span><span style=display:flex><span><span style=color:#000>  spot_price_limit</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#8f5902;font-style:italic>                      # Max spot price (only effective with SpotWithPriceLimit)
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=alibaba-cloud-configuration>Alibaba Cloud Configuration</h2><h3 id=credential-setup>Credential Setup</h3><p>Add your Alibaba Cloud credentials to environment variables, for example in <code>~/.bash_profile</code> or <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ALICLOUD_ACCESS_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_access_key&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ALICLOUD_SECRET_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_secret_key&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ALICLOUD_REGION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;cn-shanghai&#34;</span>
</span></span></code></pre></div><h3 id=supported-images>Supported Images</h3><p>The following are commonly used <a href=https://help.aliyun.com/zh/ecs/user-guide/public-mirroring-overview><strong>ECS Public OS Image</strong></a> prefixes in Alibaba Cloud:</p><table><thead><tr><th>Distro</th><th>Code</th><th>x86_64 Image Prefix</th><th>aarch64 Image Prefix</th></tr></thead><tbody><tr><td>CentOS 7.9</td><td><code>el7</code></td><td><code>centos_7_9_x64</code></td><td>-</td></tr><tr><td>Rocky 8.10</td><td><code>el8</code></td><td><code>rockylinux_8_10_x64</code></td><td><code>rockylinux_8_10_arm64</code></td></tr><tr><td>Rocky 9.6</td><td><code>el9</code></td><td><code>rockylinux_9_6_x64</code></td><td><code>rockylinux_9_6_arm64</code></td></tr><tr><td>Rocky 10.0</td><td><code>el10</code></td><td><code>rockylinux_10_0_x64</code></td><td><code>rockylinux_10_0_arm64</code></td></tr><tr><td>Debian 11.11</td><td><code>d11</code></td><td><code>debian_11_11_x64</code></td><td>-</td></tr><tr><td>Debian 12.11</td><td><code>d12</code></td><td><code>debian_12_11_x64</code></td><td><code>debian_12_11_arm64</code></td></tr><tr><td>Debian 13.2</td><td><code>d13</code></td><td><code>debian_13_2_x64</code></td><td><code>debian_13_2_arm64</code></td></tr><tr><td>Ubuntu 20.04</td><td><code>u20</code></td><td><code>ubuntu_20_04_x64</code></td><td>-</td></tr><tr><td>Ubuntu 22.04</td><td><code>u22</code></td><td><code>ubuntu_22_04_x64</code></td><td><code>ubuntu_22_04_arm64</code></td></tr><tr><td>Ubuntu 24.04</td><td><code>u24</code></td><td><code>ubuntu_24_04_x64</code></td><td><code>ubuntu_24_04_arm64</code></td></tr><tr><td>Anolis 8.9</td><td><code>an8</code></td><td><code>anolisos_8_9_x64</code></td><td>-</td></tr><tr><td>Alibaba Cloud Linux 3</td><td><code>al3</code></td><td><code>aliyun_3_0_x64</code></td><td>-</td></tr></tbody></table><h3 id=oss-storage-configuration>OSS Storage Configuration</h3><p>The <code>aliyun-meta-s3.tf</code> template additionally creates an OSS bucket and related permissions for PostgreSQL PITR backup:</p><ul><li><strong>OSS Bucket</strong>: Creates a private bucket named <code>pigsty-oss</code></li><li><strong>RAM User</strong>: Creates a dedicated <code>pigsty-oss-user</code> user</li><li><strong>Access Key</strong>: Generates AccessKey and saves to <code>~/pigsty.sk</code></li><li><strong>IAM Policy</strong>: Grants full access to the bucket</li></ul><hr><h2 id=aws-configuration>AWS Configuration</h2><h3 id=credential-setup-1>Credential Setup</h3><p>Set up AWS configuration and credential files:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ~/.aws/config</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>region</span> <span style=color:#ce5c00;font-weight:700>=</span> cn-northwest-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ~/.aws/credentials</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>aws_access_key_id</span> <span style=color:#ce5c00;font-weight:700>=</span> &lt;YOUR_AWS_ACCESS_KEY&gt;
</span></span><span style=display:flex><span><span style=color:#000>aws_secret_access_key</span> <span style=color:#ce5c00;font-weight:700>=</span> &lt;AWS_ACCESS_SECRET&gt;
</span></span></code></pre></div><p>If you need to use SSH keys, place the key files at:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/.aws/pigsty-key
</span></span><span style=display:flex><span>~/.aws/pigsty-key.pub
</span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>AWS templates may need adjustments</div><p>AWS templates are community-contributed examples and may need adjustments based on your specific requirements.</p></div><hr><h2 id=tencent-cloud-configuration>Tencent Cloud Configuration</h2><h3 id=credential-setup-2>Credential Setup</h3><p>Add Tencent Cloud credentials to environment variables:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>TENCENTCLOUD_SECRET_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_secret_id&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>TENCENTCLOUD_SECRET_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_secret_key&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>TENCENTCLOUD_REGION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;ap-beijing&#34;</span>
</span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>Tencent Cloud templates may need adjustments</div><p>Tencent Cloud templates are community-contributed examples and may need adjustments based on your specific requirements.</p></div><hr><h2 id=shortcut-commands>Shortcut Commands</h2><p>Pigsty provides some Makefile shortcuts for Terraform operations:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make u          <span style=color:#8f5902;font-style:italic># terraform apply -auto-approve + configure SSH</span>
</span></span><span style=display:flex><span>make d          <span style=color:#8f5902;font-style:italic># terraform destroy -auto-approve</span>
</span></span><span style=display:flex><span>make apply      <span style=color:#8f5902;font-style:italic># terraform apply (interactive confirmation)</span>
</span></span><span style=display:flex><span>make destroy    <span style=color:#8f5902;font-style:italic># terraform destroy (interactive confirmation)</span>
</span></span><span style=display:flex><span>make out        <span style=color:#8f5902;font-style:italic># terraform output</span>
</span></span><span style=display:flex><span>make ssh        <span style=color:#8f5902;font-style:italic># Run ssh script to configure SSH access</span>
</span></span><span style=display:flex><span>make r          <span style=color:#8f5902;font-style:italic># Reset terraform.tf to repository state</span>
</span></span></code></pre></div><hr><h2 id=notes>Notes</h2><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>Cloud Resource Costs</div><p>Cloud resources created with Terraform incur costs. After testing, promptly use <code>terraform destroy</code> to destroy resources to avoid unnecessary expenses.</p><p>It&rsquo;s recommended to use pay-as-you-go instance types for testing. Templates default to using Spot Instances to reduce costs.</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>Default Password</div><p>The default root password for VMs in all templates is <code>PigstyDemo4</code>. In production environments, be sure to change this password or use SSH key authentication.</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>Security Group Configuration</div><p>Terraform templates automatically create security groups and open necessary ports (all TCP ports open by default). In production environments, adjust security group rules according to actual needs, following the principle of least privilege.</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>SSH Access</div><p>After creation, SSH login to the admin node using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh root@&lt;public_ip&gt;
</span></span></code></pre></div><p>You can also use <code>./ssh</code> or <code>make ssh</code> to write SSH aliases to the config file, then login using <code>ssh pg-meta</code>.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8783a52d352cd41160ffaa5b596ca07f>8 - Security</h1><div class=lead>Security considerations for production Pigsty deployment</div><p>Pigsty&rsquo;s default configuration is sufficient to cover the security needs of most scenarios.</p><p>Pigsty already provides out-of-the-box <a href=/docs/pgsql/config/hba>authentication</a> and <a href=/docs/concept/sec/ac/>access control</a> models that are secure enough for most scenarios.</p><p><a href=/docs/concept/sec/ac/><img src=/img/pigsty/acl.jpg alt=pigsty-acl.jpg></a></p><p>If you want to further harden system security, here are some recommendations:</p><hr><h2 id=confidentiality>Confidentiality</h2><h3 id=important-files>Important Files</h3><p><strong>Protect your pigsty.yml configuration file or CMDB</strong></p><ul><li>The <code>pigsty.yml</code> configuration file usually contains highly sensitive confidential information. You should ensure its security.</li><li>Strictly control access permissions to admin nodes, limiting access to DBAs or Infra administrators only.</li><li>Strictly control access permissions to the pigsty.yml configuration file repository (if you manage it with git)</li></ul><p><strong>Protect your CA private key and other certificates, these files are very important.</strong></p><ul><li>Related files are generated by default in the <code>files/pki</code> directory under the Pigsty source directory on the admin node.</li><li>You should regularly back them up to a secure location.</li></ul><br><hr><h3 id=passwords>Passwords</h3><p><strong>You MUST change these passwords when deploying to production, don&rsquo;t use defaults!</strong></p><ul><li><a href=/docs/infra/param#grafana_admin_password><strong><code>grafana_admin_password</code></strong></a> : <code>pigsty</code></li><li><a href=/docs/pgsql/param#pg_admin_password><strong><code>pg_admin_password</code></strong></a> : <code>DBUser.DBA</code></li><li><a href=/docs/pgsql/param#pg_monitor_password><strong><code>pg_monitor_password</code></strong></a> : <code>DBUser.Monitor</code></li><li><a href=/docs/pgsql/param#pg_replication_password><strong><code>pg_replication_password</code></strong></a> : <code>DBUser.Replicator</code></li><li><a href=/docs/pgsql/param#patroni_password><strong><code>patroni_password</code></strong></a> : <code>Patroni.API</code></li><li><a href=/docs/node/param#haproxy_admin_password><strong><code>haproxy_admin_password</code></strong></a> : <code>pigsty</code></li><li><a href=/docs/minio/param#minio_access_key><strong><code>minio_access_key</code></strong></a> : <code>minioadmin</code></li><li><a href=/docs/minio/param#minio_secret_key><strong><code>minio_secret_key</code></strong></a> : <code>minioadmin</code></li></ul><p><strong>If using MinIO, change the default MinIO user passwords and references in pgbackrest</strong></p><ul><li>Modify MinIO regular user password: <a href=/docs/minio/param#minio_users><strong><code>minio_users</code></strong><code>.</code>[pgbackrest]<code>.</code>secret_key`</a></li><li>Modify the backup user password used by pgbackrest for MinIO: <a href=/docs/pgsql/param#pgbackrest_repo><strong><code>pgbackrest_repo</code></strong><code>.</code>minio<code>.</code>s3_key_secret`</a></li></ul><p><strong>If using remote backup repositories, enable backup encryption and set encryption passwords</strong></p><ul><li>Set [<strong><code>pgbackrest_repo</code></strong><code>.</code>*<code>.</code>cipher_type<code>](/docs/pgsql/param#pgbackrest_repo) to </code>aes-256-cbc`</li><li>You can use <code>${pg_cluster}</code> as part of the password to avoid all clusters using the same password</li></ul><p><strong>Use secure and reliable password encryption algorithms for PostgreSQL</strong></p><ul><li>Use <a href=/docs/pgsql/param#pg_pwd_enc><strong><code>pg_pwd_enc</code></strong></a> default value <code>scram-sha-256</code> instead of legacy <code>md5</code></li><li>This is the default behavior. Unless there&rsquo;s a special reason (supporting legacy old clients), don&rsquo;t change it back to <code>md5</code></li></ul><p><strong>Use <code>passwordcheck</code> extension to enforce strong passwords</strong></p><ul><li>Add <code>$lib/passwordcheck</code> to <a href=/docs/pgsql/param#pg_libs><strong><code>pg_libs</code></strong></a> to enforce password policies.</li></ul><p><strong>Encrypt remote backups with encryption algorithms</strong></p><ul><li>Use <code>repo_cipher_type</code> in <a href=/docs/pgsql/param#pgbackrest_repo><strong><code>pgbackrest_repo</code></strong></a> backup repository definitions to enable encryption</li></ul><p><strong>Configure automatic password expiration for business users</strong></p><ul><li><p>You should set an automatic password expiration time for each <a href=/docs/pgsql/config/user#define-users>business user</a> to meet compliance requirements.</p></li><li><p>After configuring auto-expiration, don&rsquo;t forget to regularly update these passwords during maintenance.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_meta , password: Pleas3-ChangeThisPwd ,expire_in: 7300 ,pgbouncer: true ,roles: [ dbrole_admin ]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_view , password: Make.3ure-Compl1ance  ,expire_in: 7300 ,pgbouncer: true ,roles: [ dbrole_readonly ] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer for meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres     ,superuser: true  ,expire_in: 7300                        ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system superuser }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replicator ,replication: true  ,expire_in: 7300 ,roles: [pg_monitor, dbrole_readonly]   ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system replicator }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_dba   ,superuser: true  ,expire_in: 7300 ,roles: [dbrole_admin]  ,pgbouncer: true ,pool_mode: session, pool_connlimit: 16 , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_monitor ,roles: [pg_monitor] ,expire_in: 7300 ,pgbouncer: true ,parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>log_min_duration_statement: 1000 } ,pool_mode: session ,pool_connlimit: 8 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql monitor user }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li></ul><p><strong>Don&rsquo;t log password change statements to postgres logs or other logs</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SET log_statement TO <span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>ALTER USER <span style=color:#4e9a06>&#34;{{ user.name }}&#34;</span> PASSWORD <span style=color:#4e9a06>&#39;{{ user.password }}&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>SET log_statement TO DEFAULT<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><br><hr><h3 id=ip-addresses>IP Addresses</h3><p><strong>Bind specified IP addresses for postgres/pgbouncer/patroni, not all addresses.</strong></p><ul><li>The default <a href=/docs/pgsql/param#pg_listen><strong><code>pg_listen</code></strong></a> address is <code>0.0.0.0</code>, meaning all IPv4 addresses.</li><li>Consider using <code>pg_listen: '${ip},${vip},${lo}'</code> to bind to specific IP address(es) for enhanced security.</li></ul><p><strong>Don&rsquo;t expose any ports directly to public IP, except infrastructure egress Nginx ports (default 80/443)</strong></p><ul><li>For convenience, components like Prometheus/Grafana listen on all IP addresses by default and can be accessed directly via public IP ports</li><li>You can modify their configurations to listen only on internal IP addresses, restricting access through the Nginx portal via domain names only. You can also use security groups or firewall rules to implement these security restrictions.</li><li>For convenience, Redis servers listen on all IP addresses by default. You can modify <a href=/docs/redis/param#redis_bind_address><strong><code>redis_bind_address</code></strong></a> to listen only on internal IP addresses.</li></ul><p><strong>Use <a href=/docs/pgsql/config/hba>HBA</a> to restrict postgres client access</strong></p><ul><li>There&rsquo;s a security-enhanced configuration template: <a href=https://github.com/pgsty/pigsty/blob/main/conf/demo/security.yml><code>security.yml</code></a></li></ul><p><strong>Restrict patroni management access: only infra/admin nodes can call control APIs</strong></p><ul><li>By default, this is restricted via <a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/oltp.yml#L109><code>restapi.allowlist</code></a>.</li></ul><br><hr><h3 id=network-traffic>Network Traffic</h3><p><strong>Use SSL and domain names to access infrastructure components through Nginx</strong></p><ul><li>Nginx SSL is controlled by <a href=/docs/infra/param#nginx_sslmode><strong><code>nginx_sslmode</code></strong></a>, default is <code>enable</code>.</li><li>Nginx domain names are specified by <a href=/docs/infra/param#infra_portal><strong><code>infra_portal</code></strong><code>.</code><component><code>.</code>domain</a>.</li></ul><p><strong>Use SSL to protect Patroni REST API</strong></p><ul><li><a href=/docs/pgsql/param#patroni_ssl_enabled><strong><code>patroni_ssl_enabled</code></strong></a> is disabled by default.</li><li>Because it affects health checks and API calls.</li><li>Note this is a global option; you must decide before deployment.</li></ul><p><strong>Use SSL to protect Pgbouncer client traffic</strong></p><ul><li><a href=/docs/pgsql/param#pgbouncer_sslmode><strong><code>pgbouncer_sslmode</code></strong></a> defaults to <code>disable</code></li><li>It has significant performance impact on Pgbouncer, so it&rsquo;s disabled by default.</li></ul><hr><h2 id=integrity>Integrity</h2><p><strong>Configure consistency-first mode for critical PostgreSQL database clusters (e.g., finance-related databases)</strong></p><ul><li><a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> database tuning template, using <code>crit.yml</code> will trade some availability for best data consistency.</li></ul><p><strong>Use crit node tuning template for better consistency.</strong></p><ul><li><a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a> host tuning template using <code>crit</code> can reduce dirty page ratio and lower data consistency risks.</li></ul><p><strong>Enable data checksums to detect silent data corruption.</strong></p><ul><li><a href=/docs/pgsql/param#pg_checksum><strong><code>pg_checksum</code></strong></a> defaults to <code>off</code>, but is recommended to enable.</li><li>When <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> = <code>crit.yml</code> is enabled, checksums are mandatory.</li></ul><p><strong>Log connection establishment/termination</strong></p><ul><li>This is disabled by default, but enabled by default in the <code>crit.yml</code> config template.</li><li>You can manually <a href=/docs/pgsql/admin#configure-cluster>configure the cluster</a> to enable <code>log_connections</code> and <code>log_disconnections</code> parameters.</li></ul><p><strong>Enable watchdog if you want to completely eliminate the possibility of split-brain during PG cluster failover</strong></p><ul><li>If your traffic goes through the recommended default HAProxy distribution, you won&rsquo;t encounter split-brain even without watchdog.</li><li>If your machine hangs and Patroni is killed with <code>kill -9</code>, watchdog can serve as a fallback: automatic shutdown on timeout.</li><li>It&rsquo;s best not to enable watchdog on infrastructure nodes.</li></ul><hr><h2 id=availability>Availability</h2><p><strong>Use sufficient nodes/instances for critical PostgreSQL database clusters</strong></p><ul><li>You need at least three nodes (able to tolerate one node failure) for production-grade high availability.</li><li>If you only have two nodes, you can tolerate specific standby node failures.</li><li>If you only have one node, use external S3/MinIO for cold backup and WAL archive storage.</li></ul><p><strong>For PostgreSQL, make trade-offs between availability and consistency</strong></p><ul><li><a href=/docs/pgsql/param#pg_rpo><strong><code>pg_rpo</code></strong></a> : <strong>Trade-off between availability and consistency</strong></li><li><a href=/docs/pgsql/param#pg_rto><strong><code>pg_rto</code></strong></a> : <strong>Trade-off between failure probability and impact</strong></li></ul><p><strong>Don&rsquo;t access databases directly via fixed IP addresses; use VIP, DNS, HAProxy, or combinations</strong></p><ul><li>Use HAProxy for service <a href=/docs/pgsql/service/#access-services>access</a></li><li>In case of failover/switchover, HAProxy will handle client traffic switching.</li></ul><p><strong>Use multiple infrastructure nodes in important production deployments (e.g., 1~3)</strong></p><ul><li>Small deployments or lenient scenarios can use a single infrastructure/admin node.</li><li>Large production deployments should have at least two infrastructure nodes as mutual backup.</li></ul><p><strong>Use sufficient etcd server instances, and use an odd number of instances (1,3,5,7)</strong></p><ul><li>See <a href=/docs/etcd#administration>ETCD Administration</a> for details.</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email - Vonng" aria-label="Email - Vonng"><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label="Email - Vonng"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=WeChat aria-label=WeChat><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=WeChat><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=Discussion><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Repo aria-label=Repo><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=Repo><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>