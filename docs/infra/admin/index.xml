<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Administration on PIGSTY</title><link>https://pigsty.io/docs/infra/admin/</link><description>Recent content in Administration on PIGSTY</description><generator>Hugo</generator><language>en</language><atom:link href="https://pigsty.io/docs/infra/admin/index.xml" rel="self" type="application/rss+xml"/><item><title>Ansible</title><link>https://pigsty.io/docs/infra/admin/ansible/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/ansible/</guid><description>&lt;p&gt;Ansible is installed by default on all INFRA nodes and can be used to manage the entire deployment.&lt;/p&gt;
&lt;p&gt;Pigsty implements automation based on &lt;strong&gt;Ansible&lt;/strong&gt;, following the &lt;strong&gt;Infrastructure-as-Code&lt;/strong&gt; philosophy.&lt;/p&gt;
&lt;p&gt;Ansible knowledge is useful for managing databases and infrastructure, but &lt;strong&gt;not required&lt;/strong&gt;. You only need to know how to execute &lt;strong&gt;Playbooks&lt;/strong&gt; - YAML files that define a series of automated tasks.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="installation"&gt;Installation&lt;/h2&gt;
&lt;p&gt;Pigsty automatically installs &lt;code&gt;ansible&lt;/code&gt; and its dependencies during the &lt;a href="https://pigsty.io/docs/setup/install#bootstrap"&gt;bootstrap process&lt;/a&gt;.
For manual installation, use the following commands:&lt;/p&gt;</description></item><item><title>Playbooks</title><link>https://pigsty.io/docs/infra/admin/playbook/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/playbook/</guid><description>&lt;p&gt;Pigsty uses &lt;strong&gt;idempotent&lt;/strong&gt; Ansible playbooks for management and control. Running playbooks requires &lt;code&gt;ansible-playbook&lt;/code&gt; to be in the system PATH; users must first &lt;a href="./ansible/#installation"&gt;install Ansible&lt;/a&gt; before executing playbooks.&lt;/p&gt;
&lt;h2 id="available-playbooks"&gt;Available Playbooks&lt;/h2&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;Module&lt;/th&gt;
 &lt;th&gt;Playbook&lt;/th&gt;
 &lt;th&gt;Purpose&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;INFRA&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;deploy.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;One-click Pigsty installation&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;INFRA&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;infra.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Initialize Pigsty infrastructure on infra nodes&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;INFRA&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;infra-rm.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Remove infrastructure components from infra nodes&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;INFRA&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;cache.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Create offline installation packages from target nodes&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;INFRA&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;cert.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Issue certificates using Pigsty self-signed CA&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;NODE&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;node.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Initialize nodes, configure to desired state&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;NODE&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;node-rm.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Remove nodes from Pigsty&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pgsql.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Initialize HA PostgreSQL cluster, or add new replica&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pgsql-rm.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Remove PostgreSQL cluster, or remove replica&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pgsql-db.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Add new business database to existing cluster&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pgsql-user.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Add new business user to existing cluster&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pgsql-pitr.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Perform point-in-time recovery (PITR) on cluster&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pgsql-monitor.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Monitor remote PostgreSQL using local exporters&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pgsql-migration.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Generate migration manual and scripts for PostgreSQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PGSQL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;slim.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Install Pigsty with minimal components&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;REDIS&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;redis.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Initialize Redis cluster/node/instance&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;REDIS&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;redis-rm.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Remove Redis cluster/node/instance&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ETCD&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;etcd.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Initialize ETCD cluster, or add new member&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ETCD&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;etcd-rm.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Remove ETCD cluster, or remove existing member&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;MINIO&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;minio.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Initialize MinIO cluster&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;MINIO&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;minio-rm.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Remove MinIO cluster&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;DOCKER&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;docker.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Install Docker on nodes&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;DOCKER&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;app.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Install applications using Docker Compose&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;FERRET&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;mongo.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Install Mongo/FerretDB on nodes&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="deployment-strategy"&gt;Deployment Strategy&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;deploy.yml&lt;/code&gt; playbook orchestrates specialized playbooks in the following group order for complete deployment:&lt;/p&gt;</description></item><item><title>Nginx Management</title><link>https://pigsty.io/docs/infra/admin/portal/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/portal/</guid><description>&lt;p&gt;Pigsty installs Nginx on INFRA nodes as the entry point for all web services, listening on standard ports 80/443.&lt;/p&gt;
&lt;p&gt;In Pigsty, you can configure Nginx to provide various services through inventory:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Expose web interfaces for monitoring components like Grafana, VictoriaMetrics (VMUI), Alertmanager, and VictoriaLogs&lt;/li&gt;
&lt;li&gt;Serve static files (software repos, documentation sites, websites, etc.)&lt;/li&gt;
&lt;li&gt;Proxy custom application services (internal apps, database management UIs, Docker application interfaces, etc.)&lt;/li&gt;
&lt;li&gt;Automatically issue self-signed HTTPS certificates, or use Certbot to obtain free Let&amp;rsquo;s Encrypt certificates&lt;/li&gt;
&lt;li&gt;Expose services through a single port using different subdomains for unified access&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="basic-configuration"&gt;Basic Configuration&lt;/h2&gt;
&lt;p&gt;Customize Nginx behavior via &lt;a href="https://pigsty.io/docs/infra/param#infra_portal"&gt;&lt;code&gt;infra_portal&lt;/code&gt;&lt;/a&gt; parameter:&lt;/p&gt;</description></item><item><title>Software Repository</title><link>https://pigsty.io/docs/infra/admin/repo/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/repo/</guid><description>&lt;p&gt;Pigsty supports creating and managing local APT/YUM software repositories for offline deployment or accelerated package installation.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="quick-start"&gt;Quick Start&lt;/h2&gt;
&lt;p&gt;To add packages to the local repository:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Add packages to &lt;a href="../param/#repo_packages"&gt;&lt;code&gt;repo_packages&lt;/code&gt;&lt;/a&gt; (default packages)&lt;/li&gt;
&lt;li&gt;Add packages to &lt;a href="../param/#repo_extra_packages"&gt;&lt;code&gt;repo_extra_packages&lt;/code&gt;&lt;/a&gt; (extra packages)&lt;/li&gt;
&lt;li&gt;Run the build command:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_build &lt;span style="color:#8f5902;font-style:italic"&gt;# Build local repo from upstream&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./node.yml -t node_repo &lt;span style="color:#8f5902;font-style:italic"&gt;# Refresh node repository cache&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="package-aliases"&gt;Package Aliases&lt;/h2&gt;
&lt;p&gt;Pigsty predefines common package combinations for batch installation:&lt;/p&gt;
&lt;h3 id="el-systems-rhelcentosrocky"&gt;EL Systems (RHEL/CentOS/Rocky)&lt;/h3&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;Alias&lt;/th&gt;
 &lt;th&gt;Description&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;node-bootstrap&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Ansible, Python3 tools, SSH related&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;infra-package&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Nginx, etcd, HAProxy, monitoring exporters, MinIO&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;pgsql-utility&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Patroni, pgBouncer, pgBackRest, PG tools&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;pgsql&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Full PostgreSQL (server, client, extensions)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;pgsql-mini&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Minimal PostgreSQL installation&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="debianubuntu-systems"&gt;Debian/Ubuntu Systems&lt;/h3&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;Alias&lt;/th&gt;
 &lt;th&gt;Description&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;node-bootstrap&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Ansible, development tools&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;infra-package&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Infrastructure components (Debian naming)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;pgsql-client&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;PostgreSQL client&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;pgsql-server&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;PostgreSQL server and related packages&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="playbook-tasks"&gt;Playbook Tasks&lt;/h2&gt;
&lt;h3 id="main-tasks"&gt;Main Tasks&lt;/h3&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;Task&lt;/th&gt;
 &lt;th&gt;Description&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;repo&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Create local repo from internet or offline packages&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;repo_build&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Build from upstream if not exists&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;repo_upstream&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Add upstream repository files&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;repo_pkg&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Download packages and dependencies&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;repo_create&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Create/update YUM or APT repository&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;repo_nginx&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Start Nginx file server&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="complete-task-list"&gt;Complete Task List&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_dir &lt;span style="color:#8f5902;font-style:italic"&gt;# Create local repository directory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_check &lt;span style="color:#8f5902;font-style:italic"&gt;# Check if local repo exists&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_prepare &lt;span style="color:#8f5902;font-style:italic"&gt;# Use existing repo directly&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_build &lt;span style="color:#8f5902;font-style:italic"&gt;# Build repo from upstream&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_upstream &lt;span style="color:#8f5902;font-style:italic"&gt;# Add upstream repositories&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_remove &lt;span style="color:#8f5902;font-style:italic"&gt;# Delete existing repo files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_add &lt;span style="color:#8f5902;font-style:italic"&gt;# Add repo to system directory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_url_pkg &lt;span style="color:#8f5902;font-style:italic"&gt;# Download packages from internet&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_cache &lt;span style="color:#8f5902;font-style:italic"&gt;# Create metadata cache&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_boot_pkg &lt;span style="color:#8f5902;font-style:italic"&gt;# Install bootstrap packages&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_pkg &lt;span style="color:#8f5902;font-style:italic"&gt;# Download packages and dependencies&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_create &lt;span style="color:#8f5902;font-style:italic"&gt;# Create local repository&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_use &lt;span style="color:#8f5902;font-style:italic"&gt;# Add new repo to system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_nginx &lt;span style="color:#8f5902;font-style:italic"&gt;# Start Nginx file server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="common-operations"&gt;Common Operations&lt;/h2&gt;
&lt;h3 id="add-new-packages"&gt;Add New Packages&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 1. Configure upstream repositories&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_upstream
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 2. Download packages and dependencies&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_pkg
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 3. Build local repository metadata&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo_create
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="refresh-node-repositories"&gt;Refresh Node Repositories&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./node.yml -t node_repo &lt;span style="color:#8f5902;font-style:italic"&gt;# Refresh repository cache on all nodes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="complete-repository-rebuild"&gt;Complete Repository Rebuild&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml -t repo &lt;span style="color:#8f5902;font-style:italic"&gt;# Create repo from internet or offline packages&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Domain Management</title><link>https://pigsty.io/docs/infra/admin/domain/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/domain/</guid><description>&lt;p&gt;Use domain names instead of IP addresses to access Pigsty&amp;rsquo;s various web services.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="quick-start"&gt;Quick Start&lt;/h2&gt;
&lt;p&gt;Add the following static resolution records to &lt;code&gt;/etc/hosts&lt;/code&gt;:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;10.10.10.10 i.pigsty g.pigsty p.pigsty a.pigsty
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Replace IP address with your actual Pigsty node&amp;rsquo;s IP.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="why-use-domain-names"&gt;Why Use Domain Names&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Easier to remember than IP addresses&lt;/li&gt;
&lt;li&gt;Flexible pointing to different IPs&lt;/li&gt;
&lt;li&gt;Unified service management through Nginx&lt;/li&gt;
&lt;li&gt;Support for HTTPS encryption&lt;/li&gt;
&lt;li&gt;Prevent ISP hijacking in some regions&lt;/li&gt;
&lt;li&gt;Allow access to internally bound services via proxy&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="dns-mechanism"&gt;DNS Mechanism&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;DNS Protocol&lt;/strong&gt;: Resolves domain names to IP addresses. Multiple domains can point to same IP.&lt;/p&gt;</description></item><item><title>Module Management</title><link>https://pigsty.io/docs/infra/admin/sop/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/sop/</guid><description>&lt;p&gt;This document covers daily management operations for the INFRA module, including installation, uninstallation, scaling, and component maintenance.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="install-infra-module"&gt;Install INFRA Module&lt;/h2&gt;
&lt;p&gt;Use the &lt;a href="https://pigsty.io/docs/infra/playbook/#infrayml"&gt;&lt;code&gt;infra.yml&lt;/code&gt;&lt;/a&gt; playbook to install the INFRA module on the &lt;code&gt;infra&lt;/code&gt; group:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# Install INFRA module on infra group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="uninstall-infra-module"&gt;Uninstall INFRA Module&lt;/h2&gt;
&lt;p&gt;Use the &lt;a href="https://pigsty.io/docs/infra/playbook/#infra-rmyml"&gt;&lt;code&gt;infra-rm.yml&lt;/code&gt;&lt;/a&gt; playbook to uninstall the INFRA module from the &lt;code&gt;infra&lt;/code&gt; group:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./infra-rm.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# Uninstall INFRA module from infra group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="scale-out-infra-module"&gt;Scale Out INFRA Module&lt;/h2&gt;
&lt;p&gt;Assign &lt;a href="https://pigsty.io/docs/infra/param/#infra_seq"&gt;&lt;code&gt;infra_seq&lt;/code&gt;&lt;/a&gt; to new nodes and add them to the &lt;code&gt;infra&lt;/code&gt; group in the inventory:&lt;/p&gt;</description></item><item><title>CA and Certificates</title><link>https://pigsty.io/docs/infra/admin/cert/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/cert/</guid><description>&lt;p&gt;Pigsty uses a &lt;strong&gt;self-signed Certificate Authority (CA)&lt;/strong&gt; by default for internal SSL/TLS encryption. This document covers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#self-signed-ca"&gt;Self-Signed CA&lt;/a&gt;: Default PKI infrastructure&lt;/li&gt;
&lt;li&gt;&lt;a href="#issue-certificates"&gt;Issue Certificates&lt;/a&gt;: Using &lt;code&gt;cert.yml&lt;/code&gt; to issue additional certificates&lt;/li&gt;
&lt;li&gt;&lt;a href="#trust-ca-certificate"&gt;Trust CA Certificate&lt;/a&gt;: Installing CA on client machines&lt;/li&gt;
&lt;li&gt;&lt;a href="#lets-encrypt"&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt;: Using real certificates for public-facing services&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="self-signed-ca"&gt;Self-Signed CA&lt;/h2&gt;
&lt;p&gt;Pigsty automatically creates a self-signed CA during infrastructure initialization (&lt;code&gt;infra.yml&lt;/code&gt;). The CA signs certificates for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PostgreSQL server/client SSL&lt;/li&gt;
&lt;li&gt;Patroni REST API&lt;/li&gt;
&lt;li&gt;etcd cluster communication&lt;/li&gt;
&lt;li&gt;MinIO cluster communication&lt;/li&gt;
&lt;li&gt;Nginx HTTPS (fallback)&lt;/li&gt;
&lt;li&gt;Infrastructure services&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="pki-directory-structure"&gt;PKI Directory Structure&lt;/h3&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;files/pki/
├── ca/
│ ├── ca.key # CA private key (keep secure!)
│ └── ca.crt # CA certificate
├── csr/ # Certificate signing requests
│ ├── misc/ # Miscellaneous certificates (cert.yml output)
│ ├── etcd/ # ETCD certificates
│ ├── pgsql/ # PostgreSQL certificates
│ ├── minio/ # MinIO certificates
│ ├── nginx/ # Nginx certificates
│ └── mongo/ # FerretDB certificates
└── infra/ # Infrastructure certificates
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="ca-variables"&gt;CA Variables&lt;/h3&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;Variable&lt;/th&gt;
 &lt;th&gt;Default&lt;/th&gt;
 &lt;th&gt;Description&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;ca_create&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Create CA if not exists, or abort&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;ca_cn&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pigsty-ca&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;CA certificate common name&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;cert_validity&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;7300d&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Default validity for issued certificates&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;/td&gt;
 &lt;td&gt;Variable&lt;/td&gt;
 &lt;td&gt;Default&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;:&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-&lt;/td&gt;
 &lt;td&gt;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;&lt;/td&gt;
 &lt;td&gt;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;CA Certificate&lt;/td&gt;
 &lt;td&gt;100 years&lt;/td&gt;
 &lt;td&gt;Hardcoded (36500 days)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;Server/Client&lt;/td&gt;
 &lt;td&gt;20 years&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;cert_validity&lt;/code&gt; (7300d)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;Nginx HTTPS&lt;/td&gt;
 &lt;td&gt;~1 year&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;nginx_cert_validity&lt;/code&gt; (397d)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&amp;gt; &lt;strong&gt;Note&lt;/strong&gt;: Browser vendors limit trust to 398-day certificates. Nginx uses shorter validity for browser compatibility.&lt;/td&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="using-external-ca"&gt;Using External CA&lt;/h2&gt;
&lt;p&gt;To use your own enterprise CA instead of auto-generated one:&lt;/p&gt;</description></item><item><title>Grafana High Availability: Using PostgreSQL Backend</title><link>https://pigsty.io/docs/infra/admin/grafana/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/infra/admin/grafana/</guid><description>&lt;p&gt;You can use PostgreSQL as Grafana&amp;rsquo;s backend database.&lt;/p&gt;
&lt;p&gt;This is a great opportunity to understand Pigsty&amp;rsquo;s deployment system. By completing this tutorial, you&amp;rsquo;ll learn:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How to &lt;a href="#create-database-cluster"&gt;create a new database cluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;How to &lt;a href="#create-grafana-business-user"&gt;create new business users&lt;/a&gt; in an existing cluster&lt;/li&gt;
&lt;li&gt;How to &lt;a href="#create-grafana-business-database"&gt;create new business databases&lt;/a&gt; in an existing cluster&lt;/li&gt;
&lt;li&gt;How to &lt;a href="#use-grafana-business-database"&gt;access databases&lt;/a&gt; created by Pigsty&lt;/li&gt;
&lt;li&gt;How to &lt;a href="#manage-grafana-dashboards"&gt;manage Grafana dashboards&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;How to manage &lt;a href="#manage-postgres-datasources"&gt;PostgreSQL datasources&lt;/a&gt; in Grafana&lt;/li&gt;
&lt;li&gt;How to &lt;a href="#one-step-grafana-upgrade"&gt;upgrade Grafana database&lt;/a&gt; in one step&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="tldr"&gt;TL;DR&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;vi pigsty.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# Uncomment DB/User definitions: dbuser_grafana grafana&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;bin/pgsql-user pg-meta dbuser_grafana
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;bin/pgsql-db pg-meta grafana
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;psql postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana -c &lt;span style="color:#4e9a06"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#4e9a06"&gt;&amp;#39;CREATE TABLE t(); DROP TABLE t;&amp;#39;&lt;/span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;# Verify connection string works&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;vi /etc/grafana/grafana.ini &lt;span style="color:#8f5902;font-style:italic"&gt;# Modify [database] type url&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;systemctl restart grafana-server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="create-database-cluster"&gt;Create Database Cluster&lt;/h2&gt;
&lt;p&gt;We can define a new database &lt;code&gt;grafana&lt;/code&gt; on &lt;code&gt;pg-meta&lt;/code&gt;, or create a dedicated Grafana database cluster &lt;code&gt;pg-grafana&lt;/code&gt; on new nodes.&lt;/p&gt;</description></item></channel></rss>