<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Configuration on PIGSTY</title><link>https://pigsty.io/docs/pgsql/config/</link><description>Recent content in Configuration on PIGSTY</description><generator>Hugo</generator><language>en</language><atom:link href="https://pigsty.io/docs/pgsql/config/index.xml" rel="self" type="application/rss+xml"/><item><title>Cluster / Instance</title><link>https://pigsty.io/docs/pgsql/config/cluster/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/pgsql/config/cluster/</guid><description>&lt;blockquote&gt;
&lt;p&gt;Choose the appropriate instance and cluster types based on your requirements to configure PostgreSQL database clusters that meet your needs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You can define different types of instances and clusters. Here are several common PostgreSQL instance/cluster types in Pigsty:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#primary"&gt;Primary&lt;/a&gt;: Define a single instance cluster.&lt;/li&gt;
&lt;li&gt;&lt;a href="#replica"&gt;Replica&lt;/a&gt;: Define a basic HA cluster with one primary and one replica.&lt;/li&gt;
&lt;li&gt;&lt;a href="#offline"&gt;Offline&lt;/a&gt;: Define an instance dedicated to OLAP/ETL/interactive queries&lt;/li&gt;
&lt;li&gt;&lt;a href="#sync-standby"&gt;Sync Standby&lt;/a&gt;: Enable synchronous commit to ensure no data loss.&lt;/li&gt;
&lt;li&gt;&lt;a href="#quorum-commit"&gt;Quorum Commit&lt;/a&gt;: Use quorum sync commit for a higher consistency level.&lt;/li&gt;
&lt;li&gt;&lt;a href="#standby-cluster"&gt;Standby Cluster&lt;/a&gt;: Clone an existing cluster and follow it&lt;/li&gt;
&lt;li&gt;&lt;a href="#delayed-cluster"&gt;Delayed Cluster&lt;/a&gt;: Clone an existing cluster for emergency data recovery&lt;/li&gt;
&lt;li&gt;&lt;a href="#citus-cluster"&gt;Citus Cluster&lt;/a&gt;: Define a Citus distributed database cluster&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="primary"&gt;Primary&lt;/h2&gt;
&lt;p&gt;We start with the simplest case: a single instance cluster consisting of one primary:&lt;/p&gt;</description></item><item><title>Kernel Version</title><link>https://pigsty.io/docs/pgsql/config/kernel/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/pgsql/config/kernel/</guid><description>&lt;blockquote&gt;
&lt;p&gt;Choosing a &amp;ldquo;kernel&amp;rdquo; in Pigsty means determining the PostgreSQL major version, mode/distribution, packages to install, and tuning templates to load.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pigsty supports PostgreSQL from version 10 onwards. The current version packages core software for versions 13-18 by default and provides a complete extension set for 17/18. The following content shows how to make these choices through configuration files.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="major-version-and-packages"&gt;Major Version and Packages&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pg_version&lt;/code&gt;: Specify the PostgreSQL major version (default 18). Pigsty will automatically map to the correct package name prefix based on the version.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_packages&lt;/code&gt;: Define the core package set to install, supports using &lt;a href="https://pigsty.io/docs/pgsql/config/alias"&gt;package aliases&lt;/a&gt; (default &lt;code&gt;pgsql-main pgsql-common&lt;/code&gt;, includes kernel + patroni/pgbouncer/pgbackrest and other common tools).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_extensions&lt;/code&gt;: List of additional extension packages to install, also supports aliases; defaults to empty meaning only core dependencies are installed.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;all&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_version&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;17&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pgsql-main pgsql-common ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;postgis, timescaledb, pgvector, pgml ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;Effect: Ansible will pull packages corresponding to &lt;code&gt;pg_version=17&lt;/code&gt; during installation, pre-install extensions to the system, and database initialization scripts can then directly &lt;code&gt;CREATE EXTENSION&lt;/code&gt;.&lt;/p&gt;</description></item><item><title>Package Alias</title><link>https://pigsty.io/docs/pgsql/config/alias/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/pgsql/config/alias/</guid><description>&lt;p&gt;PostgreSQL package naming conventions vary significantly across different operating systems:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;EL systems&lt;/strong&gt; (RHEL/Rocky/Alma/&amp;hellip;) use formats like &lt;code&gt;pgvector_17&lt;/code&gt;, &lt;code&gt;postgis36_17*&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Debian/Ubuntu systems&lt;/strong&gt; use formats like &lt;code&gt;postgresql-17-pgvector&lt;/code&gt;, &lt;code&gt;postgresql-17-postgis-3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This difference adds cognitive burden to users: you need to remember different package name rules for different systems, and handle the embedding of PostgreSQL version numbers.&lt;/p&gt;
&lt;h2 id="package-alias"&gt;Package Alias&lt;/h2&gt;
&lt;p&gt;Pigsty solves this problem through the &lt;strong&gt;Package Alias&lt;/strong&gt; mechanism: you only need to use unified aliases, and Pigsty will handle all the details:&lt;/p&gt;</description></item><item><title>User/Role</title><link>https://pigsty.io/docs/pgsql/config/user/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/pgsql/config/user/</guid><description>&lt;blockquote&gt;
&lt;p&gt;In this document, &amp;ldquo;user&amp;rdquo; refers to a logical object within a database cluster created with &lt;code&gt;CREATE USER/ROLE&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In PostgreSQL, users belong directly to the database cluster rather than a specific database. Therefore, when creating business databases and users, follow the principle of &amp;ldquo;users first, databases later&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Pigsty defines roles and users through two config parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://pigsty.io/docs/pgsql/param#pg_default_roles"&gt;&lt;strong&gt;&lt;code&gt;pg_default_roles&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;: Define globally shared roles and users&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.io/docs/pgsql/param#pg_users"&gt;&lt;strong&gt;&lt;code&gt;pg_users&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;: Define business users and roles at cluster level&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The former defines roles/users shared across the entire environment; the latter defines business roles/users specific to a single cluster. Both have the same format as arrays of user definition objects.
Users/roles are created sequentially in array order, so later users can belong to roles defined earlier.&lt;/p&gt;</description></item><item><title>Database</title><link>https://pigsty.io/docs/pgsql/config/db/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/pgsql/config/db/</guid><description>&lt;blockquote&gt;
&lt;p&gt;In this document, &amp;ldquo;database&amp;rdquo; refers to a logical object within a database cluster created with &lt;code&gt;CREATE DATABASE&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A PostgreSQL cluster can serve multiple &lt;strong&gt;databases&lt;/strong&gt; simultaneously. In Pigsty, you can &lt;a href="#define-database"&gt;&lt;strong&gt;define&lt;/strong&gt;&lt;/a&gt; required databases in cluster configuration.&lt;/p&gt;
&lt;p&gt;Pigsty customizes the &lt;code&gt;template1&lt;/code&gt; template database - creating default schemas, installing default extensions, configuring default privileges. Newly created databases inherit these settings from &lt;code&gt;template1&lt;/code&gt;.
You can also specify other template databases via &lt;a href="#template"&gt;&lt;strong&gt;&lt;code&gt;template&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; for instant &lt;a href="https://pigsty.io/docs/pgsql/admin/db#clone-database"&gt;&lt;strong&gt;database cloning&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;By default, all business databases are 1:1 added to &lt;a href="https://pigsty.io/docs/concept/arch/pgsql#pgbouncer"&gt;&lt;strong&gt;Pgbouncer&lt;/strong&gt;&lt;/a&gt; &lt;a href="#connection-pool"&gt;&lt;strong&gt;connection pool&lt;/strong&gt;&lt;/a&gt;; &lt;a href="https://pigsty.io/docs/concept/arch/pgsql#pg_exporter"&gt;&lt;strong&gt;&lt;code&gt;pg_exporter&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; auto-discovers all business databases for in-database object monitoring.
All databases are also registered as PostgreSQL datasources in &lt;a href="https://pigsty.io/docs/concept/arch/infra#grafana"&gt;&lt;strong&gt;Grafana&lt;/strong&gt;&lt;/a&gt; on all &lt;a href="https://pigsty.io/docs/concept/arch/node#infra-node"&gt;&lt;strong&gt;INFRA nodes&lt;/strong&gt;&lt;/a&gt; for PGCAT dashboards.&lt;/p&gt;</description></item><item><title>HBA Rules</title><link>https://pigsty.io/docs/pgsql/config/hba/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/pgsql/config/hba/</guid><description>&lt;h2 id="overview"&gt;Overview&lt;/h2&gt;
&lt;p&gt;HBA (Host-Based Authentication) controls &amp;ldquo;who can connect to the database from where and how&amp;rdquo;.
Pigsty manages HBA rules declaratively through &lt;a href="#pg_default_hba_rules"&gt;&lt;strong&gt;&lt;code&gt;pg_default_hba_rules&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; and &lt;a href="#pg_hba_rules"&gt;&lt;strong&gt;&lt;code&gt;pg_hba_rules&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Pigsty renders the following config files during cluster init or HBA refresh:&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;Config File&lt;/th&gt;
 &lt;th style="text-align: left"&gt;Path&lt;/th&gt;
 &lt;th style="text-align: left"&gt;Description&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL HBA&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;/pg/data/pg_hba.conf&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL server HBA rules&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;Pgbouncer HBA&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;/etc/pgbouncer/pgb_hba.conf&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Connection pool HBA rules&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;HBA rules are controlled by these parameters:&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;Parameter&lt;/th&gt;
 &lt;th style="text-align: left"&gt;Level&lt;/th&gt;
 &lt;th style="text-align: left"&gt;Description&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pg_default_hba_rules"&gt;&lt;code&gt;pg_default_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL global default HBA&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pg_hba_rules"&gt;&lt;code&gt;pg_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G/C/I&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL cluster/instance add&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgb_default_hba_rules"&gt;&lt;code&gt;pgb_default_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pgbouncer global default HBA&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgb_hba_rules"&gt;&lt;code&gt;pgb_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G/C/I&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pgbouncer cluster/instance add&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Rule features:&lt;/p&gt;</description></item><item><title>Access Control</title><link>https://pigsty.io/docs/pgsql/config/acl/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.io/docs/pgsql/config/acl/</guid><description>&lt;blockquote&gt;
&lt;p&gt;Access control is determined by the combination of &amp;ldquo;role system + privilege templates + HBA&amp;rdquo;. This section focuses on how to declare roles and object privileges through configuration parameters.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pigsty provides a streamlined ACL model, fully described by the following parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pg_default_roles&lt;/code&gt;: System roles and system users.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_users&lt;/code&gt;: Business users and roles.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_default_privileges&lt;/code&gt;: Default privileges for objects created by administrators/owners.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_revoke_public&lt;/code&gt;, &lt;code&gt;pg_default_schemas&lt;/code&gt;, &lt;code&gt;pg_default_extensions&lt;/code&gt;: Control the default behavior of &lt;code&gt;template1&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;After understanding these parameters, you can write fully reproducible privilege configurations.&lt;/p&gt;</description></item></channel></rss>